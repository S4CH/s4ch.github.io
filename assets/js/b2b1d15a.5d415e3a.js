"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[7318],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>k});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),h=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=h(e.components);return n.createElement(l.Provider,{value:t},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=h(a),d=o,k=u["".concat(l,".").concat(d)]||u[d]||c[d]||i;return a?n.createElement(k,r(r({ref:t},p),{},{components:a})):n.createElement(k,r({ref:t},p))}));function k(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:o,r[1]=s;for(var h=2;h<i;h++)r[h]=a[h];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},27184:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>h});var n=a(87462),o=(a(67294),a(3905));const i={},r="Authenticate",s={unversionedId:"Tryhackme/Authenticate/Authenticate",id:"Tryhackme/Authenticate/Authenticate",title:"Authenticate",description:"Learn how to attack authentication mechanisms used in web applications",source:"@site/writeups/Tryhackme/Authenticate/Authenticate.md",sourceDirName:"Tryhackme/Authenticate",slug:"/Tryhackme/Authenticate/",permalink:"/writeups/Tryhackme/Authenticate/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Attacktive Directory",permalink:"/writeups/Tryhackme/Attacktive Directory/"},next:{title:"Avengers Blog",permalink:"/writeups/Tryhackme/Avengers Blog/"}},l={},h=[{value:"\ud83d\udca2 We will cover  the topics",id:"-we-will-cover--the-topics",level:2},{value:"Task 1 Deploy the VM",id:"task-1-deploy-the-vm",level:2},{value:"Task 2 Dictionary attack",id:"task-2-dictionary-attack",level:2},{value:"Task 3 Re-registration",id:"task-3-re-registration",level:2},{value:"Task 4 JSON Web Token",id:"task-4-json-web-token",level:2},{value:"Task 5 No Auth",id:"task-5-no-auth",level:2}],p={toc:h},u="wrapper";function c(e){let{components:t,...a}=e;return(0,o.kt)(u,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"authenticate"},"Authenticate"),(0,o.kt)("p",null,"Learn how to attack authentication mechanisms used in web applications"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/authenticate"},"Authenticate")),(0,o.kt)("h2",{id:"-we-will-cover--the-topics"},"\ud83d\udca2 We will cover  the topics"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Brute Force (http-post-form)"),(0,o.kt)("li",{parentName:"ul"},"Re-registration"),(0,o.kt)("li",{parentName:"ul"},"JSON Web Token")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"task-1-deploy-the-vm"},"Task 1 Deploy the VM"),(0,o.kt)("p",null,"In today's time, the use of the authentication system is increasing because of the increase in the number of services that are coming up on the internet. But not everyone knows how to either make proper authentication software or how to properly set up one."),(0,o.kt)("p",null,"The aim of this room is to teach how to find authentication bugs and how you can exploit them."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Deploy the VM")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("h2",{id:"task-2-dictionary-attack"},"Task 2 Dictionary attack"),(0,o.kt)("p",null,"The very obvious method of attacking any login form is just to brute force the credentials. But in this kind of brute force, we don't simply try numbers or simple alphabets. What we do is take an existing dictionary of commonly used username/passwords and use those to see if we can find the right combination. This is known as ",(0,o.kt)("strong",{parentName:"p"},"Dictionary Attack"),"."),(0,o.kt)("p",null,"To perform a dictionary attack we can use a lot of tools like Hydra or Medusa but the issue with these CLI tools is that we need to provide a lot of arguments to them started and that could be confusing. That is why when trying a dictionary attack on a web application/form it's better to use Burp Suite. In Burp we can capture the login request and then use intruder to perform the attack."),(0,o.kt)("p",null,"If you are not familiar with burp suite then I would recommend that you first complete the ",(0,o.kt)("strong",{parentName:"p"},"Learn Burp Suite")," room.\nNow let me show you an example using the Burp Suite:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Connect on port 8888"),(0,o.kt)("li",{parentName:"ol"},"Now while the ",(0,o.kt)("strong",{parentName:"li"},"Capture")," is ",(0,o.kt)("strong",{parentName:"li"},"On")," in burp suite, enter any values you like in the username and password field."),(0,o.kt)("li",{parentName:"ol"},"Send this request to the intruder and for the position of the payload, we are just going to guess the password for the user jack. For payload, you can use any know default password list or maybe load a part of rockYou.")),(0,o.kt)("p",null,"Note: Here I know that there exists a user named jack and that is why I am using that. In a real-life scenario, you might have to guess both the username and password."),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Start the attack and wait for a bit. If you did everything correctly you'll notice that one of the requests sent by an intruder will have a bigger response then all of the others.")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/yv973xd.png",alt:null})),(0,o.kt)("p",null,"As you can see in the above screenshot that on the 5th request the length value is ",(0,o.kt)("strong",{parentName:"p"},"530")," and the length of the content in other requests is 480. This could mean that the burp was able to successfully login in ",(0,o.kt)("strong",{parentName:"p"},"Jack's")," account using the password ",(0,o.kt)("strong",{parentName:"p"},"12345678"),"."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"What is the flag you found after logging as Jack?")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"fad9ddc1feebd9e9bca05f02dd89e271")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Now try the same thing for username mike.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"What is the flag you found after logging as Mike?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'kali@kali:~/CTFs/tryhackme/Authenticate$ hydra -l mike -P /usr/share/wordlists/rockyou.txt "http-post-form://10.10.7.33:8888/login:user=^USER^&password=^PASS^:Invalid"\nHydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.\n\nHydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-11-07 16:55:08\n[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task\n[DATA] attacking http-post-form://10.10.7.33:8888/login:user=^USER^&password=^PASS^:Invalid\n[8888][http-post-form] host: 10.10.7.33   login: mike   password: 12345\n1 of 1 target successfully completed, 1 valid password found\nHydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-11-07 16:55:17\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"e1faaa144df2f24aa0a9284f4a5bb578")),(0,o.kt)("h2",{id:"task-3-re-registration"},"Task 3 Re-registration"),(0,o.kt)("p",null,"In the previous task, we saw that it is possible to just simply guess/brute force the password with the help of a password dictionary. In this task, we are going to focus on a vulnerability that is unique in its own way."),(0,o.kt)("p",null,"A lot of times what happens is that developer forgets to sanitize the input(username & password) given by the user in the code of their application which can make them vulnerable to things like SQL injection but SQLi could be a bit difficult to exploit. So we are going to focus on a vulnerability that happens because of a developer's mistake but is very easy to exploit i.e re-registration of an existing user."),(0,o.kt)("p",null,"Let's understand this with the help of an example, say there is an existing user with the name ",(0,o.kt)("strong",{parentName:"p"},"admin"),' and now we want to get access to their account so what we can do is try to re-register that username but with slight modification. We are going to enter " admin"(notice the space in the starting). Now when you enter that in the username field and enter other required information like email id or password and submit that data. It will actually register a new user but that user will have the same right as normal admin. And that new user will also be able to see all the content present under the user ',(0,o.kt)("strong",{parentName:"p"},"admin"),"."),(0,o.kt)("p",null,"To see this in action go to port ",(0,o.kt)("strong",{parentName:"p"},"8888")," and try to register a user name ",(0,o.kt)("strong",{parentName:"p"},"darren"),", you'll see that user already exists so then try to register a user \" darren\" and you'll see that you are now logged in and will be able to see the content present only in Darren's account which in our case is the flag that you need to retrieve."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"What is the flag that you found in darren's account?")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"fe86079416a21a3c99937fea8874b667")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Now try to do the same trick and see if you can login as arthur.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"What is the flag that you found in arthur's account?")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"d9ac0f7db4fda460ac3edeb75d75e16e")),(0,o.kt)("h2",{id:"task-4-json-web-token"},"Task 4 JSON Web Token"),(0,o.kt)("p",null,"JSON Web Token(JWT) is one of the commonly used methods for authorization. This is a kind of cookie that is generated using HMAC hashing or public/private keys. So unlike any other kind of cookie, it lets the website know what kind of access the currently logged in user has. The only special thing about JWT is that they are in JSON format(after decoding)."),(0,o.kt)("p",null,"JWT can be divided into 3 parts separated by a dot(.)"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Header"),": This consists of the algorithm used and the type of the token.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},'{ "alg": "HS256", "typ": "JWT"}')),(0,o.kt)("p",null,"alg could be HMAC, RSA, SHA256 or can even contain None value."),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Payload"),": This is part that contains the access given to the certain user etc. This can vary from website to website, some can just have a simple username and some ID and others could have a lot of other details."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Signature"),": This is the part that is used to make sure that the integrity of the data was maintained while transferring it from a user's computer to the server and back. This is encrypted with whatever algorithm or alg that was passed in the header's value. And this can only be decrypted with a predefined secret(which should be difficult to)")),(0,o.kt)("p",null,"Now to put all the 3 part together we base64 encode all of them separated by a dot(.) so it would look something like:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note"),": This example was taken from ",(0,o.kt)("a",{parentName:"p",href:"https://jwt.io/#debugger-io"},"jwt.io")," and you should check that website out if you want to learn more about JWT."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Exploitation")),(0,o.kt)("p",null,'If used properly this is a very secure way of authorization but the problem is with using is "properly". A lot of developers misconfigure their system leaving it open to exploitation.'),(0,o.kt)("p",null,"Now one of the methods to exploit this is to perform a brute force/dictionary attack and find the secret used for encrypting the JWT token and then used that to generate new tokens. But here we are not going to do that, we are going to see a very amazing way of exploiting this."),(0,o.kt)("p",null,"If you remember, in the Header section I said that the ",(0,o.kt)("strong",{parentName:"p"},"alg")," can be whatever the algorithm is used and also it can be ",(0,o.kt)("strong",{parentName:"p"},"None")," if no encryption is to be used. Now, this should not be used when the application is in production but again the problem of misconfiguration comes in and make the application vulnerable to this kind of attack. The attack is that an attacker can log in as low privilege user says ",(0,o.kt)("strong",{parentName:"p"},"guest")," and then get the JWT token for that user and then decode the token and edit the headers to use set ",(0,o.kt)("strong",{parentName:"p"},"alg")," value to ",(0,o.kt)("strong",{parentName:"p"},"None"),". This would mean that no encryption has to be used therefore the attacker wouldn't need to the secret used for encryption."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Practical")),(0,o.kt)("p",null,"Let's see this method in practice. For this challenge visit the port 5000."),(0,o.kt)("p",null,"It is a very simple login page and in that, you can log in via two users: user and user2. Now first let's try to login with the credentials of ",(0,o.kt)("strong",{parentName:"p"},"user:user")," . To do so first enter those credentials then click on the ",(0,o.kt)("strong",{parentName:"p"},"Authenticate")," button and then enable the capture in burp suite and then click on ",(0,o.kt)("strong",{parentName:"p"},"the Go")," button. In the burp tab, you should see a request to ",(0,o.kt)("strong",{parentName:"p"},"/protected")," and there you'll see the JWT token."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/sLKHY9V.png",alt:null})),(0,o.kt)("p",null,"Now take this JWT token and then you can decode it part by part."),(0,o.kt)("p",null,"So if we decode the first part, which will do: ",(0,o.kt)("inlineCode",{parentName:"p"},'{"typ":"JWT","alg":"HS256"}')),(0,o.kt)("p",null,"and decoding the 2nd part, we will get: ",(0,o.kt)("inlineCode",{parentName:"p"},'{"exp":1586620929,"iat":1586620629,"nbf":1586620629,"identity":1}')),(0,o.kt)("p",null,"If you try to decode the 3rd part then you'll get some gibberish. But that is okay we only need the first and the second part."),(0,o.kt)("p",null,"Now if we notice the ",(0,o.kt)("strong",{parentName:"p"},"identity")," value that is probably being used to identify the user but if you'll just edit that then it won't work because as I said the 3rd part is encrypted. So to bypass this we will make changes in the header as well as the value of the identity."),(0,o.kt)("p",null,"Encode the following string with base64 and that will be our first part"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},'{"typ":"JWT","alg":"NONE"}')),(0,o.kt)("p",null,"For the second part, we'll encode the following string: ",(0,o.kt)("inlineCode",{parentName:"p"},'{"exp":1586620929,"iat":1586620629,"nbf":1586620629,"identity":2}')),(0,o.kt)("p",null,"Notice how we changed the value of ",(0,o.kt)("strong",{parentName:"p"},"identity")," from ",(0,o.kt)("strong",{parentName:"p"},"1")," to ",(0,o.kt)("strong",{parentName:"p"},"2"),".\nSince we placed the alg value to None we don't have to add a 3rd part or the encrypted value so we can just put a dot(.) after 2nd part and leave it like that. So the final string would look like:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"eyJ0eXAiOiJKV1QiLCJhbGciOiJOT05FIn0K.eyJleHAiOjE1ODY3MDUyOTUsImlhdCI6MTU4NjcwNDk5NSwibmJmIjoxNTg2NzA0OTk1LCJpZGVudGl0eSI6MH0K.")),(0,o.kt)("p",null,"Now open the developer's tools in your browser and edit the stored cookie of the website to this new one and then just press the Go button and you'll notice that it will prompt \"Welcome user2: guest2\"."),(0,o.kt)("p",null,"In a similar manner, you can try to play and find other users on the website."),(0,o.kt)("p",null,"This kind of misconfiguration in the authentication system is common and could be exploited to escalate privileges or steal information."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Use the same method to find identity of admin user and retrieve the flag?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/Authenticate$ ./jwt.sh 0\nWelcome admin: 92498880383088033228\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"92498880383088033228")),(0,o.kt)("h2",{id:"task-5-no-auth"},"Task 5 No Auth"),(0,o.kt)("p",null,"In this I am going to show you how a lot of systems don't even have proper authentication and their system is just left open for anyone to exploit it."),(0,o.kt)("p",null,"A lot of time on websites we see that when we register a user and login with our credentials we are given a certain id which either is completely a number or ends with a number. Most of the time developers secures their application but sometime in some places, it could happen that just by changing that number we are able to see some hidden or private data."),(0,o.kt)("p",null,"To test this go to port ",(0,o.kt)("strong",{parentName:"p"},"7777"),". On that just create an account. Once the account is created visit your ",(0,o.kt)("strong",{parentName:"p"},"Private Space"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://imgur.com/RzRzvpx",alt:null})),(0,o.kt)("p",null,"As you can see in the image above the URL have ",(0,o.kt)("strong",{parentName:"p"},"/users/1"),". Try to change that value to 2 and we will get access to the admin account"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/TAkXZ4b.png",alt:null})),(0,o.kt)("p",null,"The chance of finding this kind of vulnerability is very low but it could be a very serious bug if you get lucky and found something like this."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Find the way to get into superadmin ad")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"What is the password for superadmin account?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'kali@kali:~/CTFs/tryhackme/Authenticate$ curl http://10.10.7.33:7777/users/0\n<!DOCTYPE html>\n<html>\n<head>\n\n<meta charset="utf-8">\n<meta name="viewport" content="width=device-width, initial-scale=1">\n<title>No Auth</title>\n\n<link href="/static/css/bootstrap.min.css" rel="stylesheet">\n<link href="/static/css/styles.css" rel="stylesheet">\n\n</head>\n\n<body>\n\n\n<div class="row">\n        <div class="col-lg-7 col-sm-offset-2">\n                <div class="panel panel-default">\n                        <div class="panel-heading">Hello superadmin!</div>\n                        <div class="panel-body">\n                                <div class="col-md-6">\n                                        <form method="post" action="/home" enctype="multipart/form-data">\n                                                        <div class="form-group">\n                                                        <p><h3>Your password: </h3>abcd1234</p>\n                                                        <p><h3>Your secret data: </h3>Here&#39;s your flag: 72102933396288983011</p>\n                                        </div>\n                                </div>\n                                </form>\n\n                        </div>\n                </div>\n        </div>\x3c!-- /.col--\x3e\n</div>\x3c!-- /.row --\x3e\n\n\n        <script src="/static/js/jquery-1.11.1.min.js"><\/script>\n        <script src="/static/js/bootstrap.min.js"><\/script>\n</body>\n\n</html>\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"abcd1234")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"What is the flag you found in superadmin account?")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"72102933396288983011")))}c.isMDXComponent=!0}}]);