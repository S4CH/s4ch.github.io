{{- define "main" }}

{{- if .Site.Params.homeInfoParams }}
<article class="first-entry home-info">
    <header class="entry-header">
        <h1>{{ .Site.Params.homeInfoParams.Title | markdownify }}</h1>
    </header>
    <div class="entry-content">
        {{ .Site.Params.homeInfoParams.Content | markdownify }}
    </div>
    <footer class="entry-footer">
        <div class="social-buttons">
            {{- range .Site.Params.social }}
            <a href="{{ .url }}" target="_blank" rel="noopener noreferrer me" class="social-button" title="{{ .name }}">
                {{ .name }}
            </a>
            {{- end }}
        </div>
    </footer>
</article>
{{- end }}

{{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}
{{- $pages = where $pages "Params.hidden" "!=" true }}
{{- $pages = $pages | first 3 }}

{{- if gt (len $pages) 0 }}
<header class="page-header">
    <h2>Featured Research</h2>
</header>
{{- end }}

{{- range $pages }}
<article class="post-entry">
    <header class="entry-header">
        <h3>
            <a href="{{ .Permalink }}">{{ .Title }}</a>
        </h3>
    </header>
    <div class="entry-content">
        <p>{{ .Summary | plainify | htmlUnescape | truncate 120 }}...</p>
    </div>
    <footer class="entry-footer">
        <time>{{ .Date.Format "January 2, 2006" }}</time>
        {{- if (.Param "ShowReadingTime") }}
        <span>&nbsp;·&nbsp;{{ .ReadingTime }} min read</span>
        {{- end }}
    </footer>
</article>
{{- end }}

{{- if gt (len $pages) 0 }}
<footer class="page-footer">
    <nav class="pagination">
        <a class="next" href="{{ "/research" | absURL }}">
            View All Research →
        </a>
    </nav>
</footer>
{{- end }}

{{- end }}{{/* end main */}}
